{"id":"fdfd89cb-546c-4212-85f7-d848dc37a075","version":"1.0.750","icon":"other","splash":"other","splashdata":{"img":"Servelec hsc Logo - RGB.png","bg":"#ffffff"},"settings":{"router":{"mode":"single","animation":"off"},"theme":"","push-notifications":{"android":{"enabled":true,"id":"888020801908"},"ios":{"enabled":true},"wp":{"enabled":false}},"provisioning":{"enabled":false,"manifest":"","poll":2,"manual":false,"wifionly":true},"crashReporting":{"enabled":false,"androidEnabled":false,"iosEnabled":false,"splunkAndroidApiKey":"","splunkIosApiKey":"","splunkExtraData":""},"kioskMode":{"enabled":false},"loading-message":false,"encryption":false,"logging":{"enabled":false,"bufferFrequency":100,"defaultRootLogLevel":"error","defaultMaxFileSizeKilobyte":1000,"defaultMaxFiles":5,"appEnabled":true,"appUseDefault":true,"appRootLogLevel":"error","appMaxFileSizeKilobyte":1000,"appMaxFiles":5,"clientEnabled":true,"clientUseDefault":true,"clientRootLogLevel":"error","clientMaxFileSizeKilobyte":1000,"clientMaxFiles":5,"nativeEnabled":true,"nativeUseDefault":true,"nativeRootLogLevel":"error","nativeMaxFileSizeKilobyte":1000,"nativeMaxFiles":5},"plugins":{"builtIn":{"cordova-plugin-whitelist@1.2.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-battery-status@1.2.4":{"override":false,"used":false,"enabled":false},"cordova-plugin-console@1.0.3":{"override":false,"used":true,"enabled":true},"cordova-plugin-contacts@2.1.0":{"override":false,"used":false,"enabled":false},"cordova-plugin-device@1.1.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-device-motion@1.2.1":{"override":false,"used":false,"enabled":false},"cordova-plugin-device-orientation@1.0.3":{"override":false,"used":false,"enabled":false},"cordova-plugin-file@4.2.0":{"override":false,"used":true,"enabled":true},"cordova-plugin-geolocation@2.2.0":{"override":true,"used":false,"enabled":true},"cordova-plugin-globalization@1.0.3":{"override":false,"used":true,"enabled":true},"commontime-cordova-plugin-inappbrowser@1.6.2":{"override":false,"used":false,"enabled":false},"cordova-plugin-network-information@1.2.1":{"override":true,"used":false,"enabled":true},"cordova-plugin-splashscreen@3.2.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-vibration@2.1.4":{"override":false,"used":false,"enabled":false},"cordova-plugin-statusbar@1.0.1":{"override":false,"used":true,"enabled":true},"cordova-plugin-camera@2.3.1":{"override":false,"used":true,"enabled":true},"phonegap-plugin-barcodescanner@6.0.4":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.thumbnail@1.4.8":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.fileimporter@1.0.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-opener@1.0.11":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.beacon@1.0.6":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.notification@1.0.12":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.audio@0.9.11":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.media-properties@1.2.11":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.splitscreen@1.1.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.preferences@1.0.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.authentication@1.0.8":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.urlhandler@1.1.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.securesettings@1.0.2":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.geofence@0.5.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-transfer@1.5.5":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.public.provisioning@0.0.13":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.insomnia@0.0.15":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.splunk-mint@1.0.3":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.kiosk@1.0.11":{"override":false,"used":false,"enabled":false},"cordova-android-movetasktoback@0.1.3":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.logging@1.0.24":{"override":false,"used":true,"enabled":true},"cordova-plugin-email":{"override":false,"used":true,"enabled":true},"cordova-android-crosswalk-webview@2.3.0":{"override":false,"enabled":false},"cordova-plugin-emm-app-config@1.0.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.public.messaging@0.0.42":{"override":false,"used":true,"enabled":true},"cordova-plugin-battery-status@1.1.2":{"override":false,"used":false,"enabled":false},"cordova-plugin-vibration@2.1.1":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-opener@1.0.8":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.notification@1.0.11":{"override":true,"used":true,"enabled":false},"com.commontime.cordova.audio@0.9.10":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.insomnia@0.0.6":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.public.messaging@0.0.44":{"override":true,"used":true,"enabled":false}},"customPlugins":{"cordova-plugin-android-fingerprint-auth":{"id":"cordova-plugin-android-fingerprint-auth","name":"cordova-plugin-android-fingerprint-auth","version":"1.3.1","description":"Cordova plugin to use Android fingerprint authentication API","spec":"1.3.1"},"cordova-plugin-media-capture":{"id":"cordova-plugin-media-capture","spec":"1.4.1","preferences":{},"variables":{"PHOTOLIBRARY_USAGE_DESCRIPTION":"This app would like to access your photo library.","CAMERA_USAGE_DESCRIPTION":"This app would like to use the camera.","MICROPHONE_USAGE_DESCRIPTION":"This app would like to record audio."}},"Messaging":{"id":"Messaging","spec":"https://github.com/commontime/com.commontime.cordova.public.messaging#0.0.47","version":"0.0.47"},"cordova-plugin-ionic-webview":{"id":"cordova-plugin-ionic-webview","spec":"1.1.16","name":"Ionic Webview","description":"Ionic Webview","version":"1.1.16"},"cordova-plugin-privacyscreen":{"id":"cordova-plugin-privacyscreen","name":"cordova-plugin-privacyscreen","version":"0.4.0","description":"Secures your app from displaying a screenshot in task switchers under Android and iOS. Keeps sensitive information private.","spec":"0.4.0"},"cordova-plugin-touch-id":{"id":"cordova-plugin-touch-id","name":"cordova-plugin-touch-id","version":"3.3.1","description":"Scan the fingerprint of your user with the TouchID sensor, or the user's Face with Face ID on iPhone X","spec":"3.3.1"},"com.commontime.cordova.notification":{"spec":"https://github.com/commontime/com.commontime.cordova.notification#1.0.19","id":"com.commontime.cordova.notification","preferences":{"inAppPush":"immediate"}},"cordova-plugin-file-opener2":{"id":"cordova-plugin-file-opener2","spec":"https://github.com/pwlin/cordova-plugin-file-opener2.git","name":"cordova-plugin-file-opener2","version":"2.0.19"}}},"minimise-on-back-button":true},"language":{"defaultLocale":"en_GB","initialLanguage":"","useDeviceLocale":true},"metadata":{"googleMapsApiKey":"AIzaSyAMKVGS1wSBbEoAS4YHT6opiiu72ZKmPaU","applicationkey":"rwk_test","startDebug":"false","logDebug":"true","latitude":"53.3125156","longitude":"-1.3461527"},"name":"Community_Worker","packageId":"com.servelec.elft.communityworker","schemaVersion":22,"minimumStudioVersion":"3.1.0","pages":[{"start":true,"name":"Login","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"86b36f34-9434-4a6b-9a85-fd7be7d021f3","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"// Grab and set current location\ncti.fn_get_location()\n\n// if (!cti.store.pages.Login) {\n//   cti.store.pages.Login = {\n//     username: '',\n//     password: ''\n//   }\n// }\n//cti.store.pages.Login.username = 'Ccommon'\n//cti.store.pages.Login.password = 'password'\n\n// In case we've arrived here via the Logout button, stop the click listener.\ncti.fn_stopActivityListener()\n\n$success()"},"_auto_id_":"c160d023-af2f-4659-9d6d-1e2a5143aa92","actions":[]}]}],"content":[{"name":"header","type":"area","item-type":"static","_auto_id_":"01018c7b-5e7c-447c-b3a1-33cb688d9140","content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"0b808f73-13cf-424f-ba82-b7a9249ec750","attributes":{},"actions":[],"expressions":{}},{"name":"html_splash","type":"content","item-type":"html","_auto_id_":"b654e93f-37f6-4a67-8f9b-7267585a78b8","content":"<div class=\"header\">\n  <div class=\"logo\"/>\n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_instructions","type":"content","item-type":"html","_auto_id_":"9028f643-e817-4a40-8a96-b2c8c311d8cd","content":"<div class=\"splash\">\n  <div class=\"riologo\"/>\n</div>\n<h3>Log In</h3>\n<h5>Please enter your RiO username and password</h5>","expressions":{}},{"name":"group_login","type":"area","item-type":"group","_auto_id_":"fe42e81d-18db-4c55-bc5b-3cfd3fbff666","content":[{"name":"username","type":"user-input","item-type":"text","_auto_id_":"4dd96e2f-9884-4077-a492-a78f629ffc78","label":"","required":false,"multiline":false,"debounce":1000,"placeholder":"Username","expressions":{"disabled":"$store.variables.v_isAuthenticated"},"message":"This is a required field","classes":"minimal","validators":[{"name":"hasValue","message":"Required","type":"custom","content":"function(modelValue, viewValue) {\n return (typeof viewValue == \"string\" && viewValue.length > 0) || viewValue === undefined;\n}"}],"actions":[{"event":"enter","type":"inline-function","data":{"sync":true,"code":"const btn = document.querySelector('a#button_login')\n\nif (btn) {\n  btn.click()\n}"},"_auto_id_":"79d36292-817b-4052-88b4-689de1a0a00a"}]},{"name":"password","type":"user-input","item-type":"password","_auto_id_":"046b3990-2f23-42d4-9bf4-30433450a780","label":"","required":false,"message":"This is a required field","expressions":{"disabled":"$store.variables.v_isAuthenticated"},"placeholder":"Password","classes":"minimal","actions":[{"event":"enter","type":"inline-function","data":{"sync":true,"code":"const btn = document.querySelector('a#button_login')\n\nif (btn) {\n  btn.click()\n}"},"_auto_id_":"41f250f2-2d73-4d81-ab79-84511f6023a4"}],"validators":[{"name":"hasValue","message":"Required","type":"custom","content":"function(modelValue, viewValue) {\n return (typeof viewValue == \"string\" && viewValue.length > 0) || viewValue === undefined;\n}"}]},{"name":"button_login","type":"button","item-type":"button","_auto_id_":"142af861-6014-43d5-82eb-3481308fb777","content":"Login {{'$store.variables.online ? \"\" : \"(offline)\"' | store}}","theme":"minimal","expressions":{"disabled":"!$store.pages.Login || !$store.pages.Login.username || !$store.pages.Login.password"},"actions":[{"type":"if","data":{},"_auto_id_":"47cf2f73-731f-4100-8226-6784012bb41b","operations":[{"type":"value","content":"{{($store.variables.v_isAuthenticated) ? 1 : 0}}","$selected":false},{"type":"operator","content":"==","$selected":false},{"type":"value","content":"0","$selected":false}]},{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_login - page Login', \n  'info'\n);\n\n//create base64 encoded string from username and password for the API\ncti.fn_toggle_spinner('open', 'Authenticating...');\n\nvar auth = window.btoa(cti.store.pages.Login.username + ':' + cti.store.pages.Login.password);\ncti.store.variables.auth_header = auth;\n$success();"},"_auto_id_":"08090e2d-945b-40fd-a6da-d021fea2683a","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"authenticate","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"b7819afc-1cb8-48aa-9264-a7b2c61da33f","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('close');\n\nif($data.$response.success) {\n  window.logManager.consoleLog(\n    'API CALL: /authenticate | SUCCESS', \n    'info'\n  );\n\n  cti.store.variables.v_isAuthenticated = true\n  cti.store.variables.firstLogin = true\n  \n  // Retain the username (we need it for registering for push initially but may require it elsewhere).\n  cti.store.variables.loggedInUser = cti.store.pages.Login.username\n\n  cti.utils.callAction(\"call-actionflow\", { name: \"RegisterPush\" });\n} else {\n  window.logManager.consoleLog(\n    'API CALL: /authenticate | FAIL: Reason - ' + $data.$response.message, \n    'error'\n  );\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Authentication failed\", \n    \"text\" : \"Please check your username and password are correct.\"\n  });\n  \n  cti.store.variables.v_isAuthenticated = false;\n}"},"_auto_id_":"8079bba7-954a-4185-8f7d-7e11ac44ada4","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('close');\n\nwindow.logManager.consoleLog(\n  'API CALL: /authenticate | FAIL: Reason - ' + $data.$response.message, \n  'error');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to connect to the server.\"\n});\n\ncti.store.variables.v_isAuthenticated = false;"},"_auto_id_":"727ea512-95a8-4f61-83e4-6dbe30e5ed3e"}]},{"type":"otherwise","data":{},"_auto_id_":"9e8f21b6-626d-4860-894c-8f52b1d60898"},{"event":"click","type":"call-function","data":{"name":"fn_onAppResume"},"_auto_id_":"8e34befc-f635-4ed4-9e20-148a8a24e13d"},{"type":"end-if","data":{},"_auto_id_":"1c7c1732-3b31-49d2-97d4-864aa79093a8"}],"classes":"default"},{"name":"button_revoke","type":"button","item-type":"button","_auto_id_":"36378ef0-cf4f-4efe-a315-2aaf8741046e","content":"Revoke Authentication","theme":"minimal","expressions":{"show":"$store.variables.v_isAuthenticated"},"actions":[{"event":"click","type":"call-actionflow","data":{"name":"RevokeAuthentication"},"_auto_id_":"0b7daa6b-a61b-4e3e-a9f6-290e59dbec7f"},{"event":"click","type":"call-actionflow","data":{"name":"DeregisterPush"},"_auto_id_":"24dfa839-4679-4dc7-b87e-cd42f962c2de"}]}],"repeat":false,"expressions":{}},{"name":"popupRetry","type":"component","item-type":"web-component","content":[{"name":"html_warnings","type":"content","item-type":"html","_auto_id_":"d9deaf6c-9e60-4a8a-a44a-44d8af270daf","content":"<h2>Initial Download Data Failed</h2>\n<p>There was an issue downloading the patient information data on Login. Please try again or, if you continue to have problems, contact support.</p>","expressions":{},"classes":""},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"9c755aaf-1f59-4f7a-bbff-82d775b6351b","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel","type":"button","item-type":"button","_auto_id_":"e0614259-6daf-4549-ae95-37b32c068ae0","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Login","componentInstanceId":"723ae197-d492-49b6-bde1-ca129f5b4626","function":"toggle"},"_auto_id_":"7f4dc293-ddcf-48d1-a748-aa0cbf39b9d4"}]},{"name":"button_retry","type":"button","item-type":"button","_auto_id_":"5a68be9a-8e93-4d78-9e7f-0ce15431a453","content":"RETRY","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_end_visit_1 - page Login', \n  'info'\n);\n\ncti.fn_toggle_spinner('open', 'Downloading Application Data, please wait...');\ncti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n\n$success();"},"_auto_id_":"8b87ce67-1c9d-4a10-b407-b61125bcbaf1"},{"event":"click","type":"call-component-function","data":{"page":"Login","componentInstanceId":"723ae197-d492-49b6-bde1-ca129f5b4626","function":"toggle"},"_auto_id_":"338d843b-89a3-46bf-8f89-bbfbceb4f897"}],"classes":"default"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"688e3c51-5116-47d9-aaa6-683bb3cdecdb","attributes":{},"expressions":{}}],"_auto_id_":"a7d34642-eb8f-418e-957b-06e15c4dbe62"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_version","type":"content","item-type":"html","_auto_id_":"e445ba9a-0368-4a49-8127-49996331fd62","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"_auto_id_":"a97c5346-c869-4c92-83e7-a2028537b234","expressions":{}}],"_auto_id_":"ee541b42-dc35-46ed-b42f-9209acd3af93"},{"start":false,"name":"Visits","config":[{"name":"Page Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"6fc663b9-c23a-4d5e-bb23-8077031375bf","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'Page On-Loaded: Visits', \n  'info'\n)\n\n// Create and append slip js stuff to the Visits list\nvar ol = $('#Visits #list_visits ul')[0];\n\nol.addEventListener('slip:beforereorder', function(e){\n  if (/demo-no-reorder/.test(e.target.className)) {\n    e.preventDefault();\n  }\n}, false);\n\nol.addEventListener('slip:beforewait', function(e){\n  if (e.target.className.indexOf('instant') > -1) e.preventDefault();\n}, false);\n\nol.addEventListener('slip:reorder', function(e){\n  var ul = e.target.parentNode;\n  var apts = cti.store.variables.v_selectedDayAppointments;\n  \n  apts.splice(e.detail.spliceIndex, 0, apts.splice(e.detail.originalIndex, 1)[0]);\n  for (var i = 0; i < apts.length; i++) {\n    apts[i].index = i;\n  }\n  cti.utils.updatePage();\n\n  cti.utils.callAction(\"call-function\", {\"name\":\"fn_render_map\"});\n  \n  return false;\n}, false);\n\n// Initialise slip\nnew Slip(ol);\n\n// Clear down excess data\nif(cti.store.variables.clearDown) {\n  delete cti.store.variables.clearDown\n  \n  delete cti.store.variables.duration_hours\n  delete cti.store.variables.duration_minutes\n\n  delete cti.store.variables.selected_visit\n  delete cti.store.variables.timeline\n\n  delete cti.store.variables.v_appointmentSyncFromDate\n  delete cti.store.variables.v_appointmentSyncTomDate\n\n  delete cti.store.variables.v_planner\n  delete cti.store.variables.visit_view_mode\n}\n\n// Kick off the Google Maps initialisation process\n// Calls fn_init_google_maps to check that we have maps installed...\n// ... then we execute fn_render_map on the callback of that function\nvar setMaps = cti.fn_init_google_maps(\"cti.fn_render_map\")\n\n// Hack: The Google map URL callback does not execute if the map is already added in the header script tag\nif(!setMaps) {\n  cti.fn_render_map()\n}\n\nif(cti.store.variables.v_outcomePayload_clear) {\n  delete cti.store.variables.selected_visit\n  delete cti.store.variables.v_outcomePayload_clear\n  delete cti.store.variables.o_activities\n  cti.utils.destroyPageData('Outcome')\n}\n\nif(cti.store.variables.selected_visit_clear) {\n  delete cti.store.variables.selected_visit_clear\n  delete cti.store.variables.selected_visit\n  cti.fn_toggle_spinner('open', 'Refreshing Appointment list, please wait...')\n  cti.fn_toggle_spinner('close', '', 1000)\n}\n\nif(cti.store.variables.return) {\n  delete cti.store.variables.return\n  delete cti.store.variables.selected_visit\n}\n\nfor(var i in cti.store.variables.v_selectedDayAppointments) {\n  var appointment = cti.store.variables.v_selectedDayAppointments[i]\n  var postcode = appointment.postCode.replace(/\\s/g,'')\n  var id = 'travel-container-' + i\n \n  var travelContainer = document.getElementById(id)\n  \n  if (travelContainer) {\n    if(navigator.appVersion.indexOf('Android') != -1) { \n      travelContainer.onclick = function() {\n        cti.fn_navigate(postcode)\n      }\n    } else {\n      travelContainer.href = \"maps:0,0?q=\" + postcode\n    }\n  } else {\n\tconsole.log(`Could not find ${id} in DOM, could not set click event or href.`)\n  }\n}\n\n$success()"},"_auto_id_":"a2be9697-ce70-40e8-b0fc-70e2614b1306","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"title","type":"content","item-type":"title","content":"<h4>{{'$store.variables.v_appointmentDateText' | store}}'s Visit List</h4>","_auto_id_":"42b56a8b-8d39-464d-becd-20cc3f2c8f9e"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"17563042-ccfc-48b7-acab-51b40a8b2c23","content":"","theme":"minimal","left-icon":"fa-bars","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"fn_openContentMenu"},"_auto_id_":"7f27f441-21df-4873-a906-a7f657abf3c7"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"c7a1b487-5df5-4a7d-94d7-1cdf2acbd0d2","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"fbf35c34-a8a8-413b-b870-602f1779a023","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"5e5fcf70-9ba2-4302-9ebe-390ec4bc63fc"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"f6c36260-1a34-406a-99cb-13afee8edfcd","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"9d29a9dc-cd81-4b0b-a2d6-62a4955bba76"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"c4a3b041-fef1-4ad1-89d5-73076549f7ab","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"2bbf8169-f971-4ae9-a5b8-69de3344c3d1","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"e4ed0868-a22e-4604-bd86-44325a0dc804","attributes":{"Direction":"right","MinWidth":null,"Overlay":true},"actions":[],"expressions":{},"classes":""}],"_auto_id_":"eaae86e5-df63-473e-8d40-39058d032a4d","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"64c7e408-bb07-40ca-ae25-f9e886b16e36","content":[{"name":"row_date","type":"area","item-type":"row","_auto_id_":"3e174c6c-07ad-486e-b707-f5b702421dc6","content":[{"name":"button_yesterday","type":"button","item-type":"button","_auto_id_":"b1dbbfa5-4fcf-4f02-a8de-a3cc9af53321","content":"","theme":"minimal","expressions":{"disabled":"$store.variables.v_appointmentDateText == \"Yesterday\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_yesterday - page Visits', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Loading Yesterday\\'s Appointment Data...')\n\nvar newDisplayDate = moment().subtract(1, 'days').format(\"YYYY-MM-DD\")\n\ncti.store.variables.v_appointmentDate = newDisplayDate\ncti.store.variables.v_appointmentDateText = 'Yesterday'\n\ncti.fn_load_appointments()\n\ncti.utils.updatePage()\n$success()"},"_auto_id_":"5af121fe-67ca-4cd2-930b-c4d0722c29a7","actions":[]}],"left-icon":"fa-arrow-circle-o-left"},{"name":"button_today","type":"button","item-type":"button","_auto_id_":"16ef23d6-afed-41e9-8bd6-b1bae5b9f085","content":"","theme":"minimal","expressions":{"disabled":"$store.variables.v_appointmentDateText == \"Today\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_today - page Visits', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Loading Today\\'s Appointment Data...')\n\nvar newDisplayDate = moment().format(\"YYYY-MM-DD\")\ncti.store.variables.v_appointmentDate = newDisplayDate\ncti.store.variables.v_appointmentDateText = 'Today'\n\ncti.fn_load_appointments()\n\ncti.utils.updatePage()\n$success()"},"_auto_id_":"0fc96914-d785-4bf5-90ce-548834398062"}],"left-icon":"fa-calendar"},{"name":"button_tomorrow","type":"button","item-type":"button","_auto_id_":"6e6a70a1-b578-4c0d-899e-b37d9333aa03","content":"","theme":"minimal","expressions":{"disabled":"$store.variables.v_appointmentDateText == \"Tomorrow\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_tomorrow - page Visits', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Loading Tomorrow\\'s Appointment Data...')\n\nvar newDisplayDate = moment().add(1, 'days').format(\"YYYY-MM-DD\")\ncti.store.variables.v_appointmentDate = newDisplayDate\ncti.store.variables.v_appointmentDateText = 'Tomorrow'\n\ncti.fn_load_appointments()\n\ncti.utils.updatePage()\n$success()"},"_auto_id_":"f641117f-29c4-40af-990c-f23796e35fe1","actions":[]}],"right-icon":"fa-arrow-circle-o-right"}],"expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"row_no_appointments","type":"area","item-type":"row","_auto_id_":"088aa07c-3b94-42ef-9f6f-4e085750b340","content":[{"name":"html_no_appointments","type":"content","item-type":"html","_auto_id_":"6dcd2038-94f5-4fc0-90fe-6c2000ac400c","content":"<div id=\"no-appointment\">No appointments</h3>","expressions":{"show":"$store.variables.v_selectedDayAppointments.length == 0;"}}],"expressions":{"show":"$store.variables.v_selectedDayAppointments.length == 0;"}},{"name":"list_visits","type":"content","item-type":"list","_auto_id_":"6c148268-a662-43a9-afff-b0c6eae9af38","search":"","classes":"","expressions":{"show":"$store.variables.orientation == 'landscape' || $store.variables.visit_list_view_mode == 'list'"},"model":"$store.variables.v_selectedDayAppointments","theme":"bootstrap","actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"name":"group_visit","type":"area","item-type":"group","_auto_id_":"6cd2e94a-f212-4f54-bf3b-67d4355326d5","content":[{"type":"content","item-type":"html","name":"list_visits_html","_auto_id_":"e93fa009-d32c-41c4-aa80-11d737936213","content":"<div onclick=\"cti.fn_toggle_visit_menu(this.id)\" id=\"{{$data}}\">\n  <div class=\"appointmentPinContainer {{$data.$item.status}}\">\n    <div class=\"pin\">{{$data.$item.index + 1}}</div>\n  </div>\n  <div class=\"listheading patientName\" id=\"collapsible-row-{{$data.$item.$index}}\">{{$data.$item.displayName}}</div>\n  <div class=\"nhsNumber\">NHS No. {{$data.$item.nhsNumFormatted}}</div>\n  <div class=\"subtle appointmentType\" id=\"collapsible-row-{{$data.$item.$index}}\">{{$data.$item.appointmentType.value}}</div>  <div class=\"appointmentTime\">{{$data.$item.shortTime}} - {{$data.$item.shortEndTime}}</div>\n  </div>\n</div>","expressions":{},"classes":"row-collapsed instant"},{"name":"group_row_buttons","type":"area","item-type":"group","_auto_id_":"073fb60d-cb27-43bd-ab96-e9984aeb7ba9","content":[{"name":"button_eta","type":"button","item-type":"button","_auto_id_":"652e8e4f-f1b5-4213-945f-4311522dcee3","content":"Send ETA","theme":"default","expressions":{"show":"0"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_eta - page Visits', \n  'info'\n);\n\ncti.store.variables.v_selectedRowIndex = $data.$index;\n\nif($store.variables.appointments[$store.variables.v_selectedRowIndex].patientData.demographics.mobilePhoneNumber === undefined){\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Mobile Number Unavailable\", \n    \"text\" : \"The patient does not have a mobile phone number on record.\"\n  });\n} else {\n  cti.store.pages.Visits.txtEtaMessage = \"Estimated Time of Arrival is \" + cti.store.variables.appointments[$data.$index].appointmentEta; \n  $success();\n}"},"_auto_id_":"312a047d-3497-463c-8995-a37ac9efad1b","actions":[]},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"1b59cf67-5dcf-4c48-8edd-6412937642aa","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"88660ad1-c15b-4424-ad38-3176c3428711"}],"classes":""},{"name":"button_call","type":"button","item-type":"button","_auto_id_":"144a84e4-8a97-432e-b929-201eccfc833a","content":"Call","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call - page Visits', \n  'info'\n)\n\ncti.store.variables.v_selectedRowIndex = $data.$index\n$success()"},"_auto_id_":"4b5c9bdb-3014-418d-820e-fb339b4ac970","actions":[]},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"0e36569c-e89c-4a86-beed-d8cc525771a2","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"3e20a685-60ea-4012-9277-465181a3838c"}]},{"name":"button_navigate","type":"button","item-type":"button","_auto_id_":"0b02974c-d823-46cc-a023-58a29eb2382d","content":"Navigate","theme":"default","expressions":{"show":"false"},"classes":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_navigate - page Visits', \n  'info'\n)\n\ncti.fn_navigate($data.$item.postCode)"},"_auto_id_":"a26188d1-a7af-407e-9ce9-46d7cb851667"}]},{"name":"nav_button","type":"content","item-type":"html","_auto_id_":"5775a0f5-0ce0-4ece-8487-40693f606873","content":"<a target=\"_blank\" class=\"btn btn-default default\" id=\"travel-container-{{$data.$index}}\" style=\"margin-top:10px\">Navigate</a>","expressions":{}}],"repeat":false,"expressions":{},"classes":"group_row_buttons"},{"name":"button_open","type":"button","item-type":"button","_auto_id_":"0ba8727b-c45d-4326-87d8-01a23f62c6ef","content":"","theme":"minimal","right-icon":"fa-chevron-right","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_open - page Visits', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Loading Appointment...')\n\n// Check our orientation view\ncti.store.variables.visit_view_mode = 'Menu'\n\n// Set our selected_visit variables\ncti.store.variables.selected_visit = {\n  appointmentId : $data.$item.appointmentId,\n  nhsNumFormatted : $data.$item.nhsNumFormatted,\n  displayName : $data.$item.displayName,\n  birthDateFormatted : $data.$item.birthDateFormatted\n}\n\n// Load appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  var appointments = doc.data\n  \n  var visitObj = JSON.parse(JSON.stringify(cti.store.variables.selected_visit))\n\n  // On a successful match append the patientData to the selected_visit\n  for(var i in appointments) {\n    if(appointments[i].appointmentId == cti.store.variables.selected_visit.appointmentId) {\n      cti.store.variables.selected_visit = appointments[i]\n      break\n    }\n  }\n  \n  cti.store.variables.selected_visit.displayName = visitObj.displayName\n  cti.store.variables.selected_visit.nhsNumFormatted = visitObj.nhsNumFormatted\n  \n  // Prepare the timeline and form variables\n  cti.fn_prep_timeline()\n  cti.fn_prep_forms(cti.store.variables.selected_visit)\n  \n  // Clear down all appointment stacks\n  delete cti.store.variables.v_selectedDayAppointments\n  delete cti.store.variables.v_appointments\n  \n  // Reset form controls\n  delete cti.store.pages.DialogFormOne\n  cti.store.variables.dialogFormFirstRun = false\n  \n  // Navigate to the Visit page\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n  cti.fn_toggle_spinner('close')\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB: Failed retriveing Appointments Data from Pouch - ' + reason + err, \n    'info'\n  )\n  cti.fn_toggle_spinner('close')\n})"},"_auto_id_":"e2a79328-ccf9-4d67-a848-e776be21606d"}],"classes":"button_open"}],"repeat":false,"expressions":{},"classes":"row-collapsed instant"}],"autoscroll":false,"searchFunctionExternal":""},{"name":"html_map_container","type":"content","item-type":"html","_auto_id_":"050e730a-5549-4dab-a84b-b12b98c4bbcc","content":"<div class=\"container-fluid\">\n    <div class=\"row\">\n      <div id=\"mapcontainer\" class=\"col-xs-12\">\n        <div id=\"layersmap\" class=\"embed-responsive\"></div>\n      </div>\n    </div>\n</div>","expressions":{"show":"$store.variables.orientation == 'landscape' || $store.variables.visit_list_view_mode == 'map'"}},{"name":"popupCall","type":"component","item-type":"web-component","content":[{"name":"html_call","type":"content","item-type":"html","_auto_id_":"78caf82c-7c88-437f-8840-77958a69d04e","content":"<h4>Call Patient</h4>\n<!--<p>Use one of the available contact numbers below</p>-->","expressions":{}},{"name":"html_no_numbers","type":"content","item-type":"html","_auto_id_":"9adf9123-c581-4726-8599-4d31abf827f8","content":"<p>There are currently no valid contact numbers for this patient.</p>","expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].mobilePhoneNumber == undefined && $store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].officePhoneNumber == undefined && $store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].eveningPhoneNumber == undefined"}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"02088dbb-a2f4-48de-a8d4-0bf2ef40c513","extends":{"type":"area","item-type":"row"},"content":[{"name":"call_mobile_button","type":"content","item-type":"html","_auto_id_":"cde92e79-7d3c-4a16-97df-9f19a6f79eb8","content":"<a href=\"tel:141{{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].mobilePhoneNumber' | store}}\" target=\"_blank\" class=\"btn btn-default default\" style=\"margin-top:10px\">Mobile - {{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].mobilePhoneNumber' | store}}</a>","expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].mobilePhoneNumber !== undefined"},"classes":""}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].mobilePhoneNumber !== undefined"}},{"name":"button_bar_evening","type":"area","item-type":"button-bar","_auto_id_":"0fdc17e8-df64-4707-bf93-87df24b3591a","extends":{"type":"area","item-type":"row"},"content":[{"name":"call_evening_button","type":"content","item-type":"html","_auto_id_":"e8eec627-3829-4517-9ff4-2f1b650e3b68","content":"<a href=\"tel:141{{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].eveningPhoneNumber' | store}}\" target=\"_blank\" class=\"btn btn-default default\" style=\"margin-top:10px\">Evening - {{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].eveningPhoneNumber' | store}}</a>","expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].eveningPhoneNumber !== undefined"},"classes":""}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].eveningPhoneNumber !== undefined"}},{"name":"button_bar_office","type":"area","item-type":"button-bar","_auto_id_":"c8bc100e-ae27-4386-b3d2-90ce00317df3","extends":{"type":"area","item-type":"row"},"content":[{"name":"call_office_button","type":"content","item-type":"html","_auto_id_":"016687f7-2b3d-46a1-9c59-a23f4b4a6461","content":"<a href=\"tel:141{{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].officePhoneNumber' | store}}\" target=\"_blank\" class=\"btn btn-default default\" style=\"margin-top:10px\">Office - {{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].officePhoneNumber' | store}}</a>","expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].officePhoneNumber !== undefined"},"classes":""}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].officePhoneNumber !== undefined"}},{"name":"button_bar_call","type":"area","item-type":"button-bar","_auto_id_":"6596d6ba-4375-446a-adad-e993fd443324","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel_call","type":"button","item-type":"button","_auto_id_":"4f5feb2f-c53a-491b-b9b4-82b9196d8f36","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"0e36569c-e89c-4a86-beed-d8cc525771a2","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"8d19b017-f522-43c3-bb1c-285427d7ea88"}],"classes":"default"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"0e36569c-e89c-4a86-beed-d8cc525771a2","attributes":{"id":"popupCall"},"expressions":{}}],"_auto_id_":"065a129f-aa1a-4ab0-ad1b-ef88c59c234f","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_list","type":"button","item-type":"button","_auto_id_":"91867942-a7d0-480a-b0cd-065f5785a22e","content":"LIST VIEW","theme":"default","actions":[{"event":"click","type":"set-variable","data":{"name":"visit_list_view_mode","value":"list"},"_auto_id_":"7ba74f1e-62cb-4f3c-b5a0-813666851dcb"}],"expressions":{}},{"name":"button_map","type":"button","item-type":"button","_auto_id_":"bf5a60d3-ba1c-46c9-abec-741c4a1cba6e","content":"MAP VIEW","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_map - page Visits', \n  'info'\n)\n\ncti.store.variables.visit_list_view_mode = \"map\"\n$success()"},"_auto_id_":"962a7c14-bdfb-4c68-b78e-def9f605e810","actions":[]},{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_map - page Visits', \n  'info'\n)\n\nsetTimeout(function(){\n  var center = window.mymap.getCenter()\n  var zoom = window.mymap.getZoom()\n  \n  if(screen.width <= 360) { zoom = 10 }\n  if(screen.width > 360 && screen.width <= 768) { zoom = 12 }\n  else { zoom = 11 }\n  \n  google.maps.event.trigger(window.mymap, \"resize\")\n  window.mymap.setCenter(center)\n  window.mymap.setZoom(zoom == 0 ? 8 : zoom)\n}, 500)\n\n$success()"},"_auto_id_":"92c1adf6-b32e-423f-800e-2d366b159689","actions":[]}],"expressions":{}}],"_auto_id_":"551ee811-c973-432b-90d2-46f4c865eea1","expressions":{}}],"_auto_id_":"911082cf-362b-4d21-bb53-10b3ea22d6ec"},{"start":false,"name":"Visit","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"dd295370-5c41-4ce5-805d-cd0b0a952891","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"// Clear down checks: To avoid displaying the cleared down page, clear it here\nif(cti.store.variables.v_progressNoteToAdd_clear) {\n  delete cti.store.variables.v_progressNoteToAdd_clear\n  if(cti.store.media && cti.store.media.btnPhoto) {\n    cti.store.media.btnPhoto.images = []\n  }\n  delete cti.store.variables.note\n  delete cti.store.variables.uiSubNoteTypes\n  cti.utils.destroyPageData('Note')\n}\n\nif(cti.store.variables.v_alertToAdd_clear) {\n  delete cti.store.variables.v_alertToAdd_clear;\n  cti.utils.destroyPageData('Alert');\n}\n\nif(cti.store.variables.v_alertToRemove_clear) {\n  delete cti.store.variables.v_alertToRemove_clear;\n  delete cti.store.variables.alerts\n  cti.utils.destroyPageData('RemoveAlert');\n}\n\nif(cti.store.variables.v_teamplannerToAdd_clear) {\n  delete cti.store.variables.v_teamplannerToAdd_clear;\n  cti.utils.destroyPageData('Team_Planner');\n}\n\nif(cti.store.variables.v_appointmentToAdd_clear) {\n  delete cti.store.variables.v_appointmentToAdd_clear\n  cti.utils.destroyPageData('HCP_Diary');\n}\n\nif(cti.store.variables.v_submitOutcome_clear) {\n  delete cti.store.variables.v_submitOutcome_clear;\n  cti.utils.destroyPageData('Outcome');\n}\n\nif(cti.store.variables.v_submitDialogFormPayload_clear) {\n  delete cti.store.variables.v_submitDialogFormPayload_clear\n  cti.utils.destroyPageData('DialogFormPre')\n  cti.utils.destroyPageData('DialogFormOne')\n  cti.store.repeater.DialogFormPre = {}\n  cti.store.repeater.DialogFormOne = {}\n}\n\nif(cti.store.variables.v_submitSafetyFormPayload_clear) {\n  delete cti.store.variables.v_submitSafetyFormPayload_clear\n  cti.utils.destroyPageData('SafetyForm')\n}\n\nif(cti.store.variables.v_submitlifestyleFormPayload_clear) {\n  delete cti.store.variables.v_submitlifestyleFormPayload_clear\n  cti.utils.destroyPageData('LifestyleFormOne')\n  cti.utils.destroyPageData('LifestyleFormTwo')\n  cti.utils.destroyPageData('LifestyleFormThree')\n  cti.utils.destroyPageData('LifestyleFormFour')\n  cti.utils.destroyPageData('LifestyleFormFive')\n  cti.utils.destroyPageData('LifestyleFormSix')\n  cti.store.repeater.LifestyleFormThree = {}\n  cti.store.repeater.LifestyleFormFive = {}\n}\n\nif(cti.store.variables.lifeStyleForm_View_clear) {\n  delete cti.store.variables.lifeStyleForm_View_clear\n  delete cti.store.variables.v_lifestyleForms\n  delete cti.store.variables.lifestyleHideFlags\n  cti.utils.destroyPageData('LifestyleForm_View')\n}\n\nif(cti.store.variables.dialogForm_View_clear) {\n  delete cti.store.variables.dialogForm_View_clear\n  delete cti.store.variables.v_dialogForms\n  delete cti.store.variables.dialogHideFlags\n  cti.utils.destroyPageData('DialogForm_View')\n}\n\nif(cti.store.variables.safetyForm_View_clear) {\n  delete cti.store.variables.safetyForm_View_clear\n  delete cti.store.variables.v_safetyForms\n  cti.utils.destroyPageData('SafetyForm_View')\n}\n\nif(cti.store.variables.visit_view_mode == \"Patient Demographics\") {\n  delete cti.store.variables.selected_visit.patientData.patient\n} else if(cti.store.variables.visit_view_mode == \"Alerts\") {\n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n}\n\ncti.store.variables.visit_view_mode = \"Menu\"\n$success()"},"_auto_id_":"e8a966eb-7f7e-407c-9e37-d20391c8a37f","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"cf2043ff-d4a5-43e6-8112-d3fd8f17fac2","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Visit', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"f4a7a1ec-ce29-420a-9c69-b93aa7c2ba2b","actions":[]}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Patient Summary</h4>","_auto_id_":"9c99b334-8f13-4c8b-85d2-553fd126275e"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"d83d412b-7a23-4e79-a0b4-f7afcb43d408","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"4b9eeec5-4015-44ba-a9c4-306ff75e15cc","function":"toggle"},"_auto_id_":"5bd9a473-98b4-4c86-9307-438f2e4b1b2a"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"4f25d519-7e24-4ce3-a24e-8e678c20721a","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"1b799183-db9d-4070-ac41-fed03861de44","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"1d6cd7f3-92dd-471d-92f5-da33659b7c3e"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"f1060c36-b64f-48f5-8316-3913b4a40267","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"ae1a62f2-06ab-4993-abe6-69cb733325cc"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"8ed8b855-8872-48d5-8ccd-d652ad9e8478","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"fd8ad14d-b820-4d5b-94f7-84379bf5657a","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"4b9eeec5-4015-44ba-a9c4-306ff75e15cc","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"34220c94-bb0c-475c-8135-4d40aa926cd2","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"27a9d4fa-04ac-413f-ad85-b1a83862fba8","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"b267b01f-b255-462a-82b9-95a962cf523f","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"1078fa72-7be6-4e46-bc23-cdca47fed2f7","content":"{{'$store.variables.selected_visit.appointmentType.value + \" (\" + $store.variables.selected_visit.shortTime + \" - \" + $store.variables.selected_visit.shortEndTime + \")\"'|store}}","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"set-variable","data":{"name":"visit_view_mode","value":"Menu"},"_auto_id_":"19487518-dba5-4aca-819f-a6ee45248c05"}],"classes":""},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"c9ad0de4-0466-49b8-a34a-3597b18ed349","content":"<h3 style=\"color:black\">Unsaved Data</h3>\n<p style=\"color:black\">You have unsaved data in the following areas:</p>\n<p style=\"color:black;font-weight: 700\">{{'$store.variables.unsavedVisitData' | store}}</p>\n<p style=\"color:black\">- if you continue, this information will not be sent with the Outcome.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"af97f24e-e4ff-4ec7-bd29-b5fd83a2d68d","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"969ac707-b69b-4031-9c4a-5aaea59ec234","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"c8fe2171-0ba4-4abb-8f8a-037123adbf1c"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"1a81bb93-2844-48a1-a881-e41756ea0b67","function":"toggle"},"_auto_id_":"d8f56531-9f44-4d5d-97ef-db0a626771a9"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"526ad591-e008-46c6-b241-93e88033b8ed","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"0d3aeec5-d20b-41eb-8739-4448d655132e","function":"toggle"},"_auto_id_":"9a6789cc-1dd9-4309-8fa4-d440d095c9af"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"0d3aeec5-d20b-41eb-8739-4448d655132e","attributes":{"id":"popupWarning"},"expressions":{},"actions":[]}],"expressions":{},"classes":"relative"},{"name":"scrollable_menu","type":"area","item-type":"scrollable","content":[{"name":"group_tasks","type":"area","item-type":"group","_auto_id_":"e02c4332-c5fe-478d-a4e6-c015d2f1c754","content":[{"name":"html_dialog","type":"content","item-type":"html","_auto_id_":"f2130835-e0b9-4e4c-8b81-ad275c6a7863","content":"<div onclick=\"cti.fn_load_form('dialogplus')\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon dialog\"></div>\n    <div class=\"{{'$store.variables.selected_visit.dialog_form_status' | store}}\">\n      <h5>Dialog+</h5>\n      <i class=\"arrow fa fa-chevron-right {{'$store.variables.selected_visit.dialog_form_status != \\'notcomplete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-hourglass-half {{'$store.variables.selected_visit.dialog_form_status != \\'inprogress\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-upload {{'$store.variables.selected_visit.dialog_form_status != \\'sending\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-check {{'$store.variables.selected_visit.dialog_form_status != \\'complete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-refresh {{'$store.variables.selected_visit.dialog_form_status != \\'failed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-file-text-o {{'$store.variables.selected_visit.dialog_form_status != \\'outcomed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <div class=\"subtle {{'$store.variables.selected_visit.dialog_form_status' | store}}\">{{'$store.variables.selected_visit.dialog_form_status_text' | store}}\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.dialogPlusForms.length > 0 && $store.variables.selected_visit.dialog_form_status == \\'outcomed\\' ? \\'\\' : \\'display-none\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.dialogPlusForms[0].assessmentDate.displayDate' | store}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.dialog_form"},"classes":""},{"name":"html_lifestyle","type":"content","item-type":"html","_auto_id_":"9d49318f-bc0a-4b9e-85d0-53a52b5141a0","content":"<div onclick=\"cti.fn_load_form('phlifestyl')\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon lifestyle\"></div>\n    <div class=\"{{'$store.variables.selected_visit.lifestyle_form_status' | store}}\">\n      <h5>Lifestyle</h5>\n      <i class=\"arrow fa fa-chevron-right {{'$store.variables.selected_visit.lifestyle_form_status != \\'notcomplete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-hourglass-half {{'$store.variables.selected_visit.lifestyle_form_status != \\'inprogress\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-upload {{'$store.variables.selected_visit.lifestyle_form_status != \\'sending\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-check {{'$store.variables.selected_visit.lifestyle_form_status != \\'complete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-refresh {{'$store.variables.selected_visit.lifestyle_form_status != \\'failed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-file-text-o {{'$store.variables.selected_visit.lifestyle_form_status != \\'outcomed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <div class=\"subtle {{'$store.variables.selected_visit.lifestyle_form_status' | store}}\">{{'$store.variables.selected_visit.lifestyle_form_status_text' | store}}\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms.length > 0 && $store.variables.selected_visit.lifestyle_form_status == \\'outcomed\\' ? \\'\\' : \\'display-none\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms[0].assessmentDate.displayDate' | store}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.lifestyle_form"}},{"name":"html_safety","type":"content","item-type":"html","_auto_id_":"bf0ba58c-80d5-4286-bbfb-414fe067c90c","content":"<div onclick=\"cti.fn_load_form('msp')\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon safety\"></div>\n    <div class=\"{{'$store.variables.selected_visit.safety_form_status' | store}}\">\n      <h5>My Safety Plan</h5>\n      <i class=\"arrow fa fa-chevron-right {{'$store.variables.selected_visit.safety_form_status != \\'notcomplete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-hourglass-half {{'$store.variables.selected_visit.safety_form_status != \\'inprogress\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-upload {{'$store.variables.selected_visit.safety_form_status != \\'sending\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-check {{'$store.variables.selected_visit.safety_form_status != \\'complete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-refresh {{'$store.variables.selected_visit.safety_form_status != \\'failed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-file-text-o {{'$store.variables.selected_visit.safety_form_status != \\'outcomed\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <div class=\"subtle {{'$store.variables.selected_visit.safety_form_status' | store}}\">{{'$store.variables.selected_visit.safety_form_status_text' | store}}\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.mySafetyPlanForms.length > 0 && $store.variables.selected_visit.safety_form_status == \\'outcomed\\' ? \\'\\' : \\'display-none\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.mySafetyPlanForms[0].assessmentDate.displayDate' | store}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.safety_form"}},{"name":"html_noforms","type":"content","item-type":"html","_auto_id_":"ca2e05a6-7e7c-49b5-a72b-30c9521dc30c","content":"<div>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon task\"></div>\n    <div class=\"complete\">\n      <h5>No Forms to Complete for this Visit</h5>\n      <div class=\"subtle\">Not Applicable</div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.dialog_form === false && $store.variables.selected_visit.lifestyle_form === false && $store.variables.selected_visit.safety_form === false"}},{"name":"html_patient_record_head","type":"content","item-type":"html","_auto_id_":"9d8e4c08-7672-476c-8b91-d2fc1e4d37c8","content":"Patient Record","expressions":{}}],"repeat":false,"expressions":{}},{"name":"html_button_timeline","type":"content","item-type":"html","_auto_id_":"1df54d42-d0b5-489d-a539-78abdee4e43e","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Timeline\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon timeline\"></div>\n    <div>\n      <h5>Timeline</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.timeline.length' | store}} Events</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_patient","type":"content","item-type":"html","_auto_id_":"f28273a4-d478-4158-a493-e5ee565ef237","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Patient Demographics\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon patient\"></div>\n    <div>\n      <h5>Demographics</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.displayName'|store}}</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_alerts","type":"content","item-type":"html","_auto_id_":"d8dc79cf-d998-4507-9e30-02ad87a1922d","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Alerts\",\"manual_filter\":\"true\"}});' class=\"{{'$store.variables.selected_visit.hasAlerts == true ? \\'hasAlerts\\' : \\'\\'' |store }}\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon alerts-added\"></div>\n    <div>\n      <h5>Alerts</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.openAlerts' | store}} Alerts\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.hasAlerts == false ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.alerts[0].date' | store | date:'d MMM y'}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_appointments","type":"content","item-type":"html","_auto_id_":"02b1314b-ba23-493d-97e9-f313e36ccc1d","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Appointments\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon appointments\"></div>\n    <div>\n      <h5>Appointments</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.appointmentHistory.length' | store}} Appointments\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.appointmentHistory.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.appointmentHistory[0].date' | store | date:'d MMM y HH:mm'}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_referrals","type":"content","item-type":"html","_auto_id_":"6f451fd0-0546-44f3-88a2-153e89581975","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Referrals\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon referral\"></div>\n    <div>\n      <h5>Referrals</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.referrals.length' | store}} Referrals\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.referrals.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.referrals[0].referralDate' | store | date:'d MMM y HH:mm'}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_dialog","type":"content","item-type":"html","_auto_id_":"037fbcaf-db47-46c4-ab2e-bfae05d723ac","content":"<div onclick=\"cti.fn_view_dialog(false)\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon dialog\"></div>\n    <div>\n      <h5>Dialog+ Forms</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.dialogPlusForms.length'|store}} Forms\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.dialogPlusForms.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.dialogPlusForms[0].assessmentDate.displayDate' | store}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{},"classes":""},{"name":"html_button_lifestyle","type":"content","item-type":"html","_auto_id_":"fd12cff9-790f-4fa5-97a3-456b9760831e","content":"<div onclick=\"cti.fn_view_lifestyle(false)\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon lifestyle\"></div>\n    <div>\n      <h5>Lifesyle Assessment Forms</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms.length'|store}} Forms\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms[0].assessmentDate.displayDate' | store}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_safety","type":"content","item-type":"html","_auto_id_":"37505e07-991a-41a8-8a70-a3027c74c458","content":"<div onclick=\"cti.fn_view_safety(false)\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon safety\"></div>\n    <div>\n      <h5>My Safety Plan Forms</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.mySafetyPlanForms.length'|store}} Forms\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.mySafetyPlanForms.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.mySafetyPlanForms[0].assessmentDate.displayDate' | store}}\n        </span>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_progress_note","type":"content","item-type":"html","_auto_id_":"f114725f-ba32-419c-bccb-f5ec19607e22","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Progress Notes\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon notes\"></div>\n    <div>\n      <h5>Progress Notes</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.progressNotes.length' | store}} Notes\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.progressNotes.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.progressNotes[0].dateTime' | store | date:'d MMM y HH:mm'}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_documents","type":"content","item-type":"html","_auto_id_":"7322c1c3-a2ac-43ed-8e90-db3e95ecc740","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Documents\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon documents\"></div>\n    <div>\n      <h5>Documents</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.documents.length' | store}} Documents\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.documents.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.documents[0].documentDate' | store | date:'d MMM y HH:mm'}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_allergies","type":"content","item-type":"html","_auto_id_":"fce98a30-3297-4978-b51c-206f4e5002a1","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Allergies\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon allergies\"></div>\n    <div>\n      <h5>Allergies</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.allergies.length' | store}} Allergies\n        <span style=\"opacity:0.5\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length == 0 ? \\'display-none\\' : \\'\\'' | store}}\">, Last {{'$store.variables.selected_visit.patientData.allergies[0].dateTime' | store | date:'d MMM y'}}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_contacts","type":"content","item-type":"html","_auto_id_":"c78405ff-c046-4a84-8404-274f98d9bfc9","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Contacts\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon contacts\"></div>\n    <div>\n      <h5>Contacts</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.contacts.length' | store}} Contacts</div>\n    </div>\n  </div>\n</div>","expressions":{}}],"_auto_id_":"dc14769d-76c0-41b0-b5c9-2d7ca79b7dc1","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"94cfd3b7-5c23-40bb-ba0f-4d025749609e","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"d1ba0688-3158-42eb-86a8-6dae0e347bbb","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"0fe6186d-7399-4381-988f-0ab3cc91e798","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"0e9858f0-1f8e-47b2-a832-4a7c86071fe9"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"ec1547cf-11fc-4f6e-bf63-dd039b73a708","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"e2062125-ffd8-4382-b798-df5d906b7e17"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"e30c80d6-e820-4b3d-9abe-4e2be4000e10","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (cti.fn_canOutcomeAppointment()) {\n  cti.utils.callAction('go-to-page', { name: 'Outcome' })\n} else {\n  $success()\n}"},"_auto_id_":"cb8bfbb4-12e8-4f40-87e9-33c0edfda737","actions":[{"event":"success","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"0d3aeec5-d20b-41eb-8739-4448d655132e","function":"toggle"},"_auto_id_":"d4e48fb7-a908-498d-a733-14ae6571a857"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"e013abbc-fdff-4c50-ba1a-e34f88c2df99","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"20b0ef70-f4ec-4e4e-bddd-d6b39a683ac2"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"44e84cf5-bd31-46ef-8af5-7c862a1cea07","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}],"_auto_id_":"a2ea1775-fed2-4736-8f05-9fa0c5319215"},{"start":false,"name":"Note","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"6541c7df-9be1-4d4a-a12a-5371a6ab3cdd","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"const currentDateTime = moment().format('YYYY-MM-DDTHH:mm');\nconst noteDate = document.querySelector('#note-date');\n\nif(noteDate.value === \"\"){\n  noteDate.value = currentDateTime;\n}\n\nif (!!cti.store.variables.defaultNoteType || (cti.store.pages.Note && cti.store.pages.Note.noteType)) {\n  $success()\n}"},"_auto_id_":"5b2b3d2d-c47b-4c14-bc17-941334882ae3","actions":[]},{"event":"onload","type":"call-function","data":{"name":"fn_note_load_subnotes"},"_auto_id_":"608da942-928b-4991-9615-a0d0f90e8383"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"48dd5176-d7c4-4e76-ab8b-406377bbeff4","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"fc9c15f1-6ed4-4c57-92bd-8151a48ad519","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline function - button_back - page: Note', \n  'info'\n)\n\nvar view_name = cti.store.variables.visit_view_mode\nvar page = \"Visit\"\n\nif(view_name == \"Timeline\") {\n  page = \"Timeline\"\n} else if(view_name == \"Patient Demographics\") {\n  page = \"Patient\"\n} else if(view_name == \"Alerts\") {\n  page = \"Alerts\"\n} else if(view_name == \"Appointments\") {\n  page = \"Appointments\"\n} else if(view_name == \"Referrals\") {\n  page = \"Referrals\"\n} else if(view_name == \"Progress Notes\") {\n  page = \"Notes\"\n} else if(view_name == \"Documents\") {\n  page = \"Documents\"\n} else if(view_name == \"Allergies\") {\n  page = \"Allergies\"\n} else if(view_name == \"Contacts\") {\n  page = \"Contacts\"\n}\n\n// if user presses back button clear out the data so it isn't persisted \n\nif(cti.store.repeater.Note && cti.store.repeater.Note.group_riskType){\n\tcti.store.repeater.Note.group_riskType = [];\n}\n\ncti.utils.callAction(\"delete-media\", {\"model\" : \"$store.media.btnPhoto.images[0]\"});\n\n\n\ncti.utils.callAction(\"go-to-page\", { \"name\" : page })"},"_auto_id_":"12e192ab-72a4-4677-bc07-740c32f38f4a"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>New Progress Note</h4>","_auto_id_":"c8ca3e4a-382a-4365-b4ca-d96853463718"}],"_auto_id_":"bf84185b-d20f-48ed-a9f1-94ff8c5211f2","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"6de7a407-c98e-4a57-bdc5-d78cf859a22c","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"9029365e-7ec4-4788-a418-88fe0a85f1fd","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"noteType","type":"choice","item-type":"select","_auto_id_":"7480d8d2-99b4-4cad-8413-0d53dccff32c","label":"Note Type: ","required":false,"options":[{"label":"TypeA - *** USE FOR DEMO ***","value":"nt1"},{"label":"Child Health Administration","value":"CH"},{"label":"Child Development Services","value":"CHDEVSER"},{"label":"Community Paediatrics","value":"COMPAED"},{"label":"CPA Review","value":"CPA"},{"label":"Child Protection","value":"CS"},{"label":"Diabetics","value":"DIABN"},{"label":"Dietetics","value":"DIET"},{"label":"District Nursing","value":"DN"},{"label":"EPathways Manual Completion Reason","value":"EPATHWAY"},{"label":"Geriatric Medicine","value":"GM"},{"label":"General Medical Services","value":"GMP"},{"label":"Health Visiting","value":"HV"},{"label":"Community Beds","value":"INP"},{"label":"Intermediate Care","value":"INTCARE"},{"label":"Looked after Children","value":"LACN"},{"label":"LAC Review","value":"LACReview"},{"label":"MDT Meeting","value":"MDT"},{"label":"Occupational Therapy","value":"OT"},{"label":"Paediatrics","value":"PAED"}],"message":"This is a required field","expressions":{"default":"$store.variables.defaultNoteType && $store.variables.defaultNoteType.value"},"description":"","validators":[],"actions":[{"event":"change","type":"call-function","data":{"name":"fn_note_load_subnotes"},"_auto_id_":"c38d1ae0-ed4d-4c6f-b285-a65d8642afd7"}],"option-source":"$store.api.api_rio.getnotetypes.data.progressNoteTypes.uiNoteTypes","label-property":"value","value-property":"code"},{"name":"subType","type":"choice","item-type":"select","_auto_id_":"b621ab17-3ea4-4063-b7be-9b22a0873ff3","label":"Sub Note Type:","required":false,"options":[{"label":"Option 1","value":1},{"label":"Option 2","value":2},{"label":"Option 3","value":3}],"expressions":{"show":"$store.pages.Note.noteType != undefined && $store.variables.uiSubNoteTypes.length > 0","default":"$store.variables.defaultSubNoteType && $store.variables.defaultSubNoteType.value"},"actions":[],"option-source":"$store.variables.uiSubNoteTypes","label-property":"value","value-property":"code"},{"name":"isValidated","type":"choice","item-type":"select","_auto_id_":"e47d96a2-bbbd-4964-8d40-432776dabb87","label":"Is Validated?","required":false,"options":[{"label":"Validated","value":"1"},{"label":"Not Validated","value":"0"}],"expressions":{"show":"$store.variables.note != undefined","disabled":"$store.variables.note.canValidateOwn == \"0\""},"actions":[],"message":"This is a required field","validators":[]},{"name":"specialty","type":"choice","item-type":"select","_auto_id_":"0a74260e-9533-4090-93a5-75c0fa0c9025","label":"Specialty:","required":false,"options":[{"label":"General Surgery","value":"100"},{"label":"General Medical Practice","value":"600"},{"label":"Community Medicine","value":"900"}],"expressions":{"show":"false"},"option-source":"$store.api.api_rio.getnotespecialites.data.userSpecialties.userSpecialty","label-property":"value","value-property":"code","validators":[],"actions":[]},{"name":"noteText","type":"user-input","item-type":"text","_auto_id_":"c3bf710c-ad04-46ac-b1df-4b01bdc3484f","label":"Note: ","required":true,"multiline":true,"debounce":1000,"message":"This is a required field","expressions":{},"validators":[],"actions":[]},{"name":"html_noteDate","type":"content","item-type":"html","_auto_id_":"958e5a46-afe5-49cc-ab26-99d66eee29e7","content":"<label>Date:</label><br />\n<input type=\"datetime-local\" id=\"note-date\" />","expressions":{}},{"name":"row_media","type":"area","item-type":"row","_auto_id_":"ffb31fde-6a41-4206-b021-41cffa2ae611","content":[{"name":"button_take_photo","type":"button","item-type":"take-photo-button","_auto_id_":"fff2df6d-c79b-4b13-b20b-408f746cd03e","extends":{"type":"button","item-type":"button"},"content":"Take photo","actions":[{"event":"click","type":"take-photo","data":{"quality":50,"multiple":false,"mediaId":"btnPhoto"},"_auto_id_":"f843da43-1b51-499e-9538-3f3b5207fe32"}],"left-icon":"fa-camera","theme":"minimal","expressions":{"show":"($store.media.btnPhoto == undefined || $store.media.btnPhoto.images.length == 0) && ($store.media.btnAudio == undefined || $store.media.btnAudio.audio.length == 0)"}},{"name":"image_viewer","type":"media","item-type":"image-viewer","_auto_id_":"0f78420b-9495-4e6d-b463-025db611ef68","scaleImage":true,"maxWidth":150,"maxHeight":80,"model":"$store.media.btnPhoto.images[0]","actions":[{"event":"click","type":"delete-media","data":{"model":"$store.media.btnPhoto.images[{{0}}]"},"_auto_id_":"1d21baf1-d7bf-4b07-9e64-2d40afa4bea5"}],"expressions":{"show":"$store.media.btnPhoto != undefined && $store.media.btnPhoto.images != undefined && $store.media.btnPhoto.images.length > 0"}},{"name":"button_delete_photo","type":"button","item-type":"button","_auto_id_":"ebf41e54-5836-42f9-bb31-a0fe8ca79471","content":"","theme":"minimal","left-icon":"fa-trash","actions":[{"event":"click","type":"delete-media","data":{"model":"$store.media.btnPhoto.images[{{0}}]"},"_auto_id_":"77b4ddd1-4306-4124-8d6e-d6d949bdf7c8"}],"expressions":{"show":"$store.media.btnPhoto != undefined && $store.media.btnPhoto.images != undefined && $store.media.btnPhoto.images.length > 0"}},{"name":"record_audio","type":"capture","item-type":"record-audio","_auto_id_":"3cbc1089-68cd-4ecc-a9e4-8a43d34e8ec2","label":"Record Audio: ","required":false,"smallRecorder":false,"multiple":false,"mediaId":"btnAudio","actions":[],"expressions":{"show":"0 && ($store.media.btnPhoto == undefined || $store.media.btnPhoto.images.length == 0) && ($store.media.btnAudio == undefined || $store.media.btnAudio.audio.length == 0)"}},{"name":"audio_player","type":"media","item-type":"audio","_auto_id_":"7b496a3f-17e8-4659-8bbc-30492a3b30d2","actions":[],"model":"$store.media.btnAudio.audio[0]","expressions":{"show":"0 &&  ($store.media.btnAudio != undefined && $store.media.btnAudio.audio != undefined && $store.media.btnAudio.audio.length > 0)"}},{"name":"button_delete_audio","type":"button","item-type":"button","_auto_id_":"a3753a99-2b42-47ae-8fae-917baa2598a2","content":"","theme":"minimal","actions":[{"event":"click","type":"delete-media","data":{"model":"$store.media.btnAudio.audio[{{0}}]"},"_auto_id_":"d9f12578-54cc-4075-b2a4-87733f9e352e"}],"expressions":{"show":"0 && ($store.media.btnAudio != undefined && $store.media.btnAudio.audio != undefined && $store.media.btnAudio.audio.length > 0)"},"left-icon":"fa-trash"}],"expressions":{}},{"name":"button_advanced","type":"button","item-type":"button","_auto_id_":"ecbe353a-f4ec-4500-8302-0f0c0421ce1c","content":"{{'$store.variables.show_advanced_note == false ? \"Show Advanced...\" : \"Hide Advanced\"' | store}}","theme":"default","actions":[{"type":"if","data":{},"_auto_id_":"fbfa0ebc-a6d5-4968-916b-06c2298a802c","operations":[{"type":"value","content":"{{$store.variables.show_advanced_note}}","$selected":false},{"type":"operator","content":"==","$selected":false},{"type":"value","content":"{{true}}","$selected":false}]},{"event":"click","type":"set-variable","data":{"name":"show_advanced_note","value":"{{false}}"},"_auto_id_":"71c2b86d-9b50-47ab-8381-f5538a49586d"},{"type":"otherwise","data":{},"_auto_id_":"696ef543-55c9-43fb-aa8f-ae12a2321020"},{"event":"click","type":"set-variable","data":{"name":"show_advanced_note","value":"{{true}}"},"_auto_id_":"09bcbd38-aa9e-4b3c-9eca-eeebfd43db00"},{"type":"end-if","data":{},"_auto_id_":"7a9d9b8d-2ef0-43c5-97c5-8b5cef9e171a"}],"expressions":{}},{"name":"group_advanced","type":"area","item-type":"group","_auto_id_":"7f9e95db-bdbb-47fb-8e9f-be1d4305a168","content":[{"name":"flagSignificantEvent","type":"choice","item-type":"switch","_auto_id_":"f5ef958c-cb99-463d-9531-b360956d9cd2","label":" Significant Event:","required":false,"on-text":"YES","off-text":"NO","expressions":{},"validators":[],"actions":[]},{"name":"flagThirdParty","type":"choice","item-type":"switch","_auto_id_":"6321c245-0e71-4e7e-9fdd-ba0dc3f36c3e","label":"Contains third party information:","required":false,"on-text":"YES","off-text":"NO","expressions":{}},{"name":"flagClientConceal","type":"choice","item-type":"switch","_auto_id_":"872e8fae-3196-44be-94c6-0123c548c949","label":"Conceal from Client:","required":false,"on-text":"YES","off-text":"NO","expressions":{}}],"repeat":false,"expressions":{"show":"$store.variables.show_advanced_note == true"}},{"name":"group_riskType","type":"area","item-type":"group","_auto_id_":"aebb5ba0-b706-4f6d-b071-49c54642e3af","content":[{"name":"riskType","type":"choice","item-type":"select","_auto_id_":"28e4a41e-0f2e-4237-ad4e-d57fb997618f","label":"Risk Type:","required":false,"options":[{"label":"Allergy","value":"AL"},{"label":"Child on Register","value":"CPR"},{"label":"Do Not Divulge Address","value":"DNDA"}],"expressions":{},"validators":[],"actions":[],"option-source":"$store.api.api_rio.getnoterisktypes.data.riskTypes.riskType","label-property":"value","value-property":"code"}],"repeat":true,"expressions":{"show":"$store.variables.show_advanced_note == true"}},{"name":"list_riskType","type":"content","item-type":"list","_auto_id_":"e4a646ba-4fcf-4b1c-ace2-47742971d1cd","search":"","classes":"","expressions":{"show":"$store.variables.show_advanced_note == true"},"model":"$store.repeater.Note.group_riskType","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.Note.group_riskType.splice( $data.$item.$index, 1);"},"_auto_id_":"4b032abb-c0f6-4c3d-a0fa-04f4a1716aeb","actions":[]}],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_riskType_html","_auto_id_":"0fedf8d2-5c1c-41ae-9e7f-4e4f235f4e42","content":"<i class=\"fa fa-trash\"></i> {{$data.$item.riskType.label}}"}]}],"_auto_id_":"418d9f90-a47a-4d3f-842d-394ad861159e"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"15f82456-6c8f-4837-ae2b-3fa94d2ff5aa","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"//Check that note date is not in the future\n/*function yearToDate(year){\n    return year.split(\"-\").reverse().join(\"-\");\n  }\n\nfunction yearTimeToDate(yearTime){\n      var yt = yearTime.split(\"T\");\n      var ytd = yearToDate(yt[0]);\n      return ytd + \" \" + yt[1];\n}*/\n\nconst noteDate = document.querySelector('#note-date');\n\n\nif(!!noteDate.value){\n\n    var capturedDateTime = noteDate.value;\n  \n    var capturedDateTimeFormatted = moment.utc(moment.utc(new Date(capturedDateTime)).format('YYYY-MM-DDTHH:mm')).format('YYYY-MM-DDTHH:mm');\n  \n  var isFuture = moment(capturedDateTimeFormatted).isAfter(moment().format('YYYY-MM-DDTHH:mm'));\n    \n    if(isFuture){\n            cti.utils.callAction(\"show-notification\", {\n            name: \"notification_error\",\n            title: \"Incorrect Date\",\n            text: \"Progress note date cannot be in the future\"\n          });\n          return false; \n    }else{\n      \n      \n             cti.store.pages.Note.noteDate = { result : capturedDateTime }; \n      \n      \n    }\n  }else if(noteDate.value === \"\"){\n        cti.utils.callAction(\"show-notification\", {\n        name: \"notification_error\",\n        title: \"Incorrect Date\",\n        text: \"Progress note date must be set\"\n      });\n      return false; \n\n  }\n\n// gotFile callback function\n//\n// Success callback function to use the fileEntry data to convert the\n// raw image file to base64\nfunction gotFile(fileEntry) {\n  window.logManager.consoleLog('Photo Load: Converting file store to base64...', 'info')\n\n  // Gain access to the root file URL\n  fileEntry.file(function(file) {\n    // Set new FileReader\n    var reader = new FileReader()\n    // Attach callback function\n    reader.onloadend = function(e) {\n      // ... on success generate API friendly data\n      window.logManager.consoleLog('Photo Load: File converted to Base64', 'info')\n\n      // Convert the binary back into a string\n      var dataURL = window.btoa(e.target.result)\n\n      // Set the base64 string\n      var base64 = dataURL.replace(/^data:image\\/[a-z]+;base64,/, '')\n\n      // Split down the detail so that we can catch the file type\n      /*\n      var detail = \"\"\n      if(this.result.indexOf(\"base64,\") != -1) {\n        detail = this.result.split(\"base64,\")\n      }\n      var fileType = \"\"\n      if(detail[0].indexOf(\"/\") != -1) {\n        fileType = detail[0].split(\"/\")\n      }\n      var extension = \"\"\n      if(fileType[1].indexOf(\";\") != -1) {\n        extension = fileType[1].split(\";\")\n      }\n      */\n      var fileExtension = 'jpg'\n\n      // RiO does not accept jpeg so split out the e to\n      // pass as jpg\n      if (fileExtension == 'jpeg') {\n        fileExtension = fileExtension.replace('e', '')\n      }\n\n      // Set the local variables\n      cti.store.media.btnPhoto.base64 = base64\n      cti.store.media.btnPhoto.fileExtension = fileExtension\n\n      // Call success to kick off action flow\n      $success()\n    }\n\n    // Convert the file to base64 string...\n    reader.readAsBinaryString(file)\n  })\n}\n\n// fail callback function\n//\n// Fail callback function to inform the user that the file has failed to\n// resolve from the local file system\nfunction fail(error) {\n  window.logManager.consoleLog('Photo Load: Failed - Reason: ' + error, 'error')\n\n  // Remove any corrupt trace of the file\n  if (cti.store.media && cti.store.media.btnPhoto && cti.store.media.btnPhoto.images && cti.store.media.btnPhoto.images.length === 1) {\n    delete cti.store.media.btnPhoto\n  }\n\n  // Notify the user\n  cti.utils.callAction('show-notification', {\n    name: 'notification_error',\n    title: 'Error Locating Image',\n    text: 'The application was unable to locate the image. Please retake the photo and try again.'\n  })\n\n  // Close the spinner\n  cti.fn_toggle_spinner('close', '')\n}\n\n// Show spinner message\ncti.fn_toggle_spinner('open', 'Submitting Progress Note...')\n\n// If a medical note type is entered then make sure we have a sub note type\nif (cti.store.pages.Note.noteType && (cti.store.variables.uiSubNoteTypes != undefined && cti.store.variables.uiSubNoteTypes.length > 0)) {\n  if (!cti.store.pages.Note.subType) {\n    cti.utils.callAction('show-notification', {\n      name: 'notification_error',\n      title: 'Warning: No Sub Type Selected',\n      text: 'You must enter a Sub Note Type before continuing.'\n    })\n\n    cti.fn_toggle_spinner('close', '')\n    return false\n  } else if (cti.store.pages.Note.isValidated == undefined || cti.store.pages.Note.isValidated == null) {\n    cti.utils.callAction('show-notification', {\n      name: 'notification_error',\n      title: 'Warning: Validated Error',\n      text: 'You must select a validation option for this Note Type.'\n    })\n\n    cti.fn_toggle_spinner('close', '')\n    return false\n  }\n}\n\n// Check that we have a valid image to upload\nif (cti.store.media && cti.store.media.btnPhoto && cti.store.media.btnPhoto.images && cti.store.media.btnPhoto.images.length === 1) {\n  // Check that we are running  on a device compatible with image to\n  // base64 conversion...\n  if (cordova && window && window.resolveLocalFileSystemURL) {\n    // Grab the image in a local variable\n    var photo = cti.store.media.btnPhoto.images[0]\n\n    // Then pass it to resolveLocalFileSystemURL to convert it as base64\n    window.resolveLocalFileSystemURL(photo, gotFile, fail)\n  } else {\n    // ... otherwise we ignore the file and process the submission\n    // without any documents\n    window.logManager.consoleLog(\"Photo Load: Ignoring file upload as we're in studio.\", 'info')\n\n    // Remove any trace of the photo\n    delete cti.store.media.btnPhoto\n\n    // Call success to kick off action flow\n    $success()\n  }\n} else {\n  // Call success to kick off action flow\n  $success()\n}"},"_auto_id_":"a853d720-5626-4865-9b8d-6ab134a846c2","actions":[]},{"event":"click","type":"set-variable","data":{"name":"show_advanced_note","value":"false"},"_auto_id_":"4c741785-51e4-4858-aad2-48dfd9538d32"},{"event":"click","type":"call-actionflow","data":{"name":"AddProgressNote"},"_auto_id_":"a5310c76-2117-4749-b8d5-a8356c14b537"}],"classes":"default"}],"_auto_id_":"5dd514c7-9dc5-420d-a3d5-5bb93f1ba1b0","expressions":{}}],"_auto_id_":"6b0f2fc7-c431-4c0d-a665-3506c3924249"},{"start":false,"name":"Alert","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"f27a1d91-3b56-4f78-b797-91d1b9bb695e","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"var types = cti.store.api.api_rio.alertpriorities.data\n\nif(types && types.length == 0) {\n  var obj = {\n    value: 'dummy',\n    label: 'dummy'\n  }\n  \n  if(cti.store.pages.Alert == undefined) {\n    cti.store.pages.Alert = {}\n  }\n  \n  cti.store.pages.Alert.priority = obj\n}\n\ncti.utils.updatePage()\n$success()"},"_auto_id_":"ef3c7996-9a8d-42ab-b1c8-308644a6c776"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"15fdca40-04ee-44ce-b92b-e3e8deda883d","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"901db495-df14-496e-af11-2c7ecf2666d9","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline function - button_back - page: Alert', \n  'info'\n)\n\nvar view_name = cti.store.variables.visit_view_mode\nvar page = \"Visit\"\n\nif(view_name == \"Timeline\") {\n  page = \"Timeline\"\n} else if(view_name == \"Patient Demographics\") {\n  page = \"Patient\"\n} else if(view_name == \"Alerts\") {\n  page = \"Alerts\"\n} else if(view_name == \"Appointments\") {\n  page = \"Appointments\"\n} else if(view_name == \"Referrals\") {\n  page = \"Referrals\"\n} else if(view_name == \"Progress Notes\") {\n  page = \"Notes\"\n} else if(view_name == \"Documents\") {\n  page = \"Documents\"\n} else if(view_name == \"Allergies\") {\n  page = \"Allergies\"\n} else if(view_name == \"Contacts\") {\n  page = \"Contacts\"\n}\n\ncti.utils.callAction(\"go-to-page\", { \"name\" : page })"},"_auto_id_":"977ecdf5-f894-4549-9444-e9f8b34a25ba"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>New Alert</h4>","_auto_id_":"9f720575-5add-494a-add2-3fc5645636ab"}],"_auto_id_":"718f9be6-c7eb-42e8-a856-aa37fe246831"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"202a9132-d44c-4f6e-8a34-5b066ddc246f","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"08a85e6e-1156-400c-8243-162ecd8e9d9f","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"type","type":"choice","item-type":"select","_auto_id_":"57e387e8-27f6-43b2-9fed-79a82153445d","label":"Type:","required":true,"options":[],"expressions":{},"option-source":"$store.api.api_rio.alerttypes.data","label-property":"value","value-property":"code","message":"This is a required field"},{"name":"priority","type":"choice","item-type":"select","_auto_id_":"ceda063e-5665-414c-863d-78ffdaa4cf51","label":"Priority:","required":true,"options":[],"expressions":{"show":"$store.api.api_rio.alertpriorities.data && $store.api.api_rio.alertpriorities.data.length > 0"},"label-property":"value","value-property":"code","option-source":"$store.api.api_rio.alertpriorities.data","validators":[],"actions":[],"message":"This is a required field"},{"name":"description","type":"user-input","item-type":"text","_auto_id_":"3396828f-2f8f-4db9-bd52-52ed151dfade","label":"Description:","required":true,"multiline":true,"debounce":1000,"message":"This is a required field","expressions":{},"maxlength":500,"validators":[]}],"_auto_id_":"10da53f5-682a-44a5-ad29-8792d53cf4ca","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"d5fcb24a-e909-4ab7-9827-7e6da55b5158","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"call-actionflow","data":{"name":"AddAlert"},"_auto_id_":"bf0d5fac-68f8-45ef-bd11-de6e46302e14"}],"classes":"default"}],"_auto_id_":"3613a614-60d4-469d-b51f-2fd9bc7555a0","expressions":{}}],"_auto_id_":"4ef93156-17d3-4526-a07b-b9e7abea25cf"},{"start":false,"name":"Outcome","config":[{"name":"Page Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"fc3ca296-c8bf-4b48-92b4-ef79ed7d1675","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"cti.fn_populate_duration_dl()\ncti.fn_calc_visit_duration()\n\n$success()"},"_auto_id_":"6e899ada-8966-49a3-a41c-f4fbcf4d4ea2"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"5bc7a690-409b-4f4c-9ad9-ed45534332e6","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"b66935c4-9f01-4588-bf90-2aa88279b589","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Outcome","componentInstanceId":"dd7cc424-e618-454b-a545-21a3f8c79b83","function":"toggle"},"_auto_id_":"77997434-e526-430b-8107-261abd94649a"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>End Visit<h4>","_auto_id_":"187f5de8-26de-4e22-b654-0bbc7e438480"}],"_auto_id_":"04c699e2-75b2-4e38-b3ce-674b2aaa939c"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"aafd75e9-bd25-4396-baae-f0480dccd895","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"f00094f6-ec4e-43e9-aa9e-9d0d55a18856","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"arrivalTime","type":"user-input","item-type":"time","_auto_id_":"a92d92d0-c954-4ab7-8487-dc0459a0b46a","label":"Arrived At: ","required":true,"options":{"interval":15,"min":"07:00","max":"22:00"},"left-icon":"fa-clock-o","expressions":{},"validators":[],"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"function setTime() {\n  var startDate = cti.store.variables.selected_visit.arrivalTime;\n  var arrivalTime = moment(startDate).format(\"HH:mm\");\n  var arrivalTimeHours = moment(arrivalTime, \"HH:mm\").format(\"HH\");\n  var arrivalTimeMinutes = moment(arrivalTime, \"HH:mm\").format(\"mm\");\n  var minsArrivalTime = parseInt(arrivalTimeMinutes);\n  var arrivalTimeLabel = \"\";\n\n  if(minsArrivalTime < 15) { arrivalTimeLabel = arrivalTimeHours+\":00\"; }\n  else if(minsArrivalTime >= 15 && minsArrivalTime < 30) { arrivalTimeLabel = arrivalTimeHours+\":15\"; }\n  else if(minsArrivalTime >= 30 && minsArrivalTime < 45) { arrivalTimeLabel = arrivalTimeHours+\":30\"; } \n  else if(minsArrivalTime >= 45 && minsArrivalTime < 60) { arrivalTimeLabel = arrivalTimeHours+\":45\"; }\n\n  cti.store.pages.Outcome.arrivalTime = arrivalTimeLabel;\n}\n\nvar arrivalTime = cti.store.pages.Outcome.arrivalTime;\nvar currentTime = moment().format(\"HH:mm\");\n\nif(currentTime < arrivalTime) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Time Error.\", \n    \"text\" : \"The Patient Arrival Time can not be after the current time.\"\n  });\n  setTime();\n}\n\ncti.utils.updatePage();"},"_auto_id_":"6818fcb9-3e76-4280-a397-22dfe8e5637c","actions":[]}],"message":"This is a required field"},{"name":"actualTime","type":"user-input","item-type":"time","_auto_id_":"393d0ee5-a093-411c-bc84-8548869450db","label":"Seen At: ","required":true,"options":{"interval":15,"min":"07:00","max":"22:00"},"left-icon":"fa-clock-o","expressions":{},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"function setTime() {\n  var startDate = cti.store.pages.Outcome.arrivalTime;\n  var arrivalTime = moment(startDate, \"HH:mm\").format(\"HH:mm\");\n  var arrivalTimeHours = moment(arrivalTime, \"HH:mm\").format(\"HH\");\n  var arrivalTimeMinutes = moment(arrivalTime, \"HH:mm\").format(\"mm\");\n  var minsArrivalTime = parseInt(arrivalTimeMinutes);\n  var arrivalTimeLabel = \"\";\n\n  if(minsArrivalTime < 15) { arrivalTimeLabel = arrivalTimeHours+\":00\"; }\n  else if(minsArrivalTime >= 15 && minsArrivalTime < 30) { arrivalTimeLabel = arrivalTimeHours+\":15\"; }\n  else if(minsArrivalTime >= 30 && minsArrivalTime < 45) { arrivalTimeLabel = arrivalTimeHours+\":30\"; } \n  else if(minsArrivalTime >= 45 && minsArrivalTime < 60) { arrivalTimeLabel = arrivalTimeHours+\":45\"; }\n\n  cti.store.pages.Outcome.actualTime = arrivalTimeLabel;\n}\n\nvar arrivalTime = cti.store.pages.Outcome.arrivalTime;\nvar actualTime = cti.store.pages.Outcome.actualTime;\nvar currentTime = moment().format(\"HH:mm\");\n\nif(actualTime < arrivalTime) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Time Error.\", \n    \"text\" : \"The Patients Seen At Time can not be before the Patients Arrival Time.\"\n  });\n  setTime();\n} else if(actualTime > currentTime) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Time Error.\", \n    \"text\" : \"The Patients Seen At Time can not be after the current time.\"\n  });\n  setTime();\n} else {\n  var now = moment().format(\"HH:mm\");\n  var time = moment.utc(moment(now,\"HH:mm\").diff(moment(actualTime,\"HH:mm\"))).format(\"HH:mm\");\n  var mins = moment(time, \"HH:mm\").format(\"m\");\n  var hours = moment(time, \"HH:mm\").format(\"H\");\n\n  cti.store.pages.Outcome.duration_hours = {\"label\": hours, \"value\": hours };\n  cti.store.pages.Outcome.duration_minutes = {\"label\": mins, \"value\": mins };\n}\n\ncti.utils.updatePage();"},"_auto_id_":"fde6cf10-8ea0-47e4-bba1-4ec7b7684256"}],"message":"This is a required field"},{"name":"html_duration_label","type":"content","item-type":"html","_auto_id_":"bd26277d-a235-46b1-bf9e-eabaa9f91cb5","content":"<label>Duration:</label>","expressions":{}},{"name":"row_duration","type":"area","item-type":"row","_auto_id_":"7353483e-e255-4b89-89a4-04a02dd0819c","content":[{"name":"duration_hours","type":"choice","item-type":"select","searchable":false,"_auto_id_":"665d1a96-bf72-4cbe-9dde-49115d70ab74","label":"Hours:","required":true,"options":[],"expressions":{},"option-source":"$store.variables.duration_hours","label-property":"label","value-property":"value","message":"This is a required field"},{"name":"duration_minutes","type":"choice","item-type":"select","searchable":false,"_auto_id_":"222ee1fc-3b18-455e-8f14-508cf5a20259","label":"Minutes:","required":true,"options":[],"expressions":{},"option-source":"$store.variables.duration_minutes","label-property":"label","value-property":"value","message":"This is a required field"}],"expressions":{}},{"name":"group_activities","type":"area","item-type":"group","_auto_id_":"3ff06c30-c275-4208-a166-a189887ad776","content":[{"name":"activity","type":"choice","item-type":"select","_auto_id_":"369244b3-6e09-4185-b0bb-1cc76e9c9809","label":"Activity:","required":false,"options":[{"label":"Activity A","value":"activitya"},{"label":"Activity B","value":"activityb"}],"expressions":{},"validators":[],"actions":[],"option-source":"$store.variables.selected_visit.attendees.attendee.possibleActivities.possibleActivity","label-property":"value","value-property":"code","message":"This is a required field"},{"name":"button_add_activity","type":"button","item-type":"button","_auto_id_":"8a13552f-177f-4cb6-8574-71dbdd379a16","content":"Add","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var outcome = cti.store.pages.Outcome\n\nif(outcome == undefined || outcome.activity == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: You must select a valid Activity.\", \n    \"text\" : \"You must select a valid activity from the Activities drop down list.\"\n  })\n} else {\n  if(cti.store.variables.o_activities == undefined) {\n    cti.store.variables.o_activities = []\n  }\n\n  for(var i in cti.store.variables.o_activities) {\n    if(cti.store.variables.o_activities[i].value == outcome.activity.value) {\n      cti.utils.callAction(\"show-notification\", {\n        \"name\": \"notification_warning\", \n        \"title\" : \"Warning: You must select a valid Activity.\", \n        \"text\" : \"You must select a valid activity from the Activities drop down list.\"\n      })\n      return false\n    }\n  }\n  \n  cti.store.variables.o_activities.push(outcome.activity)\n  outcome.activity = undefined\n}\n\ncti.utils.updatePage();"},"_auto_id_":"af511c43-def0-40e0-b75a-9b4986a2e5da"}],"expressions":{},"classes":"button-add-activity"}],"repeat":false,"expressions":{}},{"name":"list_activities","type":"content","item-type":"list","_auto_id_":"3b634e27-54c2-4995-a6e4-9f6f58fba96e","search":"","classes":"","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.o_activities.splice( $data.$index, 1);"},"_auto_id_":"cb466027-e3a3-4b1a-9fe1-7b28bcebae95"}],"expressions":{},"model":"$store.variables.o_activities","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_activities_html","_auto_id_":"8b1ae0d0-ba77-4c0c-80cb-81eb7622bd4c","content":"<i class=\"fa fa-times-circle-o\"></i> {{$data.$item.label}}","expressions":{}}]},{"name":"outcome","type":"choice","item-type":"select","_auto_id_":"b1f1f9e6-3bb3-4131-8ffb-beb9dcaee985","label":"Outcome:","required":true,"options":[{"label":"Outcome A","value":"outcomea"},{"label":"Outcome B","value":"outcomeb"},{"label":"Did Not Attend","value":"dna"}],"expressions":{},"message":"This is a required field","option-source":"$store.variables.selected_visit.attendees.attendee.possibleOutcomes.possibleOutcome","label-property":"value","value-property":"code"},{"name":"comments","type":"user-input","item-type":"text","_auto_id_":"9045eb47-c7fa-4390-841a-e9af7f093530","label":"Comments:","required":false,"multiline":true,"debounce":1000,"message":"This is a required field","expressions":{},"maxlength":500,"validators":[]},{"name":"popupBack","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"a9d787a3-3046-472b-b173-7683252c8581","content":"<h2>Cancel Outcome</h2>\n<p>You are about to cancel the outcome for this appointment. Any information you have entered will be lost.</p>\n<p>Do you want to continue? </p>","expressions":{}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"527d4f14-eb10-4fcc-978b-ee0a6771c93b","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"c259f4df-ec35-4060-a087-325391b77350","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.v_submitOutcome_clear = true\n\nwindow.logManager.consoleLog(\n  'inline function - button_back - page: Outcome', \n  'info'\n)\n\nvar view_name = cti.store.variables.visit_view_mode\nvar page = \"Visit\"\n\nif(view_name == \"Timeline\") {\n  page = \"Timeline\"\n} else if(view_name == \"Patient Demographics\") {\n  page = \"Patient\"\n} else if(view_name == \"Alerts\") {\n  page = \"Alerts\"\n} else if(view_name == \"Appointments\") {\n  page = \"Appointments\"\n} else if(view_name == \"Referrals\") {\n  page = \"Referrals\"\n} else if(view_name == \"Progress Notes\") {\n  page = \"Notes\"\n} else if(view_name == \"Documents\") {\n  page = \"Documents\"\n} else if(view_name == \"Allergies\") {\n  page = \"Allergies\"\n} else if(view_name == \"Contacts\") {\n  page = \"Contacts\"\n}\n\ncti.utils.callAction(\"go-to-page\", { \"name\" : page })\n\n$success()"},"_auto_id_":"f9b63665-d4d8-4ca9-890e-a5347f42455d"},{"event":"click","type":"call-component-function","data":{"page":"Outcome","componentInstanceId":"934dc2c9-8ceb-4c95-9028-84b6a629479e","function":"toggle"},"_auto_id_":"fb3e5f0e-c1d5-44d5-8dd0-bbf5fc9a1b89"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"af699398-2fe3-4b7b-bb8e-bb05c7358f4b","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Outcome","componentInstanceId":"dd7cc424-e618-454b-a545-21a3f8c79b83","function":"toggle"},"_auto_id_":"e77de206-c0d4-40d2-8e70-d7f47786fe1b"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"dd7cc424-e618-454b-a545-21a3f8c79b83","attributes":{"id":"popupBack"},"expressions":{},"actions":[]}],"_auto_id_":"117005a6-d88f-40c1-ae5f-d65ea2bc7e37","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"35abda81-e619-465a-87ab-642759771108","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.o_activities == undefined || cti.store.variables.o_activities.length == 0) {\n  // Users can submit a DNA outcome with activities, so logic check for that here ...\n  if(cti.store.pages.Outcome.outcome.label.indexOf('DNA') === -1) {\n    cti.utils.callAction(\"show-notification\", {\n      \"name\": \"notification_warning\", \n      \"title\" : \"Warning: No Activities Selected.\", \n      \"text\" : \"You must select at least 1 activity from the Activities drop down list.\"\n    });\n  } else {\n    // ... and trigger the embedded actionflow call if valid\n  \t$success();\n  }\n} else {\n  // Success triggers the embedded actionflow call on this inline function\n  $success();\n}"},"_auto_id_":"151b6673-8dde-404e-b2f8-14a0805a4085","actions":[{"event":"success","type":"call-actionflow","data":{"name":"SubmitOutcome"},"_auto_id_":"9eedc773-1575-4717-9a28-23c6aaeb119c"}]}],"classes":"default"}],"_auto_id_":"e6b11da6-602f-4d48-ad95-e50a2ac1729f","expressions":{}}],"_auto_id_":"ef2837a8-52bb-4001-abe7-f173dc482e79"},{"start":false,"name":"Wound_Care","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"47e50de7-b666-43ff-9e8e-b5fa6466fc05","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"b5f13808-e813-46ac-8dda-b174ff71bb63"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Wound Care Assessment</h4>","_auto_id_":"3b733541-77a1-4069-b73b-c36ffb371f9a"}],"_auto_id_":"6e9b9a31-0343-410f-b960-56c22097ccfe","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"8e2128fb-5c29-4e68-b84b-2d5b811da952","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"906144ed-32eb-4592-a3c4-3bcc51123b8e","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"select_wound_location","type":"choice","item-type":"select","_auto_id_":"61d01795-6b1c-49e9-9d08-bbcdd3d06138","label":"Where is the wound located?","required":false,"options":[{"label":"Abdomen","value":"Abdomen"},{"label":"Arms","value":"Arms"},{"label":"Back","value":"Back"},{"label":"Feet","value":"Feet"},{"label":"Groin","value":"Groin"},{"label":"Hands","value":"Hands"},{"label":"Head / Neck","value":"Head / Neck"},{"label":"Legs","value":"Legs"},{"label":"Shoulders","value":"Shoulders"},{"label":"Torso","value":"Torso"}],"expressions":{}},{"name":"radio_wound_new","type":"choice","item-type":"radio","_auto_id_":"e6fb2c7e-b03e-4c73-a5b5-9897d2da388b","label":"Is the wound new?","required":false,"options":[{"label":"Yes","value":"Yes"},{"label":"No","value":"No"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"actions":[]},{"name":"select_wound_type","type":"choice","item-type":"select","_auto_id_":"1544c9a5-9672-41ee-b9af-80c34b14ad8f","label":"Wound Type:","required":false,"options":[{"label":"Burn / Scald","value":"Burn / Scald"},{"label":"Diabetic Foot Ulcer","value":"Diabetic Foot Ulcer"},{"label":"Skin Tear / Laceration","value":"Skin Tear / Laceration"}],"expressions":{},"actions":[]},{"name":"select_skin_condition","type":"choice","item-type":"select","_auto_id_":"86ffed83-0d57-4060-90b1-6fdbae592b6b","label":"Condition of surrounding skin:","required":false,"options":[{"label":"Dry / Cracked","value":"Dry / Cracked"},{"label":"Healthy / Intact","value":"Healthy / Intact"},{"label":"Oedematous","value":"Oedematous"},{"label":"Macerated","value":"Macerated"}],"expressions":{},"actions":[]}],"_auto_id_":"2447b623-1b07-4571-9c61-ae9e47ce0bd3"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"333b3164-b3b9-4002-a7f8-f08706ec8fb3","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.wound_care = true;\n$success();"},"_auto_id_":"acfb013b-cda7-4480-8b29-e0f0d0da9909"},{"event":"click","type":"go-back","data":{},"_auto_id_":"aec0c1db-7714-4e52-957f-6da8c4c11e05"}],"classes":"default"}],"_auto_id_":"dbdade63-d78c-4916-a85e-535f366581db","expressions":{}}],"_auto_id_":"2b63d1f4-662f-4700-a99c-244929f02527"},{"start":false,"name":"Team_Planner","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"3de77ad3-ade3-41bb-8ba5-e365e13fd132","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"fc8ec3be-a4ce-46e7-90e5-a7b9d3115b02"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Team Planner</h4>","_auto_id_":"0fdb5648-9bb3-4258-924e-371cbdf83892"}],"_auto_id_":"d25a27c7-cf0f-4e48-ba17-e17b795bb1d9","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"e98a2211-6ac3-4ecb-80f3-957358a4f4d8","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"bc222832-b1ef-43d1-8d3e-d6ea28d254e6","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"select_team","type":"choice","item-type":"select","_auto_id_":"5f6b8968-ea3d-40af-9109-0e48e3570afe","label":"Team: ","required":true,"options":[],"expressions":{},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.authenticate.profile.userProfile.teams.team","label-property":"value","value-property":"code","actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"var selectedTeam = cti.store.pages.Team_Planner.select_team.value;\n\nfor(var i in cti.store.api.api_rio.teamplannerreferencedata.data) {\n  if(cti.store.api.api_rio.teamplannerreferencedata.data[i].code === selectedTeam) {\n    cti.store.variables.v_teamActivities = cti.store.api.api_rio.teamplannerreferencedata.data[i].activities.activity;\n    break;\n  }\n}\n\nvar referrals = cti.store.variables.selected_visit.patientData.referrals;\nvar referralsList = [];\n\nfor(var i in referrals) {\n  if(referrals[i].team.code === selectedTeam) {\n    var obj = {\n      \"id\" : referrals[i].referralId,\n      \"referrer\" : referrals[i].referrer,\n      \"referralCode\" : referrals[i].referralSource.code,\n      \"referralValue\" : referrals[i].referralSource.value\n    }\n\n    referralsList.push(obj);\n  }\n}\n\ncti.store.variables.referrals = referralsList;\n\nif(cti.store.variables.referrals.length === 0) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: No Referrals Available\", \n    \"text\" : \"There are no Referrals available for the selected team.\"\n  }); \n}\n\ncti.utils.updatePage();"},"_auto_id_":"ec7ab499-2179-47c4-b61c-fd657a8e0650"}]},{"name":"select_referral","type":"choice","item-type":"select","_auto_id_":"cda1458a-facb-4fb6-8e09-99569252c915","label":"Referral:","required":true,"options":[{"label":"Distring Nursing referral","value":"Distring Nursing referral"}],"expressions":{},"classes":"compact silver","validators":[],"option-source":"$store.variables.referrals","label-property":"referralValue","value-property":"id","message":"This is a required field"},{"name":"date_planner","type":"user-input","item-type":"date","_auto_id_":"92c4e203-617f-4815-93cc-5b09c7578d95","label":"Date: ","required":true,"expressions":{},"classes":"compact silver date_icon_left","message":"This is a required field"},{"name":"radio_time","type":"choice","item-type":"radio","_auto_id_":"d98186ad-c40d-4d27-8ed1-9c2f8b7accd7","label":"Time: ","required":true,"options":[{"label":"AM","value":"AM"},{"label":"PM","value":"PM"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"classes":"compact silver","message":"This is a required field"},{"name":"button_repeat","type":"button","item-type":"button","_auto_id_":"28cacd0a-7ad0-418b-a0c3-6d3d60145329","content":"{{'$store.variables.selected_visit.repeat == undefined ? \"Repeat: No Repeat\" : $store.variables.selected_visit.repeat'|store}}","theme":"minimal","right-icon":"fa-plus-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"Team_Planner","componentInstanceId":"a6484396-13a0-4914-b523-f69b985e2650","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"315b8831-5d63-40ae-8b64-09c5f7c30150"}],"expressions":{},"classes":"compact silver"},{"name":"group_activities","type":"area","item-type":"group","_auto_id_":"ba02bdeb-e281-4108-9bc7-d8b83e16dac4","content":[{"name":"activity","type":"choice","item-type":"select","_auto_id_":"f8518927-13e7-44fd-aaf2-b13bb5aac967","label":"Activities: ","required":true,"options":[],"expressions":{},"validators":[],"actions":[],"message":"This is a required field","option-source":"$store.variables.v_teamActivities","label-property":"value","value-property":"code"}],"repeat":true,"expressions":{}},{"name":"list_activities","type":"content","item-type":"list","_auto_id_":"9c376077-6d9d-48bb-89e5-95ef494e5413","search":"","classes":"","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.Team_Planner.group_activities.splice( $data.$item.$index, 1);"},"_auto_id_":"548a3525-6234-4bfa-af25-5ab1cc3d47de"}],"expressions":{},"model":"$store.repeater.Team_Planner.group_activities","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_activities_html","_auto_id_":"189fd9f4-9947-4866-8077-de7cf6605c21","content":"<i class=\"fa fa-times-circle-o\"></i> {{$data.$item.activity.label}}","expressions":{}}]},{"name":"comments","type":"user-input","item-type":"text","_auto_id_":"575519a4-80b6-40ef-983e-1935fe633d09","label":"Comments: ","required":true,"multiline":true,"debounce":1000,"expressions":{},"message":"This is a required field"},{"name":"popup_repeat_visit","type":"component","item-type":"web-component","content":[{"name":"html_heading","type":"content","item-type":"html","_auto_id_":"61176137-7a79-433e-a9dc-c4c0ca4bef17","content":"<h4>Repeat Visit</h4><p>When do you want the visit to repeat?</p>","expressions":{}},{"name":"number_appointments","type":"user-input","item-type":"number","_auto_id_":"cd579878-83c0-4e82-932e-091f6287b240","label":"Number of appointments: ","required":false,"decimals":2,"expressions":{},"message":"This is a required field"},{"name":"radio_repeat","type":"choice","item-type":"radio","_auto_id_":"32a1d224-3c5e-407e-b1f6-19e78e25275e","label":"","required":false,"options":[{"label":"Daily","value":"Daily"},{"label":"Weekly","value":"Weekly"},{"label":"Monthly","value":"Monthly"},{"label":"Yearly","value":"Yearly"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"Daily\""},"validators":[],"classes":""},{"name":"radio_daily","type":"choice","item-type":"radio","_auto_id_":"94303713-166d-4e1d-b1c2-bb50d33ceb38","label":"","required":false,"options":[{"label":"Every weekday","value":"Every weekday"},{"label":"Daily every...","value":"Daily every"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Daily\"","default":"\"Every weekday\""}},{"name":"radio_monthly","type":"choice","item-type":"radio","_auto_id_":"6aa049f6-c2d2-4583-83b9-2960e217e5f8","label":"","required":false,"options":[{"label":"Day","value":"Day"},{"label":"The","value":"The"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Monthly\"","default":"\"Day\""}},{"name":"radio_yearly","type":"choice","item-type":"radio","_auto_id_":"44d82cf2-8ec5-4b12-8ec8-5d39a86300ef","label":"","required":false,"options":[{"label":"Every","value":"Every"},{"label":"The","value":"The"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"Every\"","show":"$store.pages.Team_Planner.radio_repeat === \"Yearly\""}},{"name":"select_daily_interval","type":"choice","item-type":"select","_auto_id_":"8fa3f07a-099a-4a83-b50e-38aeaf0e9cd8","label":"","required":false,"options":[{"label":"1 day","value":1},{"label":"2 days","value":2},{"label":"3 days","value":3},{"label":"4 days","value":"4"},{"label":"5 days","value":"5"},{"label":"6 days","value":"6"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Daily\" && $store.pages.Team_Planner.radio_daily === \"Daily every\""}},{"name":"select_weekly_interval","type":"choice","item-type":"select","_auto_id_":"94ca98d9-f284-4fac-a064-ae3974acf862","label":"","required":false,"options":[{"label":"Recur every 1 week on","value":1},{"label":"Recur every 2 weeks on","value":2},{"label":"Recur every 3 weeks on","value":3}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Weekly\"","default":"1"}},{"name":"checkbox_weekly_days","type":"choice","item-type":"checkbox","_auto_id_":"f21580f2-0e9c-4b71-a20e-030dc347cec0","label":"","required":false,"options":[{"label":"Monday","id":1},{"label":"Tuesday","id":2},{"label":"Wednesday","id":3},{"label":"Thursday","id":"4"},{"label":"Friday","id":"5"},{"label":"Saturday","id":"6"},{"label":"Sunday","id":"7"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","show":"$store.pages.Team_Planner.radio_repeat === \"Weekly\""},"validators":[]},{"name":"select_month_day","type":"choice","item-type":"select","_auto_id_":"5c32aa84-7eae-4837-97fe-9402ba16c47e","label":"","required":false,"options":[{"label":"1 of","value":1},{"label":"2 of","value":2},{"label":"3 of","value":3},{"label":"4 of","value":"4"},{"label":"5 of","value":"5"},{"label":"6 of","value":"6"},{"label":"7 of","value":"7"},{"label":"8 of","value":"8"},{"label":"9 of","value":"9"},{"label":"10 of","value":"10"},{"label":"11 of","value":"11"},{"label":"12 of","value":"12"},{"label":"13 of","value":"13"},{"label":"14 of","value":"14"},{"label":"15 of","value":"15"},{"label":"16 of","value":"16"},{"label":"17 of","value":"17"},{"label":"18 of","value":"18"},{"label":"19 of","value":"19"},{"label":"20 of","value":"20"},{"label":"21 of","value":"21"},{"label":"22 of","value":"22"},{"label":"23 of","value":"23"},{"label":"24 of","value":"24"},{"label":"25 of","value":"25"},{"label":"26 of","value":"26"},{"label":"27 of","value":"27"},{"label":"28 of","value":"28"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Monthly\" && $store.pages.Team_Planner.radio_monthly === \"Day\""}},{"name":"select_position","type":"choice","item-type":"select","_auto_id_":"b1b011e4-81bb-432d-8444-e82836cb0f33","label":"","required":false,"options":[{"label":"First","value":"First"},{"label":"Second","value":"Second"},{"label":"Third","value":"Third"},{"label":"Fourth","value":"Fourth"},{"label":"Last","value":"Last"}],"expressions":{"show":"($store.pages.Team_Planner.radio_repeat === \"Monthly\" && $store.pages.Team_Planner.radio_monthly === \"The\") || ($store.pages.Team_Planner.radio_repeat === \"Yearly\" && $store.pages.Team_Planner.radio_yearly === \"The\")"}},{"name":"select_weekday","type":"choice","item-type":"select","_auto_id_":"198aec6c-20c9-420b-83e0-1ad85ca09058","label":"","required":false,"options":[{"label":"Monday of","value":1},{"label":"Tuesday of","value":2},{"label":"Wednesday of","value":3},{"label":"Thursday of","value":"4"},{"label":"Friday of","value":"5"},{"label":"Saturday of","value":"6"},{"label":"Sunday of","value":"7"}],"expressions":{"show":"($store.pages.Team_Planner.radio_repeat === \"Monthly\" && $store.pages.Team_Planner.radio_monthly === \"The\") || ($store.pages.Team_Planner.radio_repeat === \"Yearly\" && $store.pages.Team_Planner.radio_yearly === \"The\")"}},{"name":"select_month_interval","type":"choice","item-type":"select","_auto_id_":"8c3dd328-6f0f-4011-a74f-08a71892adc4","label":"","required":false,"options":[{"label":"every month","value":1},{"label":"every 2 months","value":2},{"label":"every 3 months","value":3},{"label":"every 4 months","value":"4"},{"label":"every 5 months","value":"5"},{"label":"every 6 months","value":"6"},{"label":"every 7 months","value":"7"},{"label":"every 8 months","value":"8"},{"label":"every 9 months","value":"9"},{"label":"every 10 months","value":"10"},{"label":"every 11 months","value":"11"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Monthly\""}},{"name":"select_month","type":"choice","item-type":"select","_auto_id_":"4dc51de7-6ecd-4a16-b9c4-e433231bf33a","label":"","required":false,"options":[{"label":"January","value":"1"},{"label":"February","value":2},{"label":"March","value":"3"},{"label":"April","value":"4"},{"label":"May","value":"5"},{"label":"June","value":"6"},{"label":"July","value":"7"},{"label":"August","value":"8"},{"label":"September","value":"9"},{"label":"October","value":"10"},{"label":"November","value":"11"},{"label":"December","value":"12"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Yearly\""}},{"name":"select_year_month_day","type":"choice","item-type":"select","_auto_id_":"c909dbb2-3153-4a42-98d2-0c476d813df9","label":"","required":false,"options":[{"label":"1st","value":1},{"label":"2nd","value":2},{"label":"3rd","value":3},{"label":"4th","value":"4"},{"label":"5th","value":"5"},{"label":"6th","value":"6"},{"label":"7th","value":"7"},{"label":"8th","value":"8"},{"label":"9th","value":"9"},{"label":"10th","value":"10"},{"label":"11th","value":"11"},{"label":"12th","value":"12"},{"label":"13th","value":"13"},{"label":"14th","value":"14"},{"label":"15th","value":"15"},{"label":"16th","value":"16"},{"label":"17th","value":"17"},{"label":"18th","value":"18"},{"label":"19th","value":"19"},{"label":"20th","value":"20"},{"label":"21st","value":"21"},{"label":"22nd","value":"22"},{"label":"23rd","value":"23"},{"label":"24th","value":"24"},{"label":"25th","value":"25"},{"label":"26th","value":"26"},{"label":"27th","value":"27"},{"label":"28th","value":"28"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Yearly\" && $store.pages.Team_Planner.radio_yearly === \"Every\""}},{"name":"button_bar","type":"area","item-type":"button-bar","_auto_id_":"c084fba0-2731-4e81-bcab-c5b53536957e","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel","type":"button","item-type":"button","_auto_id_":"57bf273b-dce8-4d17-b350-41b8f25685f7","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Team_Planner","componentInstanceId":"a6484396-13a0-4914-b523-f69b985e2650","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"021e1425-197b-4b43-b6d0-28cd1ac40f7f"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.selected_visit.repeat;"},"_auto_id_":"0047cd52-947e-4c45-9cd0-77692e173bee"}]},{"name":"button_add","type":"button","item-type":"button","_auto_id_":"b2a3f6fc-dad7-4f71-ae16-0adf58ac2c0f","content":"ADD REPEAT","theme":"default","expressions":{},"classes":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var p = cti.store.pages.Team_Planner;\nvar s = p.radio_repeat + \": \";\nvar validationError = false;\nvar validationErrorMessage = \"\";\n\nif (p.radio_repeat === \"Daily\") {\n  s += p.radio_daily;\n  if (p.radio_daily != undefined) {\n    if (p.radio_daily === \"Daily every\") {\n      if(p.select_daily_interval != undefined) {\n        s += \" \" + p.select_daily_interval.label;\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Daily Interval value.\"\n      }\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Daily Interval type.\"\n  }\n} else if (p.radio_repeat === \"Weekly\") {\n  if(p.select_weekly_interval != undefined) {\n    if(p.checkbox_weekly_days != undefined) {\n      var mon = true, \n          tue = true,\n          wed = true, \n          thu = true,\n          fri = true,\n          sat = true,\n          sun = true;\n\n      s += p.select_weekly_interval.label + \" \";\n\n      if (p.checkbox_weekly_days[1]) {\n        s += \"Monday, \";\n      } else { mon = false; }\n      if (p.checkbox_weekly_days[2]) {\n        s += \"Tuesday, \";\n      } else { tue = false; }\n      if (p.checkbox_weekly_days[3]) {\n        s += \"Wednesday, \";\n      } else { wed = false; }\n      if (p.checkbox_weekly_days[4]) {\n        s += \"Thursday, \";\n      } else { thu = false; }\n      if (p.checkbox_weekly_days[5]) {\n        s += \"Friday, \";\n      } else { fri = false; }\n      if (p.checkbox_weekly_days[6]) {\n        s += \"Saturday, \";\n      } else { sat = false; }\n      if (p.checkbox_weekly_days[7]) {\n        s += \"Sunday, \";\n      } else { sun = false; }\n\n      if(!mon && !tue && !wed && !thu && !fri && !sat && !sun) {\n        validationError = true;\n        validationErrorMessage = \"Please select the days in which you would like the Weekly Interval to occur.\"\n      } else {\n        s = s.substring(0, s.length - 2);\n      }\n    } else {\n      validationError = true;\n      validationErrorMessage = \"Please select the days in which you would like the Weekly Interval to occur.\"\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Weekly Recurring type.\"\n  }\n} else if (p.radio_repeat === \"Monthly\") {\n  if(p.radio_monthly != undefined) {\n  \ts += p.radio_monthly + \" \";\n    \n  \tif(p.radio_monthly === \"Day\") {\n      if(p.select_month_day != undefined) {\n    \ts += p.select_month_day.label + \" \";\n        \n        if(p.select_month_interval != undefined) {\n          s += p.select_month_interval.label + \" \";\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Monthly Interval value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Day in the Month.\"\n      }\n    } else {\n      if(p.select_position != undefined) {\n      \ts += p.select_position.label + \" \";\n        if(p.select_weekday != undefined) {\n          s += p.select_weekday.label + \" \";\n          if(p.select_month_interval != undefined) {\n      \t\ts += p.select_month_interval.label + \" \";\n          } else {\n            validationError = true;\n            validationErrorMessage = \"Please select a Monthly Interval value.\"\n          }\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Day value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Position value.\"\n      }\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Monthly Interval type.\"\n  }\n} else if (p.radio_repeat === \"Yearly\") {\n  if(p.radio_yearly != undefined) {\n  \ts += p.radio_yearly + \" \";\n    \n  \tif(p.radio_yearly === \"Every\") {\n      if(p.select_month != undefined) {\n    \ts += p.select_month.label + \" \";\n        if(p.select_year_month_day != undefined) {\n    \t  s += p.select_year_month_day.label + \" \";\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Year/Month value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Month value.\"\n      }\n    } else {\n      if(p.select_position != undefined) {\n      \ts += p.select_position.label + \" \";\n        if(p.select_weekday != undefined) {\n          s += p.select_weekday.label + \" \";\n          if(p.select_month != undefined) {\n      \t\ts += p.select_month.label + \" \";\n          } else {\n            validationError = true;\n            validationErrorMessage = \"Please select a Month value.\"\n          }\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Day value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Position value.\"\n      }\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Yearly Interval type.\"\n  }\n} else {\n  validationError = true;\n  validationErrorMessage = \"Please select a type of Interval Appointment.\"\n}\n\nif(cti.store.pages.Team_Planner.number_appointments === undefined) {\n  validationError = true;\n  validationErrorMessage = \"Please enter a number of Repeat Appointments.\"\n}\n\nif(validationError) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Validation Error on Team Planner\", \n    \"text\" : validationErrorMessage\n  }); \n} else {\n  cti.store.variables.selected_visit.repeat = s;\n  $success();\n}"},"_auto_id_":"53a4f3ba-cea4-4ba4-86ee-1f4c57ab6ad5"},{"event":"click","type":"call-component-function","data":{"page":"Team_Planner","componentInstanceId":"a6484396-13a0-4914-b523-f69b985e2650","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"bbc7f5f3-9ba6-4e94-923d-85e115aae252"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"9f8ede8e-76f6-48d8-877f-c39d56f07cf0","attributes":{"id":"popup_repeat_visit"},"expressions":{},"actions":[]}],"_auto_id_":"228c0443-34bb-42eb-94db-ebbb372a504e"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"fab7c746-858a-43b3-9517-89b491905824","content":"SAVE TO TEAM PLANNER","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.repeater.Team_Planner.group_activities.length === 0) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Validation Error on Team Planner\", \n    \"text\" : \"Please select at least 1 valid Activity from the list above.\"\n  }); \n} else {\n  $success();\n}"},"_auto_id_":"b338f353-9726-4f95-932b-73f458fb7b6a"},{"event":"click","type":"call-actionflow","data":{"name":"AddTPAppointment"},"_auto_id_":"5724974d-d28c-47be-8f60-b4565b7b2742"}],"classes":"default"}],"_auto_id_":"ec80c542-d755-495c-afdb-a74a519df707","expressions":{}}],"_auto_id_":"d3079477-89a6-4e6d-915f-094169eec29e"},{"start":false,"name":"HCP_Diary","config":[{"name":"Page Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"0796e390-7d76-4413-b7c5-4e6e9cec4b80","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"//Set a default for the switch questions\n\nif(cti.store.pages.HCP_Diary.switch_carer_appointment === undefined){\n  cti.store.pages.HCP_Diary.switch_carer_appointment = false;\n}\n\nif(cti.store.pages.HCP_Diary.switch_proxy_contact === undefined){\n  cti.store.pages.HCP_Diary.switch_proxy_contact = false;\n}\n\nif(cti.store.pages.HCP_Diary.switch_f2f_contact === undefined){\n  cti.store.pages.HCP_Diary.switch_f2f_contact = false;\n}\n\n\nif(cti.store.pages.HCP_Diary.switch_non_client === undefined){\n  cti.store.pages.HCP_Diary.switch_non_client = false;\n}\n\n//Set a default for the duration slider\n\nif(cti.store.pages.HCP_Diary.slider_duration === undefined){\n  cti.store.pages.HCP_Diary.slider_duration = 15;\n}\n\n$success()"},"_auto_id_":"79759872-eda5-458d-900b-4d8ec44f1388","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"eb43c0ea-805c-45a7-8ed6-75c2073917c4","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"38fe4612-ccde-4346-8cc0-22dd7870a9fd"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>HCP DIARY</h4>","_auto_id_":"344d08ad-117d-4b08-88c9-493cb72caa2c"}],"_auto_id_":"a76f9417-7d18-4bac-b388-d0badb1789ff","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"b4a09fb4-d2dc-498b-8b83-04200085954d","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"d46ada18-720d-4dc9-bec4-e6531cc5d973","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"date_planner","type":"user-input","item-type":"date","_auto_id_":"5c1d347c-a240-4e3c-b2dc-f9ef1b8e50e1","label":"Date: ","required":true,"left-icon":"fa-calendar","expressions":{},"classes":"compact silver date_icon_left","message":"This is a required field","validators":[],"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"if (cti.store.pages.HCP_Diary.date_planner === null) {\n  cti.store.variables.v_availableSlots = null\n  return false\n}\n\n// Get the selected date from the date question and record the selected day of the week\ncti.store.variables.v_selectedAppointmentDate = moment(cti.store.pages.HCP_Diary.date_planner)\n\ncti.store.variables.v_selectedDayOfWeek = cti.store.variables.v_selectedAppointmentDate.day() - 1 // moment defaults to a Sunday start of week, which I disagree with.\n\nvar fourWeeks = moment()\n  .add(4, 'weeks')\n  .format('YYYY-MM-DD')\nvar maxDaysFromNow = moment(fourWeeks).diff(moment(), 'days')\nvar selectedDaysFromNow = cti.store.variables.v_selectedAppointmentDate.diff(moment(), 'days')\n\nif (selectedDaysFromNow < maxDaysFromNow && selectedDaysFromNow >= 0) {\n  cti.store.variables.v_isValidAppointmentDate = true\n} else {\n  cti.store.variables.v_isValidAppointmentDate = false\n  cti.utils.callAction('show-notification', { name: 'notification_error', title: 'Invalid Date Selection', text: 'Appointments cannot be booked for past dates and can only be booked up to 4 weeks from the current date.' })\n  return false;\n}\n\nvar selectedDayBusySlots = cti.store.api.api_rio.busydiaryslots.data.filter(e => {\n  return e.startDateTime.substr(0, 10) === cti.store.variables.v_selectedAppointmentDate.format('YYYY-MM-DD')\n})\n\ncti.store.variables.v_availableSlots = cti.fn_merge_busy_slots(selectedDayBusySlots, cti.store.variables.v_selectedDayOfWeek)\n\n// Check to see if we have any valid slots and warn user if we do\nif(cti.store.variables.v_availableSlots.length === 0) {\n  cti.store.variables.v_isValidAppointmentDate = false\n  cti.utils.callAction('show-notification', { \n    name: 'notification_error', \n    title: 'No Diary Slots Available', \n    text: 'You have selected a date that does not contain any valid Diary slots. Please select an alternative date and try again.' \n  })\n}\n\n// Reset the intended duration value as each time the date changes the time will do also\ncti.store.pages.HCP_Diary.select_intended_duration = undefined;\ncti.store.variables.v_intended_durations = undefined;\n\n// Reset start time as we have a new date value\ncti.store.pages.HCP_Diary.select_start_time = undefined;\n\n$success()"},"_auto_id_":"dbffe50c-a7e5-4668-aab1-e5d3319d2160"}]},{"name":"select_start_time","type":"choice","item-type":"select","_auto_id_":"74c724fb-c2bb-48a3-9e0d-d07ccf7cb9d4","label":"Start Time:","required":true,"options":[],"expressions":{"disabled":"$store.variables.v_isValidAppointmentDate === false || $store.variables.v_isValidAppointmentDate === undefined"},"classes":"compact silver","option-source":"$store.variables.v_availableSlots","label-property":"value","value-property":"code","message":"This is a required field","actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"var startTime = cti.store.pages.HCP_Diary.select_start_time.value;\nvar templates = cti.store.variables.v_diary_template;\n\nvar weekday = new Array(7);\nweekday[1]=\"Monday\";\nweekday[2]=\"Tuesday\";\nweekday[3]=\"Wednesday\";\nweekday[4]=\"Thursday\";\nweekday[5]=\"Friday\";\nweekday[6]=\"Saturday\";\nweekday[0]=\"Sunday\";\n\nvar day = weekday[cti.store.variables.v_selectedDayOfWeek];\n\nfor(var i in templates) {\n  if(templates[i].name == day) {\n    var sessions = templates[i].sessions;\n    break;\n  }\n}\n\nfor(var x in sessions) {\n  var sessionStartHours = moment(sessions[x].startTime, 'HH:mm:ss').format('HH');\n  \n  var sessionEndHours = moment(sessions[x].endTime, 'HH:mm:ss').format('HH');\n  var sessionEndMins = moment(sessions[x].endTime, 'HH:mm:ss').format('mm');\n\n  var hours = moment(startTime, 'HH:mm:ss').format('HH');\n  var mins = moment(startTime, 'HH:mm:ss').format('mm');\n\n  if(hours >= sessionStartHours && (hours < sessionEndHours || hours === sessionEndHours && sessionEndMins <= 30)) {\n    var obj = {\n      label: sessions[x].slotLength + ' minutes',\n      value: sessions[x].slotLength\n    };\n    cti.store.variables.v_intended_durations = []\n    cti.store.variables.v_intended_durations.push(obj);\n    break;\n  }\n}\n\nif(cti.store.pages.HCP_Diary.select_intended_duration === undefined) {\n  cti.store.pages.HCP_Diary.select_intended_duration = {\n    code: cti.store.variables.v_intended_duration.label,\n    value: cti.store.variables.v_intended_duration.value\n  }\n}\n\ncti.utils.updatePage();"},"_auto_id_":"c8f63acc-6205-4ca5-8d63-1a1203c76584"}]},{"name":"select_intended_duration","type":"choice","item-type":"select","_auto_id_":"5d78c72a-aa4a-450a-98f0-d5b2d4c00c83","label":"Duration: ","required":true,"options":[{"label":"Option 1","value":1},{"label":"Option 2","value":2},{"label":"Option 3","value":3}],"message":"This is a required field","expressions":{"disabled":"$store.pages.HCP_Diary.select_start_time === undefined"},"classes":"compact silver","option-source":"$store.variables.v_intended_durations","label-property":"label","value-property":"value","actions":[]},{"name":"select_location","type":"choice","item-type":"select","_auto_id_":"dad7801f-1015-4f92-a198-610a79e1b321","label":"Location:","required":true,"options":[],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.locations.location","label-property":"value","value-property":"code"},{"name":"select_urgency","type":"choice","item-type":"select","_auto_id_":"909f05a8-e492-413f-bdf2-70fc7474346d","label":"Urgency:","required":true,"options":[],"expressions":{"default":"\"Routine\"","show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.urgencies.urgency","label-property":"value","value-property":"code"},{"name":"select_type","type":"choice","item-type":"select","_auto_id_":"d0f4b0ca-a420-406b-819f-6c4f784cc500","label":"Type:","required":true,"options":[],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.types.type","label-property":"value","value-property":"code"},{"name":"group_activities","type":"area","item-type":"group","_auto_id_":"d384533c-872f-4192-a013-dd3d50b1ea9d","content":[{"name":"activity","type":"choice","item-type":"select","_auto_id_":"b9f220bc-c521-4516-a094-2989b65c5b45","label":"Activities: ","required":true,"options":[],"expressions":{},"validators":[],"actions":[],"message":"This is a required field","option-source":"$store.variables.selected_visit.attendees.attendee.possibleActivities.possibleActivity","label-property":"value","value-property":"code"}],"repeat":true,"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"}},{"name":"list_activities","type":"content","item-type":"list","_auto_id_":"386d5faf-0918-4fd2-b1f7-57a85addc410","search":"","classes":"","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.HCP_Diary.group_activities.splice( $data.$item.$index, 1);"},"_auto_id_":"8099db9d-feeb-450d-98bb-7fce438461ac","actions":[]}],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"model":"$store.repeater.HCP_Diary.group_activities","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_activities_html","_auto_id_":"a2d1e986-cdaf-415d-b472-35488bccdbc8","content":"<i class=\"fa fa-times-circle-o\"></i> {{$data.$item.activity.label}}","expressions":{}}]},{"name":"text_comment","type":"user-input","item-type":"text","_auto_id_":"77838979-1802-4137-80ee-26f9c1b3a312","label":"Comments: ","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"}},{"name":"button_advanced","type":"button","item-type":"button","_auto_id_":"a80681f0-d97a-4651-93fe-f23f88f486ae","content":"{{'$store.variables.show_advanced_appt == false ? \"Show Advanced...\" : \"Hide Advanced\"' | store}}","theme":"default","actions":[{"type":"if","data":{},"_auto_id_":"48c7dd83-263a-4f7e-88b4-69ae53bcfe9a","operations":[{"type":"value","content":"{{$store.variables.show_advanced_appt}}","$selected":false},{"type":"operator","content":"==","$selected":false},{"type":"value","content":"{{true}}","$selected":false}]},{"event":"click","type":"set-variable","data":{"name":"show_advanced_appt","value":"{{false}}"},"_auto_id_":"5271122d-1a00-441e-9f1e-31a6f4568227"},{"type":"otherwise","data":{},"_auto_id_":"be1a70d4-1f51-420c-bf38-0ca9deb4943e"},{"event":"click","type":"set-variable","data":{"name":"show_advanced_appt","value":"{{true}}"},"_auto_id_":"57429d8f-3784-4775-ad4a-a29e8559cfbc"},{"type":"end-if","data":{},"_auto_id_":"9c3ca826-6cdf-459f-86b7-4bce40e34541"}],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"}},{"name":"group_advanced","type":"area","item-type":"group","_auto_id_":"7e482bd5-03b8-47d8-bdf6-639d9490aba5","content":[{"name":"switch_carer_appointment","type":"choice","item-type":"switch","_auto_id_":"120af3c2-64d1-4a8c-9421-5f706d429690","label":"Carer appointment:","required":false,"on-text":"YES","off-text":"NO","expressions":{},"classes":"","actions":[]},{"name":"switch_proxy_contact","type":"choice","item-type":"switch","_auto_id_":"4c2c2a9b-e568-4a47-9b50-f21eb96bd911","label":"Proxy Contact:","required":false,"on-text":"YES","off-text":"NO","expressions":{}},{"name":"switch_f2f_contact","type":"choice","item-type":"switch","_auto_id_":"002af982-e30b-4480-8b32-c0769c567f06","label":"Face to face contact:","required":false,"on-text":"YES","off-text":"NO","expressions":{},"validators":[],"actions":[]},{"name":"switch_non_client","type":"choice","item-type":"switch","_auto_id_":"2d1676dd-f3b3-421e-b856-29e6c18967e1","label":"Non Client Appointment","required":false,"on-text":"YES","off-text":"NO","expressions":{},"validators":[]},{"name":"contact_comment","type":"user-input","item-type":"text","_auto_id_":"78cdc452-8198-4697-9d2e-f1a0b9c953ae","label":"Comments for Contact:","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"select_transport_required","type":"choice","item-type":"select","_auto_id_":"0d6f8d64-07d5-4cab-a663-617691cedabe","label":"Transport:","required":false,"options":[],"expressions":{"default":"\"Not Required\""},"validators":[],"classes":"compact","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.transportRequired.transport","label-property":"value","value-property":"code"},{"name":"transport_comment","type":"user-input","item-type":"text","_auto_id_":"5684c483-3bcc-4b57-bf81-1ad2b86fe315","label":"Comments for Transport:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.HCP_Diary.select_transport_required.label !== 'Not Required' && $store.pages.HCP_Diary.select_transport_required !== null && $store.pages.HCP_Diary.select_transport_required !== undefined"}},{"name":"select_interpret_required","type":"choice","item-type":"select","_auto_id_":"140aab6b-f6bb-4ec9-b213-5c3fff3972fb","label":"Interpreter:","required":false,"options":[],"expressions":{"default":"\"Not Required\""},"validators":[],"actions":[],"classes":"compact","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.interpreterRequired.interpreter","label-property":"value","value-property":"code"},{"name":"select_interpret_language","type":"choice","item-type":"select","_auto_id_":"423b3fd8-1afd-4773-9ba5-d18f5e893259","label":"Language:","required":false,"options":[],"option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.interpreterLanguages.interpreterLanguage","label-property":"value","value-property":"code","validators":[],"actions":[],"expressions":{"show":"$store.pages.HCP_Diary.select_interpret_required.label !== \"Not Required\" && $store.pages.HCP_Diary.select_interpret_required !== null && $store.pages.HCP_Diary.select_interpret_required !== undefined"},"classes":"compact"},{"name":"interpreter_comment","type":"user-input","item-type":"text","_auto_id_":"2d7970e8-14fe-4ee9-a62e-9feedbe917ee","label":"Comments for Interpreter:","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.HCP_Diary.select_interpret_required.label !== \"Not Required\" && $store.pages.HCP_Diary.select_interpret_required !== null && $store.pages.HCP_Diary.select_interpret_required !== undefined"}}],"repeat":false,"expressions":{"show":"$store.variables.show_advanced_appt"}}],"_auto_id_":"02023256-ec5e-4e8f-b030-432c6c7c002d"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"529abd7a-e4b0-4985-bbba-0f9696f3b5a1","content":"SAVE TO HCP DIARY","theme":"default","expressions":{"disabled":"$form.invalid || $store.repeater.HCP_Diary == undefined || $store.repeater.HCP_Diary.group_activities == undefined || $store.repeater.HCP_Diary.group_activities.length == 0"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.v_appointmentToAdd_clear = true\n$success();"},"_auto_id_":"c1a26c63-107b-4e7b-a98a-1e0f50d3b7bc"},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"1369c07f-b579-40ed-aaf7-abeefd02ffbe"}],"classes":"default"}],"_auto_id_":"e9afb12c-62ec-4ef1-98d8-954059ce9f1a","expressions":{}}],"_auto_id_":"a5e97c18-a35b-47d4-93ac-244d1204fa77"},{"start":false,"name":"Document","config":[{"name":"Page Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"91062a97-05ac-49c4-b7ef-afd3501891f5","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"var userAssetLocation = cti.store.schema.assetDir || 'user-assets/';\nvar base64Data = \"data:\" + cti.store.variables.v_selectedDocument.fileType + \";base64,\" + cti.store.variables.v_selectedDocument.base64;\n\n// Check fileType of document...\nif(cti.store.variables.v_selectedDocument.fileType == \"image/jpeg\") {\n  // Load Spinner\n  cti.fn_toggle_spinner('open', 'Loading Image...');\n  \n  // ... if type of jpeg process under the embed tag\n  // Grab the page div element for display\n  var imageDiv = document.getElementById('image');\n  imageDiv.classList.add(\"doc-image-class\");\n\n  var img = document.createElement('img');\n  img.id = \"embed-doc\";\n  img.style.width = \"100%\"\n  img.style.height = \"100%\"\n  img.src = base64Data;\n  img.type = cti.store.variables.v_selectedDocument.fileType;\n  imageDiv.appendChild(img);\n  \n  // Close Spinner\n  cti.fn_toggle_spinner('close', '', 1000);\n} else if(cti.store.variables.v_selectedDocument.fileType == \"image/png\") {\n  // Load Spinner\n  cti.fn_toggle_spinner('open', 'Loading Image...');\n  \n  // ... if type of jpeg process under the embed tag\n  // Grab the page div element for display\n  var imageDiv = document.getElementById('image');\n  imageDiv.classList.add(\"doc-image-class\");\n\n  var img = document.createElement('img');\n  img.id = \"embed-doc\";\n  img.style.width = \"100%\"\n  img.style.height = \"100%\"\n  img.src = base64Data;\n  img.type = cti.store.variables.v_selectedDocument.fileType;\n  imageDiv.appendChild(img);\n  \n  // Close Spinner\n  cti.fn_toggle_spinner('close', '', 1000);\n} else if(cti.store.variables.v_selectedDocument.fileType == \"application/pdf\") {\n  // Load Spinner\n  cti.fn_toggle_spinner('open', 'Loading PDF...');\n  \n  var pdfDiv = document.getElementById('pdf');\n  pdfDiv.classList.add(\"doc-image-class\");\n  \n  base64Data = base64Data.replace(/^[^,]+,/, '');\n  var pdfData = atob(base64Data);\n\n  PDFJS.workerSrc = userAssetLocation+'pdf.worker.js'\n  \n  var loadingTask = PDFJS.getDocument({data: pdfData});\n  loadingTask.promise.then(function(pdf) {\n    var pageNumber = 1;\n    pdf.getPage(pageNumber).then(function(page) {\n      // Customised viewport setting\n      var desiredWidth = screen.width - 20;\n      var viewport = page.getViewport(1);\n      var scale = desiredWidth / viewport.width;\n      var scaledViewport = page.getViewport(scale);\n\n      // Prepare canvas using PDF page dimensions\n      var canvas = document.getElementById('the-canvas');\n      var context = canvas.getContext('2d');\n      canvas.height = scaledViewport.height;\n      canvas.width = scaledViewport.width;\n\n      // Render PDF page into canvas context\n      var renderContext = {\n        canvasContext: context,\n        viewport: scaledViewport\n      };\n      var renderTask = page.render(renderContext);\n      renderTask.then(function () {\n        // Close Spinner\n        cti.fn_toggle_spinner('close', '', 500);\n      });\n    });\n  }, function (reason) {\n    // PDF loading error\n    console.error(reason);\n    // Close Spinner\n    cti.fn_toggle_spinner('close', '', 500);\n  });\n}\n\ncti.utils.updatePage();\n$success()"},"_auto_id_":"2255c66d-69d1-4f42-a198-87595f970bbc"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"6dce130b-fdea-4bb4-9260-07309ca16a38","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline function - button_back - page: Document', \n  'info'\n)\n\nif(cti.store.variables.v_selectedDocument && cti.store.variables.v_selectedDocument.fileType == \"application/pdf\") {\n  var canvas = document.getElementById('the-canvas');\n  var context = canvas.getContext('2d');\n  context.clearRect(0, 0, canvas.width, canvas.height);\n} else if(cti.store.variables.v_selectedDocument && cti.store.variables.v_selectedDocument.fileType == \"image/jpeg\") {\n  var imageDiv = document.getElementById('image');\n  var embed = document.getElementById('embed-doc');\n  \n  if(embed != null) {\n    imageDiv.removeChild(embed);\n  }\n} else if(cti.store.variables.v_selectedDocument && cti.store.variables.v_selectedDocument.fileType == \"image/jpg\") {\n  var imageDiv = document.getElementById('image');\n  var embed = document.getElementById('embed-doc');\n  \n  if(embed != null) {\n    imageDiv.removeChild(embed);\n  }\n} else if(cti.store.variables.v_selectedDocument && cti.store.variables.v_selectedDocument.fileType == \"image/png\") {\n  var imageDiv = document.getElementById('image');\n  var embed = document.getElementById('embed-doc');\n  \n  if(embed != null) {\n    imageDiv.removeChild(embed);\n  }\n}\n\ndelete cti.store.variables.v_selectedDocument\ndelete cti.store.variables.v_documentGetPayload\n\nvar view_name = cti.store.variables.visit_view_mode\nvar page = \"Visit\"\n\nif(view_name == \"Timeline\") {\n  page = \"Timeline\"\n} else if(view_name == \"Patient Demographics\") {\n  page = \"Patient\"\n} else if(view_name == \"Alerts\") {\n  page = \"Alerts\"\n} else if(view_name == \"Appointments\") {\n  page = \"Appointments\"\n} else if(view_name == \"Referrals\") {\n  page = \"Referrals\"\n} else if(view_name == \"Progress Notes\") {\n  page = \"Notes\"\n} else if(view_name == \"Documents\") {\n  page = \"Documents\"\n} else if(view_name == \"Allergies\") {\n  page = \"Allergies\"\n} else if(view_name == \"Contacts\") {\n  page = \"Contacts\"\n}\n\ncti.utils.callAction(\"go-to-page\", { \"name\" : page })"},"_auto_id_":"aa86d76b-bd5c-4bd4-a3ec-7454be2318a4"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Document Display</h4>","_auto_id_":"51e7e95f-b71e-4815-b858-e43d79761d03"},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"0b00b546-5a45-4af8-b747-c67fa1b14f2f","attributes":{},"expressions":{}}],"_auto_id_":"9315da6e-49ef-48f3-8253-1d5537080d79"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"bac97838-f481-49a3-bbf3-c9535576d4bf","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"2b583f94-ec21-49b9-9969-12375c558055","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_pdf_area","type":"content","item-type":"html","_auto_id_":"0dc35e63-1400-40a2-a413-08bf5090233d","content":"<div id=\"pdf\">\n  <canvas id=\"the-canvas\"></canvas>\n</div>","expressions":{"show":"$store.variables.v_selectedDocument.fileType == \"application/pdf\""}},{"name":"html_image_area","type":"content","item-type":"html","_auto_id_":"7f5a7944-007a-440c-800c-be26cb93c381","content":"<div id=\"image\"></div>","expressions":{"show":"$store.variables.v_selectedDocument.fileType == \"image/jpeg\" || $store.variables.v_selectedDocument.fileType == \"image/jpg\" || $store.variables.v_selectedDocument.fileType == \"image/png\""}}],"_auto_id_":"ab1e126a-ea04-4449-abf6-4ccd0256eadd"}],"_auto_id_":"ad689e1f-97bc-4768-8a31-a0356adc3292"},{"start":false,"name":"Enter_PIN","config":[],"content":[{"name":"header","type":"area","item-type":"static","_auto_id_":"10e8dd8a-6804-48f7-a00a-f59d0173f9e1","content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"9489b677-a394-4dca-b574-46de1bebe1ea","attributes":{},"expressions":{}},{"name":"html_splash","type":"content","item-type":"html","_auto_id_":"406e8a5d-66a7-4daa-b0be-abfcd0f06719","content":"<div class=\"header\">\n  <div class=\"logo\"/>\n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_instructions","type":"content","item-type":"html","_auto_id_":"5d8378ff-53fc-46ee-9236-18f1dd937cfe","content":"<div class=\"splash\">\n  <div class=\"riologo\"/>\n</div>\n<h3>Enter App Pin</h3>\n<h5>Please enter your app PIN below</h5>","expressions":{}},{"name":"group_login","type":"area","item-type":"group","_auto_id_":"69648083-e666-4b66-9e47-64d516c4f11d","content":[{"name":"pwdUserPIN","type":"user-input","item-type":"password","_auto_id_":"66759f7f-54c6-4fa1-b118-10eca9d1a5d6","label":"","required":false,"message":"This is a required field","expressions":{},"placeholder":"Enter your app PIN","actions":[{"event":"enter","type":"inline-function","data":{"sync":true,"code":"if (window.debug) {\n  debugger\n}\n\nconst btn = document.querySelector('a#button_submit_pin')\n\nif (btn) {\n  btn.click()\n}"},"_auto_id_":"855263a8-454b-419e-a604-734afe5f2830"}],"validators":[],"classes":"minimal"},{"name":"button_submit_pin","type":"button","item-type":"button","_auto_id_":"1874dda9-5b11-457a-8027-9ff8896896c0","content":"Enter Pin","theme":"minimal","expressions":{"disabled":"$store.pages.Enter_PIN.pwdUserPIN === undefined || $store.pages.Enter_PIN.pwdUserPIN === \"\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.pages.Enter_PIN && cti.store.pages.Enter_PIN.pwdUserPIN == cti.store.variables.v_userPIN){\n  cti.fn_toggle_spinner('open', 'Loading...');\n  \n  cti.store.pages.Enter_PIN.pwdUserPIN = \"\";\n  cti.store.variables.pin_login = true\n  \n  cti.store.variables.v_appointmentDate = moment().format(\"YYYY-MM-DD\");\n  cti.store.variables.v_appointmentDateText = 'Today';\n  \n  if(cti.store.variables.online) {\n    cti.fn_toggle_spinner('open', 'Fetching Appointments, please wait...')\n    cti.utils.callAction(\"call-actionflow\", { name: \"GetVisitList\" })\n  } else {\n    cti.fn_load_appointments()\n  }\n  \n  cti.fn_startActivityListener()\n} else {\n  cti.store.pages.Enter_PIN.pwdUserPIN = \"\";\n  cti.store.variables.v_pinAttempts = cti.store.variables.v_pinAttempts + 1;\n\n  if(cti.store.variables.v_pinAttempts >= 3){\n    delete cti.store.variables.v_userPIN;\n    delete cti.store.variables.v_isAuthenticated;\n    cti.store.variables.v_pinAttempts = 0; \n    cti.store.pages.Login.password = \"\";\n    cti.utils.callAction(\"go-to-page\", {\"name\" : \"Login\"});\n  }\n}"},"_auto_id_":"1aee173c-ad7d-4158-a860-40e4e9a432c1"}],"classes":"default"},{"name":"button_revoke","type":"button","item-type":"button","_auto_id_":"7af4fd06-0c62-4b48-b649-3a0db0afc27b","content":"Revoke Authentication","theme":"minimal","expressions":{"show":"$store.variables.v_isAuthenticated"},"actions":[{"event":"click","type":"call-actionflow","data":{"name":"RevokeAuthentication"},"_auto_id_":"b097324c-b0f6-4345-92ab-31255092f433"},{"event":"click","type":"call-actionflow","data":{"name":"DeregisterPush"},"_auto_id_":"6c424f55-efcf-4cda-ba23-62080d1062b1"}]}],"repeat":false,"expressions":{}}],"_auto_id_":"c05ea891-c767-4611-81ee-6c8cc1132876"}],"_auto_id_":"b1ba7e87-eef9-4a3a-96b7-860a76afb916"},{"start":false,"name":"Set_PIN","config":[],"content":[{"name":"header","type":"area","item-type":"static","_auto_id_":"7593aaff-d1e1-4980-b75d-25890e02c450","content":[{"name":"html_splash","type":"content","item-type":"html","_auto_id_":"7495a1fa-1f78-415a-9174-e740e5410b86","content":"<div class=\"header\">\n  <div class=\"logo\"/>\n</div>","expressions":{}},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"aadeac77-46b6-4c51-8c52-4f176b2a35b2","attributes":{},"expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_instructions","type":"content","item-type":"html","_auto_id_":"59c11ec7-e1e6-4476-87c3-b227e659023d","content":"<div class=\"splash\">\n  <div class=\"riologo\"/>\n</div>\n<h3>Set App Pin</h3>\n<h5>Set a PIN code for this app below</h5>","expressions":{}},{"name":"group_login","type":"area","item-type":"group","_auto_id_":"e89a756d-1e13-413e-b90b-4d45f5799de6","content":[{"name":"txtPIN","type":"user-input","item-type":"text","_auto_id_":"a6d0a1f5-2608-4f9e-a550-6c30f274f6c4","label":"","required":false,"multiline":false,"debounce":250,"expressions":{},"validators":[],"actions":[{"event":"enter","type":"inline-function","data":{"sync":true,"code":"const btn = document.querySelector('a#button_set_pin')\n\nif (btn) {\n  btn.click()\n}"},"_auto_id_":"f13b777d-6a11-4de8-b6b2-7be9c7c2cd38"}],"classes":"minimal"},{"name":"button_set_pin","type":"button","item-type":"button","_auto_id_":"3aa427a5-8a1b-4be8-a81e-2c81097a0009","content":"Set Pin","theme":"minimal","expressions":{"disabled":"$store.pages.Set_PIN.txtPIN === undefined"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (cti.store.pages.Set_PIN.txtPIN != '') {\n  cti.fn_toggle_spinner('open', 'Setting PIN...');\n  \n  cti.store.variables.v_userPIN = cti.store.pages.Set_PIN.txtPIN\n  cti.store.pages.Set_PIN.txtPIN = ''\n\n  cti.store.variables.v_pinAttempts = 0\n\n  if (cti.store.variables.getVisitListStatus) {\n    cti.fn_load_appointments()\n  } else {\n    cti.store.variables.v_appointmentDate = moment().format('YYYY-MM-DD')\n    cti.store.variables.v_appointmentDateText = 'Today'\n\n    cti.fn_toggle_spinner('open', 'Fetching Appointments, please wait...')\n    cti.utils.callAction('call-actionflow', { name: 'GetVisitList' })\n  }\n\n  cti.fn_startActivityListener()\n}\n"},"_auto_id_":"356212df-0400-462b-a2d0-ffac6832bbf7","actions":[]}],"classes":"default"},{"name":"button_revoke","type":"button","item-type":"button","_auto_id_":"db911f98-9981-48a7-9020-8d834801df45","content":"Revoke Authentication","theme":"minimal","expressions":{"show":"$store.variables.v_isAuthenticated"},"actions":[{"event":"click","type":"call-actionflow","data":{"name":"RevokeAuthentication"},"_auto_id_":"4cd10f9c-5212-4e0f-a438-549bc1ece102"},{"event":"click","type":"call-actionflow","data":{"name":"DeregisterPush"},"_auto_id_":"544bad4a-a03c-4bbd-a9e7-401e522c6f16"}]}],"repeat":false,"expressions":{}}],"_auto_id_":"3c35c622-ba57-4cee-8fa2-9fa4e78e3a20"}],"_auto_id_":"4873da73-3a34-4db6-9a3d-2a6707e940da"},{"start":false,"name":"RemoveAlert","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"d0c168ec-adf2-4928-9a0b-e024057f8855","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"RemoveAlert","componentInstanceId":"cdb47658-47a4-488b-9004-ae58d036f2f3","function":"toggle"},"_auto_id_":"cf8681e7-6518-43d7-813e-fc7a4a9b59db"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"55d92a33-03d0-4c61-829e-0f735246b5ae","attributes":{},"expressions":{}},{"name":"title","type":"content","item-type":"title","content":"<h4>Remove Alert</h4>","_auto_id_":"666c7d11-9902-4a9c-b408-43f4219c668f"}],"_auto_id_":"25ad56c4-30f7-4a13-84a0-0e642ca5602f"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"9520fd0a-c59e-4552-95bf-cbdc96e3e4d2","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"8cfc4e1c-ccc9-4a8c-b552-dcc5e0eb2ab3","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable_results","type":"area","item-type":"scrollable","content":[{"name":"list_alerts","type":"content","item-type":"list","_auto_id_":"5c917a51-974a-4ae1-9eab-54bfb2037d0e","search":"","classes":"","expressions":{},"model":"$store.variables.alerts","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_alerts_html","_auto_id_":"8c8b81e8-4182-4542-9535-a2e148e872c3","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatLeft\">\n    <strong>Date:</strong> <span class=\"highlight\">{{$data.$item.date | date:'d MMM y'}}</span>\n  </div>\n  <div class=\"floatRight\">\n    <strong>Priority:</strong> {{$data.$item.priority.value }}\n  </div>\n</div>\n<div class=\"row hidden-xs hidden-middle-row\">   \n  <div class=\"floatLeft\">\n    <strong>Type:</strong> {{$data.$item.type.value}}\t\n  </div>\n  <div class=\"floatRight\">\n    <strong>Ended:</strong> {{$data.$item.removalDate == undefined ? \"No\" : \"Yes\"}}\t\n  </div>\n</div>\n<div class=\"row hidden-xs hidden-middle-row {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n  <div class=\"floatLeft\">\n    <strong>Removal Date:</strong> {{$data.$item.date | date:mediumDate}}\n  </div>\n  <div class=\"floatRight\">\n    <strong>Removal Comment:</strong> {{$data.$item.removalComment == \"\" ? \"No Comment\" : $data.$item.removalComment}}\t\n  </div>\n</div>\n<div class=\"row hidden-xs hidden-bottom-row\">   \n  <div class=\"floatLeft\">\n    {{$data.$item.text}}\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatLeft\">\n    <strong>Date:</strong> <span class=\"highlight\">{{$data.$item.date | date:'d MMM y'}}</span>\n  </div>\n  <div class=\"floatRight\">\n    <strong>Priority:</strong> {{$data.$item.priority.value }}\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row\">   \n  <div class=\"floatLeft\">\n    <strong>Type:</strong> {{$data.$item.type.value}}\t\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row\">   \n  <div class=\"floatLeft\">\n    <strong>Ended:</strong> {{$data.$item.removalDate == undefined ? \"No\" : \"Yes\"}}\t\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n  <div class=\"floatLeft\">\n    <strong>Removal Date:</strong> {{$data.$item.date | date:mediumDate}}\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n  <div class=\"floatLeft\">\n    <strong>Removal Comment:</strong> {{$data.$item.removalComment == \"\" ? \"No Comment\" : $data.$item.removalComment}}\t\n  </div>\n</div>\n<div class=\"row visible-xs visible-bottom-row\">   \n  <div class=\"floatLeft\">\n    {{$data.$item.text}}\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.displayAlerts.length > 0"}}],"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.alertToRemove) {\n  var visibleString = 'alertRowVisible-' + cti.store.variables.alertToRemove.id;\n  var hiddenString = 'alertRowHidden-' + cti.store.variables.alertToRemove.id;\n\n  var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  if(visible == null) {\n    delete cti.store.variables.alertToRemove;\n    return false;\n  }\n  if(hidden == null) {\n    delete cti.store.variables.alertToRemove;\n    return false;\n  }\n\n  visible.classList.remove('selected');\n  hidden.classList.remove('selected');\n  \n  if($data.$item.id != cti.store.variables.alertToRemove.id) {\n    cti.store.variables.alertToRemove = $data.$item;\n\n    var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n    var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n    var visible = document.getElementById(visibleString);\n    var hidden = document.getElementById(hiddenString);\n\n    visible.classList.add('selected');\n    hidden.classList.add('selected');\n  } else {\n    delete cti.store.variables.alertToRemove;\n  }\n} else {\n    cti.store.variables.alertToRemove = $data.$item;\n\n  var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n  var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n  var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  visible.classList.add('selected');\n  hidden.classList.add('selected');\n}\n\ncti.utils.updatePage();"},"_auto_id_":"24ac94b2-baf4-4106-b18c-d9cdb2bbffa7"}]},{"name":"date","type":"user-input","item-type":"date","_auto_id_":"30a78507-2610-4a78-95d0-331ecc0e04d8","label":"End Date: ","required":true,"left-icon":"fa-calendar","expressions":{},"message":"This is a required field","validators":[]},{"name":"description","type":"user-input","item-type":"text","_auto_id_":"688e2224-b931-4593-a7eb-e2a4714dceb7","label":"Comment:","required":true,"multiline":true,"debounce":1000,"message":"This is a required field","expressions":{},"maxlength":500,"validators":[]},{"name":"popupBack","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"01d1e329-b70d-464f-a1da-73ed9a4c392e","content":"<h2>Confirm Cancel</h2>\n<p>Any information you have entered on this page will lost.</p>\n<p>Are you sure you wish to cancel? </p>","expressions":{}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"90f4ba3c-ba12-4743-8218-5413e33064b8","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"7c15e687-9e2a-436d-a329-4de5130444ef","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.v_alertToRemove_clear = true\n\nwindow.logManager.consoleLog(\n  'inline function - button_back - page: RemoveAlert', \n  'info'\n)\n\ncti.utils.callAction(\"go-to-page\", { \"name\" : \"Alerts\" })\n\n$success()"},"_auto_id_":"e897ac43-5e83-496f-8675-2207ba60a843"},{"event":"click","type":"call-component-function","data":{"page":"RemoveAlert","componentInstanceId":"e7fa22a5-a954-4f24-9001-44e2be773bfb","function":"toggle"},"_auto_id_":"c7429932-14e7-4612-92ce-294eedaf5d08"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"8db9eb7a-e6e0-43e6-ac1d-57472ecc46fa","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"RemoveAlert","componentInstanceId":"cdb47658-47a4-488b-9004-ae58d036f2f3","function":"toggle"},"_auto_id_":"3d07bf9e-97c4-4f7e-9de2-dbd01f2d66e5"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"cdb47658-47a4-488b-9004-ae58d036f2f3","attributes":{},"expressions":{}}],"_auto_id_":"19020d4e-f08a-483b-abf6-687f2bbf4b68","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"61728e00-cfb3-4e97-afeb-7e7442353b99","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var alert = cti.store.variables.alerts[0]\n\nif(alert) {\n  var createdDate = moment(alert.date).format(\"YYYY-MM-DD\");\n  var removeDate = moment(cti.store.pages.RemoveAlert.date).format(\"YYYY-MM-DD\");\n  if(createdDate > removeDate) {\n      cti.utils.callAction(\n        \"show-notification\", {\n          \"name\": \"notification_warning\",\n          \"title\": \"Incorrect Date Entered\",\n          \"text\": \"Please select an End Date that is not older than the Alert's created date.\"\n        }\n      );\n  } else {\n    // Calls embedded CallActionFlow attached to this inline-function\n    delete cti.store.variables.alerts\n    cti.store.variables.alertToRemove = alert\n    $success();\n  }\n} else {\n  cti.utils.callAction(\n    \"show-notification\", {\n      \"name\": \"notification_warning\",\n      \"title\": \"No Alert Selected\",\n      \"text\": \"Please select the Alert you wish to remove from the list above.\"\n    }\n  );\n}"},"_auto_id_":"e7cf1112-d2f6-4b4a-b10d-e766afaafa04","actions":[{"event":"success","type":"call-actionflow","data":{"name":"RemoveAlert"},"_auto_id_":"451aa864-21e9-40a7-a77d-b08d88d6152b"}]}],"classes":"default"}],"_auto_id_":"3f0fde6f-e4d8-4cf3-a464-4d5c33a936c6","expressions":{}}],"_auto_id_":"3c95c3a3-6f7c-4d97-a288-a1788dbb14ed"},{"start":false,"name":"SafetyForm","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"57e2cff5-fd7e-45cf-a0b9-d96e618cdb5a","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"b05fed8a-b75e-44aa-bf61-c400ef481c9d","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"4fcd563b-3838-4108-9718-a234f6fa4fc5"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>My Safety Plan</h4>","_auto_id_":"1c4c14f2-9663-4313-a79a-5d3c7b7f411f"}],"_auto_id_":"9686646a-68dc-4d9b-ba0f-3e9ce6f185b4"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"f43b9e63-e468-491d-bc2d-fd9eb7cd6de4","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"6c26add4-b047-4b0b-b783-96cc37fc3798","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"6d90704e-d154-4b63-8588-b8d0d7a19eba","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_results","type":"area","item-type":"scrollable","content":[{"name":"sf_triggers","type":"user-input","item-type":"text","_auto_id_":"8903d7da-c98a-44d7-97a3-7316f529e6bc","label":"Triggers: ","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.triggers && $store.variables.lastMySafety.triggers.result"},"validators":[],"actions":[],"default":""},{"name":"sf_triggers_actionplan","type":"user-input","item-type":"text","_auto_id_":"479508c6-4417-4a90-8dde-89aa39b313b8","label":"Triggers action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.triggersAp && $store.variables.lastMySafety.triggersAp.result"}},{"name":"sf_earlyws","type":"user-input","item-type":"text","_auto_id_":"4077afcb-60a6-4008-a0d5-0aa9ea49625d","label":"How do I know when things are getting worse? (Early warning signs)","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.earlyWs && $store.variables.lastMySafety.earlyWs.result"}},{"name":"sf_earlyws_actionplan","type":"user-input","item-type":"text","_auto_id_":"6c3b655b-6253-48fe-b856-75620f16dd66","label":"When things are getting worse action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.earlyWsap && $store.variables.lastMySafety.earlyWsap.result"}},{"name":"sf_getworse","type":"user-input","item-type":"text","_auto_id_":"2d1bf386-74c8-4f51-9c44-72e39c08d0ac","label":"How do I know when things have got worse? (e.g. in crisis, feeling unsafe)","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.getWorse && $store.variables.lastMySafety.getWorse.result"}},{"name":"sf_getworse_actionplan","type":"user-input","item-type":"text","_auto_id_":"ef052002-71a4-4e51-b928-bb7cee633f67","label":"When things have got worse action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.getWorseAp && $store.variables.lastMySafety.getWorseAp.result"}},{"name":"sf_assisteddecision","type":"user-input","item-type":"text","_auto_id_":"b729d024-5dfd-4bc7-9a6a-e24eff207d00","label":"What I would like you to do for me when I am unable to make decisions for myself?","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.decisions && $store.variables.lastMySafety.decisions.result"}},{"name":"sf_advancedirective","type":"choice","item-type":"switch","_auto_id_":"cddc48ac-92b7-498a-b096-c2a31dbdf260","label":"This is my Advance Directive: ","required":false,"on-text":"Yes","off-text":"No","expressions":{},"validators":[],"actions":[]},{"name":"sf_contact","type":"user-input","item-type":"text","_auto_id_":"6e050c19-5a46-4c6d-842f-687a0278630f","label":"How can I best be contacted?","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.contact && $store.variables.lastMySafety.contact.result"}},{"name":"sf_contactreach","type":"user-input","item-type":"text","_auto_id_":"5c714a3d-5f38-4f72-b52e-0f82ca7d0466","label":"Who can be contacted if I can't be reached?","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.contReach && $store.variables.lastMySafety.contReach.result"}},{"name":"sf_crisisnumber","type":"user-input","item-type":"text","_auto_id_":"bfd90a2c-b535-49c8-b751-ad5987d98c1a","label":"My local crisis line number is:","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.crisisNo && $store.variables.lastMySafety.crisisNo.result"}},{"name":"sf_outofcrisis","type":"user-input","item-type":"text","_auto_id_":"eb953cf9-85e0-460d-a1a7-bfdc5284fb49","label":"How will I know when I am out of crisis?","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastMySafety && $store.variables.lastMySafety.outofCrisis && $store.variables.lastMySafety.outofCrisis.result"}},{"name":"sf_serviceuseragreedplan","type":"choice","item-type":"switch","_auto_id_":"8c650031-9984-4651-a567-8b7996a1baa5","label":"Service user agreed plan? ","required":false,"on-text":"Yes","off-text":"No","expressions":{},"validators":[],"actions":[]}],"_auto_id_":"a4066ce3-d752-44ca-a191-e97a9e4ff384","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"889e053b-3919-499e-9920-b7236cfdcb9a","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"//cti.store.variables.selected_visit.safety_form_status = true;\n//cti.store.variables.selected_visit.safety_form_object.status = \"complete\";\n//cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"});\n// TODO: Tidy up expired code\ncti.utils.callAction(\"call-actionflow\", { name: \"SubmitSafetyForm\" })"},"_auto_id_":"728cb403-078a-4e8e-ac8b-bf6ba6049b4a","actions":[]}],"classes":"default"}],"_auto_id_":"e3d0f24b-688c-4c25-8a55-e8a70c6afcd8","expressions":{}}],"_auto_id_":"d793aa9e-a0e0-443e-9e75-b713c06f61a5"},{"start":false,"name":"SafetyForm_View","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"7364bc62-4b33-4c47-8538-b3900eb65627","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"2bfbcbeb-0cbc-49e4-815f-59ab7527e496","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.safetyForm_View_clear = true\n$success()"},"_auto_id_":"c2473440-8758-4929-9449-069a4c2424d5"},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"c37a8c58-f333-43b8-be48-a4290458a45a"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>My Safety Plans</h4>","_auto_id_":"a5b2e514-438f-4510-85d9-b7a124a9994f"}],"_auto_id_":"85bbf6ca-ca02-4fae-9da6-79432c2ff20f"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"5bdb90f4-d365-4eee-9545-3752953164ba","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"5939703e-d9cc-40d0-b8fb-0ffa30a092d9","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"2d1837ba-6e91-4cc9-b97a-664b152c3ea4","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_results","type":"area","item-type":"scrollable","content":[{"name":"list_safety_forms","type":"content","item-type":"list","_auto_id_":"1c168ca8-5240-47eb-85d5-420f2bbb9b8f","static":false,"model":"$store.variables.v_safetyForms","data":"[]","autoscroll":false,"search":"","order":false,"pagination":true,"content":[{"name":"button_back_to_date","type":"button","item-type":"button","_auto_id_":"65f3ea79-3fb7-4a5f-966c-bc9dbae7c9f4","content":"Completed On: {{$data.$item.sf_assessmentdate}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"sf_triggers","type":"user-input","item-type":"text","_auto_id_":"c7d36d04-975e-4687-81ac-4ca6cb24d660","label":"Triggers: ","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"},"validators":[],"actions":[]},{"name":"sf_triggers_actionplan","type":"user-input","item-type":"text","_auto_id_":"e2b4121a-a491-47c2-8557-e9144a7579b9","label":"Triggers action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_earlyws","type":"user-input","item-type":"text","_auto_id_":"26e4e519-2325-43e8-9ba6-cc1729048928","label":"How do I know when things are getting worse? (Early warning sings)","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_earlyws_actionplan","type":"user-input","item-type":"text","_auto_id_":"362984ea-c703-4bd2-8172-683a11d94b2f","label":"When things are getting worse action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_getworse","type":"user-input","item-type":"text","_auto_id_":"b9e44e61-aa3b-4792-8c80-038ea1bb43c5","label":"How do I know when things have got worse? (e.g. in crisis, feeling unsafe)","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_getworse_actionplan","type":"user-input","item-type":"text","_auto_id_":"48136134-2a27-4323-af40-10b9aaf892ed","label":"When things have got worse action plan:","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_assisteddecision","type":"user-input","item-type":"text","_auto_id_":"35e9a1e2-e7f6-4104-a087-a999bf4b4171","label":"What I would like you to do for me when I am unable to make decisions for myself?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_advancedirective","type":"choice","item-type":"switch","_auto_id_":"588d45f8-dede-48f1-ac8a-7715f9ff3722","label":"This is my Advance Directive: ","required":false,"on-text":"Yes","off-text":"No","expressions":{"disabled":"1"},"validators":[],"actions":[]},{"name":"sf_contact","type":"user-input","item-type":"text","_auto_id_":"df6c085e-7378-44d9-82f4-f3cd534306f7","label":"How can I best be contacted?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_contactreach","type":"user-input","item-type":"text","_auto_id_":"ab44ed3b-1ebf-4c45-adc4-a091419102e6","label":"Who can be contacted if I can't be reached?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_crisisnumber","type":"user-input","item-type":"text","_auto_id_":"a2945578-3c96-4bd1-b262-ef38ce9f6b82","label":"My local crisis line number is:","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_outofcrisis","type":"user-input","item-type":"text","_auto_id_":"2cb71f8d-cee9-4cde-95bf-6e054ea9d485","label":"How will I know when I am out of crisis?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1"}},{"name":"sf_serviceuseragreedplan","type":"choice","item-type":"switch","_auto_id_":"ad7d6107-47d1-4f2b-b424-9ee4452c8d2c","label":"Service user agreed plan? ","required":false,"on-text":"Yes","off-text":"No","expressions":{"disabled":"1"},"validators":[],"actions":[]}],"dataSource":"dynamic","expressions":{},"paginationItemsPerPage":1,"paginationBelow":true,"paginationFirstLabel":"First","paginationPrevLabel":"Prev","paginationNextLabel":"Next","paginationLastLabel":"Last","paginationPrevNext":false,"paginationShowOnePage":false,"paginationAbove":false,"actions":[]}],"_auto_id_":"6dc0776c-3b53-4304-b031-e12a46355fd8","expressions":{}}],"_auto_id_":"fd703739-6395-42d9-9214-ced9db7b9b7a"},{"start":false,"name":"LifestyleForm_View","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"fb27bbd3-a8ab-4282-8b65-4ad3e23af72e","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"0b12538b-25f6-4094-add8-ec376b655b86","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.lifeStyleForm_View_clear = true\n$success()"},"_auto_id_":"9a1d6cbe-e4d1-4c95-8083-7321539e82f6"},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"4acd3003-dd86-43d5-b3c3-55e0c5a385bb"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Forms</h4>","_auto_id_":"b2e47deb-f8d4-4cfe-8771-54cc87961699"}],"_auto_id_":"2a596677-3bd1-4046-b062-6a2fe8555159","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"4b78f47b-2962-403b-9144-1932949b535d","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"93b3aabf-2275-4ae9-a900-3cebccb4081c","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"e09da008-7405-4703-9afa-1725d414b2e9","content":"<p>Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"5acae864-59e6-4768-9e00-4dd3e53ae752","content":[{"name":"list_lifestyleforms","type":"content","item-type":"list","_auto_id_":"a14cf3fc-6317-4c0f-8ac7-eebb8c5630c5","static":false,"model":"$store.variables.v_lifestyleForms","data":"[]","autoscroll":false,"search":"","order":false,"pagination":true,"content":[{"name":"button_back_to_date","type":"button","item-type":"button","_auto_id_":"a5f67102-73b2-4d37-aadf-6855842bf5a9","content":"Completed On: {{$data.$item.assessmentDate}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""},{"name":"html_smoking","type":"content","item-type":"html","_auto_id_":"f7bc5d39-e3bb-4306-9748-c4aca1924e9a","content":"<div onclick=\"cti.fn_toggle_lifestyle('smoking')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Smoking</h4>\n  <i id=\"smoking\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\" ></i>\n</div>","expressions":{}},{"name":"lssmoked","type":"choice","item-type":"select","_auto_id_":"619baaf4-7634-4cab-807b-5d78016f7391","label":"Have you ever smoked?","required":false,"options":[{"label":"Not assessed","value":"SS01"},{"label":"No","value":"SS02"},{"label":"Ex-smoker","value":"SS03"},{"label":"Current smoker","value":"SS04"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.smoking == false"},"classes":"question_primary","validators":[],"actions":[]},{"name":"lscigperday","type":"user-input","item-type":"number","_auto_id_":"f950d881-61a4-4d6f-81d6-733d27dd3a80","label":"Cigarettes per day","required":false,"decimals":2,"expressions":{"show":"$data.$item.lssmoked.value == \"SS04\" && $store.variables.lifestyleHideFlags.smoking == false","disabled":"1"}},{"name":"smokeadvice","type":"choice","item-type":"select","_auto_id_":"f34edc97-5c0c-42f7-89b6-341f2e9fb8be","label":"Very brief advice given?","required":false,"options":[{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"expressions":{"disabled":"1","show":"$data.$item.lssmoked.value == \"SS04\" && $store.variables.lifestyleHideFlags.smoking == false"}},{"name":"Refsmoke","type":"choice","item-type":"select","_auto_id_":"40b83f95-825d-4415-8add-0496b0f3f46e","label":"Referred to smoking cessation services?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but rejected","value":"04"}],"expressions":{"show":"$data.$item.lssmoked.value == \"SS04\" && $store.variables.lifestyleHideFlags.smoking == false","disabled":"1"},"description":""},{"name":"StopSmoke","type":"choice","item-type":"select","_auto_id_":"a2179370-70c8-4d95-9442-2d7872f8bb1b","label":"Stop smoking medication given?","required":false,"options":[{"label":"Medication not offered","value":"01az"},{"label":"Medication offered & accepted","value":"02az"},{"label":"Medication offered but declined","value":"03az"},{"label":"Not medically appropriate","value":"04az"}],"expressions":{"show":"$data.$item.lssmoked.value == \"SS04\" && $store.variables.lifestyleHideFlags.smoking == false","disabled":"1"}},{"name":"smokeintoffer","type":"choice","item-type":"select","_auto_id_":"cf56486f-cdb3-4861-87c4-36c5c7f9babe","label":"Other intervention offered?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"show":"$data.$item.lssmoked.value == \"SS04\" && $store.variables.lifestyleHideFlags.smoking == false","disabled":"1"}},{"name":"smokefreetext1","type":"user-input","item-type":"text","_auto_id_":"6416c932-2db8-4692-9a1c-4a83103f6e63","label":"Details of any other intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.lssmoked.value == \"SS04\" && ($store.pages.LifestyleForm_View.smokeintoffer.value == \"03\" || $store.pages.LifestyleForm_View.smokeintoffer.value == \"04\") && $store.variables.lifestyleHideFlags.smoking == false"},"validators":[],"actions":[]},{"name":"html_diet","type":"content","item-type":"html","_auto_id_":"ca4acb06-dc74-48a5-911b-1e597cab096b","content":"<hr/>\n<div onclick=\"cti.fn_toggle_lifestyle('diet')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Diet</h4>\n  <i id=\"diet\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"diethealthy","type":"choice","item-type":"select","_auto_id_":"515ee0e5-db46-4385-8d9b-eac365c9d0d7","label":"Do you think you eat a healthy diet?","required":false,"options":[{"label":"Not assessed","value":"01"},{"label":"Not at all","value":"02"},{"label":"Some of the time","value":"03"},{"label":"Most of the time","value":"04"},{"label":"Nearly all the time","value":"05"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.diet == false"},"classes":"question_primary"},{"name":"lsdietcomment","type":"user-input","item-type":"text","_auto_id_":"561815a7-41ae-433f-922e-4586ec44f5be","label":"Please give more detail","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.diet == false"},"validators":[],"actions":[]},{"name":"dietintervention","type":"choice","item-type":"select","_auto_id_":"129aea6e-ad17-4324-8789-6afa9b546330","label":"Intervention offered?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but rejected","value":"04"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.diet == false"}},{"name":"dietintdetails","type":"user-input","item-type":"text","_auto_id_":"6280238e-6ef6-4df5-ad71-5118960953bc","label":"Details of intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"($data.$item.dietintervention.value == \"03\" || $data.$item.dietintervention.value == \"04\") && $store.variables.lifestyleHideFlags.diet == false","disabled":"1"}},{"name":"html_exercise","type":"content","item-type":"html","_auto_id_":"055ebfa0-3228-4e41-854a-0042aa08d271","content":"<hr/>\n<div onclick=\"cti.fn_toggle_lifestyle('exercise')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Exercise</h4>\n  <i id=\"exercise\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"regularexercise","type":"choice","item-type":"select","_auto_id_":"5d02094e-d145-4ef0-a777-8e93b73475c3","label":"Do you exercise regularly?","required":false,"options":[{"label":"Not assessed","value":"00"},{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.exercise == false"},"classes":"question_primary"},{"name":"exercise_repeat_displayer","type":"content","item-type":"list","_auto_id_":"e654ce57-d662-407e-9c4c-9c4adfe02e72","static":false,"model":"$data.$item.regularexercise.repeater","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"exercise_displayer","type":"content","item-type":"html","_auto_id_":"d837e84b-ff47-4e24-bb64-d4ef5c41e3a9","content":"<div id=\"{{ $data.$index }}\" class=\"excercise_item\">\n  <div class=\"node\">{{ $data.$item.intensity.resultString}} intensity</div>\n  <div class=\"node\">{{ $data.$item.misperweek.result}} minutes</div>\n</div>","expressions":{},"classes":"flex_row"}],"dataSource":"dynamic","expressions":{"show":"$data.$item.regularexercise.value == \"01\" && $store.variables.lifestyleHideFlags.exercise == false"},"actions":[],"classes":"repeater"},{"name":"exintoffer","type":"choice","item-type":"select","_auto_id_":"34f0ad01-3c96-47b5-8078-3123d69598f6","label":"Intervention offered","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.exercise == false"}},{"name":"intdetails","type":"user-input","item-type":"text","_auto_id_":"b485a952-b7e5-4376-b03d-84440bc300a1","label":"Details of intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"($data.$item.exintoffer == \"03\" || $data.$item.exintoffer == \"04\") && $store.variables.lifestyleHideFlags.exercise == false","disabled":"1"},"validators":[],"actions":[]},{"name":"html_alcohol","type":"content","item-type":"html","_auto_id_":"61a49b04-779f-44bd-8f87-7c3faddb6443","content":"<hr/>\n<div onclick=\"cti.fn_toggle_lifestyle('alcohol')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Alcohol</h4>\n  <i id=\"alcohol\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"alcCurrentUser","type":"choice","item-type":"select","_auto_id_":"bc70f4f0-a142-452e-b4ab-93d12e92b1da","label":"Are you a current alcohol user? ","required":false,"options":[{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.alcohol == false"},"actions":[],"validators":[]},{"name":"withdrawal","type":"choice","item-type":"select","_auto_id_":"e3a87bc1-c8b0-4363-9ad7-beb69e8507b4","label":"Is there evidence of alcohol withdrawal?","required":false,"options":[{"label":"Yes","value":1},{"label":"No","value":2}],"expressions":{"disabled":"1","show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false"},"actions":[],"validators":[]},{"name":"alcHowOften","type":"choice","item-type":"select","_auto_id_":"e79ffba7-5995-4863-91df-e45fe1e0d97a","label":"How often do you have an alcoholic drink?","required":false,"options":[{"label":"Never","value":"0"},{"label":"Monthly or less","value":"1"},{"label":"2-4 times per month","value":"2"},{"label":"2-3 times per week","value":"3"},{"label":"4+ per week","value":"4"}],"expressions":{"disabled":"1","show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false"},"validators":[],"actions":[]},{"name":"alcHowManyUnits","type":"choice","item-type":"select","_auto_id_":"dde72156-dbda-49a4-93a1-a0a21caee1be","label":"How many units of alcohol do you consume on a typical day when drinking?","required":false,"options":[{"label":"1-2","value":"0"},{"label":"3-4","value":"1"},{"label":"5-6","value":"2"},{"label":"7-9","value":"3"},{"label":"10+","value":"4"}],"expressions":{"disabled":"1","show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false"}},{"name":"alcExceedUnits","type":"choice","item-type":"select","_auto_id_":"c45cedef-a8eb-4431-b913-71f25d22fca1","label":"How often do you exceed 6 or more units on a single occasion?","required":false,"options":[{"label":"Never","value":"0"},{"label":"Less than monthly","value":"1"},{"label":"Monthly","value":"2"},{"label":"Weekly","value":"3"},{"label":"Daily or almost daily","value":"4"}],"validators":[],"expressions":{"show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false","disabled":"1"}},{"name":"alcIntervention","type":"choice","item-type":"select","_auto_id_":"5d9fa453-8d3a-4003-b08a-d156b19b460a","label":"Intervention","required":false,"options":[{"label":"None required","value":"01az"},{"label":"Brief advice given","value":"02az"},{"label":"Self-referred to alcohol services","value":"03az"},{"label":"Referral to alcohol services made","value":"04az"},{"label":"Referral offered but declined","value":"05az"}],"validators":[],"expressions":{"disabled":"1","show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false"},"actions":[]},{"name":"alcintdetail","type":"user-input","item-type":"text","_auto_id_":"0ff43fd4-6c67-4613-a489-a72fd123c79c","label":"Details of service offered","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$data.$item.alcCurrentUser.value != \"02\" && $store.variables.lifestyleHideFlags.alcohol == false"},"validators":[],"actions":[]},{"name":"html_drugs","type":"content","item-type":"html","_auto_id_":"24ed3e55-2bcf-4f37-983a-83c64040c8fd","content":"<hr/>\n<div onclick=\"cti.fn_toggle_lifestyle('drugs')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Drugs</h4>\n  <i id=\"drugs\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"recdruguse","type":"choice","item-type":"select","_auto_id_":"c4c9b2b2-e84d-46da-9e9b-e09d810c7b7b","label":"Have you ever used recreational drugs?","required":false,"options":[{"label":"Not assessed","value":"1na"},{"label":"No","value":"2no"},{"label":"In the past","value":"3tp"},{"label":"Current user","value":"4cu"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.drugs == false"},"classes":"question_primary"},{"name":"drugs_repeat_displayer","type":"content","item-type":"list","_auto_id_":"aa3d4f2d-0fa9-40ae-95c2-fb94bb870715","static":false,"model":"$data.$item.recdruguse.repeater","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"drug_displayer","type":"content","item-type":"html","_auto_id_":"e520a200-942e-404b-bf35-d548a0dea94a","content":"<div class=\"repeater_item\">\n  <div class=\"node\">Currently Using: {{ $data.$item.currentuse.resultString }}</div>\n  <div class=\"node\">Drug name: {{ $data.$item.drugname.resultString }}</div>\n  <div class=\"node\">Other drug: {{ $data.$item.otherdrug.resultString }}</div>\n  <div class=\"node\">Used per week: {{ $data.$item.useperweek.resultString }}</div>\n  <div class=\"node\">Mode of use: {{ $data.$item.modeofuse.resultString }}</div>\n</div>","expressions":{}}],"dataSource":"dynamic","expressions":{"show":"$data.$item.recdruguse.value == \"4cu\" && $store.variables.lifestyleHideFlags.drugs == false"},"actions":[],"classes":"repeater"},{"name":"drugintoffer","type":"choice","item-type":"select","_auto_id_":"cba782c3-985b-49ae-ae5e-82ed8681d238","label":"Intervention offered?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"disabled":"1","show":"$data.$item.recdruguse.value == \"4cu\" && $store.variables.lifestyleHideFlags.drugs == false"}},{"name":"drugintdetails","type":"user-input","item-type":"text","_auto_id_":"a329e6e8-3585-4537-9708-5de5c459cc04","label":"Details of interventions offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$data.$item.recdruguse.value == \"4cu\" && ($data.$item.drugintoffer.value == \"03\" || $data.$item.drugintoffer.value == \"04\") && $store.variables.lifestyleHideFlags.drugs == false","disabled":"1"}},{"name":"html_other","type":"content","item-type":"html","_auto_id_":"4405f6ca-8333-499e-92c2-5f3fbc4035cc","content":"<hr/>\n<div onclick=\"cti.fn_toggle_lifestyle('other')\" style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Other</h4>\n  <i id=\"other\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"menwellbeing","type":"choice","item-type":"select","_auto_id_":"54e930b8-7d5f-431a-93cf-0b3b5842fe25","label":"5 Ways to Mental Wellbeing","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Offered and accepted","value":"02"},{"label":"Offered but declined","value":"03"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}},{"name":"signpost","type":"choice","item-type":"select","_auto_id_":"333156fb-c708-4a64-a792-ab9e0d12eb85","label":"Signposting for support with debt or housing","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}},{"name":"signdetail","type":"user-input","item-type":"text","_auto_id_":"a5ed68da-70f7-4286-a504-46e147a93bd6","label":"Details of intervention offered","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}},{"name":"addcomm","type":"user-input","item-type":"text","_auto_id_":"27deae61-853a-48e3-8d50-1f6d37b50594","label":"Comments:","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}},{"name":"YNPresent","type":"choice","item-type":"radio","_auto_id_":"e931edbc-e1f0-43a0-9949-2e3ad0bf39e6","label":"Present?","required":false,"options":[{"label":"Yes","value":"v8aa"},{"label":"No","value":"v8ab"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$data.$item.YNPresent != \"\" && $store.variables.lifestyleHideFlags.other == false"}},{"name":"admissionassess","type":"choice","item-type":"radio","_auto_id_":"21bb4c4f-6aa0-4a3c-9542-9c74fe8af364","label":"Admission assesment: ","required":false,"options":[{"label":"Yes","value":1},{"label":"No","value":2}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}},{"name":"SentCopy","type":"choice","item-type":"radio","_auto_id_":"72f617a7-63fa-43c8-9446-31af62c6c2dd","label":"Copy of CPA sent?","required":false,"options":[{"label":"Yes","value":"V8aa"},{"label":"No","value":"V8ab"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"1","show":"$data.$item.YNPresent != \"\" && $store.variables.lifestyleHideFlags.other == false"}},{"name":"assessmentstatus","type":"choice","item-type":"select","_auto_id_":"b00e4440-a650-4282-a4b1-fc3dd3c008b3","label":"Status","required":false,"options":[{"label":"Assessment complete","value":"01"},{"label":"Patient declined entire assessment","value":"02"},{"label":"Patient declined part of assessment","value":"03"},{"label":"Unsafe to conduct assessment","value":"04"},{"label":"Assessment incomplete","value":"01a"},{"label":"Form Entered in Error","value":"99"}],"expressions":{"disabled":"1","show":"$store.variables.lifestyleHideFlags.other == false"}}],"dataSource":"dynamic","expressions":{},"paginationItemsPerPage":1,"paginationBelow":true,"paginationFirstLabel":"First","paginationPrevLabel":"Prev","paginationNextLabel":"Next","paginationLastLabel":"Last","paginationAbove":false}],"expressions":{}}],"_auto_id_":"322434f1-9f45-42a7-a733-ccb5194bf051"},{"start":false,"name":"Timeline","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"a81c6ddc-23df-40a8-b3af-82ee8553b882","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Timeline', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"e7015c22-f01d-42f2-bf57-c26e0176c010"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Timeline</h4>","_auto_id_":"b3aa34c4-864f-44c6-a380-7e136004d1d9"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"fede74d9-5aab-4e3f-a719-aff15f3fc4d8","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Timeline","componentInstanceId":"e8072f82-fe6b-4041-8b1b-8888ff7c378e","function":"toggle"},"_auto_id_":"3442d53b-60ab-4607-94c2-d12f4dba4421"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"a9d9bde8-01ea-4b8c-b6fe-6db91f0b5983","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"47804683-a660-4b0f-9a51-47cb778fd869","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"b6076d2c-604e-4204-8f8a-f379cde807ae"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"ddda97ca-880f-4bd7-8aa5-60815845cdc4","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"e48e6132-57e9-41b2-a058-be7b8100cdce"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"63cc6f0e-70e3-4033-a385-c7148d970e16","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"16c9ec85-55ba-4960-a037-9ec8228c6e36","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"e8072f82-fe6b-4041-8b1b-8888ff7c378e","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"3b037b9d-4a37-46e9-a047-b52fd7384509","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"fc3fab2f-1215-4819-8428-6cdd2abdd5de","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"7221295d-2b24-4dfc-9f87-fcd5efe7bd7a","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"da6f39f6-d431-4b5d-bb8c-8eb9478db1e8","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"6888ac77-a277-40a2-ab7c-01180530b111"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"2a3e0002-48a4-4ce3-90ba-fd8f0f26c9cd","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"70ae5082-305e-46a3-b1ab-e22c572472ba","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"3888701d-4487-47cb-959d-719250c07e1f","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"51400e43-e3e0-41af-bcce-48e74e19c43d","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"d1ab20cf-7b50-46a9-bcb9-5f32cf9f6a96"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"27943add-ee00-4674-a201-fe7c8cb734f9","function":"toggle"},"_auto_id_":"758eca8e-60af-47a5-984e-99d50c21b68a"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"30e70609-0e43-4d3e-be5b-2d2ac15dea82","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"27943add-ee00-4674-a201-fe7c8cb734f9","function":"toggle"},"_auto_id_":"647be3b2-e616-4de1-ae96-8ce1cf2519bc"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"25537889-e1a0-4d9b-82bc-d484a83cfe26","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"e26cb873-7f6a-489d-90c1-83f5346a6106","content":[{"name":"list_timeline","type":"content","item-type":"list","_auto_id_":"3f289d8e-5dc3-4822-930d-f057394c5278","search":"","classes":"","model":"$store.variables.timeline","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_timeline_html","_auto_id_":"415d0657-c84d-4b9b-b995-5051d3bbb956","content":"<div class=\"icon {{$data.$item.eventType}}\"></div>\n<div class=\"event\">\n    <div class=\"eventType\">\n        {{$data.$item.eventType == \"admission\" ? \"Admission\" : \"\"}}\n        {{$data.$item.eventType == \"documents\" ? \"Document Added: \" + $data.$item.title : \"\"}}\n        {{$data.$item.eventType == \"referral\" ? \"Referred to \" + $data.$item.referredToDisplay + \" by \" + $data.$item.referrer + \", \" + $data.$item.referralSource.value : \"\"}}\n        {{$data.$item.eventType == \"notes\" ? \"Progress Note: \" + $data.$item.progressNoteType.value + \", \" + $data.$item.progressNoteSubType.value : \"\"}}\n        {{$data.$item.eventType == \"appointments\" ? \"Appointment: \" + $data.$item.type + \" with \" + $data.$item.hcpSurname + \", \" + $data.$item.hcpForename + \" \" + $data.$item.hcpTitle : \"\"}}\n        {{$data.$item.eventType == \"alerts-added\" ? \"Alert Added\" : \"\"}}\n      \t{{$data.$item.eventType == \"alerts-removed\" ? \"Alert Removed\" : \"\"}}\n      \t{{$data.$item.eventType == \"allergies\" ? \"Allergy Added\" : \"\"}}\n    </div>\n    <div class=\"date\">\n      <!--\n      {{$data.$item.eventType == \"allergies\" ? $data.$item.eventDateDisplay : $data.$item.eventDate | date:'dd MMM yyyy HH:mm'}}\n\t  -->\n      {{$data.$item.timelineDisplayDate}}\n    </div>\n    <div class=\"eventDescription\">\n        {{$data.$item.eventType == \"admission\" ? \"Admitted to \" + $data.$item.admittedWard : \"\"}}\n        {{$data.$item.eventType == \"documents\" ? \"Type: \" + $data.$item.documentType.value : \"\"}}\n        {{$data.$item.eventType == \"referral\" ? $data.$item.urgency.value + \" referral to service \" + $data.$item.specialty.value : \"\"}}\n        {{$data.$item.eventType == \"alerts-added\" ?  $data.$item.type.value : \"\"}}\n        {{$data.$item.eventType == \"alerts-removed\" ?  $data.$item.displayText : \"\"}}\n      \t{{$data.$item.eventType == \"allergies\" ?  $data.$item.substance : \"\"}}\n    </div>\n    <div ng-bind-html=\"$data.$item.timeLineDisplay\" class=\"eventDescription\" >\n        {{$data.$item.eventType == \"notes\" || $data.$item.eventType == \"appointments\" ? $data.$item.timeLineDisplay : \"\"}}\t\n    </div>\n</div>","expressions":{}}]}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"1dfff93d-11f4-405a-94d7-26afb5ff27b0","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"4a4bab96-cfd8-4314-bd03-8531388c8cf3","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"83b38156-abb6-435e-8f1d-822c687f6213","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"4b901742-e10f-4783-b7f3-e43ffb086eb7"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"22475c3a-d0bc-413d-bd28-89dabb5e26ae","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"08122a07-93e0-418b-9e05-47079550db12"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"3fe30434-be47-411e-b446-92676dde83ef","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"222f86d3-2547-436d-87d9-2c36e6c4a7b7","actions":[{"event":"success","type":"call-component-function","data":{"page":"Timeline","componentInstanceId":"25537889-e1a0-4d9b-82bc-d484a83cfe26","function":"toggle"},"_auto_id_":"0f581657-271a-4a00-bde6-fa894842d15f"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"a7160d94-ed76-4e82-a67d-bb976a82f894","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"95b853cf-9e8b-4e3d-9cf3-1d45ac6ba201"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"9e5b9ba7-ec5e-4d01-8ab6-4f4df4538ea3","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}],"_auto_id_":"01a12205-4b31-4f54-9cee-1e0cc6c03018"},{"start":false,"name":"Patient","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"3e473f41-7fb8-4bc5-bb3c-2a573460f39b","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Patient', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"705f7013-34d4-41ac-988d-0656c5519ff4","actions":[]}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Demographics</h4>","_auto_id_":"1a6274d9-0267-445d-b0d6-5c24d0a9c629"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"7d24b3c2-1a52-468c-b633-0e5f586c29e7","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Patient","componentInstanceId":"7d4ae673-a6a8-473b-a4ff-201a66cb7d81","function":"toggle"},"_auto_id_":"e2e9b3bc-fbd2-4f35-bece-6826a8aeb2ac"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"e707d876-7779-493b-a4a5-4d33741093c7","attributes":{},"expressions":{},"actions":[]},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"eeb7a24e-5aa5-48ed-8835-f21a110b4e57","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"731ce8a5-fa73-4824-8da3-d13b04d58360"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"1b758a92-04bd-4a97-acfb-629d6a946d79","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"784babb4-aad5-4cb1-a763-25ccff71e528"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"9c74a4ce-22eb-43d9-b8ff-388187d04ca6","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"f910d3e9-cbd8-4262-b6b1-b3403cd93e47","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"7d4ae673-a6a8-473b-a4ff-201a66cb7d81","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"e65f4a0e-66ff-428c-991c-0d23f9bde72a","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"61c516ad-9c9b-4109-b43b-aebcf0940589","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"4816f7d7-dae9-4ae4-823b-d35aefc490d4","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"6787f6a9-decd-436f-bd35-87e4b9eb4ab5","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"692e8bbf-6779-470d-ac9e-4211f7d7bb72"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"4d93a5b4-847e-4dcc-83c9-f1c56e1c33fd","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"d6ea4626-a8c3-4b3a-b993-fea163f4ad05","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"a02553b9-a3c9-4cd5-9489-7214dbb7d096","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"f965c237-1129-4c1c-ba71-b398af2a0b6c","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"99c0ee90-4222-41d0-997c-57d9a4f45767"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"4f722bc4-cb7e-481b-8566-164ddd9b9197","function":"toggle"},"_auto_id_":"adc1b995-c284-441a-8ae6-4097d275dbd7"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"7df07200-f33e-4068-8729-00a79f73425d","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Patient","componentInstanceId":"e66be484-99ee-4cb5-826f-d163980b28a2","function":"toggle"},"_auto_id_":"42ef58ed-6955-4528-9f6d-514644ec6730"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"e66be484-99ee-4cb5-826f-d163980b28a2","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"3f73b7dd-b6e8-4e81-9c9a-6c7f28b19fac","content":[{"name":"list_patient","type":"content","item-type":"list","_auto_id_":"7182bd76-bd86-45b4-9c5e-30994ddc467a","search":"","classes":"","model":"$store.variables.selected_visit.patientData.patient","theme":"","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_patient_html","_auto_id_":"79000866-a631-4f1d-a7f5-4e8d007a88ff","content":"<div class=\"card_holder\">\n  <div class=\"line_after\">\n    <div class=\"contact_name\">\n{{'$store.variables.selected_visit.displayName' | store}}\n    </div>\n    <div class=\"dob\">\n      <span>DOB</span>{{$data.$item.birthDate}} (aged {{$data.$item.age}})\n    </div>\n    <div class=\"gp\"><span>Current GP</span>{{$data.$item.gpDetails}}</div>\n    <div class=\"nhs\"><span>NHS Number</span>{{$data.$item.nhsNumFormatted}}</div>\n    <div class=\"client_id\"><span>Client ID</span>{{$data.$item.clientId.value}}</div>\n  </div>\n  <div class=\"line_after icon location\" onclick=\"cti.fn_navigate(this.id)\" id=\"{{$data.$item.postCode}}\">\n    <div class=\"short_address\">{{$data.$item.addressFormatted}}</div>\n    <div class=\"p_code\">{{$data.$item.postCode}}</div>\n  </div>\n  <div class=\"{{$data.$item.eveningPhoneNumber != undefined || $data.$item.officePhoneNumber != undefined || $data.$item.mobilePhoneNumber != undefined ? 'line_after' : ''}}\">\n    <div class=\"gender\"><span>Gender</span>{{$data.$item.gender.value}}</div>\n    <div class=\"ethnic\"><span>Ethnicity</span>{{$data.$item.ethnicity.value}}</div>\n    <div class=\"language\"><span>Language</span>{{$data.$item.language.value != undefined ? $data.$item.language.value : \"Not Specified\"}}</div>\n    <div class=\"nationality\"><span>Nationality</span>{{$data.$item.nationality.value != undefined ? $data.$item.nationality.value : \"Not Specified\"}}</div>\n  </div>\n  <div ng-if=\"$data.$item.eveningPhoneNumber != undefined || $data.$item.officePhoneNumber != undefined || $data.$item.mobilePhoneNumber != undefined\" class=\"phones icon\">\n    <div class=\"mobile\" ng-if=\"$data.$item.mobilePhoneNumber != ''\" onclick=\"cti.fn_call_contact()\"><span>Mob</span>{{$data.$item.mobilePhoneNumber}}</div>\n    <div class=\"office\" ng-if=\"$data.$item.officePhoneNumber != ''\" onclick=\"cti.fn_call_contact()\"><span>Day</span>{{$data.$item.officePhoneNumber}}</div>\n    <div class=\"evening\" ng-if=\"$data.$item.eveningPhoneNumber != ''\" onclick=\"cti.fn_call_contact()\"><span>Eve</span>{{$data.$item.eveningPhoneNumber}}</div>\n  </div>\n</div>","expressions":{}}]},{"name":"popupCall","type":"component","item-type":"web-component","content":[{"name":"html_call","type":"content","item-type":"html","_auto_id_":"b1281d15-2703-403e-b47a-8a2049f496a1","content":"<h4>Call Patient</h4>\n<!--<p>Use one of the available contact numbers below</p>-->","expressions":{}},{"name":"html_no_numbers","type":"content","item-type":"html","_auto_id_":"6b9c1b86-9c29-46c8-9ae9-ebd6434c27cc","content":"<p>There are currently no valid contact numbers for this patient.</p>","expressions":{"show":"$store.variables.selected_visit.patientData.demographics.mobilePhoneNumber == undefined && $store.variables.selected_visit.patientData.demographics.officePhoneNumber == undefined && $store.variables.selected_visit.patientData.demographics.eveningPhoneNumber == undefined"}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"9ceae54d-43ae-400c-ac77-05680b342d70","extends":{"type":"area","item-type":"row"},"content":[{"name":"call_mobile_button","type":"content","item-type":"html","_auto_id_":"fdfa9fb4-8a99-4efe-a566-9ee95ccec738","content":"<a href=\"tel:141{{'$store.variables.selected_visit.patientData.demographics.mobilePhoneNumber' | store}}\" target=\"_blank\" class=\"btn btn-default default\" style=\"margin-top:10px\">Mobile - {{'$store.variables.selected_visit.patientData.demographics.mobilePhoneNumber' | store}}</a>","expressions":{}}],"expressions":{"show":"$store.variables.selected_visit.patientData.demographics.mobilePhoneNumber !== undefined"}},{"name":"button_bar_evening","type":"area","item-type":"button-bar","_auto_id_":"52f92b78-34f3-4911-923e-836a2ea945d9","extends":{"type":"area","item-type":"row"},"content":[{"name":"call_evening_button","type":"content","item-type":"html","_auto_id_":"dcdceece-67d7-43b3-b5f1-e8d802a782a5","content":"<a href=\"tel:141{{'$store.variables.selected_visit.patientData.demographics.eveningPhoneNumber' | store}}\" target=\"_blank\" class=\"btn btn-default default\" style=\"margin-top:10px\">Evening - {{'$store.variables.selected_visit.patientData.demographics.eveningPhoneNumber' | store}}</a>","expressions":{}}],"expressions":{"show":"$store.variables.selected_visit.patientData.demographics.eveningPhoneNumber !== undefined"}},{"name":"button_bar_office","type":"area","item-type":"button-bar","_auto_id_":"69906af2-1156-481f-9c82-bd7d0e4ea16e","extends":{"type":"area","item-type":"row"},"content":[{"name":"call_office_button","type":"content","item-type":"html","_auto_id_":"7331cea1-985a-4188-9ba9-c1edddbe99fd","content":"<a href=\"tel:141{{'$store.variables.selected_visit.patientData.demographics.officePhoneNumber' | store}}\" target=\"_blank\" class=\"btn btn-default default\" style=\"margin-top:10px\">Office - {{'$store.variables.selected_visit.patientData.demographics.officePhoneNumber' | store}}</a>","expressions":{}}],"expressions":{"show":"$store.variables.selected_visit.patientData.demographics.officePhoneNumber !== undefined"}},{"name":"button_bar_call","type":"area","item-type":"button-bar","_auto_id_":"43f42a69-2b5e-497d-befc-16efc4277567","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel_call","type":"button","item-type":"button","_auto_id_":"f140076f-9361-41d4-9687-f8384d571d57","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Patient","componentInstanceId":"edb5c78b-6c74-4ce2-a3a7-56d36fed07d5","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"f2067eb4-89b3-443c-8d8e-f5ed7208a55c"}],"classes":"default"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"edb5c78b-6c74-4ce2-a3a7-56d36fed07d5","attributes":{"id":"popupCall"},"expressions":{}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"88eea068-2e5b-4849-96b7-5df27d0d9e98","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"b261ba8d-4093-4c3b-934f-58cd8efdf0a3","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"fd3a2382-e604-485d-af47-064c8446fa4b","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"32c79f26-48ef-440e-b402-d60481dd176a"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"b5c46705-f2ad-43b5-a161-0f313c751f5a","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"5616c732-91ed-405c-8742-cb1d4be1f3a7"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"1a6ff23a-883a-453b-8bd7-b9fb9b90667f","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"97879be2-2141-431e-bec1-d3ae5539c855","actions":[{"event":"success","type":"call-component-function","data":{"page":"Patient","componentInstanceId":"e66be484-99ee-4cb5-826f-d163980b28a2","function":"toggle"},"_auto_id_":"9af88341-30df-4165-a280-5697fd19d319"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"8fef241e-807a-4ed2-8d14-ac7c11e7207d","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"4cd215fb-2cd4-4a44-a94a-8509683ae715"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"ddf899ca-eb3d-4fa9-9230-e8796b592557","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}],"_auto_id_":"5988dbf5-fc56-4758-bb96-8402b579cbba"},{"start":false,"name":"Alerts","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"45772126-059e-4ad3-bf3f-fe08f9079d44","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.v_alertToRemove_clear) {\n  delete cti.store.variables.v_alertToRemove_clear;\n  delete cti.store.variables.alerts\n  cti.utils.destroyPageData('RemoveAlert');\n}\n\n$success()"},"_auto_id_":"a7f43a5e-954a-480e-9c80-448ad83b9c5d"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"0cad1fe5-cb58-4767-920c-562044588a02","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Alerts', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"95b7dfdb-c8cb-4163-ac54-78fd495956a5"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Alerts</h4>","_auto_id_":"0f330e75-0dd3-4cb9-bb72-b6e334586976"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"09dc6ee8-91ec-44bf-884e-07db9fa68d79","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Alerts","componentInstanceId":"31e5ded9-8602-4226-878a-d9263522c9dd","function":"toggle"},"_auto_id_":"55f52fb6-c266-4681-bf6a-d5cf5d6b6b05"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"71174076-df15-4890-af58-2aa3a6c1d30a","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"af8ac3ce-3264-466b-b30d-3e1ebc13d772","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"cae2d468-8209-4e60-b19a-6f79510d24b3"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"57d80443-47d1-48c4-a6e6-1d2243527bc5","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"827a36d6-e36e-44ff-9424-9bd4f505f92c"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"1d4ca511-f8db-4a2a-8e25-a6719878e631","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"ac738cd9-3412-448a-a5fc-5d9c450ffbdf","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"31e5ded9-8602-4226-878a-d9263522c9dd","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"41ed4c58-7a12-4126-9360-e07eefef34ac","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"a18b314c-33e5-4fe6-ae98-3d410fc9a101","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"b6060d56-46df-44fe-af68-ca7dce5a5cea","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"56578c20-1dda-4dd0-ad98-049850d5b7e0","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"8b8d26c6-1358-4c6f-a16c-b15dcaa01de0"}],"classes":""},{"name":"button_filter","type":"button","item-type":"button","_auto_id_":"0dcf9a84-2801-433e-8ddd-80da0f13b7ee","content":"{{'$store.variables.filter == undefined || $store.variables.filter == \"open\" ? \"Open\" : \"All\"' | store}} Alerts ({{'$store.variables.selected_visit.patientData.displayAlerts.length' | store}})","theme":"minimal","expressions":{"show":"$store.variables.visit_view_mode == \"Alerts\""},"actions":[{"event":"click","type":"call-function","data":{"name":"fn_set_view","params":{"view_name":"Alerts","manual_filter":""}},"_auto_id_":"306ebb99-76d2-4071-b015-08072e6dd2aa"}],"right-icon":"fa-filter","classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"a2a6650f-3e3a-4519-bf94-742a5fee1b4f","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"bdd1d9b6-6245-439e-a204-57a633a090ac","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"e508d941-d727-4526-9384-40d13617f81f","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"709b3043-77cc-4c28-9808-61799a990155"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"f04b2d0f-1121-4be8-a03b-1f027cd6c8e7","function":"toggle"},"_auto_id_":"dde44dbb-3565-4532-b027-3c007fe8da85"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"b029196e-a1a6-4c91-893b-fceb8633ff4b","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"f04b2d0f-1121-4be8-a03b-1f027cd6c8e7","function":"toggle"},"_auto_id_":"6783f73d-22cf-45d2-a0de-9470c10dee7b"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"d26b5857-354e-4a8f-997d-d4bc49db4680","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"1992c964-db68-4335-958d-bd0d7e7f62b6","content":[{"name":"list_alerts","type":"content","item-type":"list","_auto_id_":"0f5236c1-4b60-4b08-a064-e795f71596e9","search":"","classes":"","expressions":{},"model":"$store.variables.selected_visit.patientData.displayAlerts","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_alerts_html","_auto_id_":"f0187d8b-e68d-4130-bda9-6723158ae00b","content":"<!-- HTML Template for tablet size devices and above -->\n<div id=\"alertRowHidden-{{$data.$item.id}}\" class=\"card_holder\">\n  <div class=\"alert_type\">{{$data.$item.type.value}}</div>\n  <div class=\"date\"><span>Date</span>{{$data.$item.date | date:'d MMM y'}}</div>\n  <div class=\"flex_row line_after\">\n    <div class=\"priority\"><span>Priority</span>{{$data.$item.priority.value }}</div>\n    <div class=\"ended\"><span>Ended</span>{{$data.$item.removalDate == undefined ? \"No\" : \"Yes\"}}</div>\n  </div> \n  <div class=\"line_after {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n    <div class=\"removal_date\"><span>Removal date</span>{{$data.$item.removalDate | date:'d MMM y'}}</div>\n    <div class=\"removal_comment\"><span>Comment</span>{{$data.$item.removalComment == \"\" ? \"No Comment\" : $data.$item.removalComment}}</div>    \n  </div>\n  <div class=\"alert_text\">{{$data.$item.text}}</div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.displayAlerts.length > 0"}}],"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"// We don't want to be able to select previously end-dated alerts.\nif (!!$data.$item.removalDate) {\n  return\n}\n\nif(cti.store.variables.alerts === undefined) {\n  cti.store.variables.alerts = []\n}\n\nvar alert = cti.store.variables.alerts[0]\n\nif (alert) {\n  //var visibleString = 'alertRowVisible-' + cti.store.variables.alertToRemove.id;\n  var hiddenString = 'alertRowHidden-' + alert.id;\n\n  //var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  if(hidden == null) {\n    cti.store.variables.alerts = []\n    return false;\n  }\n\n  //visible.classList.remove('selected');\n  hidden.classList.remove('selected');\n  \n  if($data.$item.id != alert.id) {\n    var alertToRemove = $data.$item;\n\n    //var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n    var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n    //var visible = document.getElementById(visibleString);\n    var hidden = document.getElementById(hiddenString);\n\n    //visible.classList.add('selected');\n    hidden.classList.add('selected');\n\n\tcti.store.variables.alerts = [];\n\tcti.store.variables.alerts.push(alertToRemove);\n  } else {\n    cti.store.variables.alerts = []\n  }\n} else {\n  var alertToRemove = $data.$item;\n\n  //var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n  var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n  //var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  //visible.classList.add('selected');\n  hidden.classList.add('selected');\n\n  cti.store.variables.alerts = [];\n  cti.store.variables.alerts.push(alertToRemove);\n}\n\ncti.utils.updatePage();"},"_auto_id_":"8f8d66b0-ab08-4693-8a91-ab1a26464457"}]},{"name":"image_alerts","type":"media","item-type":"image-viewer","_auto_id_":"4bab6c82-077f-43a0-98ab-cde040e69157","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.alerts.length == 0"},"fileName":"thin-0550_attention_error_alert_caution.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_alerts_nodata_html","_auto_id_":"01027cef-210b-4079-97a6-3f67e7242394","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Patient Alerts</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Patient Alerts</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.alerts.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"7fc458cf-e01e-4bc4-9328-1ae05d81bf66","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"b45ddd34-10be-46cd-97b4-e44c5ee6210d","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"d0714d8f-5eff-4fc2-8e10-680c0d5bee87","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"b13f4f15-e1d6-44dc-9cb8-68bff733ee0b"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"47a496b6-76cc-4725-840d-607fb5fd937e","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"357133a9-ff9e-4ecf-aad8-3fda766d3737"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"7a767503-d9c4-416d-87e9-86c9d6fad28f","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"00564856-7339-4c52-98d5-ea6c03695cfa","actions":[{"event":"success","type":"call-component-function","data":{"page":"Alerts","componentInstanceId":"d26b5857-354e-4a8f-997d-d4bc49db4680","function":"toggle"},"_auto_id_":"06beae6b-5e18-4402-8eb3-245fa9a37285"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"5402e41c-2ee0-4d82-ad73-0e5206857f6d","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"3862f912-8c47-436c-ad69-07d696d7660c"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"545b95ee-e2ae-413d-857a-e5428ea3b25f","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}],"_auto_id_":"bec561c6-4892-4991-b7b1-9c85bbc9da7a"},{"start":false,"name":"Appointments","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"cdfac0ec-af4d-40ce-a54b-64df461c1586","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Appointments', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"991c6869-55eb-41a7-a3c5-1ad99fcbd740"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Appointments</h4>","_auto_id_":"574ec85c-b62f-496a-b90a-8c600d366e5b"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"ae4076cf-34d4-41e3-84d6-7db658026d64","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Appointments","componentInstanceId":"87eaaef7-080b-48dc-bfe4-594fca7de2e8","function":"toggle"},"_auto_id_":"c9e8fde6-ef37-46ac-87c8-c39a86cb424b"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"2acd8b27-5f51-49f0-a92d-6a389ca3aa87","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"6959b08c-4a48-4d6e-8c2a-22bf5ddc90d8","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"6cbdd776-00aa-4fbd-9da9-7b3bf003a829"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"471af4d4-8eb3-467e-86d0-159a2463763b","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"25564a21-e489-4629-b2f9-bdc438267ee7"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"1792ad8f-40bc-4f09-b47d-b4d5e7f0c3a5","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"b172c066-6655-4fbf-9990-eed6bb14d9c4","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"87eaaef7-080b-48dc-bfe4-594fca7de2e8","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"961c94b8-dccd-45f7-9dc8-3bd27d5d503c","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"c62ed8cc-1dc4-424f-9d39-5c02e73b99d1","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"194dd363-aae5-44a3-982e-45f6c17cd4c2","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"c9770b87-b4aa-4029-8fdd-e2978e905685","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"adc5ade5-b683-44f7-9de3-f22785d9f36b"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"2b48feee-9579-4f73-8ba6-9e258d5ed002","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"dcb3b4d4-f20d-4514-926f-8f99798ca823","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"6d2b1420-7991-4b9b-9b28-53db7c13be8d","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"2195b45a-37d5-4dd9-bd7a-bbbe7e4626c9","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"7958087c-dacc-4581-b96d-d65deb57a0a2"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"997b39e8-2ffa-45ff-9c49-b3b6d74d9a6f","function":"toggle"},"_auto_id_":"b5bd07fc-5295-41ef-b8dd-88ed854d7024"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"dd8c0033-9af9-4651-a802-ff289f392a09","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"997b39e8-2ffa-45ff-9c49-b3b6d74d9a6f","function":"toggle"},"_auto_id_":"6969e540-1978-438f-b5ed-c654c10c50a0"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"9ae46f7a-a747-43f0-9792-7d49b5307a9c","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"739fa795-9085-4dc3-8068-28be0b076dda","content":[{"name":"list_appointments","type":"content","item-type":"list","_auto_id_":"8c0bc66a-7968-4bb8-a170-b285e81b2a82","search":"","classes":"","expressions":{},"model":"$store.variables.selected_visit.patientData.appointmentHistory","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_appointments_html","_auto_id_":"20014b9c-928d-4c8a-ac08-1fc3fa8ddd76","content":"<div class=\"card_holder\">\n  <div class=\"line_after\">\n    <div class=\"appt_type\">{{$data.$item.type}}</div>\n    <div >{{$data.$item.hcpSurname}}, {{$data.$item.hcpForename}}  {{$data.$item.hcpTitle && $data.$item.hcpTitle != '' ? '(' : ''}}{{$data.$item.hcpTitle}}{{$data.$item.hcpTitle && $data.$item.hcpTitle != '' ? ')' : ''}}</div>\n  </div>\n  <div class=\"{{$data.$item.comment == '' ? '' : 'line_after'}}\">\n    <div class=\"date\"><span>Date</span>{{$data.$item.date | date:'d MMM y h:mm'}} ({{$data.$item.intendedDuration}} Minutes)</div>\n    <div><span>Setting</span>{{$data.$item.clinic}}</div>\n    <div><span>Location</span>{{$data.$item.location}}</div>\n    <div class=\"{{$data.$item.cancellationReason == '' ? 'display-none' : 'Yes'}}\">\n      <span>Cancellation</span>{{$data.$item.cancellationReason != \"\" ? $data.$item.cancellationReason : \"Not Applicable\"}}\n    </div>\n    <div class=\"{{$data.$item.outcome == '' ? 'display-none' : 'Yes'}}\">\n      <span>Outcome</span>{{$data.$item.outcome != \"\" ? $data.$item.outcome : \"Not Applicable\"}}\n    </div>\n  </div>\n  <div class=\"{{$data.$item.comment == '' ? 'display-none' : 'Yes'}}\">   \n    <span>Comments</span>{{$data.$item.comment != \"\" ? $data.$item.comment : \"Not Applicable\"}}\t\t\n  </div>\n</div> "}],"actions":[]},{"name":"image_appointments","type":"media","item-type":"image-viewer","_auto_id_":"f4d1c1ae-1ff1-451e-9026-0f340717e2dc","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.appointmentHistory.length == 0"},"fileName":"thin-0023_calendar_month_day_planner_events.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_apps_nodata_html","_auto_id_":"35ed6692-06e9-4fe0-8f1e-73244fbb7f15","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Appointment History</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Appointment History</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.appointmentHistory.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"ffcfba44-9ca5-46c9-9ea5-b82d24a9cd10","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"1c3039d9-b7df-4c3c-8cdd-8e175a06b933","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"35be87e8-24ca-438c-8883-c31ca659ea52","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"5157acbb-a17f-4c43-8c90-eaf7789e0dd5"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"8721a36c-2f45-4f39-ae35-04b43e4ae225","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"db2782dd-0223-4ebe-82f7-5402e1353080"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"23a31c77-85fd-476a-9451-13f2eb22f48e","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"61c68a53-3377-4f33-8f75-d39b6758e8e2","actions":[{"event":"success","type":"call-component-function","data":{"page":"Appointments","componentInstanceId":"9ae46f7a-a747-43f0-9792-7d49b5307a9c","function":"toggle"},"_auto_id_":"e75b96e3-c81c-4827-8009-6c88e0794a28"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"a4fe747e-6366-4733-ad13-bf9e85f7c5e7","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"b1393a58-e013-4d67-90a2-6b6a21b70df4"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"f076285c-9b19-4f6e-9c58-0cc5d278ee94","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}],"_auto_id_":"d2bacb0e-8b88-4cd4-a1b9-0821db444386"},{"start":false,"name":"Referrals","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"f13c925f-e07f-41af-aa4c-a45f8aac413e","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Referrals', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"0433ce2e-14cb-4309-98df-ab76ee6016f9"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Referrals</h4>","_auto_id_":"9393bf05-6470-47b6-9ecb-de204f8e2be0","expressions":{}},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"47326a76-03b0-435c-8f84-aabc38883374","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Referrals","componentInstanceId":"28169b85-b937-477a-8cea-7089a074211e","function":"toggle"},"_auto_id_":"236ccf70-c22e-44c0-8d3a-1968c4cf1e15"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"3e5ee03f-d57e-450f-af11-ef40ec945a31","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"d4a0c877-5c95-44b9-b877-ee61adacaa33","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"6e3ba2dc-8f12-428a-866e-966f4b921657"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"82a33479-5035-43ba-a334-6e732645826b","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"6eb1adf7-e06a-457c-9c7a-4db622714801"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"a69b50e0-4de9-4999-84cb-3fc4c4a831d9","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"d961ad94-b308-4a89-8ed5-c59f27a25efa","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"28169b85-b937-477a-8cea-7089a074211e","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"b0578843-25ff-45ec-8aa5-b1b50d86b582","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"cc74d35c-dbf3-4337-b354-dfae278bb5e7","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"b78c99e5-57a1-4029-a874-b78c8c2f4dfe","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"c8f0bac4-f449-49ee-8cf3-93ab929ef602","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"07a3d060-2832-4d1d-8bc8-fb1de01efa29"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"ee9ca95f-c3d2-42d7-bdad-08df28e5e52d","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"9a0b10f0-002a-4cd3-a0b5-1f93b02c0e90","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"556b319f-65c2-467e-afde-3f534f5db631","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"44ada140-342b-403f-80cd-d69f18dcf5f5","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"876844ef-5128-46e8-b096-4fcfec3cf580"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"787f54ec-b9a2-42cd-b30b-d3bc045ce3f2","function":"toggle"},"_auto_id_":"9f207860-1db0-4e37-98c1-7ce28990fde6"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"c4464316-2378-45a7-8228-4a06f2868956","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"787f54ec-b9a2-42cd-b30b-d3bc045ce3f2","function":"toggle"},"_auto_id_":"537c900f-dc92-4c1b-961b-d6f8b1b6e2d0"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"3d82a92a-39a6-4abb-ae71-4dacf26db882","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"38b13d62-1240-4dd7-bf84-8987d030bd5a","content":[{"name":"list_referrals","type":"content","item-type":"list","_auto_id_":"890604f9-9a78-4169-a5b9-7893d4cdd449","search":"","classes":"","model":"$store.variables.selected_visit.patientData.referrals","theme":"","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_referrals_html","_auto_id_":"8bd550e3-292c-46ef-be10-4e7e1b17ed88","content":"<div class=\"card_holder\">\n  <div class=\"flex_row\">\n    <div class=\"referral\">Referred to {{$data.$item.specialty.value}}</div>\n    <div ng-if=\"$data.$item.associatedDocuments.associatedDocument.fileType\" class=\"doc_link_holder fa {{$data.$item.associatedDocuments.associatedDocument.fileType == 'image/jpeg' ? 'fa-camera' : 'fa-file-text-o'}}\" onclick=\"cti.fn_load_document(this.id)\" id=\"{{$data.$item.associatedDocuments.associatedDocument}}\"></div>\n  </div>  \n    <div class=\"service\"><span>Date</span>{{$data.$item.referralDate | date:'d MMM y h:mm'}}</div>\n    <div class=\"service\"><span>Team/HCP</span>{{$data.$item.team.value}}</div>\n    <div class=\"referrer\"><span>By</span>{{$data.$item.referrer}}</div>\n    <div class=\"referrer\"><span>Source</span>{{$data.$item.referralSource.value}}</div>   \n</div>"}]},{"name":"image_referrals","type":"media","item-type":"image-viewer","_auto_id_":"7a93cd48-9c39-4d64-8697-3f56716749f5","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.referrals.length == 0"},"fileName":"thin-0825_stetoscope_doctor_hospital_ill.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_referral_nodata_html","_auto_id_":"05308e00-ef14-4068-93e4-fd2c91acdbbb","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Referral Information</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Referral Information</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.referrals.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"8c8169b8-91c3-47c2-9a36-898007247534","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"77084b53-cf59-4bfb-93cf-d45dfd4a09fd","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"d2998b23-e1e1-44f8-b5ad-f3649bb400eb","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"6d1b7fef-cffb-4cc9-80e9-1dd0f558842e"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"31f36ab0-45fe-43a1-8e12-cd798803696b","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"ea02d4b7-4018-4d1e-92a0-7ec486f0f914"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"54930ccb-77f0-4a15-9fa5-077b1c30a989","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"7460b625-9626-4df8-a936-d75fb0e3cc6c","actions":[{"event":"success","type":"call-component-function","data":{"page":"Referrals","componentInstanceId":"3d82a92a-39a6-4abb-ae71-4dacf26db882","function":"toggle"},"_auto_id_":"8b8bd311-cd30-4d9e-b870-3bf11c86cac2"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"202c0073-3baa-471e-b826-7ffd79664c1b","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"8aed5f60-d5ac-42ca-9376-b33972270dbe"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"a76b5cd7-8368-4fe5-861f-5f1da5c520d9","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}],"_auto_id_":"7df3fdd4-0e56-4b4d-aada-df842527905c"},{"start":false,"name":"Notes","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"cd89764e-4add-40af-b3a5-553f3a61125b","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Notes', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"2ab160d2-bac1-4b7f-a6a3-14cb3de66fd0"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Progress Notes</h4>","_auto_id_":"a98484d1-0371-464d-91ec-94878aa1e144"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"c1b9af8e-3023-4b59-9cc5-6918f46979c6","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Notes","componentInstanceId":"355e2802-6643-4684-9f1d-12b57c678b50","function":"toggle"},"_auto_id_":"43aed283-3262-4fe6-9734-c11cee553977"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"a524cef2-573c-4231-a202-ef77666bf880","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"793c0b1a-ee42-4823-a321-146f2c3fa2d5","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"62a4013c-cfd0-4f75-b345-d82c9246b942"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"05299227-4946-4aa2-8df5-bfa4ba4276c5","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"aaf027a7-7977-42b7-92de-ed0d58fffc79"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"b133fbb7-51e6-4a0c-bfbe-9f96fa7bdb31","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"b962e1dc-c25a-4534-82b6-d16d19e095ce","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"355e2802-6643-4684-9f1d-12b57c678b50","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"92711f35-fb7a-4674-96f0-3c7990c78e8b","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"0e615de5-ce90-4244-bf34-fd7a106f05a1","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"51173175-260d-44a9-9cb9-796a068fa3f6","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"5936b3e7-9dad-41c2-940e-50408c403af1","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"dce5e2c5-f0fc-4914-90da-cfee2e43cfd2"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"3600fdc6-9c3e-47d0-817e-2847263d084a","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"81da9caf-20ed-453e-a928-85c7c953a519","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"bf07c402-558d-45fe-95a0-c78bf53ee2b2","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"37ef2f44-2a35-4238-a354-cc8596422256","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"e84893a7-ebbe-4ea0-945d-96d8004e5119"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"b37de555-68b0-46ed-aca0-a540075a9651","function":"toggle"},"_auto_id_":"b658d8a2-5f3f-4ba4-8cbe-a665fc7236ed"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"da7e93b2-c18a-493e-977e-e9e63324dea6","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"b37de555-68b0-46ed-aca0-a540075a9651","function":"toggle"},"_auto_id_":"a6fc3bcd-b3f0-46a1-ac88-9d058f26f2c5"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"db1a2a92-1c47-4f5d-8ec1-1f935a74f829","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"f0d58c7f-7d57-49c5-b44a-9af34787bf02","content":[{"name":"list_notes","type":"content","item-type":"list","_auto_id_":"e67f2792-b6eb-4146-ac17-3a2e397ac3de","search":"","classes":"","expressions":{},"model":"$store.variables.selected_visit.patientData.progressNotes","actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_notes_html","_auto_id_":"1db2d532-62f5-481b-be77-33d58f1d849f","content":"<div class=\"card_holder\">\n    <div class=\"line_after flex_row\">\n        <div class=\"note_type left half\">{{$data.$item.progressNoteType.value}}</div>\n        <div class=\"sub_type right half\">{{$data.$item.progressNoteSubType.value}}</div>\n        <div class=\"speciality full\"><span>Specialty</span>{{$data.$item.specialty.value}}</div>\n    </div>\n    <div class=\"line_after\">\n        <div class=\"{{$data.$item.associatedDocuments != undefined ? 'documents' : 'hide'}}\">\n            <p class=\"fa {{$data.$item.associatedDocuments.associatedDocument.fileType != 'application/pdf' ? 'fa-camera' : 'fa-file-text-o'}}\" onclick=\"cti.fn_load_document(this.id)\" id=\"{{$data.$item.associatedDocuments.associatedDocument}}\"></p>\n        </div>\n        <div class=\"date\"><span>Date</span>{{$data.$item.dateTime | date:'dd MMM yyyy HH:mm'}}</div>\n        <div class=\"hcp\"><span>HCP</span>{{$data.$item.enteredBy.surname}}, {{$data.$item.enteredBy.firstname}} {{$data.$item.enteredBy.title && $data.$item.enteredBy.title !== '' ? '(' : ''}}{{$data.$item.enteredBy.title && $data.$item.enteredBy.title !== '' ? $data.$item.enteredBy.title : ''}}{{$data.$item.enteredBy.title && $data.$item.enteredBy.title != '' ? ')' : ''}}</div>      \n        <div class=\"validated\"><span>Validated</span>{{$data.$item.verifyDate == undefined ? \"Not Validated\" : \"Validated\"}}</div>\n        <div class=\"significant\"><span>Significant</span>{{$data.$item.isSignificant == \"0\" ? \"No\" : \"Yes\"}}</div>\n        <div class=\"third_party\"><span>Third party</span>{{$data.$item.isThirdParty == \"0\" ? \"No\" : \"Yes\"}}</div>\n        <div class=\"risk\"><span>Risk</span>{{$data.$item.isRiskRelated == \"0\" ? \"No\" : \"Yes\"}}</div>\n    </div>\n        <div class=\"note\">{{$data.$item.noteText}}</div>\n</div>","expressions":{}}]},{"name":"image_notes","type":"media","item-type":"image-viewer","_auto_id_":"99b4efaa-c046-4969-9fe9-d1b14b5371e7","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.progressNotes.length == 0"},"fileName":"thin-0003_write_pencil_new_edit.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_notes_nodata_html","_auto_id_":"a0dd3d07-3775-4a60-a802-dbdba8b92cad","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Progress Notes</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Progress Notes</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.progressNotes.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"364e4381-4930-4012-a536-e9e1b805d2aa","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"2a32c82d-6c82-4e46-a192-9ee726b1db32","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"337f3a05-eb36-4369-b223-fb4f63df14a1","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"957254cd-4d53-42a5-a063-8766c4387aa1"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"a8444950-a88e-4394-8141-b6ac70562e44","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"7ee7f8f2-33f2-41ef-bac4-dcf7c7e0c707"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"93f6e1e8-245a-434b-be87-acd3c90106df","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"6d20dd99-6bf9-4ebd-95e8-a4f4814a5ad5","actions":[{"event":"success","type":"call-component-function","data":{"page":"Notes","componentInstanceId":"db1a2a92-1c47-4f5d-8ec1-1f935a74f829","function":"toggle"},"_auto_id_":"7cc7b007-3fbb-4809-a055-e816a543a635"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"d09c2f8e-764b-4bf4-8549-2141e649b5c5","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"03a73e5a-9cf8-4738-a4ab-2c99eaf83684"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"1fb097b9-c981-4246-b1d9-d11cf967c739","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}],"_auto_id_":"1ec4a9fe-8a06-4934-aa7e-836b39dd15b0"},{"start":false,"name":"Documents","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"64ca3ab1-a05e-40f2-8401-bcf998cd88a6","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Documents', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"d723134e-78b7-4dba-a437-aaac1b54f6d9"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Documents</h4>","_auto_id_":"6b9a7a50-c1cb-44ff-8330-ceb2e2b2376e"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"ec9869d1-efce-44f7-a68a-aac521a0a957","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Documents","componentInstanceId":"76ac5218-c762-409e-8c74-adb7d9f0b900","function":"toggle"},"_auto_id_":"6c542ca7-9f0a-4e11-aec0-8a6b5eac9e28"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"ae744d9e-a314-4a87-bc74-e3dcbdc099f9","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"1efa1a07-8807-43f0-8c37-661a5fcda6fd","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"2bb9234b-db48-4421-bef1-9e96e76e07e9"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"7f1b3de1-10cc-41af-b5d7-eebf61052f52","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"44d01da6-8549-4ceb-8fa4-2b9338365168"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"cd9e0ddc-c49e-4558-b589-12a616e93033","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"04ada33f-379b-4caa-9b07-6e2148fa3f28","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"76ac5218-c762-409e-8c74-adb7d9f0b900","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"dc322b78-09a3-4d0c-8121-ceeb0cb00268","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"615cfa0f-13da-44fa-86b6-43ad7fed713c","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"3a4f1f79-d1ec-4bba-a5f7-e3801883d907","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"6705ebe1-2fca-4fec-9ba2-4b3915b6c2ee","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"4e94ce07-4a3b-497e-86f1-7fb96f91836f"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"dc41bb68-ce5e-4839-99ae-71badf3fc24e","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"58c69c8a-2ad3-4fea-8a72-df52d64eddd7","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"85008722-ed65-46d5-9b6c-7473d87fbc13","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"ebb1c7f0-8f6b-45b1-bd4a-8ea7836d1db8","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"d0003b9e-4042-406b-97b8-ae44de350221"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"9da08882-90a6-46fe-914d-e6458e97c868","function":"toggle"},"_auto_id_":"609c328e-8963-4f87-afdb-374e3ef9a5e8"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"f746dcf9-3ca7-41fd-a1da-fe1af1ed9b38","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"9da08882-90a6-46fe-914d-e6458e97c868","function":"toggle"},"_auto_id_":"c5f1bfaa-5f5c-4f40-a46a-6e41fbdaa293"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"6df99514-4777-42ae-9022-39920ba9cd81","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"734a0121-0134-490f-80a8-9672c3a5d166","content":[{"name":"list_documents","type":"content","item-type":"list","_auto_id_":"812f9798-dd63-4569-9662-d4174ae4631d","search":"","classes":"","model":"$store.variables.selected_visit.patientData.documents","theme":"","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_documents_html","_auto_id_":"4c9132b4-5a20-46f7-88df-54bdf5a93ce6","content":"<div class=\"card_holder\" onclick=\"cti.fn_load_document(this.id)\" id=\"{{$data.$item}}\"> \n    <div class=\"contact_name\">{{$data.$item.title}}\n      <div class=\"doc_link_holder fa fa-file-image-o {{$data.$item.fileType == 'image/bmp' || $data.$item.fileType == 'image/x-ms-bmp' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-file-word-o {{$data.$item.fileType == 'application/msword' || $data.$item.fileType == 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-file-image-o {{$data.$item.fileType == 'image/gif' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-chrome {{$data.$item.fileType == 'text/html' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-file-image-o {{$data.$item.fileType == 'image/jpeg' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-file-pdf-o {{$data.$item.fileType == 'application/pdf' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-file-image-o {{$data.$item.fileType == 'image/png' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-file-word-o {{$data.$item.fileType == 'text/rtf' || $data.$item.fileType == 'application/rtf' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-file-text-o {{$data.$item.fileType == 'text/plain' ? '' : 'display-none'}}\" ></div>\n      <div class=\"doc_link_holder fa fa-file-excel-o {{$data.$item.fileType == 'application/vnd.ms-excel' || $data.$item.fileType == 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ? '' : 'display-none'}}\" ></div>\n    </div>\n    <div class=\"relationship\"><span>Date</span>{{$data.$item.documentDate | date:'d MMM y HH:mm'}}</div>\n    <div class=\"type\"><span>Type</span>{{$data.$item.documentType.value}}</div>\n</div>","expressions":{}}]},{"name":"image_documents","type":"media","item-type":"image-viewer","_auto_id_":"3cbda038-7fe5-4ecb-91bb-9fe0c4a22dcc","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.documents.length == 0"},"fileName":"thin-0073_documents_files_paper_text_archive_copy.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_docs_nodata_html","_auto_id_":"96c221ce-1660-4af7-9b0e-9e3d0fdd59ab","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Documents Available</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Documents Available</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.documents.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"8ad31e0e-8ead-4701-9b0b-c125b8f57456","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"84c9b385-ae91-4db9-8d29-ab4a6f6d3d11","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"3e58eab9-1e8f-4943-aa1e-57eb991a674d","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"1fdf9740-66c8-4815-97aa-47077267b656"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"20970dbe-a8a9-42c4-8b8d-f91062fa8bb6","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"7ff643f4-d77e-4a93-80f9-a46cce5fe0c2"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"f2c7bc92-af63-4d03-a215-8d0d5276ed76","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"05a1eb4d-4990-4db8-82c1-8013dfc551ce","actions":[{"event":"success","type":"call-component-function","data":{"page":"Documents","componentInstanceId":"6df99514-4777-42ae-9022-39920ba9cd81","function":"toggle"},"_auto_id_":"0073a657-46ac-440a-9ba6-1a6ce09e5e60"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"109bf054-05a0-4271-b507-862253359881","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"1092c8ec-e49a-4368-a08b-0ceccf443dfe"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"8c156b28-eba3-4237-8035-c676d7ef70c0","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}],"_auto_id_":"8640701e-ceb0-4d31-9d2a-eda33677e530"},{"start":false,"name":"Allergies","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"1a9ec8dc-2772-4d25-bf61-e37a50b7a541","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Allergies', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"51ca06f4-ccf0-4281-8966-3fc2d3b28562"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Allergies</h4>","_auto_id_":"2a197762-d6ba-4808-8e0c-1e64a6a9aed7"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"f34671de-f186-422d-bd4b-8e27c5f6bca5","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Allergies","componentInstanceId":"17605ef6-441f-4f33-8d4a-257e595e7904","function":"toggle"},"_auto_id_":"ed3eff75-7ea5-4290-964e-167cd93ecb12"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"975cd3fc-9107-4625-85d2-de6b89292c49","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"c423f803-c458-4a49-919b-4d5c426f9116","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"6a511741-8492-4836-af11-8510de5dd7ad"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"1b1b94cf-311f-4703-b8f3-1acd54b250ca","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"3e9c7259-3bf6-4fc0-a8a2-247ee650f351"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"190b2b1e-d095-4591-9308-cbef0b905486","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"c1d8e3b0-1fa2-4845-9150-04ba2b24ee36","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"17605ef6-441f-4f33-8d4a-257e595e7904","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"94fa51b9-1b14-4a3e-be51-b427a1e60c40","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"860f44e3-1e49-4b85-9d66-4bdfebdfe76c","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"bcc3a660-54d0-4e93-ad83-24bef5cdebb9","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"c067a06c-61d4-4291-bdcc-35486b507d5d","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"223943cc-ee5f-4c68-b1e9-fc14150f1e6e"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"1321870c-58ce-44af-a3a5-3faf266c2985","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"5b30a455-86a1-4020-8725-918be2279364","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"12c76ed1-3686-4653-9fc2-3952ac5f4800","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"54c5b8d4-1330-4011-a7f9-e39700476586","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"d29645e0-1275-4799-89d8-1a230a457362"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"18ab2fad-0083-4d95-9bdd-ccf0a96ff03d","function":"toggle"},"_auto_id_":"d03dbf05-aad7-49d8-b7a8-d03e6a1771d8"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"d847c2cd-c203-45b3-a1a6-1bb1880a49be","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"18ab2fad-0083-4d95-9bdd-ccf0a96ff03d","function":"toggle"},"_auto_id_":"39c47048-b894-4b01-ab91-8421c9b1c1a6"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"8a5ff8ea-1d99-4f79-a55f-c7ee4d0a457e","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"bf427c76-ee5b-4277-8e89-9ffd2788bdd5","content":[{"name":"list_allergies","type":"content","item-type":"list","_auto_id_":"dc3ec009-1109-4878-919c-89b0e8a1fe84","search":"","classes":"","model":"$store.variables.selected_visit.patientData.allergies","theme":"","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_allergies_html","_auto_id_":"6c2b96fd-a8b0-4e7b-b0fe-d9a68acc5ae2","content":"<div class=\"card_holder\" >\n    <div class=\"line_after\">   \n        <div class=\"substance\">{{$data.$item.substance}} - {{$data.$item.reactionSeverity}}</div>\n        <div class=\"type\"><span>Type</span>{{$data.$item.reactionType}}</div>\n    </div>\n    <div class=\"{{$data.$item.reaction != '' ? 'line_after' : ''}}\">  \n        <div class=\"year\"><span>Identified in</span>{{$data.$item.yearOfIdentification}}</div>\n        <div class=\"reporter\"><span>Reported by</span>{{$data.$item.reportedBy}}</div>\n    </div>\n    <div class=\"reaction {{$data.$item.reaction != '' ? '' : 'hide'}}\"><span>Reaction</span>{{$data.$item.reaction}}</div>\n</div>","expressions":{}}]},{"name":"image_allergies","type":"media","item-type":"image-viewer","_auto_id_":"18264c19-0777-433f-9334-df145a69d1c4","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.allergies.length == 0"},"fileName":"thin-0816_microscope_laboratory.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_allergy_nodata_html","_auto_id_":"9c314a23-d223-4b2d-b7e9-641a182bdb7b","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Allergies Identified</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Allergies Identified</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.allergies.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"40c3e748-2944-4029-8f6c-21d446084d7e","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"208ee7c6-6881-4a15-ab68-184ff77b41ae","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"8c591ca0-6cc8-49a3-947a-118c47a96987","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"143f6add-da99-4dbd-aab3-e664365b22bd"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"f1069200-c61c-4c59-81b2-12b5054242c1","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"2fb97d94-a63a-4de7-9dd9-f53f70a2d16d"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"141b4843-f6dc-4e3d-a30f-7d9704b76d9a","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"6efdb2ec-8dab-429a-ac77-d94771e7dc96","actions":[{"event":"success","type":"call-component-function","data":{"page":"Allergies","componentInstanceId":"8a5ff8ea-1d99-4f79-a55f-c7ee4d0a457e","function":"toggle"},"_auto_id_":"3eddfe08-86a2-44d5-b97c-18cdca1d50f3"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"493c7445-4a3e-4fcf-9918-4353ba8c0ae7","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"cc9b811c-1cd1-4160-84ac-72133cf6441d"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"70615558-9b29-40a2-9d41-8f96f2725422","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}],"_auto_id_":"513096e9-a7ac-477f-bb38-ffa119b1b56b"},{"start":false,"name":"Contacts","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"7c50e688-0c68-4e03-a0bc-79d70625d818","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Contacts', \n  'info'\n)\n\ncti.fn_save_appointment()"},"_auto_id_":"2d776736-28bd-4cd1-a2b7-072257afb75c"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Contacts</h4>","_auto_id_":"6e77fe56-8d85-41b8-af85-86d492fbd811"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"b7acaa50-93f6-4dff-b4ba-7df59280ef5e","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Contacts","componentInstanceId":"56eea828-8c7d-40b1-aa47-df5bf7b90131","function":"toggle"},"_auto_id_":"2503181a-f706-4bb8-8149-45ff43717838"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"05aeeb5a-75f8-4f6e-ba77-dcda4e92a7c9","attributes":{},"expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"btn_refresh","type":"button","item-type":"button","_auto_id_":"5031f3be-a41f-4063-8d9c-f72aec9790d1","content":"Refresh Appointments","theme":"default","actions":[{"event":"click","type":"call-actionflow","data":{"name":"RefreshAppointments"},"_auto_id_":"a7792de1-851b-45f5-9efe-2520a87be659"}],"expressions":{}},{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"da32c5f3-2bd0-451b-b967-b08341ce4ee9","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"27a21eb3-6713-422e-b708-ca3ab76c1d44"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"85f7fb05-4051-438c-a101-b4e2d1677160","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"63c1f104-cebd-45df-b52f-60b387a72d22","content":"<span onClick=\"cti.utils.callAction('go-to-page', {name: 'About'})\">Version {{'$store.schema.version' | store}}</span>","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"56eea828-8c7d-40b1-aa47-df5bf7b90131","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"5f8f1667-4aed-4c52-a2d3-feb8f1023327","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"d915f621-0e3b-4f2d-bc18-948db97aa107","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"9527ac46-43b8-450a-a708-23a169899cf8","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"99ad15b1-cb09-4f6f-b53c-339b88702272","content":"Back to Summary","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"b7a88679-0837-44ca-a9fb-fb22db5dd686"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"3637faac-ad88-4235-9c1f-cc585b1e5fe7","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{},"classes":"infoBanner"},{"name":"popupWarning","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"03418701-f6e5-4094-8118-fbe6bd361828","content":"<h3 style=\"color:black\">Warning: Outstanding Form Data</h3>\n<p style=\"color:black\">The following forms have either outstanding data or have failed to send to RiO: {{'$store.variables.formStatus' | store}}. If you continue then this information will be lost.</p>\n<p style=\"color:black\">Do you want to continue? </p>","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"button-bar","_auto_id_":"bb9c5761-7056-40cb-bbbc-5bcac739e2b2","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"bc5c3418-fb12-430a-9d31-99b9605fba8e","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.formStatus\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n$success()"},"_auto_id_":"6317c039-dd61-415c-a775-c7ff1dd0282f"},{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"793ced63-c4fd-454e-bc8f-7389d13c46ac","function":"toggle"},"_auto_id_":"e74beb41-51bf-40ef-875b-c916b30de163"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"839a4acc-8efa-4d4a-8387-105a61eccf8b","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"793ced63-c4fd-454e-bc8f-7389d13c46ac","function":"toggle"},"_auto_id_":"07d7d6b6-0119-49bc-8066-8501a4a44d78"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"86a74e4e-7c59-45ee-968e-8229c8c3efa6","attributes":{"id":"popupWarning"},"expressions":{}}],"expressions":{},"classes":"relative"},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"e8d30d95-da48-4feb-9091-7a7279d6e385","content":[{"name":"list_contacts","type":"content","item-type":"list","_auto_id_":"38ddf9d3-8492-41ec-989e-9a136e516939","search":"","classes":"list_contact","model":"$store.variables.selected_visit.patientData.contacts","theme":"","expressions":{},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_contacts_html","_auto_id_":"443ea231-2e2d-4d34-b307-55bc3c0ac30c","content":"<div class=\"card_holder\" >\n  <div class=\"line_after\">   \n    <div class=\"contact_name\">{{$data.$item.name}}</div>\n    <div class=\"relationship\"><span>Relationship</span>{{$data.$item.contactRelationship.value}}</div>\n    <div class=\"type\"><span>Type</span>{{$data.$item.contactType.value}}</div>\n  </div>\n  <div class=\"icon phones {{$data.$item.emailAddress != '' ? 'line_after' : ''}}\" onclick=\"cti.fn_call_contact(this.id)\" id=\"{{$data.$item.mainPhone}}\">\n    <span>Phone</span>{{$data.$item.mainPhone}}\n  </div>\n  <div class=\"{{$data.$item.emailAddress != '' ? '' : 'hide'}}\" >\n    <div class=\"email\"><span>Email</span>{{$data.$item.emailAddress}}</div>\n  </div>\n</div>","expressions":{}}]},{"name":"image_contacts","type":"media","item-type":"image-viewer","_auto_id_":"ca44846c-7a0d-4c6b-b680-888465878e09","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.selected_visit.patientData.contacts.length == 0"},"fileName":"thin-0301_address_book_contacts.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_contacts_nodata_html","_auto_id_":"a43ba59b-473a-4e7f-a369-630502c61229","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Key Contacts</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Contacts Available</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.contacts.length == 0"}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"2bf7fcb5-f683-430a-b249-7efa4bf1f5f1","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date()\ncti.store.variables.selected_visit.status = 'started'\ncti.utils.updatePage()"},"_auto_id_":"02a966f3-a9b2-45e6-883e-0ca71d6688f6","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"73499c6c-ec2b-439e-843c-e14c38bd1288","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"b0914517-019b-4082-8ec8-4f4a94b62907"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"15095555-6724-4336-b117-586ef55c4886","content":"ADD ALERT","theme":"default","expressions":{"show":"$store.variables.selected_visit.arrivalTime != undefined && $store.variables.selected_visit.status != \"new\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"e0f5d3fe-3564-4251-82d5-ad3eccd359bf"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"d3786a72-c55b-4fac-a35a-6c14adc7d1c9","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.formStatus = undefined\ncti.store.variables.o_activities = []\n\nif(dialog == \"failed\" || dialog == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Dialog+\"\n  } else {\n    cti.store.variables.formStatus += \", Dialog+\"\n  }\n} else if(dialog == \"complete\") {\n  var dialogObj = {\n    group : undefined,\n    value : \"dialogplus\",\n    label : \"DIALOG+\"\n  }\n    \n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif(safety == \"failed\" || safety == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"My Safety Plan\"\n  } else {\n    cti.store.variables.formStatus += \", My Safety Plan\"\n  }\n} else if(safety == \"complete\") {\n  var safetyObj = {\n    group : undefined,\n    value : \"msp\",\n    label : \"My Safety Plan\"\n  }\n    \n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif(lifestyle == \"failed\" || lifestyle == \"inprogress\") {\n  if(cti.store.variables.formStatus == undefined) {\n  \tcti.store.variables.formStatus = \"Lifestyle Assessment Form\"\n  } else {\n    cti.store.variables.formStatus += \", Lifestyle Assessment Form\"\n  }\n} else if(lifestyle == \"complete\") {\n  var lifestyleObj = {\n    group : undefined,\n    value : \"phlifestyl\",\n    label : \"Lifestyle Assessment Form\"\n  }\n    \n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nif(cti.store.variables.formStatus == undefined) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Outcome\"})\n} else {\n  $success()\n}"},"_auto_id_":"12daa61f-621e-4d54-9e9f-b056cd49c757","actions":[{"event":"success","type":"call-component-function","data":{"page":"Contacts","componentInstanceId":"86a74e4e-7c59-45ee-968e-8229c8c3efa6","function":"toggle"},"_auto_id_":"6901191b-3d3f-44eb-8fd3-70758f623e41"}]}],"classes":"default"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"3a741d01-4ff4-4aff-9f9f-af66ddfc29d9","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"e15afd76-7351-42e0-b8a2-3c91bb623a8d"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alerts === undefined || $store.variables.alerts.length === 0"}}],"_auto_id_":"92f8bcc7-3926-444d-a3ee-a562b34e8f41","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}],"_auto_id_":"6f37759c-4ed2-427d-a3f0-5deb19276999"},{"start":false,"name":"LifestyleFormOne","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"d58f7e12-f93b-430c-9821-d3c21daf738b","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"c5ff4001-c454-4f48-8291-7ece8e024c4d"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"4fbb0938-6374-43f2-8f0d-63f31a2e5ade","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"275f1f5d-04db-4c5d-8671-bec4fcbabe6b","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"5b95e288-f628-456d-9bf9-51fa7490cb0a"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"6f4578b5-ce62-46a1-8122-6f923522260e"}],"_auto_id_":"0aa0394a-5e6f-436d-a1c6-3bdf450d90e7","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"c0defb9a-bbda-404d-a0d8-96a6172ad926","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"550c4b59-654b-42ba-b39e-470765275392","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"ce868c52-d48e-4bc7-b908-ed2891c0c3e3","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"457617af-21ac-44f5-8e5a-7d083f826adb","content":[{"name":"html_smoking","type":"content","item-type":"html","_auto_id_":"d16e5c26-1a8b-4ebc-b42c-9d711e52ce79","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Smoking</h4>\n  <i id=\"smoking\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Smoking","type":"area","item-type":"group","_auto_id_":"63e053d5-66de-468c-9862-0dbaf7dfaadf","content":[{"name":"lssmoked","type":"choice","item-type":"select","_auto_id_":"0c2ee344-11a1-4e88-86e7-87d8f29d1517","label":"Have you ever smoked?","required":true,"options":[{"label":"Not assessed","value":"SS01"},{"label":"No","value":"SS02"},{"label":"Ex-smoker","value":"SS03"},{"label":"Current smoker","value":"SS04"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.lssmoked && $store.variables.lastLifestyleForm.lssmoked.result"},"classes":"question_primary","message":"This is a required field"},{"name":"Smoker","type":"area","item-type":"group","_auto_id_":"cffd733a-e1b7-4543-b37b-e065469c3f94","content":[{"name":"lscigperday","type":"user-input","item-type":"number","_auto_id_":"ad661a91-ef70-4ab1-8e6c-a22f3a81b03b","label":"Cigarettes per day","required":false,"decimals":2,"expressions":{"show":"$store.pages.LifestyleFormOne.lssmoked.value == \"SS04\"","default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.lscigperday && $store.variables.lastLifestyleForm.lscigperday.result"}},{"name":"smokeadvice","type":"choice","item-type":"radio","_auto_id_":"6e0dfcda-b1c5-4223-90d0-33cefef98add","label":"Very brief advice given?","required":true,"options":[{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.smokeadvice && $store.variables.lastLifestyleForm.smokeadvice.result"},"message":"This is a required field"},{"name":"Refsmoke","type":"choice","item-type":"select","_auto_id_":"975225d7-c100-48f5-813b-9ff5a2bedb48","label":"Referred to smoking cessation services?","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but rejected","value":"04"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.refsmoke && $store.variables.lastLifestyleForm.refsmoke.result"},"description":"","message":"This is a required field","actions":[]},{"name":"StopSmoke","type":"choice","item-type":"select","_auto_id_":"93ef5b17-8c58-433b-87fb-5b533af08da9","label":"Stop smoking medication given?","required":true,"options":[{"label":"Medication not offered","value":"01az"},{"label":"Medication offered & accepted","value":"02az"},{"label":"Medication offered but declined","value":"03az"},{"label":"Not medically appropriate","value":"04az"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.stopSmoke && $store.variables.lastLifestyleForm.stopSmoke.result"},"message":"This is a required field","actions":[]},{"name":"smokeintoffer","type":"choice","item-type":"select","_auto_id_":"3a5608c7-261d-4bd3-9076-3676575108f6","label":"Other intervention offered?","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.smokeintoffer && $store.variables.lastLifestyleForm.smokeintoffer.result"},"message":"This is a required field","actions":[]},{"name":"smokefreetext1","type":"user-input","item-type":"text","_auto_id_":"6594c90b-c072-4308-afa3-d36fc15239ce","label":"Details of interventions offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.LifestyleFormOne.smokeintoffer.value == \"03\" || $store.pages.LifestyleFormOne.smokeintoffer.value == \"04\"","default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.smokefreetext1 && $store.variables.lastLifestyleForm.smokefreetext1.result"},"validators":[],"actions":[]}],"repeat":false,"expressions":{}}],"repeat":false,"expressions":{},"classes":"question_group"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_next","type":"button","item-type":"button","_auto_id_":"3b90b50a-7d18-47e8-9900-976492cb8e01","content":"NEXT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var smoked = cti.store.pages.LifestyleFormOne.lssmoked.value\nvar advice = cti.store.pages.LifestyleFormOne.smokeadvice\nvar ref = cti.store.pages.LifestyleFormOne.Refsmoke\nvar stop = cti.store.pages.LifestyleFormOne.StopSmoke\nvar inter = cti.store.pages.LifestyleFormOne.smokeintoffer\n\nif((smoked == \"SS04\" || smoked == \"SS01\") && advice == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Form Invalid\", \n    \"text\" : \"Please answer if the patient has been given advice.\"\n  })\n  return false\n}\nif((smoked == \"SS04\" || smoked == \"SS01\") && ref == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Form Invalid\", \n    \"text\" : \"Please answer if the patient has been referred to smoking cessation services.\"\n  })\n  return false\n}\nif((smoked == \"SS04\" || smoked == \"SS01\") && stop == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Form Invalid\", \n    \"text\" : \"Please answer if the patient has been given stop smoking medication.\"\n  })\n  return false\n}\nif((smoked == \"SS04\" || smoked == \"SS01\") && inter == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Form Invalid\", \n    \"text\" : \"Please answer if intervention has been offered to the patient.\"\n  })\n  return false\n}\n\ncti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormTwo\" })"},"_auto_id_":"a56cf23b-597e-4805-a467-3b9fa0ae7807","actions":[]}],"classes":"default"}],"_auto_id_":"a62faead-06cf-4880-bf5d-db597c2450de","expressions":{}}],"_auto_id_":"dc3442c7-0d7d-493c-a4d6-8d204b5d8794"},{"start":false,"name":"LifestyleFormTwo","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"1aec4728-3558-4e9c-9837-5ed2eb3d3d3b","actions":[{"event":"onloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"c05a9387-308f-4db4-9cb1-13e43684b1e8"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"f0231075-e33c-45e5-8442-10e5295cfdff","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"25934612-799c-401e-9407-f012fedb00a1","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"cbb2c62e-d39b-4ffb-8464-b9c2efe0f536"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"f9b93dcd-384c-44f2-a769-9466c6f28fad"}],"_auto_id_":"e0cb3766-fbed-4a41-a523-1d9a621694b7","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"553f06d9-6cd4-40f1-94c8-a7cdc08cea71","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"a9bed9b7-63d9-41a3-9a22-266bdeb32cf0","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"5a8037ea-1000-4038-8980-f0db173e1cfd","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"379df90c-6f1f-43b8-8176-ebdf992505cb","content":[{"name":"html_diet","type":"content","item-type":"html","_auto_id_":"cb90dfdd-dbb3-4f59-9047-6947ed45b9ab","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Diet</h4>\n  <i id=\"diet\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Diet","type":"area","item-type":"group","_auto_id_":"fc29a963-4da5-4aa6-ae59-c17b03098c8b","content":[{"name":"diethealthy","type":"choice","item-type":"select","_auto_id_":"538aa7a6-9eb7-430d-8b40-a6b128cbf101","label":"Do you think you eat a healthy diet?","required":true,"options":[{"label":"Not assessed","value":"01"},{"label":"Not at all","value":"02"},{"label":"Some of the time","value":"03"},{"label":"Most of the time","value":"04"},{"label":"Nearly all the time","value":"05"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.diethealthy && $store.variables.lastLifestyleForm.diethealthy.result"},"classes":"question_primary","message":"This is a required field"},{"name":"lsdietcomment","type":"user-input","item-type":"text","_auto_id_":"5bc4cd1a-fedc-44a8-9760-62987978f7f5","label":"Please give more detail","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.lsdietcomment && $store.variables.lastLifestyleForm.lsdietcomment.result"},"validators":[],"actions":[]},{"name":"dietintervention","type":"choice","item-type":"select","_auto_id_":"09c626c8-4d04-430c-9db6-ef9b27bab6a6","label":"Intervention offered?","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but rejected","value":"04"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.dietintervention && $store.variables.lastLifestyleForm.dietintervention.result"},"message":"This is a required field"},{"name":"dietintdetails","type":"user-input","item-type":"text","_auto_id_":"fbb88b80-34f1-4ed8-9bf8-96af99f8f82d","label":"Details of interventions offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.LifestyleFormTwo.dietintervention.value == \"03\" || $store.pages.LifestyleFormTwo.dietintervention.value == \"04\"","default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.dietintdetails && $store.variables.lastLifestyleForm.dietintdetails.result"}}],"repeat":false,"expressions":{},"classes":"question_group"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"6ab228c2-3d7c-42e3-954a-b84fdcf2c7db","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormOne\" });"},"_auto_id_":"6a0e7a8d-3800-4d6a-baaf-fe3f77d86cde","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"97152f9e-3f4d-4ad2-ad07-e95e993e2662","content":"NEXT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormThree\" })"},"_auto_id_":"d4afe342-e37c-4b65-93cb-763bf246ce3f","actions":[]}],"classes":"default"}],"_auto_id_":"1196693c-7828-4094-bf8d-8969ebe46034","expressions":{}}],"_auto_id_":"1929ad2b-116c-4021-877b-1d997d1dd030"},{"start":false,"name":"LifestyleFormThree","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"0c0460b8-2917-4527-80fa-384637cdc312","actions":[{"event":"onloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"987f84dc-5ce4-4b00-9e12-457f6573d7cc"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"e9e809a5-a900-405e-ae37-cfd1a23818f3","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"9d911a04-f737-4582-8198-60443584e453","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"81ab27a8-1a8f-41ac-843f-1882efc1f812"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"73aaf1b3-d75f-4554-869f-ba0f9a16b072"}],"_auto_id_":"9a0dff75-cec2-43a3-bc06-4892d61ad18c","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"cb3cb455-960e-4d96-a614-c2065439cbcf","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"fd5f1521-0a77-4e76-ade7-17f0d09513e3","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"07e602c4-d01c-4a6b-bd39-3028f8e599e6","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"630cc45c-e98d-49c1-b38c-528f7db5d8dc","content":[{"name":"html_exercise","type":"content","item-type":"html","_auto_id_":"02d4aa02-a4ba-47bf-a55a-695e718b06d9","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Exercise</h4>\n  <i id=\"exercise\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Exercise","type":"area","item-type":"group","_auto_id_":"eb603d55-8d9b-41eb-a3e9-5cdc7d3cc839","content":[{"name":"regularexcercise","type":"choice","item-type":"select","_auto_id_":"41b50604-caa1-4b51-8323-cbdd6410f0b8","label":"Do you exercise regularly?","required":true,"options":[{"label":"Not assessed","value":"00"},{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.regularexercise && $store.variables.lastLifestyleForm.regularexercise.result"},"classes":"question_primary","message":"This is a required field"},{"name":"exercise_repeater","type":"area","item-type":"group","_auto_id_":"7eb058c7-5297-41d4-890a-9e54cbab347b","content":[{"name":"Intensity","type":"choice","item-type":"select","_auto_id_":"2738188d-b6f7-48cf-91d0-bd18a80ddb37","label":"Intensity","required":true,"options":[{"label":"Low","value":"01"},{"label":"Medium","value":"02"},{"label":"High","value":"03"}],"expressions":{"default":"5"},"validators":[],"actions":[],"message":"This is a required field"},{"name":"misperweek","type":"user-input","item-type":"number","_auto_id_":"3360e82a-ce32-4eee-b5e1-1f28b7521b9e","label":"Minutes per week","required":true,"decimals":2,"expressions":{},"message":"This is a required field"}],"repeat":true,"expressions":{"show":"$store.pages.LifestyleFormThree.regularexcercise.value == \"01\""}},{"name":"exercise_repeat_displayer","type":"content","item-type":"list","_auto_id_":"8863a5a9-bb27-46ab-b128-948532d3483d","static":false,"model":"$store.repeater.LifestyleFormThree.exercise_repeater","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"exercise_displayer","type":"content","item-type":"html","_auto_id_":"0272db60-ef88-4c97-a983-8fb3ba7cba85","content":"<div id=\"{{ $data.$index }}\" class=\"excercise_item\" onclick=\"cti.store.repeater.LifestyleFormThree.exercise_repeater.splice(this.id,1);cti.utils.updatePage()\">\n  <div class=\"node\">{{ $data.$item.Intensity.label}} intensity</div>\n  <div class=\"node\">{{ $data.$item.misperweek}} minutes</div>\n</div>","expressions":{},"classes":"flex_row"}],"dataSource":"dynamic","expressions":{},"actions":[],"classes":"repeater","listItemClasses":"$store.pages.LifestyleFormThree.regularexcercise.value == \"01\""},{"name":"exintoffer","type":"choice","item-type":"select","_auto_id_":"fff87eac-b61b-4864-ba76-56f401b0803c","label":"Intervention offered","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.exintoffer && $store.variables.lastLifestyleForm.exintoffer.result"},"message":"This is a required field"},{"name":"intdetails","type":"user-input","item-type":"text","_auto_id_":"b2456d88-d494-49aa-ba13-4aeb069e880c","label":"Details of interventions offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.LifestyleFormThree.exintoffer.value == \"03\" || $store.pages.LifestyleFormThree.exintoffer.value == \"04\"","default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.intdetails && $store.variables.lastLifestyleForm.intdetails.result"},"validators":[],"actions":[]}],"repeat":false,"expressions":{},"classes":"question_group"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"afb407ce-5cda-4b74-aff3-dac18f0ab940","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormTwo\" });"},"_auto_id_":"1f32eaf7-6b4e-42d7-9518-23bd72255203","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"dcf09897-b7ab-4c7e-8df3-7c51092d4a02","content":"NEXT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormFour\" })"},"_auto_id_":"b2915b6b-4085-4321-9b62-059fb3e8c2a4","actions":[]}],"classes":"default"}],"_auto_id_":"3e236227-24c1-4ab2-91ce-c8fc32c7f0dc","expressions":{}}],"_auto_id_":"9288bb5a-faec-4435-a678-68a3764585bf"},{"start":false,"name":"LifestyleFormFour","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"63f3c3f7-1459-4e73-8425-e1885ada9235","actions":[{"event":"onloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"a394d36c-6c0f-4942-84e2-74cdb0576b32"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"66ea7c51-20cd-4c95-873c-addc0c868bb3","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"79b4d1b0-dd35-4ca5-9357-0481d78b0955","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"9a53b65e-2a9d-445b-a47d-706cd9da7127"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"7607979b-33d4-416a-8fa5-59216a1fff02"}],"_auto_id_":"b5d661f8-f0e0-4114-bdae-d1bf4175d410","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"7fa71a7d-1f29-491f-9512-62929a063e85","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"ca4e19c5-c708-4870-abc4-dc2147d2dee4","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"a3894e6f-a7b9-4d7d-ba0d-f653d39ee7c8","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"d7bd868e-101a-479f-a401-adbb39b93b30","content":[{"name":"html_alcohol","type":"content","item-type":"html","_auto_id_":"4035558d-2d52-49c7-887f-4e169e4226bd","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Alcohol</h4>\n  <i id=\"alcohol\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Alcohol","type":"area","item-type":"group","_auto_id_":"9e97c7a4-0909-4a80-8798-7f4e21f458e4","content":[{"name":"alcCurrentUser","type":"choice","item-type":"radio","_auto_id_":"6e9f26fe-edc3-4ec9-9996-fa8025e6a9d0","label":"Are you a current alcohol user? ","required":true,"options":[{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.alcCurrentUser && $store.variables.lastLifestyleForm.alcCurrentUser.result"},"validators":[],"actions":[],"classes":"question_primary","message":"This is a required field"},{"name":"Drinks","type":"area","item-type":"group","_auto_id_":"c1d60752-d45f-452a-b568-d982e0b6f0d5","content":[{"name":"withdrawal","type":"choice","item-type":"radio","_auto_id_":"a387cf79-b492-4abc-9f8d-f229ed851b06","label":"Is there evidence of alcohol withdrawal?","required":false,"options":[{"label":"Yes","value":"1"},{"label":"No","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.withdrawal && $store.variables.lastLifestyleForm.withdrawal.result && $store.variables.lastLifestyleForm.withdrawal.result.toString()"},"validators":[]},{"name":"alcHowOften","type":"choice","item-type":"select","_auto_id_":"316ea324-5627-4561-9891-373954a53b1f","label":"How often do you have an alcoholic drink?","required":false,"options":[{"label":"Never","value":"0"},{"label":"Monthly or less","value":"1"},{"label":"2-4 times per month","value":"2"},{"label":"2-3 times per week","value":"3"},{"label":"4+ per week","value":"4"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.alcHowOften && $store.variables.lastLifestyleForm.alcHowOften.result"},"validators":[],"actions":[]},{"name":"alcHowManyUnits","type":"choice","item-type":"select","_auto_id_":"59f0ff93-9768-48ff-b2f6-9610634253d2","label":"How many units of alcohol do you consume on a typical day when drinking?","required":false,"options":[{"label":"1-2","value":"0"},{"label":"3-4","value":"1"},{"label":"5-6","value":"2"},{"label":"7-9","value":"3"},{"label":"10+","value":"4"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.alcHowManyUnits && $store.variables.lastLifestyleForm.alcHowManyUnits.result"}},{"name":"alcExceedUnits","type":"choice","item-type":"select","_auto_id_":"2f43de42-23bf-42b1-bcee-539b41cfcfff","label":"How often do you exceed 6 or more units on a single occasion?","required":false,"options":[{"label":"Never","value":"0"},{"label":"Less than monthly","value":"1"},{"label":"Monthly","value":"2"},{"label":"Weekly","value":"3"},{"label":"Daily or almost daily","value":"4"}],"validators":[],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.alcExceedUnits && $store.variables.lastLifestyleForm.alcExceedUnits.result"}}],"repeat":false,"expressions":{"show":"$store.pages.LifestyleFormFour.alcCurrentUser == \"01\""}},{"name":"alcIntervention","type":"choice","item-type":"select","_auto_id_":"2b741bb4-9ee0-4758-9aff-c53a4fd8dda5","label":"Intervention","required":true,"options":[{"label":"None required","value":"01az"},{"label":"Brief advice given","value":"02az"},{"label":"Self-referred to alcohol services","value":"03az"},{"label":"Referral to alcohol services made","value":"04az"},{"label":"Referral offered but declined","value":"05az"}],"validators":[],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.alcIntervention && $store.variables.lastLifestyleForm.alcIntervention.result"},"actions":[],"message":"This is a required field"},{"name":"alcintdetail","type":"user-input","item-type":"text","_auto_id_":"73548c1b-1d57-4c6b-a356-3e95cad644fb","label":"Details of interventions offered","required":true,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.alcintdetail && $store.variables.lastLifestyleForm.alcintdetail.result"},"validators":[],"actions":[],"message":"This is a required field","default":""}],"repeat":false,"expressions":{},"classes":"question_group"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"91f7a828-16fb-47ed-b0d1-b9c6a7cfa779","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormThree\" });"},"_auto_id_":"01e315be-3d2a-4e84-b29f-edadb5694d15","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"9749f641-766c-4199-9d03-8ceecc6a0a47","content":"NEXT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormFive\" })"},"_auto_id_":"de2a5b43-fbc8-46f0-967a-97c64194e061","actions":[]}],"classes":"default"}],"_auto_id_":"3626a4e5-be01-41e9-83f0-17c89d96d72f","expressions":{}}],"_auto_id_":"26b484c4-d908-4d17-8fae-4a8a93c2b857"},{"start":false,"name":"LifestyleFormFive","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"683bf410-327c-44ee-b2e6-8eed5ac4ce38","actions":[{"event":"onloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"fcf7ae4e-f5c2-40d7-9b9a-3cbd21fa1478"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"eccf7f0b-96d6-4e96-8418-0cc0a74c03b7","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"238c4cf4-f125-4bdd-a090-2a81efb9ed11","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"7be4585f-13c9-43f6-a399-bae03491f97a"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"66c19f29-2235-4ea0-9726-b835ead5032e"}],"_auto_id_":"86c5b390-1cbe-476d-85ca-70f503c65184","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"0ce4ea9d-5709-45a8-aa3a-48b4b512ab1b","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"50f2f038-298d-4bba-944f-0052fc0acf7a","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"2efed447-436b-4792-9777-7d14b13e080a","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"a6fe1940-a980-4762-8803-629707d97a46","content":[{"name":"html_drugs","type":"content","item-type":"html","_auto_id_":"570a6509-6c98-49db-8eaa-5d8df1f436dc","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Drugs</h4>\n  <i id=\"drugs\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Drugs","type":"area","item-type":"group","_auto_id_":"65b7c650-d454-4aa8-a836-d05aae4e8ca4","content":[{"name":"recdruguse","type":"choice","item-type":"select","_auto_id_":"a7118fc8-6190-43f9-bd26-b6f379dfce67","label":"Have you ever used recreational drugs?","required":true,"options":[{"label":"Not assessed","value":"1na"},{"label":"No","value":"2no"},{"label":"In the past","value":"3tp"},{"label":"Current user","value":"4cu"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.recdruguse && $store.variables.lastLifestyleForm.recdruguse.result"},"classes":"question_primary","message":"This is a required field"},{"name":"drugs_group","type":"area","item-type":"group","_auto_id_":"cf452b4c-85fa-4b79-9bef-c1155712b6d5","content":[{"name":"drugname","type":"choice","item-type":"select","_auto_id_":"49583483-b3d2-499c-9369-41cc2f75093c","label":"Drug name:","required":true,"options":[{"label":"Amphetamines","value":"01"},{"label":"Cannabis","value":"02"},{"label":"Powder cocaine","value":"03"},{"label":"Crack cocaine","value":"04"},{"label":"Heroin","value":"05"},{"label":"Ketamine","value":"08"},{"label":"Legal highs","value":"10"},{"label":"Ecstasy","value":"06"},{"label":"Khat","value":"07"},{"label":"Crystal meth","value":"09"},{"label":"Other","value":"99"}],"expressions":{},"validators":[],"message":"This is a required field"},{"name":"otherdrug","type":"user-input","item-type":"text","_auto_id_":"8681e574-5a3b-489d-9634-5a989959e46c","label":"If 'Other' enter name","required":false,"multiline":false,"debounce":250,"expressions":{"show":"$store.pages.LifestyleFormFive.drugname.value == \"99\""},"validators":[],"actions":[]},{"name":"currentuse","type":"choice","item-type":"radio","_auto_id_":"55732b31-f98e-4418-a732-c38e5f1f9ca5","label":"Currently using?","required":false,"options":[{"label":"Yes","value":"1"},{"label":"No","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"useperweek","type":"user-input","item-type":"text","_auto_id_":"79076abb-93f9-4209-b76e-e3de62c4a883","label":"Quantity used in average week","required":false,"multiline":false,"debounce":250,"expressions":{}},{"name":"modeofuse","type":"user-input","item-type":"text","_auto_id_":"1879a225-7d0f-47a3-86b6-ef3342eee4fd","label":"Mode of user (e.g. smoked, injected)","required":false,"multiline":false,"debounce":1000,"expressions":{},"validators":[]}],"repeat":true,"expressions":{"show":"$store.pages.LifestyleFormFive.recdruguse.value == \"4cu\""}},{"name":"drugs_repeat_displayer","type":"content","item-type":"list","_auto_id_":"506f71d3-207a-46e1-a5f6-89c917da32b0","static":false,"model":"$store.repeater.LifestyleFormFive.drugs_group","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"drug_displayer","type":"content","item-type":"html","_auto_id_":"a3031374-293b-4841-b987-e663d626a5ed","content":"<div id=\"{{ $data.$index }}\" class=\"repeater_item\" onclick=\"cti.store.repeater.LifestyleFormFive.drugs_group.splice(this.id,1);cti.utils.updatePage()\">\n  <div class=\"node\">{{ $data.$item.otherdrug || $data.$item.drugname.label}}</div>\n  <div class=\"node\">{{ $data.$item.useperweek }}</div>\n  <div class=\"node\">{{ $data.$item.modeofuse }}</div>\n</div>","expressions":{}}],"dataSource":"dynamic","expressions":{},"actions":[],"classes":"repeater","listItemClasses":"$store.pages.LifestyleFormFive.recdruguse == \"4cu\""},{"name":"drugintoffer","type":"choice","item-type":"select","_auto_id_":"702db19e-b6fc-4be9-8276-c6bd533d6e17","label":"Intervention offered?","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.drugintoffer && $store.variables.lastLifestyleForm.drugintoffer.result"},"message":"This is a required field"},{"name":"drugintdetails","type":"user-input","item-type":"text","_auto_id_":"470a3392-3b41-4667-abb8-2851d043bbd4","label":"Details of interventions offered","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"$store.pages.LifestyleFormFive.drugintoffer.value == \"03\" || $store.pages.LifestyleFormFive.drugintoffer.value == \"04\"","default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.drugintdetails && $store.variables.lastLifestyleForm.drugintdetails.result"}}],"repeat":false,"expressions":{},"classes":"question_group"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"bb6b3f02-38bb-4610-98b5-533b336bf234","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormFour\" });"},"_auto_id_":"1963d6c2-b2b5-481e-9100-73709b2a14b3","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"7e7db352-6302-4f42-9352-84b8d66da515","content":"NEXT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormSix\" });"},"_auto_id_":"9f10924e-9e7d-4835-b268-8df654e47ad3","actions":[]}],"classes":"default"}],"_auto_id_":"208080b7-0793-4b55-914b-6b78189e16d0","expressions":{}}],"_auto_id_":"061fb17e-8d72-4f96-91b1-9c9ed85257db"},{"start":false,"name":"LifestyleFormSix","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"0302aaad-aaa6-42b3-a5c7-dee0626e6caa","actions":[{"event":"onloaded","type":"inline-function","data":{"sync":true,"code":"var page = cti.store.pages.LifestyleForm\n$success()"},"_auto_id_":"cfe7a3c9-7993-487b-8c55-3e8372ce969c"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"477c928b-a963-4217-9f70-7d97be9780ec","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"f0f98007-76b5-4951-8762-996f6701e879","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"9c170e90-a951-49e9-a25b-732e58330709"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"13395677-efad-40ca-b358-5eb8fcdf6c5b"}],"_auto_id_":"7d8725c0-3c43-4cbb-ad27-df0bc37dea50","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"9159fddd-b315-4bc3-9c6f-08b7824f9d7a","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"94bc068a-dacc-4307-aab0-8bfefcc193d9","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"f56d5ca2-284a-48f0-bc4e-2896eea091b3","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"127d9832-8993-41ac-9e93-e68b50793583","content":[{"name":"html_other","type":"content","item-type":"html","_auto_id_":"abd014c3-f38a-4042-87f1-d5a3bb35f0ef","content":"<div style=\"display:inline-block;width:100%;color:green;\">\n  <h4 style=\"display:inline-block\">Other</h4>\n  <i id=\"other\" class=\"arrow fa fa-chevron-down\" style=\"float:right;line-height:40px\"></i>\n</div>","expressions":{}},{"name":"Other","type":"area","item-type":"group","_auto_id_":"59085ee3-62b7-45dc-a6e8-9fe079dcf681","content":[{"name":"menwellbeing","type":"choice","item-type":"select","_auto_id_":"59fa82ff-cb37-449e-aeb2-949e6dc1ce0c","label":"5 Ways to Mental Wellbeing","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Offered and accepted","value":"02"},{"label":"Offered but declined","value":"03"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.menwellbeing && $store.variables.lastLifestyleForm.menwellbeing.result"},"message":"This is a required field"},{"name":"signpost","type":"choice","item-type":"select","_auto_id_":"fade3a47-5d43-4fe5-a105-3b52ad54a646","label":"Signposting for support with debt or housing","required":true,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.signpost && $store.variables.lastLifestyleForm.signpost.result"},"message":"This is a required field"},{"name":"signdetail","type":"user-input","item-type":"text","_auto_id_":"966483be-373f-46e4-b659-f56af54406a2","label":"Details of interventions offered","required":true,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.signdetail && $store.variables.lastLifestyleForm.signdetail.result"},"message":"This is a required field"},{"name":"addcomm","type":"user-input","item-type":"text","_auto_id_":"08b32d97-308b-4e3f-8f3c-ca3f716759ad","label":"Comments:","required":false,"multiline":true,"debounce":1000,"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.addcomm && $store.variables.lastLifestyleForm.addcomm.result"}},{"name":"admissionassess","type":"choice","item-type":"radio","_auto_id_":"f9e31916-b40c-4ff3-8d20-bd942387fc72","label":"Admission assesment: ","required":true,"options":[{"label":"Yes","value":1},{"label":"No","value":2}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.admissionassess && $store.variables.lastLifestyleForm.admissionassess.result"},"message":"This is a required field"},{"name":"assessmentstatus","type":"choice","item-type":"select","_auto_id_":"35e70883-af63-43dc-884c-6328f9440f0a","label":"Status of assessment","required":true,"options":[{"label":"Assessment complete","value":"01"},{"label":"Patient declined entire assessment","value":"02"},{"label":"Patient declined part of assessment","value":"03"},{"label":"Unsafe to conduct assessment","value":"04"},{"label":"Assessment incomplete","value":"01a"},{"label":"Form Entered in Error","value":"99"}],"expressions":{"default":"$store.variables.lastLifestyleForm && $store.variables.lastLifestyleForm.assessmentstatus && $store.variables.lastLifestyleForm.assessmentstatus.result"},"message":"This is a required field"}],"repeat":false,"expressions":{}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"73acf969-eaf9-4ed1-bbbc-3bd27f92f81b","content":"PREVIOUS","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", { name: \"LifestyleFormFive\" });"},"_auto_id_":"45f1174e-906d-40fc-bfd1-2ee346c44427","actions":[]}],"classes":"default"},{"name":"button_save","type":"button","item-type":"button","_auto_id_":"2f20d454-5755-43ae-a8f5-e50bdadde01d","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"//cti.store.variables.selected_visit.lifestyle_form_status = true;\n//cti.store.variables.selected_visit.lifestyle_form_object.status = \"complete\";\n//cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"});\ncti.utils.callAction(\"call-actionflow\", { name: \"SubmitLifestyleForm\" });"},"_auto_id_":"63cdf0d0-0971-49e5-a955-f8c7b68e2f10","actions":[]}],"classes":""}],"_auto_id_":"5b19b572-3884-41fc-8049-c4b49cfc2579","expressions":{}}],"_auto_id_":"3c71a601-1c67-42bd-9185-0d870e56caf3"},{"start":false,"name":"DialogFormPre","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"f72e0b0e-654b-40af-b107-86eaab7831bc","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"const patientData = cti.store.variables.selected_visit.patientData || null;\n\n//If the page object doesn't already exist make sure we create an empty object so we can set the properties on it and load the previous results.\nif(!cti.store.pages.DialogFormPre){\n  cti.store.pages.DialogFormPre = {};\n}\n\nif (patientData && patientData.dialogPlusForms && patientData.dialogPlusForms.length > 0) {\n  \n    if(cti.store.pages.DialogFormPre.MHMatters === undefined ){\n      cti.store.pages.DialogFormPre.MHMatters =  patientData.dialogPlusForms[0].mhMatters.result;  \n    }\n    if(cti.store.pages.DialogFormPre.MHSkills === undefined ){\n        cti.store.pages.DialogFormPre.MHSkills =  patientData.dialogPlusForms[0].mhSkills.result; \n    }\n    if(cti.store.pages.DialogFormPre.MHRecovery === undefined ){\n        cti.store.pages.DialogFormPre.MHRecovery =  patientData.dialogPlusForms[0].mhRecovery.result; \n    }\n\n}\n\n$success();"},"_auto_id_":"9337ceba-f761-4340-81b8-dfddbb0114e2","actions":[]},{"event":"onload","type":"call-function","data":{"name":"fn_hideFreeSpinner"},"_auto_id_":"66b5186b-ca8b-4b45-91af-cbbd2f0565b7"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"1ba15e65-a4c6-45c3-b4dc-14b02cf1bab0","attributes":{},"expressions":{},"actions":[]},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"62332c4d-b25a-4b1a-a300-d226ceb31e2f","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"d0b7c7a4-8da3-42a4-8226-7e5f473f3e54"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Assessment</h4>","_auto_id_":"007bf84f-f8d8-4c19-b08b-141078139d89"}],"_auto_id_":"b49b7f08-8928-4c46-8085-f14fcc3a7505","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"a3f5e80a-dbf3-4b3c-b88a-227d4cef476c","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"22f02dfc-c40a-4c5a-a08e-1287cfb3d85b","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"gettingStartedBanner","type":"content","item-type":"html","_auto_id_":"1f1f6e4e-a3da-4b84-9444-8889a5877efc","content":"<p>Getting Started</p>","expressions":{},"classes":"banner-dark"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"4594d27f-f0b3-49c4-a855-42017736ed94","content":[{"name":"preDialogText","type":"content","item-type":"html","_auto_id_":"b4a6762f-814b-4285-ba2f-7726d4ed8f71","content":"<div class=\"PreDialogText\"><p>This form must be completed at point of entry into the service, at regular intervals throughout clinical contact and at discharge.</p>\n<p>In all scenarios the answer to the question 'Does the service user want help?' should be completed by the service user.</p>\n<p>Occasionally the clinician's view may be different to that of the service user or the service user may lack the capacity to decide.<br />\nIn both cases the box most likely to represent the service user's views should be ticked.</p>\n<p>The free text box should then be used to provide reasons for the service user's view followed by the views of the professional or family if different.</p>\n<p>When discussing and creating an action plan please follow steps 1-3 for each area you agree to discuss today:</p>\n<p><strong>Step 1: Understanding</strong> - why this rating and not a lower one? - what is working?</p>\n<p><strong>Step 2: Looking forward</strong> - best case scenario? - smallest improvement?</p>\n<p><strong>Step 3: Considering options</strong> - what can the patient do? - what can the clinician do? - what can others do?</p></div>\n<h4>Pre Assessment Questions</h4>","expressions":{}},{"name":"PreDialogQs","type":"area","item-type":"group","_auto_id_":"7cbe17e6-2400-450d-b251-1358da6781a4","content":[{"name":"StageTreat","type":"choice","item-type":"radio","_auto_id_":"276a040f-9553-4943-9597-bb3899047740","label":"Is this a CPA review?","required":true,"options":[{"label":"Yes","value":"03CRP"},{"label":"No","value":"05"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"message":"This is a required field","validators":[],"actions":[]},{"name":"StageTreat1","type":"choice","item-type":"select","_auto_id_":"1d824ef0-7200-4b48-8a5a-7eb5329708c5","label":"Stage of Treatment:","required":true,"options":[{"label":"Assessment","value":"01ASS"},{"label":"Review","value":"02Rev"},{"label":"Discharge (From CPA or Trust)","value":"03Dis"}],"expressions":{},"message":"This is a required field","actions":[]},{"name":"InCareDec","type":"choice","item-type":"select","_auto_id_":"7fa29487-38f7-45a6-974e-9d2fcc9ec002","label":"Initial Care Decision","required":false,"options":[{"label":"Short term support to max independence","value":"01az"},{"label":"Long term support -  nursing care","value":"02az"},{"label":"Long term support - residential care","value":"03az"},{"label":"Long term support - community / prison","value":"04az"},{"label":"Ongoing low level support","value":"07az"},{"label":"No services provided - deceased","value":"10az"},{"label":"100% NHS funded care","value":"05az"},{"label":"No services provided","value":"11az"},{"label":"End of life","value":"06az"},{"label":"Signposted to other services","value":"09az"},{"label":"Short term support (other)","value":"08az"}],"expressions":{"show":"$store.pages.DialogFormPre.StageTreat1.value == \"01ASS\""},"actions":[]},{"name":"SUCap","type":"choice","item-type":"select","_auto_id_":"eb4418a3-6873-48ec-bdf3-fd37255d6f5e","label":"Service user response","required":true,"options":[{"label":"Service user agreed assessment","value":"01SUA"},{"label":"Service user declined assessment","value":"02SUDA"},{"label":"SU lacks capacity - carer completed","value":"03SULCCARE"},{"label":"SU lacks capacity - clinician completed","value":"04SULCCLIN"},{"label":"SU declined-carer completed(CAMHS only)","value":"05SUDCAMHS"}],"expressions":{},"message":"This is a required field","actions":[]},{"name":"MHRecovery","type":"user-input","item-type":"text","_auto_id_":"9fc5834f-65cf-4d2b-89d2-076d58bfe494","label":"What recovery means to me? My long term goals.  What I would like to achieve in 12 months time.","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"MHMatters","type":"user-input","item-type":"text","_auto_id_":"2851eda2-4c1f-4c5a-b188-8fefcf43a964","label":"What matters to me?","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"MHSkills","type":"user-input","item-type":"text","_auto_id_":"ee2f494a-7406-4d4d-b735-cac5ba9eafe7","label":"My skills, strengths and experiences that will help me achieve my goals","required":false,"multiline":true,"debounce":1000,"expressions":{}}],"repeat":false,"expressions":{}},{"name":"isCPA","type":"area","item-type":"group","_auto_id_":"276510f2-99ed-42dd-8790-40fd6eb9f7e1","content":[{"name":"divider","type":"content","item-type":"html","_auto_id_":"cd0e0008-ffdf-4feb-89fd-845eae5eb0a8","content":"<hr/>","expressions":{}},{"name":"attendeesHeader","type":"content","item-type":"html","_auto_id_":"31f3f692-2010-44e7-9b7c-83b18cf9d102","content":"<h4>CPA Meeting Attendees</h4>","expressions":{}},{"name":"grpCPAMeetingAttendees","type":"area","item-type":"group","_auto_id_":"c1b1efcd-eeda-4192-a7d8-03dc434c55d0","content":[{"name":"CPAMeetingAttendeeName","type":"user-input","item-type":"text","_auto_id_":"c9ae7f32-1da1-4c03-ad28-537bc0764ce0","label":"Name: ","required":true,"multiline":false,"debounce":1000,"expressions":{},"message":"This is a required field"},{"name":"CPAMeetingAttendeeDesRel","type":"user-input","item-type":"text","_auto_id_":"2b6771dd-e24b-4aec-ad17-ecdd756074be","label":"Designation/Relationship: ","required":false,"multiline":false,"debounce":1000,"expressions":{}},{"name":"CPAMeetingAttendeePresent","type":"choice","item-type":"radio","_auto_id_":"5d4ddc00-58ad-4537-a579-f083045e1ef1","label":"Present: ","required":false,"options":[{"label":"Yes","value":"yes"},{"label":"No","value":"no"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"CPAMeetingAttendeeCopy","type":"choice","item-type":"radio","_auto_id_":"4e3a8ae7-2b1c-4b48-ac15-c06b3ee58cf0","label":"Copy of CPA Sent: ","required":false,"options":[{"label":"Yes","value":"yes"},{"label":"No","value":"no"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}}],"repeat":true,"expressions":{}},{"name":"CPAAttendeesList","type":"content","item-type":"list","_auto_id_":"91535684-bcea-4d5f-a3f8-cbb5a733f0ea","static":false,"model":"$store.repeater.DialogFormPre.grpCPAMeetingAttendees","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"CPAAttendeesList_html","type":"content","item-type":"html","_auto_id_":"85688d78-094e-4c90-b872-a65b94abc885","content":"<div id=\"{{ $data.$index }}\" class=\"excercise_item\" onclick=\"cti.store.repeater.DialogFormPre.grpCPAMeetingAttendees.splice(this.id,1);cti.utils.updatePage()\">\n  <div class=\"node\">{{$data.$item.CPAMeetingAttendeeName}}\n{{!!$data.$item.CPAMeetingAttendeeDesRel ? \" (\" + $data.$item.CPAMeetingAttendeeDesRel + \")\" : \"\"}}</div>\n  <div class=\"node\">{{$data.$item.CPAMeetingAttendeePresent === \"yes\" ? \" [Present]\" : \"\"}}</div>\n    <div class=\"node\">{{$data.$item.CPAMeetingAttendeeCopy === \"yes\" ? \" [Copy Sent]\" : \"\"}}</div>\n</div>","expressions":{}}],"dataSource":"dynamic","expressions":{},"classes":"repeater"},{"name":"divider_1","type":"content","item-type":"html","_auto_id_":"d74ad114-f869-4021-9787-efe85a1b4763","content":"<hr/>","expressions":{}},{"name":"RCYN","type":"choice","item-type":"radio","_auto_id_":"8a3a3dc9-0cbf-4238-aed1-f007ebacef95","label":"Does the Lead Clinician agree to this care plan? ","required":false,"options":[{"label":"Yes","value":"yes"},{"label":"No","value":"no"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"SUYN","type":"choice","item-type":"radio","_auto_id_":"9b56c37d-c179-4258-9f1c-f4267a084063","label":"Does the service user agree with this care plan?","required":false,"options":[{"label":"Yes","value":"yes"},{"label":"No","value":"no"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"SUDisagree","type":"user-input","item-type":"text","_auto_id_":"6d43e85e-0975-4532-b006-4dd1510f3887","label":"Please state who has agreed to this plan:  ","required":false,"multiline":true,"debounce":1000,"expressions":{}},{"name":"RevUnplan","type":"choice","item-type":"checkbox","_auto_id_":"eb957bdf-b9dd-4c10-94e6-966244fcbb35","label":"Is this review unplanned? ","required":false,"options":[{"id":"yes"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{}},{"name":"CareDec","type":"choice","item-type":"select","_auto_id_":"992795c7-7237-42e1-9583-a349ce0aab3c","label":"Care decision following review: ","required":false,"options":[{"label":"Setting change- move to residential care","value":"01az"},{"label":"Setting change- move to nursing care","value":"01bz"},{"label":"Setting change- move to community","value":"01cz"},{"label":"Short term support to max independence","value":"01dz"},{"label":"Same location long term support increase","value":"01ez"},{"label":"Same location and same long term support","value":"01fz"},{"label":"Same location long term support decrease","value":"01gz"},{"label":"Same location suspend long term support","value":"01hz"},{"label":"Same location long term support ended","value":"01iz"}],"expressions":{"show":"!$store.pages.DialogFormPre.RevUnplan.yes"}},{"name":"CareDecUnplan","type":"choice","item-type":"select","_auto_id_":"f9b7153c-792a-4e4b-b00b-53af0fea1f49","label":"Care decision following unplanned review: ","required":false,"options":[{"label":"Hospital episode (planned)","value":"01az"},{"label":"Hospital episode (unplanned)","value":"01bz"},{"label":"Issues related to carer","value":"01cz"},{"label":"Change of residence","value":"01dz"},{"label":"Fall","value":"01fz"},{"label":"Bereavement","value":"01gz"},{"label":"Other accident / incident","value":"01jz"},{"label":"Any significant event in prison","value":"01kz"},{"label":"Safeguarding concern","value":"01ez"},{"label":"Change in client condition","value":"01hz"},{"label":"Other significant event","value":"01iz"}],"expressions":{"show":"$store.pages.DialogFormPre.RevUnplan.yes"}},{"name":"Funded","type":"choice","item-type":"select","_auto_id_":"96a91872-dfec-41bd-9d0a-62e405fa7453","label":"If this client is receiving a package of care, who is responsible for funding?","required":false,"options":[{"label":"Local Authority funded","value":"01az"},{"label":"NHS funded","value":"01bz"},{"label":"Jointly funded - LA & NHS","value":"01cz"}],"expressions":{}},{"name":"NxtRev","type":"user-input","item-type":"date","_auto_id_":"9389adec-651b-47f1-919b-09469e252c6a","label":"Next CPA review date: ","required":false,"left-icon":"fa-calendar","expressions":{},"options":{"min":"current"},"validators":[],"actions":[]},{"name":"S117Comm","type":"user-input","item-type":"text","_auto_id_":"d0cf3566-62d7-418b-b108-8f8d51560a55","label":"Details of funded elements of the care plan including S117 aftercare: ","required":false,"multiline":true,"debounce":1000,"expressions":{},"validators":[]},{"name":"CarerView","type":"user-input","item-type":"text","_auto_id_":"8c4e9416-bcd8-4853-893d-a73e4a0b12f9","label":"Carer's views: ","required":false,"multiline":true,"debounce":1000,"expressions":{}}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormPre.StageTreat === \"03CRP\""}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_begin","type":"button","item-type":"button","_auto_id_":"b04263e2-8e52-4a87-9b05-dba0aad1d7eb","content":"BEGIN ASSESSMENT","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_showFreeSpinner('Loading Dialog+ Form...')\n\ncti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormOne\"})"},"_auto_id_":"66b8c99a-0e2c-413f-8582-54f1ef15f40a","actions":[]}],"classes":"default"}],"_auto_id_":"a0ddf4b0-e251-44fc-940c-47668c1e65dc","expressions":{}}],"_auto_id_":"d9f6f61d-f96f-4ef4-a0d5-3e6278737e88"},{"start":false,"name":"DialogFormOne","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"cde1d7aa-c2a4-4a5a-ac04-0098cd19243d","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"const sliders = document.querySelectorAll('cti-slider')\n\n// dialogIsReadOnly = the entire form is readonly because it is a historical view. This will only display the previous bar and *no* draggable slider.\n// The sliders historiconly property decides whether or not to display the draggable slider.\n// The sliders readOnly property is applied when Declined to Answer is ticked and the slider should apply avoid-clicks.\n\nfor (let i = 0; i < sliders.length; i++) {\n  if (cti.store.variables.dialogIsReadOnly) {\n    sliders[i].setAttribute('historiconly', 'true');\n  } else {\n    sliders[i].removeAttribute('historiconly');\n  }\n}\n\nsetTimeout(() => {\n  \n    let index = cti.store.pages.DialogFormOne && cti.store.pages.DialogFormOne.pickReviewCombo && cti.store.pages.DialogFormOne.pickReviewCombo.value !== undefined ? cti.store.pages.DialogFormOne.pickReviewCombo.value : -1;\n  \n     \n    \n\n    if(cti.store.variables.dialogIsReadOnly){\n      index = 0;\n      cti.store.pages.DialogFormOne.pickReviewCombo = {};\n      cti.store.pages.DialogFormOne.pickReviewCombo.value = index;\n    }\n  \n    cti.store.variables.currentDialogComboValue = index;\n  \n    cti.fn_setPreviousDialogVals(index)\n  \n    cti.fn_hideFreeSpinner()\n  }, 250)\n"},"_auto_id_":"2229d19e-1edf-4d81-92b8-c8218e7bd390"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"3524a7c1-4f9b-4ed0-963f-71948f8e0a9a","attributes":{},"expressions":{},"actions":[]},{"name":"dialogInfoPopup","type":"component","item-type":"web-component","content":[{"name":"dialogInfoPopupText","type":"content","item-type":"html","_auto_id_":"d1dfd3cf-3742-455e-a637-6532694d691a","content":"<div class=\"infoRow\">\n  <div class=\"step\">Step 1</div>\n  <div class=\"detail\">\n    <div class=\"header\">Understanding</div>\n    <ul>\n      <li>Why this rating and not a lower one?</li>\n      <li>What is working?</li>\n    </ul>\n  </div>\n</div>\n<div class=\"infoRow\">\n  <div class=\"step\">Step 2</div>\n  <div class=\"detail\">\n    <div class=\"header\">Looking forward</div>\n    <ul>\n      <li>Best case scenario?</li>\n      <li>Smallest improvement?</li>\n    </ul>\n  </div>\n</div>\n<div class=\"infoRow\">\n  <div class=\"step\">Step 3</div>\n  <div class=\"detail\">\n    <div class=\"header\">Considering options</div>\n    <ul>\n      <li>What can the patient do?</li>\n      <li>What can the clinician do?</li>\n      <li>What can others do?</li>\n    </ul>\n  </div>\n</div>\n<div class=\"infoRow\">\n  <div class=\"step\">Step 4</div>\n  <div class=\"detail\">\n    <div class=\"header\">Agreeing on actions</div>\n  </div>\n</div>","expressions":{}},{"name":"btnCloseInfoPopup","type":"button","item-type":"button","_auto_id_":"0ba008f6-b6fb-4b70-b668-faeacbd96097","content":"CLOSE","theme":"default","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"6e011268-4200-44dd-90f8-b0d59f571719"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"48158950-a194-44a2-bddb-dae490234f98","attributes":{"id":"dialogInfoPopup"},"actions":[],"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"f0ffb47a-3958-4b67-b84e-f5881dab8853","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.dialogIsReadOnly) {\n  \n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n  \n} else {\n  \n  cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormPre\"})\n}\n\ncti.store.variables.dialogIsReadOnly = false\n\ncti.store.variables.dialogFormFirstRun = false"},"_auto_id_":"d5d48393-a510-497c-8154-9fd8f957b10c"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"1ed895fc-e6c7-4655-95e7-39e71c947fb6"}],"_auto_id_":"a65d3cfc-88ae-437d-a944-f982ca5dde7e","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"c227e5e5-4573-457e-a5b3-460585ba68fc","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"c308356d-064b-41be-a6fe-e0b4a177a049","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"2bb4015c-ff63-44dd-9032-f4a635d9bb2d","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1","show":"0"},"actions":[],"classes":""}],"expressions":{}},{"name":"static_ReviewBar","type":"area","item-type":"static","_auto_id_":"feb08a65-a080-441e-9700-7d736dbc8c08","content":[{"name":"prevFormBtn","type":"button","item-type":"button","_auto_id_":"4f782446-f7eb-4a5a-8f21-55f80bf192bb","content":"","theme":"minimal","expressions":{"show":"$store.variables.selected_visit.patientData.dialogPlusForms && !!$store.variables.selected_visit.patientData.dialogPlusForms.length","disabled":"!$store.pages.DialogFormOne.pickReviewCombo || ($store.pages.DialogFormOne.pickReviewCombo && $store.pages.DialogFormOne.pickReviewCombo.value < 0)"},"left-icon":"fa-arrow-circle-o-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\nif (!cti.store.pages.DialogFormOne.pickReviewCombo) {\n  cti.store.pages.DialogFormOne.pickReviewCombo = {}\n}\n\nlet index = cti.store.variables.currentPreviousDialogIndex !== undefined ? cti.store.variables.currentPreviousDialogIndex : -1\n\nif (index > -1) {\n  index--\n}\n\ncti.store.variables.currentPreviousDialogIndex = index\ncti.store.pages.DialogFormOne.pickReviewCombo.value = index\n\ncti.fn_setPreviousDialogVals(index)"},"_auto_id_":"6dc98983-9363-4c3b-b37f-09143f5d5a0d"}]},{"name":"grpDatePicker","type":"area","item-type":"group","_auto_id_":"c4cca8b7-0f0c-439d-ba79-29d6f1d8e6a5","content":[{"name":"reviewPill","type":"content","item-type":"html","_auto_id_":"2f6b6612-445c-4d94-a34a-caacb2d4876e","content":"<span class='dot previous-dot'></span>","expressions":{},"classes":""},{"name":"pickReviewCombo","type":"choice","item-type":"select","_auto_id_":"4831bb61-faba-4610-826f-3ba636c82326","label":"","required":false,"options":[{"label":"Mock Data","value":1},{"label":"Option 2","value":2},{"label":"Option 3","value":3},{"label":"option 4","value":"4"},{"label":"option 5","value":"5"}],"validators":[],"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"if (window.debug) {\n  debugger\n}\n\nconsole.log('PICK VALUE: ' + JSON.stringify(cti.store.pages.DialogFormOne.pickReviewCombo));\n\nconst index = cti.store.pages.DialogFormOne.pickReviewCombo && cti.store.pages.DialogFormOne.pickReviewCombo.value !== undefined ? cti.store.pages.DialogFormOne.pickReviewCombo.value : -1\n\ncti.store.variables.currentPreviousDialogIndex = index\n\n// combo value gets updated here\ncti.store.variables.currentDialogComboValue = index;\n\ncti.fn_setPreviousDialogVals(index)"},"_auto_id_":"12ff9b50-b974-414a-9962-e21d7907ff14","actions":[]}],"expressions":{},"classes":"reviewSelect","description":"","option-source":"$store.variables.selected_visit.patientData.dialogPlusForms","label-property":"displayDate","value-property":"index"}],"repeat":false,"expressions":{"show":"$store.variables.selected_visit.patientData.dialogPlusForms && !!$store.variables.selected_visit.patientData.dialogPlusForms.length"}},{"name":"nextFormBtn","type":"button","item-type":"button","_auto_id_":"79530047-3a6b-45ab-9920-9e86fde0e3b6","content":"","theme":"minimal","expressions":{"show":"$store.variables.selected_visit.patientData.dialogPlusForms && !!$store.variables.selected_visit.patientData.dialogPlusForms.length","disabled":"$store.pages.DialogFormOne.pickReviewCombo && $store.pages.DialogFormOne.pickReviewCombo.value === 4"},"left-icon":"fa-arrow-circle-o-right","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\nif (!cti.store.pages.DialogFormOne.pickReviewCombo) {\n  cti.store.pages.DialogFormOne.pickReviewCombo = {}\n}\n\nconst MAX_PREVIOUS_FORMS = 5\n\nlet index = cti.store.variables.currentPreviousDialogIndex !== undefined ? cti.store.variables.currentPreviousDialogIndex : -1   // Start at -1 so we can go to 0 if this is first click.\n\nlet originalIndex = index;\n\nif (index < MAX_PREVIOUS_FORMS - 1) {\n  index++\n}\n\ncti.store.variables.currentPreviousDialogIndex = index\n\ncti.store.pages.DialogFormOne.pickReviewCombo.value = index\n\ncti.fn_setPreviousDialogVals(index)\n"},"_auto_id_":"7f9698b8-07bf-44f0-b368-9f7ae28aab18"}]}],"expressions":{},"classes":"reviewSelectorBar"},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"29385772-7237-45d0-bf1f-60f0f6ed12ec","content":[{"name":"group_PreQuestions","type":"area","item-type":"group","_auto_id_":"f1efa3cc-aeb7-4f19-acea-9dfa8a0cb516","content":[{"name":"PreDialogQs","type":"area","item-type":"group","_auto_id_":"7cbe17e6-2400-450d-b251-1358da6781a4","content":[{"name":"StageTreat_prev","type":"choice","item-type":"radio","_auto_id_":"276a040f-9553-4943-9597-bb3899047740","label":"Is this a CPA review?","required":false,"options":[{"label":"Yes","value":"03CRP"},{"label":"No","value":"05"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"true"},"message":"This is a required field","validators":[],"actions":[]},{"name":"StageTreat1_prev","type":"choice","item-type":"select","_auto_id_":"1d824ef0-7200-4b48-8a5a-7eb5329708c5","label":"Stage of Treatment:","required":false,"options":[{"label":"Assessment","value":"01ASS"},{"label":"Review","value":"02Rev"},{"label":"Discharge (From CPA or Trust)","value":"03Dis"}],"expressions":{"disabled":"true"},"message":"This is a required field","actions":[]},{"name":"InCareDec_prev","type":"choice","item-type":"select","_auto_id_":"7fa29487-38f7-45a6-974e-9d2fcc9ec002","label":"Initial Care Decision","required":false,"options":[{"label":"Short term support to max independence","value":"01az"},{"label":"Long term support -  nursing care","value":"02az"},{"label":"Long term support - residential care","value":"03az"},{"label":"Long term support - community / prison","value":"04az"},{"label":"Ongoing low level support","value":"07az"},{"label":"No services provided - deceased","value":"10az"},{"label":"100% NHS funded care","value":"05az"},{"label":"No services provided","value":"11az"},{"label":"End of life","value":"06az"},{"label":"Signposted to other services","value":"09az"},{"label":"Short term support (other)","value":"08az"}],"expressions":{"show":"$store.pages.DialogFormOne.StageTreat1_prev.value == \"01ASS\"","disabled":"true"},"actions":[]},{"name":"SUCap_prev","type":"choice","item-type":"select","_auto_id_":"eb4418a3-6873-48ec-bdf3-fd37255d6f5e","label":"Service user response","required":false,"options":[{"label":"Service user agreed assessment","value":"01SUA"},{"label":"Service user declined assessment","value":"02SUDA"},{"label":"SU lacks capacity - carer completed","value":"03SULCCARE"},{"label":"SU lacks capacity - clinician completed","value":"04SULCCLIN"},{"label":"SU declined-carer completed(CAMHS only)","value":"05SUDCAMHS"}],"expressions":{"disabled":"true"},"message":"This is a required field","actions":[]},{"name":"MHRecovery_prev","type":"user-input","item-type":"text","_auto_id_":"9fc5834f-65cf-4d2b-89d2-076d58bfe494","label":"What recovery means to me? My long term goals.  What I would like to achieve in 12 months time.","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"true"}},{"name":"MHMatters_prev","type":"user-input","item-type":"text","_auto_id_":"2851eda2-4c1f-4c5a-b188-8fefcf43a964","label":"What matters to me?","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"true"}},{"name":"MHSkills_prev","type":"user-input","item-type":"text","_auto_id_":"ee2f494a-7406-4d4d-b735-cac5ba9eafe7","label":"My skills, strengths and experiences that will help me achieve my goals","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"true"}}],"repeat":false,"expressions":{}},{"name":"isCPA","type":"area","item-type":"group","_auto_id_":"276510f2-99ed-42dd-8790-40fd6eb9f7e1","content":[{"name":"divider","type":"content","item-type":"html","_auto_id_":"cd0e0008-ffdf-4feb-89fd-845eae5eb0a8","content":"<hr/>","expressions":{}},{"name":"cpa_header","type":"content","item-type":"html","_auto_id_":"1e510b84-9034-4c71-9466-0d57f5db2ccb","content":"<h4>CPA Review</h4>","expressions":{}},{"name":"attendeesHeader","type":"content","item-type":"html","_auto_id_":"31f3f692-2010-44e7-9b7c-83b18cf9d102","content":"<p>Meeting Attendees</p>","expressions":{"show":"$store.pages.DialogFormOne.DialogplusCpaAttendRows && $store.pages.DialogFormOne.DialogplusCpaAttendRows.repeater && $store.pages.DialogFormOne.DialogplusCpaAttendRows.repeater.length > 0"}},{"name":"CPAAttendeesList","type":"content","item-type":"list","_auto_id_":"91535684-bcea-4d5f-a3f8-cbb5a733f0ea","static":false,"model":"$store.pages.DialogFormOne.DialogplusCpaAttendRows.repeater","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"CPAAttendeesList_html","type":"content","item-type":"html","_auto_id_":"85688d78-094e-4c90-b872-a65b94abc885","content":"<div class=\"excercise_item\">\n  <div class=\"node\">{{$data.$item.name.result}}\n{{!!$data.$item.design.result ? \" (\" + $data.$item.design.result + \")\" : \"\"}}</div>\n  <div class=\"node\">{{$data.$item.ynPresent.resultString === \"Yes\" ? \" [Present]\" : \"\"}}</div>\n    <div class=\"node\">{{$data.$item.sentCopy.resultString === \"Yes\" ? \" [Copy Sent]\" : \"\"}}</div>\n</div>","expressions":{}}],"dataSource":"dynamic","expressions":{},"classes":"repeater","actions":[]},{"name":"divider_1","type":"content","item-type":"html","_auto_id_":"d74ad114-f869-4021-9787-efe85a1b4763","content":"<hr/>","expressions":{}},{"name":"RCYN_prev","type":"choice","item-type":"radio","_auto_id_":"8a3a3dc9-0cbf-4238-aed1-f007ebacef95","label":"Does the Lead Clinician agree to this care plan? ","required":false,"options":[{"label":"Yes","value":"1"},{"label":"No","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"true"}},{"name":"SUYN_prev","type":"choice","item-type":"radio","_auto_id_":"9b56c37d-c179-4258-9f1c-f4267a084063","label":"Does the service user agree with this care plan?","required":false,"options":[{"label":"Yes","value":"1"},{"label":"No","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"true"}},{"name":"SUDisagree_prev","type":"user-input","item-type":"text","_auto_id_":"6d43e85e-0975-4532-b006-4dd1510f3887","label":"Please state who has agreed to this plan:  ","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"true"}},{"name":"RevUnplan_prev","type":"choice","item-type":"checkbox","_auto_id_":"eb957bdf-b9dd-4c10-94e6-966244fcbb35","label":"Is this review unplanned? ","required":false,"options":[{"id":"yes"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"disabled":"true"}},{"name":"CareDec_prev","type":"choice","item-type":"select","_auto_id_":"992795c7-7237-42e1-9583-a349ce0aab3c","label":"Care decision following review: ","required":false,"options":[{"label":"Setting change- move to residential care","value":"01az"},{"label":"Setting change- move to nursing care","value":"01bz"},{"label":"Setting change- move to community","value":"01cz"},{"label":"Short term support to max independence","value":"01dz"},{"label":"Same location long term support increase","value":"01ez"},{"label":"Same location and same long term support","value":"01fz"},{"label":"Same location long term support decrease","value":"01gz"},{"label":"Same location suspend long term support","value":"01hz"},{"label":"Same location long term support ended","value":"01iz"}],"expressions":{"show":"!$store.pages.DialogFormOne.RevUnplan_prev.yes","disabled":"true"}},{"name":"CareDecUnplan_prev","type":"choice","item-type":"select","_auto_id_":"f9b7153c-792a-4e4b-b00b-53af0fea1f49","label":"Care decision following unplanned review: ","required":false,"options":[{"label":"Hospital episode (planned)","value":"01az"},{"label":"Hospital episode (unplanned)","value":"01bz"},{"label":"Issues related to carer","value":"01cz"},{"label":"Change of residence","value":"01dz"},{"label":"Fall","value":"01fz"},{"label":"Bereavement","value":"01gz"},{"label":"Other accident / incident","value":"01jz"},{"label":"Any significant event in prison","value":"01kz"},{"label":"Safeguarding concern","value":"01ez"},{"label":"Change in client condition","value":"01hz"},{"label":"Other significant event","value":"01iz"}],"expressions":{"show":"$store.pages.DialogFormOne.RevUnplan_prev.yes","disabled":"true"}},{"name":"Funded_prev","type":"choice","item-type":"select","_auto_id_":"96a91872-dfec-41bd-9d0a-62e405fa7453","label":"If this client is receiving a package of care, who is responsible for funding?","required":false,"options":[{"label":"Local Authority funded","value":"01az"},{"label":"NHS funded","value":"01bz"},{"label":"Jointly funded - LA & NHS","value":"01cz"}],"expressions":{"disabled":"true"}},{"name":"NxtRev_prev","type":"user-input","item-type":"date","_auto_id_":"9389adec-651b-47f1-919b-09469e252c6a","label":"Next CPA review date: ","required":false,"left-icon":"fa-calendar","expressions":{"disabled":"true"},"options":{"min":"current"},"validators":[],"actions":[]},{"name":"S117Comm_prev","type":"user-input","item-type":"text","_auto_id_":"d0cf3566-62d7-418b-b108-8f8d51560a55","label":"Details of funded elements of the care plan including S117 aftercare: ","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"true"},"validators":[]},{"name":"CarerView_prev","type":"user-input","item-type":"text","_auto_id_":"8c4e9416-bcd8-4853-893d-a73e4a0b12f9","label":"Carer's views: ","required":false,"multiline":true,"debounce":1000,"expressions":{"disabled":"true"}}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.StageTreat_prev === \"03CRP\""}},{"name":"preQsDivider","type":"content","item-type":"html","_auto_id_":"6e1ead99-95f9-40ca-b756-21e3a42da61e","content":"<hr/>","expressions":{}}],"repeat":false,"expressions":{"show":"$store.variables.dialogIsReadOnly"}},{"name":"mentalHealthTitle","type":"content","item-type":"html","content":"<h4>Mental health</h4>\n<div class=\"rio_slider\" id=\"DialogMentalHealthSummary\"></div>","expressions":{},"classes":"","_auto_id_":"bda65f95-8199-45c9-81f0-13bad431c510"},{"name":"mentalHealthGroup","type":"area","item-type":"group","content":[{"name":"MHSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"if (window.debugDeclined) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#MHSatPl_Slider');\n\nconst declined = cti.store.pages.DialogFormOne.MHSatDeclinedToAnswer && cti.store.pages.DialogFormOne.MHSatDeclinedToAnswer.selected || false;\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}"},"_auto_id_":"a7b0ff66-347d-43d0-b535-2531f1d38bf1","actions":[]}],"classes":"dialogPlusFormElement","_auto_id_":"278d400a-ec0b-417f-b68f-9313f4902885","validators":[]},{"name":"MHSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"MHSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.MHSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your mental health?","previousValue":"{{$store.pages.DialogFormOne.MHSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.MHSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.MHSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"008cb996-03bd-4ced-883f-7f719a17a91b"},{"name":"MHSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"5420bb81-8240-4523-8647-bb447773c213"},{"name":"group_MHSatActions","type":"area","item-type":"group","content":[{"name":"MHSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'MHSatActions_discuss')"},"_auto_id_":"e9a2d3d2-dd81-437d-9899-0fef2bbf97d5"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"34b7f01b-cea6-46a5-8590-8bf5b64e90d8"},{"name":"MHSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.MHSatActions_discuss && !!$store.pages.DialogFormOne.MHSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('MHSatActions')"},"_auto_id_":"8b61e505-6bec-4c53-8a5e-ab5c7e206fad"}],"_auto_id_":"a682f96e-7e97-4237-b2b6-35d87e5773b9"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"68a81df2-4607-45da-bcdc-3f3dbd4b10b7"},{"name":"group_MHSatActions_text","type":"area","item-type":"group","content":[{"name":"group_MHSatActions_header","type":"area","item-type":"group","content":[{"name":"html_MHSatActions","type":"content","item-type":"html","content":"<span>Mental health goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"bf40d338-221a-4746-83f1-d1f59478faba"},{"name":"btn_MHSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"d21a97be-813b-4589-aa30-3164595bedea"}],"expressions":{},"_auto_id_":"44aeba44-39c8-4749-ab50-e785e5c7bf71"}],"repeat":false,"expressions":{},"_auto_id_":"d9c141ac-6db9-4b3f-b834-25b058a5b953"},{"name":"group_MHSATActions_cur","type":"area","item-type":"group","content":[{"name":"MHSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.MHSatActions"},"_auto_id_":"63b1c589-03d5-4224-a2cc-3041e193d524"},{"name":"MHSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"e17734d7-9e44-413c-abfc-c1e9c3827e3c"},{"name":"MHSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"41e7f378-7cff-4dba-a0e4-aa0abb79debe"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"072245d2-3442-4970-9015-a78cd8472bf9"},{"name":"group_MHSATActions_prev","type":"area","item-type":"group","content":[{"name":"MHSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.MHSatActions_prev"},"_auto_id_":"f8ee747b-6f48-498d-a499-514883c13eba"},{"name":"MHSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.MHSatActions_prev"},"_auto_id_":"dd0a1c2d-8f15-4d6c-bd3e-0490dfc9b651"},{"name":"MHSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.MHSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"d2257e5e-a733-448d-a237-966d95fa8e6f"}],"repeat":false,"expressions":{"show":"!!$store.pages.DialogFormOne.MHSatActions_prev"},"classes":"dialogPlusDiscussBox","_auto_id_":"ec1d9150-5984-4717-a391-96662c691595"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.MHSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"23912eca-ed32-4b4f-8b0d-c7549d38daa7"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"a1ec3613-f9cd-4dff-8fd8-de80f5d6c4ab"},{"name":"physicalHealthTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Physical health</h4>\n<div class=\"rio_slider\" id=\"DialogPhysicalHealthSummary\"></div>","expressions":{},"classes":"","_auto_id_":"51b0f06e-3583-4595-87b9-ba100c6971e7"},{"name":"physicalHealthGroup","type":"area","item-type":"group","content":[{"name":"PHSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"if (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#PHSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.PHSatDeclinedToAnswer && cti.store.pages.DialogFormOne.PHSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}"},"_auto_id_":"3e38080d-e7d4-4527-86f5-fdafe7ceeccf"}],"classes":"dialogPlusFormElement","_auto_id_":"c8aab67c-94d0-4251-afaa-d833b97fa3ce"},{"name":"PHSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"PHSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.PHSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your physical health?","previousValue":"{{$store.pages.DialogFormOne.PHSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.PHSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.PHSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"f4eae879-cca4-44d0-811f-7cbbb8357e7d"},{"name":"PHSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"17e04cb9-c91f-41dc-90eb-e37af965abd9"},{"name":"group_PHSatActions","type":"area","item-type":"group","content":[{"name":"PHSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'PHSatActions_discuss')"},"_auto_id_":"18434621-ccd1-4bbb-80f4-f451344797a5"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"fbafeef0-4be1-4b48-a40e-267085a7c93c"},{"name":"PHSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.PHSatActions_discuss && !!$store.pages.DialogFormOne.PHSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('PHSatActions')"},"_auto_id_":"247bbb4b-84d0-4d4f-ac1d-1b440c252659"}],"_auto_id_":"0c0aef84-d673-4f57-b0f3-d5b5396ded47"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"652bbe9c-7e3e-438e-bb76-32344d689bed"},{"name":"group_PHSatActions_text","type":"area","item-type":"group","content":[{"name":"group_PHSatActions_header","type":"area","item-type":"group","content":[{"name":"html_PHSatActions","type":"content","item-type":"html","content":"<span>Physical health goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"4a8cd5c7-1da6-4d7b-a827-4b3988b8ccb3"},{"name":"btn_PHSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"c802668d-8233-4307-8ae8-51c72606d288"}],"expressions":{},"_auto_id_":"e0678ac9-1c55-4ecd-9c6e-d703946c0b2e"}],"repeat":false,"expressions":{},"_auto_id_":"1d67a4ba-3b8e-4b86-b351-ad697abd14b5"},{"name":"group_PHSATActions_cur","type":"area","item-type":"group","content":[{"name":"PHSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.PHSatActions"},"_auto_id_":"c4c9cfc0-1cbf-4540-98c0-3dd4e3f43cff"},{"name":"PHSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"e343205b-f3ee-4159-a5c0-67f3455a347f"},{"name":"PHSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"336d7cce-e28a-497a-a97c-86d69a92b765"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"a45cfcef-2409-4c6c-996a-d9bb6f995770"},{"name":"group_PHSATActions_prev","type":"area","item-type":"group","content":[{"name":"PHSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.PHSatActions_prev"},"_auto_id_":"21e9a080-2f2b-458e-ae05-4ab73dc89a19"},{"name":"PHSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.PHSatActions_prev"},"_auto_id_":"cd919279-3977-4353-9972-2a97ea741c73"},{"name":"PHSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.PHSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"ead95fad-477b-431c-a247-0adcd70fd297"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"28e881ac-b626-4dbd-ac23-5f0584eca67d"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.PHSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"cf94e392-72e3-4ebf-a9e4-bf67c1e8cdd6"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"44c5057b-7f4f-4a25-aef0-86b803037ae6"},{"name":"jobSituationTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Job Situation</h4>\n<div class=\"rio_slider\" id=\"DialogJobSituationSummary\"></div>","expressions":{},"classes":"","_auto_id_":"cfc14cc5-535d-4de1-9779-9bd21bb47cb4"},{"name":"jobSituationGroup","type":"area","item-type":"group","content":[{"name":"JSSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"if (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#JSSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.JSSatDeclinedToAnswer && cti.store.pages.DialogFormOne.JSSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"a6eea2a1-5e6c-45c1-aff2-3012856e64b5"}],"classes":"dialogPlusFormElement","_auto_id_":"9cb206c5-e894-4cb3-a5c0-9c4b8a0272c9","validators":[]},{"name":"JSSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"JSSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.JSSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your job situation?","previousValue":"{{$store.pages.DialogFormOne.JSSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.JSSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.JSSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"81e1c998-8051-4091-b5fd-e6ce4e6c7673"},{"name":"JSSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"90332613-0fc6-425d-9716-dacd11a1e7ca"},{"name":"group_JSSatActions","type":"area","item-type":"group","content":[{"name":"JSSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'JSSatActions_discuss')"},"_auto_id_":"b9f5da39-6429-416d-bc4b-e2b414319e84"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"e28c587c-896b-4cf6-8277-3815d8299076"},{"name":"JSSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.JSSatActions_discuss && !!$store.pages.DialogFormOne.JSSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('JSSatActions')"},"_auto_id_":"c95accd8-4b0c-4850-8926-45df84ed9534"}],"_auto_id_":"6d0dd7b7-9893-433a-8d5d-38e2ae758468"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"60b0a310-250f-4f6f-887d-f4c17d6a6c98"},{"name":"group_JSSatActions_text","type":"area","item-type":"group","content":[{"name":"group_JSSatActions_header","type":"area","item-type":"group","content":[{"name":"html_JSSatActions","type":"content","item-type":"html","content":"<span>Job Situation goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"4745ec21-0cd9-47c0-b3f7-90b37589394f"},{"name":"btn_JSSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"aa60002d-26cb-4e46-94c7-87859011cbc2"}],"expressions":{},"_auto_id_":"10306d0e-9658-45c2-ad6e-a9515a5d9322"}],"repeat":false,"expressions":{},"_auto_id_":"43531398-e39e-4808-a15c-02cf954b5fec"},{"name":"group_JSSATActions_cur","type":"area","item-type":"group","content":[{"name":"JSSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.JSSatActions"},"_auto_id_":"134d4d34-f339-4780-b550-cf4ea74b6c1f"},{"name":"JSSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"9f875437-98bc-474b-a75c-7cb4c28ea335"},{"name":"JSSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"5846bda5-c3d8-4c43-ba41-1d359eba7a0d"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"b21985e8-2b23-4ca7-b907-335d82217c9f"},{"name":"group_JSSATActions_prev","type":"area","item-type":"group","content":[{"name":"JSSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.JSSatActions_prev"},"_auto_id_":"cfbf765e-0c93-4b21-80a3-85c5523e50d4"},{"name":"JSSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.JSSatActions_prev"},"_auto_id_":"b95c56cb-da35-4ad1-acaf-05c29cb97aa9"},{"name":"JSSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.JSSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"d38b192a-8b98-4c0b-966d-00397040a3d9"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"b67181bc-1326-47cc-bf1d-ee3d817a98e0"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.JSSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"75030fa4-7ac9-4e45-a77e-882dddc0af3f"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"896934c3-96ad-4cdb-ba44-8a469c1a3607"},{"name":"accommodationTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Accommodation</h4>\n<div class=\"rio_slider\" id=\"DialogAccommodationSummary\"></div>","expressions":{},"classes":"","_auto_id_":"ddfe274b-4840-4cac-acbd-b7cc1caea4cf"},{"name":"accommodationGroup","type":"area","item-type":"group","content":[{"name":"ACSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"if (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#ACSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.ACSatDeclinedToAnswer && cti.store.pages.DialogFormOne.ACSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"92994e0a-9c15-4573-a567-5db884b01274"}],"classes":"dialogPlusFormElement","_auto_id_":"506e6c2a-0771-4a99-99a4-7fcd9fcf19a3"},{"name":"ACSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"ACSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.ACSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your accommodation?","previousValue":"{{$store.pages.DialogFormOne.ACSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.ACSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.ACSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"83e1f4ad-c7b6-4eeb-b0c9-59072e270bcb"},{"name":"ACSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"8545f4ca-5d47-44cb-a208-48214a20a8d6"},{"name":"group_ACSatActions","type":"area","item-type":"group","content":[{"name":"ACSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'ACSatActions_discuss')"},"_auto_id_":"0574323b-f994-408e-8db4-18b234408285"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"79529b49-2197-4986-9875-6cac67bb1dd0"},{"name":"ACSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.ACSatActions_discuss && !!$store.pages.DialogFormOne.ACSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('ACSatActions')"},"_auto_id_":"b76ca33b-d2e0-44b7-9af1-f5211fd998aa"}],"_auto_id_":"df7e32a1-2b69-4181-8931-80c33b7ed81f"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"622134ba-f86d-4e61-bc18-c4e63907499d"},{"name":"group_ACSatActions_text","type":"area","item-type":"group","content":[{"name":"group_ACSatActions_header","type":"area","item-type":"group","content":[{"name":"html_ACSatActions","type":"content","item-type":"html","content":"<span>Accommodation goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"3da6ac25-9556-40f6-b69c-8f00692f9fad"},{"name":"btn_ACSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"fe70a1fc-a4be-498c-84fd-8353fe11e98b"}],"expressions":{},"_auto_id_":"aebcc6b7-4244-4f57-8dcf-2315af84db03"}],"repeat":false,"expressions":{},"_auto_id_":"932767bc-ffba-417d-8288-21428309fde5"},{"name":"group_ACSatActions_cur","type":"area","item-type":"group","content":[{"name":"ACSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.ACSatActions"},"_auto_id_":"5a572b45-d2c5-4eca-9988-ce5b245c1b39"},{"name":"ACSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"0daa5651-1732-4ecf-ab07-bff59a5a03b0"},{"name":"ACSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"d54ec9f1-c534-401d-b44d-bcb4476d34b3"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"8b43a38d-bd20-4462-bc90-2f61b9490691"},{"name":"group_ACSatActions_prev","type":"area","item-type":"group","content":[{"name":"ACSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.ACSatActions_prev"},"_auto_id_":"953999cb-55b6-4312-a283-9a96575c10a9"},{"name":"ACSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.ACSatActions_prev"},"_auto_id_":"9c2b611c-a074-43c6-aa80-25fd44883bdf"},{"name":"ACSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.ACSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"6ad18129-efc8-4eb9-8fa5-72bc71a9a96f"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"4dcbe909-88c6-4c43-a64d-979edde96d23"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.ACSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"d4243703-36c1-45d6-bb69-ed069a67abed"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"eabe56d1-7704-43bd-a226-40321d79f04d"},{"name":"leisureActivitiesTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Leisure Activities</h4>\n<div class=\"rio_slider\" id=\"DialogLeisureActivitiesSummary\"></div>","expressions":{},"classes":"","_auto_id_":"e7798aed-a1f6-423d-b125-4284abf7aa0d"},{"name":"leisureActivitiesGroup","type":"area","item-type":"group","content":[{"name":"LASatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"if (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#LASatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.LASatDeclinedToAnswer && cti.store.pages.DialogFormOne.LASatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"5dbe38ff-44fc-4ff7-b0c7-9da84a092648"}],"classes":"dialogPlusFormElement","_auto_id_":"c62a79aa-6bc9-4db3-9a85-6a65a8dada67"},{"name":"LASatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"LASatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.LASatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your leisure activities?","previousValue":"{{$store.pages.DialogFormOne.LASatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.LASatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.LASatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"12357521-a0b5-4a4b-8bd6-feb0de26c2f2"},{"name":"LASatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"5b68bc8f-0587-41eb-923f-95a812dceea7"},{"name":"group_LASatActions","type":"area","item-type":"group","content":[{"name":"LASatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'LASatActions_discuss')"},"_auto_id_":"e4ee2bb1-5dd2-4ab2-872b-10a0085c3c2f"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"161a662a-a198-416c-b2ec-e854c075e184"},{"name":"LASatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.LASatActions_discuss && !!$store.pages.DialogFormOne.LASatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('LASatActions')"},"_auto_id_":"07983d9f-3dac-41c4-81bc-45f102b9daa6"}],"_auto_id_":"6be35658-dc21-4037-bf23-6a6a81e9c0d4"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"6af8214f-6c7a-49e2-b7a8-49a7fc15b727"},{"name":"group_LASatActions_text","type":"area","item-type":"group","content":[{"name":"group_LASatActions_header","type":"area","item-type":"group","content":[{"name":"html_LASatActions","type":"content","item-type":"html","content":"<span>Leisure Activities goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"6ccb807b-e18e-4e42-af2d-63c68526f606"},{"name":"btn_LASat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"1609a93f-0204-4d76-967f-e59edd81538d"}],"expressions":{},"_auto_id_":"490fca4e-9884-429a-b248-d8152da355ea"}],"repeat":false,"expressions":{},"_auto_id_":"ada417d9-dffd-4884-b7ac-3e274fde65c0"},{"name":"group_LASatActions_cur","type":"area","item-type":"group","content":[{"name":"LASatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.LASatActions"},"_auto_id_":"b4bf6129-b6cb-4829-adeb-00fb57070622"},{"name":"LASatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"4b2b85c5-8096-4cb6-83d3-725e272c6459"},{"name":"LASatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"59342a4a-93c9-42e6-9a74-7cadb17c3fe4"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"03099d58-4d0e-40ae-b2aa-da2555e9100e"},{"name":"group_LASatActions_prev","type":"area","item-type":"group","content":[{"name":"LASatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.LASatActions_prev"},"_auto_id_":"1d2e9890-955d-4d18-9c80-f6f98e675874"},{"name":"LASatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.LASatActions_prev"},"_auto_id_":"e5d5c230-401f-417f-a7e0-2f495d5a3556"},{"name":"LASatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.LASatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"02b86482-6ccb-4847-8a3d-8a5265d186a8"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"19ee5389-d0a6-4366-ae59-77e419480889"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.LASatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"34f1fdfb-d131-4747-8ed7-975994ea7420"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"18743f28-d0ba-4bf6-880a-2064e9e60438"},{"name":"partnerFamilyTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Partner / Family</h4>\n<div class=\"rio_slider\" id=\"DialogPartnerFamilySummary\"></div>","expressions":{},"classes":"","_auto_id_":"514746f3-28aa-41b4-92e8-719f0983d29f"},{"name":"partnerFamilyGroup","type":"area","item-type":"group","content":[{"name":"RSSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"\nif (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#RSSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.RSSatDeclinedToAnswer && cti.store.pages.DialogFormOne.RSSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"a14392d1-e8e5-4e97-ae4e-39b30db73e17"}],"classes":"dialogPlusFormElement","_auto_id_":"861c2027-2aeb-40a5-b6f7-79c9ac2268b7"},{"name":"RSSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"RSSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.RSSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your relationship with your partner / family?","previousValue":"{{$store.pages.DialogFormOne.RSSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.RSSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.RSSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"71739109-ebd5-48fd-8ad8-9b73aca0c507"},{"name":"RSSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"8cc3ccf3-069a-4d2f-a82e-088692923ce0"},{"name":"group_RSSatActions","type":"area","item-type":"group","content":[{"name":"RSSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'RSSatActions_discuss')"},"_auto_id_":"8bb3bf44-b6d8-4d78-9109-75ee33724e76"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"e612c9be-5f35-4cda-8620-7d36b6768cc7"},{"name":"RSSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.RSSatActions_discuss && !!$store.pages.DialogFormOne.RSSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('RSSatActions')"},"_auto_id_":"a856ab34-0610-4849-9fa5-31c82f11d38d"}],"_auto_id_":"00ee5c14-f82e-4422-a1f4-57a268f2d6f6"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"b93e4fc1-c17b-4a82-83fd-6b007854a55c"},{"name":"group_RSSatActions_text","type":"area","item-type":"group","content":[{"name":"group_RSSatActions_header","type":"area","item-type":"group","content":[{"name":"html_RSSatActions","type":"content","item-type":"html","content":"<span>Relationship with partner / family goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"8b14daab-ef35-4ee2-9b18-03c8cba4cf8e"},{"name":"btn_RSSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"915a84bc-0144-4695-869b-191ab0e8c085"}],"expressions":{},"_auto_id_":"4aca255b-124f-400e-ab4b-a592f9493db2"}],"repeat":false,"expressions":{},"_auto_id_":"13215308-80d9-4a5a-bf33-5564cf66b817"},{"name":"group_RSSatActions_cur","type":"area","item-type":"group","content":[{"name":"RSSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.RSSatActions"},"_auto_id_":"497cb64d-7545-47e1-8ff3-47b2bd42a914"},{"name":"RSSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"a2f4f7bb-23d3-482f-8d3d-cacc5aeee6d7"},{"name":"RSSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"ccf51ece-5f9b-472f-8369-d02a4984663d"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"a864d7c4-246e-476d-bccb-e1b0d64c1d24"},{"name":"group_RSSatActions_prev","type":"area","item-type":"group","content":[{"name":"RSSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.RSSatActions_prev"},"_auto_id_":"db53a29d-239f-4688-b2b2-70292f379758"},{"name":"RSSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.RSSatActions_prev"},"_auto_id_":"299fa28f-745d-4d5c-9708-00b8f1748731"},{"name":"RSSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.RSSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"c0f2bc5a-ea11-4aa0-9436-eed929d58f28"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"d38095ce-3e50-4033-a137-67c5b36959b0"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.RSSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"98b86396-cd22-45ac-8292-52b536c8c04a"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"4c1df3cb-ebf3-4eeb-a5ad-edd3eec5ac32"},{"name":"friendshipsTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Friendships</h4>\n<div class=\"rio_slider\" id=\"DialogFriendshipsSummary\"></div>","expressions":{},"classes":"","_auto_id_":"06ef06b3-0afe-48db-beb1-c7c735292edf"},{"name":"friendshipsGroup","type":"area","item-type":"group","content":[{"name":"FSSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"\nif (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#FSSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.FSSatDeclinedToAnswer && cti.store.pages.DialogFormOne.FSSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"b8852053-f72e-4f6d-aacd-66f6ea281ae2"}],"classes":"dialogPlusFormElement","_auto_id_":"331e65bf-4a8b-4988-a023-91c2e39c31d1"},{"name":"FSSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"FSSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.FSSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your friendships?","previousValue":"{{$store.pages.DialogFormOne.FSSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.FSSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.FSSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"7ca5ccd6-7e74-4271-9ef3-0b39dbccd6f4"},{"name":"FSSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"2138b4c5-be0d-4abc-93f4-bcde82a2a0ed"},{"name":"group_FSSatActions","type":"area","item-type":"group","content":[{"name":"FSSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'FSSatActions_discuss')"},"_auto_id_":"5f5bc860-7443-4614-8f1c-3243cfd319f5"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"5f31d461-561d-49e2-9ff1-c30d60cfbe2c"},{"name":"FSSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.FSSatActions_discuss && !!$store.pages.DialogFormOne.FSSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('FSSatActions')"},"_auto_id_":"e6a4e5b0-ff30-4595-ae28-609ab5c4270e"}],"_auto_id_":"4e4bf6f7-bb89-48b0-a499-ec20723975a5"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"187529dd-0e9c-443e-9a0d-0af7606ae5ef"},{"name":"group_FSSatActions_text","type":"area","item-type":"group","content":[{"name":"group_FSSatActions_header","type":"area","item-type":"group","content":[{"name":"html_FSSatActions","type":"content","item-type":"html","content":"<span>Friendship goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"249063ba-c2ab-4b70-b251-756dc0bb40ed"},{"name":"btn_FSSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"e8431a4d-a922-46c8-8920-ed4143c2542a"}],"expressions":{},"_auto_id_":"4bff2f96-7b7a-424e-aecb-2d87e7186c08"}],"repeat":false,"expressions":{},"_auto_id_":"5f1b4591-f68c-4a63-9533-93defead46ae"},{"name":"group_FSSatActions_cur","type":"area","item-type":"group","content":[{"name":"FSSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.FSSatActions"},"_auto_id_":"b8a73bbc-0fe1-4fe6-8bb9-8eca4c74c55f"},{"name":"FSSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"71471c1a-bd9d-4aa2-98f7-098e339d7244"},{"name":"FSSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"3689cc12-1339-40f3-bb8c-53f2e83a11e5"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"92cf13ca-e020-4cfa-abb7-6bc7355b8ed3"},{"name":"group_FSSatActions_prev","type":"area","item-type":"group","content":[{"name":"FSSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.FSSatActions_prev"},"_auto_id_":"b198cce1-b2ec-4cb0-b231-f665a73ad4fa"},{"name":"FSSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.FSSatActions_prev"},"_auto_id_":"f72d16df-3832-4cf7-b91c-48493ec27d04"},{"name":"FSSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.FSSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"afbb84d8-46c2-46fd-bba1-aac712a450fe"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"235e1ee5-a75e-4662-9dfd-cfdb17ec8805"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.FSSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"2c5e1fe4-a3ac-4ad2-b146-a3ebc5aee587"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"9b63729a-38c8-45cc-a1cf-b927df0b5cbd"},{"name":"personalSafetyTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Personal Safety</h4>\n<div class=\"rio_slider\" id=\"DialogPersonalSafetySummary\"></div>","expressions":{},"classes":"","_auto_id_":"e3e531b9-0df8-42e4-8251-98d54f6fcdfb"},{"name":"personalSafetyGroup","type":"area","item-type":"group","content":[{"name":"PSSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"\nif (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#PSSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.PSSatDeclinedToAnswer && cti.store.pages.DialogFormOne.PSSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"85bf4176-c6a7-45a7-ac66-b97e1a7db63e"}],"classes":"dialogPlusFormElement","_auto_id_":"ed683f5d-ba34-4815-b2a7-ab6d418d09ad"},{"name":"PSSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"PSSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.PSSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your personal safety?","previousValue":"{{$store.pages.DialogFormOne.PSSatPl_prev }}","previousDot":"{{$store.pages.DialogFormOne.PSSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.PSSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"c4b95370-f0d6-4d08-a705-d00a5679e4b9"},{"name":"PSSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"ffc4f7f7-d533-4717-84e8-eef45976cea8"},{"name":"group_PSSatActions","type":"area","item-type":"group","content":[{"name":"PSSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'PSSatActions_discuss')"},"_auto_id_":"b30b74a0-35e0-411a-8445-af1ea5a58ecd"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"cf4a63e2-7d77-4974-8e39-3b705b28d847"},{"name":"PSSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.PSSatActions_discuss && !!$store.pages.DialogFormOne.PSSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('PSSatActions')"},"_auto_id_":"af39e4ff-cd26-4654-ad25-5f416c744f11"}],"_auto_id_":"1f2ed2fa-49d8-4ab9-ad70-7a0868070a4e"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"d20d0b96-2cf3-48e9-ae36-4058d65d02e8"},{"name":"group_PSSatActions_text","type":"area","item-type":"group","content":[{"name":"group_PSSatActions_header","type":"area","item-type":"group","content":[{"name":"html_PSSatActions","type":"content","item-type":"html","content":"<span>Personal safety goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"80c90f56-a508-4edb-9cc4-0ba55e05b04d"},{"name":"btn_PSSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"68541af7-bf9b-4ccc-ac88-da988e326480"}],"expressions":{},"_auto_id_":"63b389d3-e60b-4e26-8f8a-bf503046b69a"}],"repeat":false,"expressions":{},"_auto_id_":"b3d71b6c-8161-4923-9460-de1165ef32aa"},{"name":"group_PSSatActions_cur","type":"area","item-type":"group","content":[{"name":"PSSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.PSSatActions"},"_auto_id_":"2c88a92e-4367-409f-9419-cd08d9d9b9b5"},{"name":"PSSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"7e09626d-1b69-48ee-8831-2ba0260b2f41"},{"name":"PSSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"522cc39c-57da-4a77-96ad-7534930d6bac"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"4361beb9-770a-48d8-a64c-bdf92f1d823f"},{"name":"group_PSSatActions_prev","type":"area","item-type":"group","content":[{"name":"PSSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.PSSatActions_prev"},"_auto_id_":"741cfa3c-339a-4fc1-954c-fa326e75ec8b"},{"name":"PSSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.PSSatActions_prev"},"_auto_id_":"74e6c142-012b-4e9a-9f15-0bc0c857017d"},{"name":"PSSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.PSSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"4309a729-f41b-4058-adb6-5411cec7ee57"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"52978214-37d9-4f5a-ad07-809b4b1e37a4"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.PSSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"64a14c62-ba54-4269-af22-edaa307d3cb8"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"96a24750-bacf-4a6b-942d-001a14aecb91"},{"name":"financesTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Finances</h4>\n<div class=\"rio_slider\" id=\"DialogFinancesSummary\"></div>","expressions":{},"classes":"","_auto_id_":"d38deedb-7be2-47ad-a515-bb1eff9a8c98"},{"name":"financesGroup","type":"area","item-type":"group","content":[{"name":"FISatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"\nif (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#FISatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.FISatDeclinedToAnswer && cti.store.pages.DialogFormOne.FISatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"8cb9c307-ae13-49f7-b628-2d4a3840d077"}],"classes":"dialogPlusFormElement","_auto_id_":"70d472bf-d840-4836-b57a-3078c3721e27"},{"name":"FISatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"FISatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.FISatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your finances?","previousValue":"{{$store.pages.DialogFormOne.FISatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.FISatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.FISatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"19949c42-d4e9-40be-8d2d-9f7bdebc966b"},{"name":"FISatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"5448527b-3a3f-4dcb-949c-fdeeafd7c9b7"},{"name":"group_FISatActions","type":"area","item-type":"group","content":[{"name":"FISatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'FISatActions_discuss')"},"_auto_id_":"15fd80a6-32cc-4967-aa01-cb4866067752"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"e7d62df1-c188-4948-9771-3aade04a8275"},{"name":"FISatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.FISatActions_discuss && !!$store.pages.DialogFormOne.FISatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('FISatActions')"},"_auto_id_":"97146719-88d2-4b2a-b8f1-c0d578c492c4"}],"_auto_id_":"f076551e-8a6e-4e58-8f49-a7ca9113b30d"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"efa85fdc-4bb0-470f-a733-075106371b2f"},{"name":"group_FISatActions_text","type":"area","item-type":"group","content":[{"name":"group_FISatActions_header","type":"area","item-type":"group","content":[{"name":"html_FISatActions","type":"content","item-type":"html","content":"<span>Finances goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"886e42e9-df7a-400d-90ae-09cc0b0d3cd4"},{"name":"btn_FISat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"99526402-5cb4-45f5-9bbe-76d6b74df3b9"}],"expressions":{},"_auto_id_":"50048d75-95ec-4194-bb8f-f704b489c744"}],"repeat":false,"expressions":{},"_auto_id_":"650ab23d-66f0-4e84-9417-9048e026aad8"},{"name":"group_FISatActions_cur","type":"area","item-type":"group","content":[{"name":"FISatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.FISatActions"},"_auto_id_":"355f1632-0786-4c92-8972-09d740cb0d7e"},{"name":"FISatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"1be0061d-7e48-4494-aec7-e3a85d3b56a4"},{"name":"FISatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"cf7170c8-a168-4357-8cc3-105c33683838"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"f03bd388-3ad0-4614-b6ac-31fcefb630d5"},{"name":"group_FISatActions_prev","type":"area","item-type":"group","content":[{"name":"FISatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.FISatActions_prev"},"_auto_id_":"0875342a-c811-438d-ae27-f43924ac1bd4"},{"name":"FISatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.FISatActions_prev"},"_auto_id_":"91587629-c304-46c7-a4e1-b3e16e7e68ce"},{"name":"FISatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.FISatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"0906360e-1757-4133-8d89-e3dc44c71d0d"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"d4ab8eac-b7fd-4668-aa7e-9a67fae27fc2"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.FISatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"422a8bfc-5097-41cf-9ba9-54cd37ca582b"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"e6febd94-0783-4123-9d7e-457c6f54eb3c"},{"name":"identityTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Identity</h4>\n<div class=\"rio_slider\" id=\"DialogIdentitySummary\"></div>","expressions":{},"classes":"","_auto_id_":"17bb8a6b-86f6-4e4e-b864-c73dca2d975a"},{"name":"identityGroup","type":"area","item-type":"group","content":[{"name":"CNSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"\nif (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#CNSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.CNSatDeclinedToAnswer && cti.store.pages.DialogFormOne.CNSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"ccde4b2f-3951-45f1-83c7-06a7963ab48a"}],"classes":"dialogPlusFormElement","_auto_id_":"43948ff1-b9be-4ebf-99cf-06664f974ec9"},{"name":"CNSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"CNSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.CNSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your expression of identity?","previousValue":"{{$store.pages.DialogFormOne.CNSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.CNSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.CNSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"3f10495c-99ad-451a-9446-b3b0ce023c85"},{"name":"CNSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"c977aca6-434c-429e-8497-fae2ff29451a"},{"name":"group_CNSatActions","type":"area","item-type":"group","content":[{"name":"CNSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'CNSatActions_discuss')"},"_auto_id_":"3826bd65-802d-4bbe-917f-c0907e17450f"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"9f0b0f7c-4e4b-4644-9f85-dc6e5ddd6710"},{"name":"CNSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.CNSatActions_discuss && !!$store.pages.DialogFormOne.CNSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('CNSatActions')"},"_auto_id_":"2b7ec6c1-b92b-4225-8374-0fedb421e8cc"}],"_auto_id_":"e13df25d-ebab-46fc-ad01-22d401db4c93"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"8759259d-71c2-40bf-924e-8a38e3f33af2"},{"name":"group_CNSatActions_text","type":"area","item-type":"group","content":[{"name":"group_CNSatActions_header","type":"area","item-type":"group","content":[{"name":"html_CNSatActions","type":"content","item-type":"html","content":"<span>Identity goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"b61c9299-4992-4345-949e-bce4deb0892d"},{"name":"btn_CNSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"28813538-2572-456e-b6c8-e2d310221ca5"}],"expressions":{},"_auto_id_":"07812678-3699-43bb-b8e4-c34c135de55c"}],"repeat":false,"expressions":{},"_auto_id_":"82130c35-1785-4959-bf16-0b3cf4f1f556"},{"name":"group_CNSatActions_cur","type":"area","item-type":"group","content":[{"name":"CNSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.CNSatActions"},"_auto_id_":"7cdede2b-5d94-4128-b803-5159144958aa"},{"name":"CNSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"88d7f011-aafb-4c67-b37f-e110cbf84f7c"},{"name":"CNSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"c46b197c-8211-4d63-9c9a-9c044fe8191c"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"3ace2e9c-b710-4961-8b87-418792287f32"},{"name":"group_CNSatActions_prev","type":"area","item-type":"group","content":[{"name":"CNSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.CNSatActions_prev"},"_auto_id_":"4b738a37-4206-48a8-8af0-38664e773077"},{"name":"CNSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.CNSatActions_prev"},"_auto_id_":"cf046cc0-27a1-461b-bad1-1f4ddd1c0537"},{"name":"CNSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.CNSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"5bfa3f26-1c8a-466d-85d5-b3963eef1d36"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"5d43b179-5cf7-4748-9d11-01a08d478361"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.CNSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"c40b2008-c460-4924-ae32-495e459f1251"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"8f6b742d-1ec3-46f5-b4fe-332e522d79dd"},{"name":"substanceAlcoholTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Substance / Alcohol</h4>\n<div class=\"rio_slider\" id=\"DialogSubstanceAlcoholSummary\"></div>","expressions":{},"classes":"","_auto_id_":"a73eff60-d1d6-4883-8603-d48ad98c2b4a"},{"name":"substanceAlcoholGroup","type":"area","item-type":"group","content":[{"name":"SUSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"\nif (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#SUSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.SUSatDeclinedToAnswer && cti.store.pages.DialogFormOne.SUSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"2db3a55f-3f96-47c8-89e3-d9a2b6e511fe"}],"classes":"dialogPlusFormElement","_auto_id_":"cef7d54f-0426-455a-8cc7-5136ca6f28f0"},{"name":"SUSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"SUSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.SUSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your substance / alcohol use?","previousValue":"{{$store.pages.DialogFormOne.SUSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.SUSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.SUSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"dbc35c22-adb1-42f0-a1e3-45e97e11cbf6"},{"name":"SUSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"b5bc09f5-fb06-4109-9599-a9f900c3e72e"},{"name":"group_SUSatActions","type":"area","item-type":"group","content":[{"name":"SUSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'SUSatActions_discuss')"},"_auto_id_":"298a8a88-8b85-4da7-935b-29a83ce4066e"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"375615c2-7510-45b2-b73d-adbab9826206"},{"name":"SUSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.SUSatActions_discuss && !!$store.pages.DialogFormOne.SUSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('SUSatActions')"},"_auto_id_":"2d420f1f-b785-4abd-b77c-984a305c47b5"}],"_auto_id_":"d35e837e-4672-47cb-aefb-95eb518f99e6"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"ae31c08e-1075-4638-9916-7b62dde1b94c"},{"name":"group_SUSatActions_text","type":"area","item-type":"group","content":[{"name":"group_SUSatActions_header","type":"area","item-type":"group","content":[{"name":"html_SUSatActions","type":"content","item-type":"html","content":"<span> Substance / Alcohol goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"c208c26e-57d7-4365-912e-e90ab8bc32c4"},{"name":"btn_SUSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"1e7521ce-744a-4371-ac79-72000374e714"}],"expressions":{},"_auto_id_":"00cd9ed1-f9c1-400a-86ca-13153df0e678"}],"repeat":false,"expressions":{},"_auto_id_":"371bde3c-d727-4356-945c-7194b549a920"},{"name":"group_SUSatActions_cur","type":"area","item-type":"group","content":[{"name":"SUSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.SUSatActions"},"_auto_id_":"d1bbd769-2239-4826-bbcf-d491d413a979"},{"name":"SUSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"89402b9f-0ec5-4384-b001-57bab0e1d607"},{"name":"SUSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"57a78fd2-7ca5-4332-95cd-b48ece9cc114"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"f1e6bf5f-2936-4ead-988c-0e9e0bc59e73"},{"name":"group_SUSatActions_prev","type":"area","item-type":"group","content":[{"name":"SUSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.SUSatActions_prev"},"_auto_id_":"dc61340c-d447-46ad-baea-dbaa94a27b89"},{"name":"SUSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.SUSatActions_prev"},"_auto_id_":"ef90b48d-2336-4444-bb1a-078397742cd7"},{"name":"SUSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.SUSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"d7dd5449-75cc-446f-9863-a830bc8f8e31"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"5a468e19-15c9-4108-9068-7e111d9fa767"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.SUSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"71cdb4b6-9133-4b31-9a8f-6892127c3072"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"53797e31-636a-4deb-ab6a-f2f52965edce"},{"name":"medicationTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Medication</h4>\n<div class=\"rio_slider\" id=\"DialogMedicationSummary\"></div>","expressions":{},"classes":"","_auto_id_":"64498541-0e59-47d8-9db8-55ba57e15d23"},{"name":"medicationGroup","type":"area","item-type":"group","content":[{"name":"MDSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"\nif (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#MDSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.MDSatDeclinedToAnswer && cti.store.pages.DialogFormOne.MDSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"240f06d3-5333-4e45-a561-38159ad06db4"}],"classes":"dialogPlusFormElement","_auto_id_":"5b8b3e57-a7fa-428a-af6c-8b0d21a7af33"},{"name":"MDSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"MDSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.MDSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your medication?","previousValue":"{{$store.pages.DialogFormOne.MDSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.MDSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.MDSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"eaee6505-4276-45a4-9cca-01503f1123b8"},{"name":"MDSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"a9a26513-4724-4c00-a851-a8af526418f6"},{"name":"group_MDSatActions","type":"area","item-type":"group","content":[{"name":"MDSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'MDSatActions_discuss')"},"_auto_id_":"335bf4a8-915e-4c51-9571-875a2f5e1ae1"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"2a46e2f3-a7c4-4268-a7ce-aa78a0dc3691"},{"name":"MDSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.MDSatActions_discuss && !!$store.pages.DialogFormOne.MDSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('MDSatActions')"},"_auto_id_":"be38b23a-ca74-4aeb-b831-25c7a019d2ea"}],"_auto_id_":"23498790-e3c3-4e77-a77d-dbdda2863e04"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"593eda90-bbbc-4600-863d-35c210dbbb0b"},{"name":"group_MDSatActions_text","type":"area","item-type":"group","content":[{"name":"group_MDSatActions_header","type":"area","item-type":"group","content":[{"name":"html_MDSatActions","type":"content","item-type":"html","content":"<span>Medication goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"3c3289b8-b434-4091-91d5-8690dc013864"},{"name":"btn_MDSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"b8c6916c-66bb-4a7a-b4a7-008e66262cea"}],"expressions":{},"_auto_id_":"38bf43b6-85e0-43da-96be-56460476c184"}],"repeat":false,"expressions":{},"_auto_id_":"64dd8b71-f70f-4e25-a0e0-ccb10583d9e6"},{"name":"group_MDSatActions_cur","type":"area","item-type":"group","content":[{"name":"MDSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.MDSatActions"},"_auto_id_":"74bbe54e-fa2d-4ef6-a1cf-d12bc8c05c8b"},{"name":"MDSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"05d52c46-b51c-4ac3-a519-7de45f9eb50c"},{"name":"MDSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"7e2acae6-c882-4cd3-bf5f-dd5f0281b802"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"8b742757-1032-49e6-a1c9-f87a4a98d6ea"},{"name":"group_MDSatActions_prev","type":"area","item-type":"group","content":[{"name":"MDSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.MDSatActions_prev"},"_auto_id_":"ea749d36-fcc0-4f67-999d-7fc17c213a1b"},{"name":"MDSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.MDSatActions_prev"},"_auto_id_":"05c9825c-fb26-400b-a8a1-ecb72dfb077f"},{"name":"MDSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.MDSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"aa3eb0e6-cc1b-4d7e-9094-843aea3e324a"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"2a533336-b882-472b-ae28-c2c685c90117"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.MDSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"c64a0b47-2e39-4f02-8157-a67032f8753c"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"d6c1bdfe-36ed-4960-b17f-9092fc760c13"},{"name":"practicalHelpTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Practical Help</h4>\n<div class=\"rio_slider\" id=\"DialogPracticalHelpSummary\"></div>","expressions":{},"classes":"","_auto_id_":"6412fb32-0e22-4201-b608-068b91fccec9"},{"name":"practicalHelpGroup","type":"area","item-type":"group","content":[{"name":"PRSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"\nif (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#PRSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.PRSatDeclinedToAnswer && cti.store.pages.DialogFormOne.PRSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"a0e222d9-6c02-4f7d-a44c-d847a1e5d2b1"}],"classes":"dialogPlusFormElement","_auto_id_":"42336e92-5bf0-4ab9-9b81-84a3682ab7c1"},{"name":"PRSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"PRSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.PRSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with the practical help you receive?","previousValue":"{{$store.pages.DialogFormOne.PRSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.PRSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.PRSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"5b7c50a5-93e2-454c-97bc-0abd60a77794"},{"name":"PRSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"f90fbb9d-72ad-47d6-89a2-f51adfc262df"},{"name":"group_PRSatActions","type":"area","item-type":"group","content":[{"name":"PRSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'PRSatActions_discuss')"},"_auto_id_":"d5c19371-1f7a-4832-bfdb-7ba0a7d64b51"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"28d386e0-da1a-4be3-ad82-c5e08e2384e9"},{"name":"PRSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.PRSatActions_discuss && !!$store.pages.DialogFormOne.PRSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('PRSatActions')"},"_auto_id_":"72227f98-1705-47f5-8020-da61c4428612"}],"_auto_id_":"ed8fe94c-3b43-4492-9898-98dd9d249191"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"da6b310b-68d0-48a6-b718-71fde52e55b3"},{"name":"group_PRSatActions_text","type":"area","item-type":"group","content":[{"name":"group_PRSatActions_header","type":"area","item-type":"group","content":[{"name":"html_PRSatActions","type":"content","item-type":"html","content":"<span>Practical Help goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"120ca4cd-7e6f-4859-a19b-37c72346a77f"},{"name":"btn_PRSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"4a4779b4-2f91-42c7-93a5-1944673d24cf"}],"expressions":{},"_auto_id_":"9df34082-6783-4be2-918f-b6a3f07633f8"}],"repeat":false,"expressions":{},"_auto_id_":"f16b4dba-de92-492e-be9d-5df23accdd15"},{"name":"group_PRSatActions_cur","type":"area","item-type":"group","content":[{"name":"PRSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.PRSatActions"},"_auto_id_":"98acc9f8-5ac2-4d77-ad95-17ddfc22b09c"},{"name":"PRSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"27c641ed-1743-4079-846c-a81decfe099f"},{"name":"PRSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"5a58e1c7-3f04-47a1-89db-40dc3cb2d9ac"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"eedcbcbb-c882-450e-8424-50259146cd07"},{"name":"group_PRSatActions_prev","type":"area","item-type":"group","content":[{"name":"PRSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.PRSatActions_prev"},"_auto_id_":"9d2cc1c2-7f1b-4633-a31d-eb24991a4186"},{"name":"PRSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.PRSatActions_prev"},"_auto_id_":"11c17304-52b6-47a9-a441-51b236b2b252"},{"name":"PRSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.PRSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"2c985dc3-44c3-4ec0-ab77-901daa3c667d"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"aa709a47-52a3-477d-8239-868e09c1eb9a"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.PRSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"4abd75ce-edb2-438e-9d94-d80735ee24fc"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"0a68d917-c62f-4698-b0b6-ba79889143a9"},{"name":"mhpMeetingsTitle","type":"content","item-type":"html","content":"<hr/>\n<h4>Meetings with Mental Health Professionals</h4>\n<div class=\"rio_slider\" id=\"DialogMHPMeetingsSummary\"></div>","expressions":{},"classes":"","_auto_id_":"b5e81a45-0c46-4533-a4a4-88fd51e148c1"},{"name":"mhpMeetingsGroup","type":"area","item-type":"group","content":[{"name":"MPSatDeclinedToAnswer","type":"choice","item-type":"checkbox","label":"Declined to answer: ","required":false,"options":[{"label":"","id":"selected"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","disabled":"$store.variables.dialogIsReadOnly"},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"\nif (window.debug) {\n  debugger\n}\n\nif (!cti.store.pages.DialogFormOne) {\n  cti.store.pages.DialogFormOne = {}\n}\n\nconst slider = document.querySelector('#MPSatPl_Slider')\nconst declined = cti.store.pages.DialogFormOne.MPSatDeclinedToAnswer && cti.store.pages.DialogFormOne.MPSatDeclinedToAnswer.selected || false\n  \nif (slider) {\n  slider.setAttribute('readOnly', declined ? 'true' : 'false')\n}\n"},"_auto_id_":"b7a03e3d-0d1b-4dea-a627-20aafae74126"}],"classes":"dialogPlusFormElement","_auto_id_":"9b83d3cf-640d-44bb-ba92-2a19b9871634"},{"name":"MPSatPl_Slider","type":"component","item-type":"web-component","content":[],"componentId":"93f9a77a-705f-4dc5-8740-370c65706076","attributes":{"sliderID":"MPSatPl","rangeMin":1,"rangeMax":7,"roundToSteps":true,"storeLocation":"{{$store.pages.DialogFormOne.MPSatPl}}","debounceOverride":null,"questionText":"How satisfied are you with your meetings with mental health professionals?","previousValue":"{{$store.pages.DialogFormOne.MPSatPl_prev}}","previousDot":"{{$store.pages.DialogFormOne.MPSatActions_prev ? '1' : '0'}}","currentDot":"{{$store.pages.DialogFormOne.MPSatActions ? '1' : '0'}}"},"actions":[],"expressions":{},"classes":"question-slider","_auto_id_":"d06eabca-41b3-4cc8-9f8f-cfe67823b633"},{"name":"MPSatHelp","type":"choice","item-type":"radio","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"actions":[],"validators":[],"classes":"dialogPlusFormElement","_auto_id_":"4e133db9-f003-47a6-85b4-fc12e1a3f991"},{"name":"group_MPSatActions","type":"area","item-type":"group","content":[{"name":"MPSatActions_discuss","type":"button","item-type":"button","content":"Discuss","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggleModelBoolean('DialogFormOne', 'MPSatActions_discuss')"},"_auto_id_":"fcf43a65-1e49-4da1-af5b-ab7a49e2d747"}],"expressions":{},"left-icon":"fa-comments-o","_auto_id_":"fdb76322-da3f-4b3b-b2fa-a735a7619c04"},{"name":"MPSatActions_copy","type":"button","item-type":"button","content":"Copy Previous","theme":"default","expressions":{"show":"$store.pages.DialogFormOne.MPSatActions_discuss && !!$store.pages.DialogFormOne.MPSatActions_prev && !$store.variables.dialogIsReadOnly"},"left-icon":"fa-arrow-left","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_dialogCopyPrevious('MPSatActions')"},"_auto_id_":"b1ef4937-4caf-4d00-8641-62ffa113abe3"}],"_auto_id_":"7b1afd7c-bbcf-4f96-95b2-cbd6e6c8cff9"}],"repeat":false,"expressions":{},"classes":"dialogPlusActions","_auto_id_":"d40638c7-7696-408b-8504-3c49ecb0faa1"},{"name":"group_MPSatActions_text","type":"area","item-type":"group","content":[{"name":"group_MPSatActions_header","type":"area","item-type":"group","content":[{"name":"html_MPSatActions","type":"content","item-type":"html","content":"<span>Meetings with Mental Health Professionals goals and actions:</span>","expressions":{},"classes":"dialogPlusDiscussHeader","_auto_id_":"d8711065-47bb-4819-992c-8f12493479ed"},{"name":"btn_MPSat_info","type":"button","item-type":"button","content":"","theme":"default","left-icon":"fa-info-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"48158950-a194-44a2-bddb-dae490234f98","function":"toggle"},"_auto_id_":"52977dd3-2a19-4960-b02f-171332a5675b"}],"expressions":{},"_auto_id_":"256954dc-cf66-4c1e-800f-069c17c019fc"}],"repeat":false,"expressions":{},"_auto_id_":"6523e9ac-8624-43fa-929a-23f39853a2dd"},{"name":"group_MPSatActions_cur","type":"area","item-type":"group","content":[{"name":"MPSatActions_cdot","type":"content","item-type":"html","content":"<span class=\"dot current-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.MPSatActions"},"_auto_id_":"0b3b1471-fdc7-4be5-830a-7866094ceb60"},{"name":"MPSatActions_cheader","type":"content","item-type":"html","content":"<label>Today</label>","expressions":{},"_auto_id_":"3d5c166d-b692-4f08-9810-b286b4d81554"},{"name":"MPSatActions","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"validators":[],"actions":[],"expressions":{"disabled":"$store.variables.dialogIsReadOnly"},"placeholder":"","_auto_id_":"de357088-5a35-46e3-838b-0b4bbc11de2e"}],"repeat":false,"expressions":{"show":"!$store.variables.dialogIsReadOnly"},"classes":"dialogPlusDiscussBox","_auto_id_":"cb559ce9-d495-4573-b0f4-dc0ea1fb33a6"},{"name":"group_MPSatActions_prev","type":"area","item-type":"group","content":[{"name":"MPSatActions_pdot","type":"content","item-type":"html","content":"<span class=\"dot previous-dot\"></span>","expressions":{"show":"!!$store.pages.DialogFormOne.MPSatActions_prev"},"_auto_id_":"c1c8b227-38e3-4e4e-8f00-0cd1b16b4881"},{"name":"MPSatActions_pheader","type":"content","item-type":"html","content":"<label>{{'$store.variables.selected_visit.patientData.dialogPlusForms[$store.variables.currentPreviousDialogIndex].displayDate' | store}}</label>","expressions":{"show":"!!$store.pages.DialogFormOne.MPSatActions_prev"},"_auto_id_":"191cfebe-8ec4-4b20-a1ea-d9072ee2bffb"},{"name":"MPSatActions_prev","type":"user-input","item-type":"text","label":"","required":false,"multiline":true,"debounce":1000,"expressions":{"show":"!!$store.pages.DialogFormOne.MPSatActions_prev","disabled":"true"},"validators":[],"actions":[],"_auto_id_":"380c2dd9-fefc-4de9-a5ee-10fc903619df"}],"repeat":false,"expressions":{},"classes":"dialogPlusDiscussBox","_auto_id_":"d67424c0-025e-4d79-bed1-13f9d7e454da"}],"repeat":false,"expressions":{"show":"$store.pages.DialogFormOne.MPSatActions_discuss"},"classes":"dialogPlusDiscuss","_auto_id_":"9f490a19-5528-465c-84b3-34241c47dd19"}],"repeat":false,"expressions":{},"classes":"accord","_auto_id_":"7e34c96b-1661-40ff-8920-41d5a4db0751"},{"name":"button_bar_yesandno","type":"area","item-type":"button-bar","_auto_id_":"a2f6d9c5-42a8-4e77-8ff8-35aa7d5fb8f8","extends":{"type":"area","item-type":"row"},"content":[{"name":"popupBack_NOT_USED","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"34a6b565-3a09-418c-b2c0-9c5d80692bc5","content":"<h2>Cancel Dialog+ Form</h2>\n<p>You are about to cancel the completion of the Dialog+ form. Any information you have entered will be lost.</p>\n<p>Do you want to continue? </p>","expressions":{}},{"name":"button_yes","type":"button","item-type":"button","_auto_id_":"e8e432e4-0ffc-4f5f-b3b1-5d74ac7f9f51","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"fn_resetCurrentDialogPlus"},"_auto_id_":"a5e99650-3acc-4021-9b8e-34d55f74a741"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.dialogIsReadOnly) {\n  \n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n  \n} else {\n  \n  cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormPre\"})\n}\n\ncti.store.variables.dialogIsReadOnly = false\n\ncti.store.variables.dialogFormFirstRun = false"},"_auto_id_":"5ea36e8b-777d-4a3b-bd2f-1b7190c1cbf1"}],"classes":"default"},{"name":"button_no","type":"button","item-type":"button","_auto_id_":"027e0e8e-f8a2-4466-9343-e155cc69afc1","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"935daf81-7b5b-49c8-94da-42adac187bc1","function":"toggle"},"_auto_id_":"7f751503-9cb2-4ea5-9960-fa28822ae6be"}]}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"935daf81-7b5b-49c8-94da-42adac187bc1","attributes":{"id":"popupBack"},"expressions":{}}],"expressions":{}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"confirmPopup","type":"component","item-type":"web-component","content":[{"name":"html_confirm","type":"content","item-type":"html","_auto_id_":"06e23363-f11e-4599-8941-c5ddcebeea1d","content":"Are you sure you would like to submit?","expressions":{}},{"name":"button_bar_yesno","type":"area","item-type":"group","_auto_id_":"7b17fdd4-5379-4369-aff0-6aace07d3d02","content":[{"name":"button_cancel","type":"button","item-type":"button","_auto_id_":"3c70d16f-0564-43d2-8fb9-f2e47c68609b","content":"CANCEL","theme":"default","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"85b0add9-2090-4e28-ae59-82eed0e70936","function":"toggle"},"_auto_id_":"71bc5c11-b98a-44d1-806a-198ad2a1c8e1"}],"expressions":{}},{"name":"button_continue","type":"button","item-type":"button","_auto_id_":"bf5ee85a-6c5e-490f-9ad6-cbee692fc686","content":"CONTINUE","theme":"default","actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"85b0add9-2090-4e28-ae59-82eed0e70936","function":"toggle"},"_auto_id_":"081d52e7-5a66-442a-935e-b8ff7476afd7"},{"event":"click","type":"call-actionflow","data":{"name":"SubmitDialogForm"},"_auto_id_":"266ab94d-9936-48e6-ad44-ec98eb85ef95"}],"expressions":{},"classes":"default"}],"repeat":false,"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"85b0add9-2090-4e28-ae59-82eed0e70936","attributes":{"id":"confirmPopup"},"actions":[],"expressions":{}},{"name":"button_previous","type":"button","item-type":"button","_auto_id_":"c63ed330-0723-4bdb-9517-e9f0ca8ca778","content":"PREVIOUS","theme":"default","expressions":{"show":"0"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormPre\"})"},"_auto_id_":"fe5cbb56-f6e9-4357-8e63-842af6e6b80b","actions":[]}],"classes":"default"},{"name":"button_next","type":"button","item-type":"button","_auto_id_":"45670b15-36cc-45c5-8c03-2292f7682404","content":"COMPLETE FORM","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"DialogFormOne","componentInstanceId":"85b0add9-2090-4e28-ae59-82eed0e70936","function":"toggle"},"_auto_id_":"2c33dfe6-246f-4ae4-b677-5df13f92b59f"}],"classes":"default"}],"_auto_id_":"acd1b8a3-cbe1-4d01-af5c-9d8ff8f34efa","expressions":{"show":"$store.variables.dialogIsReadOnly != true"}}],"_auto_id_":"eb7a123b-596d-4cd2-8d8b-88ace3d732a6"},{"start":false,"name":"Debug","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"3ce50651-990d-4243-b93a-0547aff5c5aa","attributes":{},"expressions":{}},{"name":"button_back","type":"button","item-type":"button","_auto_id_":"2b4cda31-1f75-4ac3-9c27-338859a3ecef","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visits","isConditional":false},"_auto_id_":"db6c16fc-1680-44e7-bb44-112cf757f1e3"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Debug</h4>","_auto_id_":"8577ce02-79f8-4676-8306-0f885bf1683d"}],"_auto_id_":"672e5781-ebc6-4b1b-b316-c5c54e591d39","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"b761fdaf-2ed7-42b3-8d34-f47630ab44a3","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"7e99ba3a-7edd-45ca-9a25-bdcef89eced4","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.displayName' | store}}</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.hasAlerts == true ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"28de3fc8-2875-47a1-b35c-c44986bc25ef","content":[{"name":"list_41","type":"content","item-type":"list","_auto_id_":"3b0ffd5f-7766-41b6-aae5-67bd6f34c928","static":false,"model":"$store.debug","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"html_123","type":"content","item-type":"html","_auto_id_":"f9a4d4c0-8c77-4926-a857-dda024d5bcde","content":"<p>Debug: {{$data.$item.debug}}</p>"}],"dataSource":"dynamic"}],"expressions":{}}],"_auto_id_":"52a80a39-7b6e-400b-ac81-ce8fa30c13ac"},{"start":false,"name":"About","config":[],"content":[{"name":"main","type":"area","item-type":"scrollable","_auto_id_":"9fa10436-c6bd-42a9-bbe8-4e1afbb27766","content":[{"name":"title","type":"content","item-type":"html","_auto_id_":"67aa474c-8639-477c-bae1-f6f6450ff249","content":"<h2>About</h2>","expressions":{}},{"name":"applicationData","type":"content","item-type":"list","_auto_id_":"5ffcdd43-657e-49a2-98c3-34a2d42353b9","static":false,"model":"$store.variables.applicationData","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"detail","type":"content","item-type":"html","_auto_id_":"c4676648-56d5-4eb7-81ba-4e46810758d1","content":"<div class=\"application-data-item\">\n  <div class=\"application-data-item-name\">{{$data.$item.name}}:</div>\n  <div class=\"application-data-item-value\">{{$data.$item.value}}</div>\n</div>","expressions":{}}],"dataSource":"dynamic","expressions":{}},{"name":"btnClose","type":"button","item-type":"button","_auto_id_":"44f5d854-ec46-4e9a-bfe1-9515e5e695ff","content":"Close","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"let stack = false\ntry {\n  stack = JSON.parse(localStorage.Community_Worker_stack)\n} catch(e) {}\n\nlet lastPage = \"Visits\"\nif (stack) {\n  lastPage = stack[stack.length-2].replace(/\\//, \"\")\n}\n\ncti.utils.callAction('go-to-page', {name: lastPage})"},"_auto_id_":"7a62cdfd-8163-416c-b8be-ddd81097f3c1"}]}],"expressions":{}}]}],"actionflows":[{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (window.debug_safety) {\n    debugger\n}\n\nwindow.logManager.consoleLog(\n    'API Call: submitsafetyform - Sending...', \n    'info'\n  )\n  \n  cti.fn_toggle_spinner('open', 'Submitting My Safety Form, please wait...')\n  \n  cti.store.variables.selected_visit.safety_form_status = \"sending\";\n  cti.store.variables.selected_visit.safety_form_status_text = \"Syncing form to RiO\";\n  \n  // Set payload\n  var payload = {\n    appointmentId : \"\",\n    clientId : {},\n    authorId : null,\n    referralId: \"\",\n    AssessmentDate : \"\",\n    Triggers : \"\",\n    TriggersAP : \"\",\n    Contact : \"\",\n    ContReach : \"\",\n    OutofCrisis : \"\",\n    EarlyWS : \"\",\n    GetWorseAP : \"\",\n    GetWorse : \"\",\n    EarlyWSAP : \"\",\n    Decisions : \"\",\n    AdvDir : \"\",\n    SUAgree : \"\",\n    CrisisNo : \"\"\n  }\n  \n  // Set variables for the safety form page, current appointment and\n  // the payload submission object\n  var safetyForm = cti.store.pages.SafetyForm\n  var appointment = cti.store.variables.selected_visit\n  \n  // Set the clientId and AssessmentDate elements\n  payload.appointmentId = appointment.appointmentId\n  payload.clientId = appointment.attendees.attendee.clientId\n  payload.referralId = appointment.attendees.attendee.referral.referralId || \"\"\n  payload.AssessmentDate = moment().format('YYYY-MM-DD HH:mm:ss')\n  \n  // Check that we have a valid page source\n  if(safetyForm === undefined) {\n    safetyForm = {}\n  }\n  \n  // Check the Triggers input element\n  if(safetyForm.sf_triggers) {\n    payload.Triggers = safetyForm.sf_triggers\n  }\n  // Check the Triggers Action Plan input element\n  if(safetyForm.sf_triggers_actionplan) {\n    payload.TriggersAP = safetyForm.sf_triggers_actionplan\n  }\n  // Check the Contact input element\n  if(safetyForm.sf_contact) {\n    payload.Contact = safetyForm.sf_contact\n  }\n  // Check the Contact Reachable input element\n  if(safetyForm.sf_contactreach) {\n    payload.ContReach = safetyForm.sf_contactreach\n  }\n  // Check the Out of Crisis input element\n  if(safetyForm.sf_outofcrisis) {\n    payload.OutofCrisis = safetyForm.sf_outofcrisis\n  }\n  // Check the Early Warning input element\n  if(safetyForm.sf_earlyws) {\n    payload.EarlyWS = safetyForm.sf_earlyws\n  }\n  // Check the Getting Worse input element\n  if(safetyForm.sf_getworse) {\n    payload.GetWorse = safetyForm.sf_getworse\n  }\n  // Check the Getting Worse Action Plan input element\n  if(safetyForm.sf_getworse_actionplan) {\n    payload.GetWorseAP = safetyForm.sf_getworse_actionplan\n  }\n  // Check the Early Warnings Action Plan input element\n  if(safetyForm.sf_earlyws_actionplan) {\n    payload.EarlyWSAP = safetyForm.sf_earlyws_actionplan\n  }\n  // Check the Decisions input element\n  if(safetyForm.sf_assisteddecision) {\n    payload.Decisions = safetyForm.sf_assisteddecision\n  }\n  // Check the Advance Directive boolean\n  if(safetyForm.sf_advancedirective) {\n    payload.AdvDir = \"True\"\n  } else {\n    payload.AdvDir = \"False\"\n  }\n  // Check the Service User Agreed boolean\n  if(safetyForm.sf_serviceuseragreedplan) {\n    payload.SUAgree = \"True\"\n  } else {\n    payload.SUAgree = \"False\"\n  }\n  // Check the Crisis Number input element\n  if(safetyForm.sf_crisisnumber) {\n    payload.CrisisNo = safetyForm.sf_crisisnumber\n  }\n  \n  // Set the payload parameter in the store\n  cti.store.variables.v_submitSafetyFormPayload = payload\n\n  console.log(`Safety form payload:`, `${JSON.stringify(payload)}`)\n  \n  setTimeout(function(){ \n    cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n  }, 3000)\n  \n  $success()"},"_auto_id_":"f0f462db-7d94-4ebc-9377-28d53d109ce7","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"submitsafetyform","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_submitSafetyFormPayload}}"}},"_auto_id_":"990edcc0-a830-43d9-91fa-ac9c39655ea8","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Grab response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif(!response.success) {  \n  cti.fn_toggle_spinner('close')\n\n  window.logManager.consoleLog(\n    'API CALL: submitsafetyform FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Unable to submit Safety Form: \" + response.message\n  })\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    cti.store.variables.selected_visit.safety_form_status = \"failed\"\n    cti.store.variables.selected_visit.safety_form_status_text = \"Failed to Upload My Safety Plan, tap to retry...\"\n  }\n} else {\n  window.logManager.consoleLog(\n    'API CALL: submitsafetyform SUCCESS', \n    'info'\n  )\n\n  var currentFormLength = 0\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentFormLength = cti.store.variables.selected_visit.patientData.mySafetyPlanForms.length\n\n    if(response.data != undefined && response.data.length >= currentFormLength) {\n      cti.store.variables.selected_visit.patientData.mySafetyPlanForms = response.data\n    }\n\n    for (var i in cti.store.variables.selected_visit.patientData.mySafetyPlanForms) {\n      var safetyForm = cti.store.variables.selected_visit.patientData.mySafetyPlanForms[i];\n\n      safetyForm.assessmentDate.displayDate = moment(safetyForm.assessmentDate.result).format(\"DD MMM YYYY HH:mm\");\n    }\n\n    cti.store.variables.selected_visit.safety_form_status = \"complete\"\n    cti.store.variables.selected_visit.safety_form_status_text = \"Completed\"\n\n    delete cti.store.variables.selected_visit.safety_form_page\n    cti.store.variables.v_submitSafetyFormPayload_clear = true\n  } else {\n    cti.fn_update_patient_data(response.clientId.value, 'safety', response.data, response.appointmentId)\n  }\n\n  cti.store.variables.v_submitSafetyFormPayload_clear = true\n}\n\ndelete cti.store.variables.v_submitSafetyFormPayload\ndelete cti.store.offlineApi.api_rio_offline.submitsafetyform\n\ncti.utils.updatePage()"},"_auto_id_":"47b6507d-5dfe-4f48-9053-6f7d482daaa0"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog(\n  'API CALL: submitsafetyform FAILED - Reason: ' + response.message, \n  'error'\n)\n\n// Notifiy user of failed submission\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to submit Safety Form: \" + response.message\n})\n\n// Set status to failed\ncti.store.variables.selected_visit.safety_form_status = \"failed\"\ncti.store.variables.selected_visit.safety_form_status_text = \"Failed to Upload My Safety Plan, tap to retry...\"\n\ndelete cti.store.variables.v_submitSafetyFormPayload\ndelete cti.store.offlineApi.api_rio_offline.submitsafetyform\n\ncti.utils.updatePage()"},"_auto_id_":"29d7700d-cfac-435c-a080-2976fe8521cb"}]}],"name":"SubmitSafetyForm"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (window.debug_dialog) {\n    debugger\n  }\n  \n  window.logManager.consoleLog('API Call: submitdialogForm - Sending...', 'info')\n  \n  cti.fn_toggle_spinner('open', 'Submitting Dialog+ Form, please wait...')\n  \n  cti.store.variables.selected_visit.dialog_form_status = 'sending'\n  cti.store.variables.selected_visit.dialog_form_status_text = 'Syncing form to RiO'\n  \n  // Set payload\n  var payload = {\n    appointmentId: '',\n    clientId: {},\n    authorId: null,\n    referralId: '',\n    AssessmentDate: '',\n    MHSkills: '',\n    SUCap: '',\n    RCYN: '',\n    SUYN: '',\n    MHRecovery: '',\n    MHMatters: '',\n    MHSatActions: '',\n    PHSatActions: '',\n    JSSatActions: '',\n    LASatActions: '',\n    RSSatActions: '',\n    FSSatActions: '',\n    PSSatActions: '',\n    FISatActions: '',\n    CNSatActions: '',\n    SUSatActions: '',\n    MDSatActions: '',\n    PRSatActions: '',\n    MPSatActions: '',\n    JSSatPL: '',\n    PHSatPL: '',\n    ACSatPL: '',\n    LASatPL: '',\n    RSSatPL: '',\n    FSSatPL: '',\n    PSSatPL: '',\n    FISatPL: '',\n    SUSatPL: '',\n    CNSatPL: '',\n    MDSatPL: '',\n    PRSatPL: '',\n    MPSatPL: '',\n    MHSat1: '',\n    ACSatActions: '',\n    RevUnplan: '',\n    CareDecUnplan: '',\n    CareDec: '',\n    InCareDec: '',\n    Funded: '',\n    SUDisagree: '',\n    StageTreat: '',\n    StageTreat1: '',\n    NxtRev: '',\n    S117Comm: '',\n    CarerView: '',\n    MHSatHelp: '',\n    JSSatHelp: '',\n    ACSatHelp: '',\n    LASatHelp: '',\n    RSSatHelp: '',\n    FSSatHelp: '',\n    PSSatHelp: '',\n    FISatHelp: '',\n    CNSatHelp: '',\n    SUSatHelp: '',\n    MDSatHelp: '',\n    PRSatHelp: '',\n    MPSatHelp: '',\n    PHSatHelp: '',\n    CPAAttend: []\n  }\n  \n  // Set variables for the form page, current appointment and\n  // the payload submission object\n  var dialogForms = []\n  \n  var dialogFormOne = cti.store.pages.DialogFormOne || {}\n  dialogForms.push(dialogFormOne)\n  \n  var dialogFormPre = cti.store.pages.DialogFormPre || {}\n  dialogForms.push(dialogFormPre)\n  \n  var dialogForm = dialogForms.reduce(function(result, currentObject) {\n    for (var key in currentObject) {\n      if (currentObject.hasOwnProperty(key)) {\n        result[key] = currentObject[key]\n      }\n    }\n  \n    return result\n  }, {})\n  \n  // Add any CPA attendees (stored in the repeater)...\n  //\n  // CPAAttend : [\n  //   {\n  //     CPAAttendRow : {\n  //       Design : \"\",\n  //       Name : \"\",\n  //       SentCopy : \"\",\n  //       YNPresent :  \"\"\n  //     }\n  //   }\n  // ]\n  const YES_CODE = 'V8aa'\n  const NO_CODE = 'V8ab'\n  \n  if (cti.store.repeater.DialogFormPre && cti.store.repeater.DialogFormPre.grpCPAMeetingAttendees) {\n    cti.store.repeater.DialogFormPre.grpCPAMeetingAttendees.forEach(a => {\n      payload.CPAAttend.push({\n        CPAAttendRow: {\n          Design: a.CPAMeetingAttendeeDesRel || \"\",\n          Name: a.CPAMeetingAttendeeName,\n          SentCopy: a.CPAMeetingAttendeeCopy === 'yes' ? YES_CODE : NO_CODE,\n          YNPresent: a.CPAMeetingAttendeePresent === 'yes' ? YES_CODE : NO_CODE\n        }\n      })\n    })\n  }\n  \n  var appointment = cti.store.variables.selected_visit\n  \n  // Set the clientId, referralId and AssessmentDate elements\n  payload.appointmentId = appointment.appointmentId\n  payload.clientId = appointment.attendees.attendee.clientId\n  payload.referralId = appointment.attendees.attendee.referral.referralId || \"\"\n  payload.AssessmentDate = moment().format('YYYY-MM-DD HH:mm:ss')\n  \n  // Check that we have a valid page source\n  if (dialogForm === undefined) {\n    dialogForm = {}\n  }\n  \n  if (dialogForm.MHSkills) {\n    payload.MHSkills = dialogForm.MHSkills\n  }\n  \n  if (dialogForm.SUCap) {\n    payload.SUCap = dialogForm.SUCap.value\n  }\n  \n  if (dialogForm.RCYN) {\n    payload.RCYN = dialogForm.RCYN === 'yes' ? '1' : '2'\n  }\n  \n  if (dialogForm.SUYN) {\n    payload.SUYN = dialogForm.SUYN === 'yes' ? '1' : '2'\n  }\n  \n  if (dialogForm.MHRecovery) {\n    payload.MHRecovery = dialogForm.MHRecovery\n  }\n  \n  if (dialogForm.MHMatters) {\n    payload.MHMatters = dialogForm.MHMatters\n  }\n  \n  if (dialogForm.MHSatActions) {\n    payload.MHSatActions = dialogForm.MHSatActions\n  }\n  \n  if (dialogForm.PHSatActions) {\n    payload.PHSatActions = dialogForm.PHSatActions\n  }\n  \n  if (dialogForm.JSSatActions) {\n    payload.JSSatActions = dialogForm.JSSatActions\n  }\n  \n  if (dialogForm.LASatActions) {\n    payload.LASatActions = dialogForm.LASatActions\n  }\n  \n  if (dialogForm.RSSatActions) {\n    payload.RSSatActions = dialogForm.RSSatActions\n  }\n  \n  if (dialogForm.FSSatActions) {\n    payload.FSSatActions = dialogForm.FSSatActions\n  }\n  \n  if (dialogForm.PSSatActions) {\n    payload.PSSatActions = dialogForm.PSSatActions\n  }\n  \n  if (dialogForm.FISatActions) {\n    payload.FISatActions = dialogForm.FISatActions\n  }\n  \n  if (dialogForm.CNSatActions) {\n    payload.CNSatActions = dialogForm.CNSatActions\n  }\n  \n  if (dialogForm.SUSatActions) {\n    payload.SUSatActions = dialogForm.SUSatActions\n  }\n  \n  if (dialogForm.MDSatActions) {\n    payload.MDSatActions = dialogForm.MDSatActions\n  }\n  \n  if (dialogForm.PRSatActions) {\n    payload.PRSatActions = dialogForm.PRSatActions\n  }\n  \n  if (dialogForm.MPSatActions) {\n    payload.MPSatActions = dialogForm.MPSatActions\n  }\n  \n  const getSliderResult = (slider) => {\n      if (dialogForm[`${slider}DeclinedToAnswer`] && dialogForm[`${slider}DeclinedToAnswer`].selected) {\n          return '8'\n      }\n      return dialogForm[`${slider}Pl`] && dialogForm[`${slider}Pl`].toString() || ''\n  }\n  \n  payload.ACSatPL = getSliderResult('ACSat')\n  payload.CNSatPL = getSliderResult('CNSat')\n  payload.FISatPL = getSliderResult('FISat')\n  payload.FSSatPL = getSliderResult('FSSat')\n  payload.JSSatPL = getSliderResult('JSSat')\n  payload.LASatPL = getSliderResult('LASat')\n  payload.MDSatPL = getSliderResult('MDSat')\n  payload.MHSat1  = getSliderResult('MHSat')\n  payload.MPSatPL = getSliderResult('MPSat')\n  payload.PHSatPL = getSliderResult('PHSat')\n  payload.PRSatPL = getSliderResult('PRSat')\n  payload.PSSatPL = getSliderResult('PSSat')\n  payload.RSSatPL = getSliderResult('RSSat')\n  payload.SUSatPL = getSliderResult('SUSat')\n  \n  if (dialogForm.ACSatActions) {\n    payload.ACSatActions = dialogForm.ACSatActions\n  }\n  \n  payload.RevUnplan = !!(dialogForm.RevUnplan && dialogForm.RevUnplan.yes)\n  \n  if (dialogForm.CareDecUnplan) {\n    payload.CareDecUnplan = dialogForm.CareDecUnplan.value\n  }\n  \n  if (dialogForm.CareDec) {\n    payload.CareDec = dialogForm.CareDec.value\n  }\n  \n  if (dialogForm.InCareDec) {\n    payload.InCareDec = dialogForm.InCareDec.value\n  }\n  \n  if (dialogForm.Funded) {\n    payload.Funded = dialogForm.Funded.value\n  }\n  \n  if (dialogForm.SUDisagree) {\n    payload.SUDisagree = dialogForm.SUDisagree\n  }\n  \n  if (dialogForm.StageTreat) {\n    payload.StageTreat = dialogForm.StageTreat\n  }\n  \n  if (dialogForm.StageTreat1) {\n    payload.StageTreat1 = dialogForm.StageTreat1.value\n  }\n  \n  if (dialogForm.NxtRev) {\n    payload.NxtRev = dialogForm.NxtRev\n  }\n  \n  if (dialogForm.S117Comm) {\n    payload.S117Comm = dialogForm.S117Comm\n  }\n  \n  if (dialogForm.CarerView) {\n    payload.CarerView = dialogForm.CarerView\n  }\n  \n  if (dialogForm.MHSatHelp) {\n    payload.MHSatHelp = dialogForm.MHSatHelp\n  }\n  \n  if (dialogForm.JSSatHelp) {\n    payload.JSSatHelp = dialogForm.JSSatHelp\n  }\n  \n  if (dialogForm.ACSatHelp) {\n    payload.ACSatHelp = dialogForm.ACSatHelp\n  }\n  \n  if (dialogForm.LASatHelp) {\n    payload.LASatHelp = dialogForm.LASatHelp\n  }\n  \n  if (dialogForm.RSSatHelp) {\n    payload.RSSatHelp = dialogForm.RSSatHelp\n  }\n  \n  if (dialogForm.FSSatHelp) {\n    payload.FSSatHelp = dialogForm.FSSatHelp\n  }\n  \n  if (dialogForm.PSSatHelp) {\n    payload.PSSatHelp = dialogForm.PSSatHelp\n  }\n  \n  if (dialogForm.FISatHelp) {\n    payload.FISatHelp = dialogForm.FISatHelp\n  }\n  \n  if (dialogForm.CNSatHelp) {\n    payload.CNSatHelp = dialogForm.CNSatHelp\n  }\n  \n  if (dialogForm.SUSatHelp) {\n    payload.SUSatHelp = dialogForm.SUSatHelp\n  }\n  \n  if (dialogForm.MDSatHelp) {\n    payload.MDSatHelp = dialogForm.MDSatHelp\n  }\n  \n  if (dialogForm.PRSatHelp) {\n    payload.PRSatHelp = dialogForm.PRSatHelp\n  }\n  \n  if (dialogForm.MPSatHelp) {\n    payload.MPSatHelp = dialogForm.MPSatHelp\n  }\n  \n  if (dialogForm.PHSatHelp) {\n    payload.PHSatHelp = dialogForm.PHSatHelp\n  }\n  \n  // Set the payload parameter in the store\n  cti.store.variables.v_submitDialogFormPayload = payload\n  \n  cti.store.variables.dialogFormFirstRun = false\n  \n  console.log(`DIALOG+ form payload:`, `${JSON.stringify(payload)}`)\n  \n  setTimeout(function() {\n    cti.utils.callAction('go-to-page', { name: 'Visit' })\n  }, 3000)\n  \n  $success()"},"_auto_id_":"b4a9ac90-6907-4dca-8240-1052014ecfb0","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"submitdialogform","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_submitDialogFormPayload}}"}},"_auto_id_":"bfd68fc7-b788-42dd-8fb1-3e46ce090759","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Dialog response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif(!response.success) {  \n  cti.fn_toggle_spinner('close')\n\n  window.logManager.consoleLog(\n    'API CALL: submitdialogform FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Dialog+ Form Submission Failed\", \n    \"text\" : \"Unable to submit Dialog+ Form: \" + response.message\n  })\n\n  if(selected_visit && selected_visit.attendees && selected_visit.attendees.attendee) {\n    \n    if(response.clientId === undefined || (response.clientId && response.clientId.value == selected_visit.attendees.attendee.clientId.value)) {\n      cti.store.variables.selected_visit.dialog_form_status = \"failed\"\n      cti.store.variables.selected_visit.dialog_form_status_text = \"Failed to Upload Dialog+, tap to retry...\"\n    }\n  }\n} else {\n  window.logManager.consoleLog(\n    'API CALL: submitdialogform SUCCESS', \n    'info'\n  )\n\n  var currentFormLength = 0\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentFormLength = cti.store.variables.selected_visit.patientData.dialogPlusForms.length\n\n    if(response.data != undefined && response.data.length >= currentFormLength) {\n      cti.store.variables.selected_visit.patientData.dialogPlusForms = response.data\n    }\n\n    for (var i in cti.store.variables.selected_visit.patientData.dialogPlusForms) {\n      var dialogForm = cti.store.variables.selected_visit.patientData.dialogPlusForms[i];\n\n      dialogForm.assessmentDate.displayDate = moment(dialogForm.assessmentDate.result).format(\"DD MMM YYYY HH:mm\");\n    }\n\n    cti.store.variables.selected_visit.dialog_form_status = \"complete\"\n    cti.store.variables.selected_visit.dialog_form_status_text = \"Completed\"\n\n    delete cti.store.variables.selected_visit.dialog_form_page\n    cti.store.variables.v_submitDialogFormPayload_clear = true\n  } else {\n    cti.fn_update_patient_data(response.clientId.value, 'dialog', response.data, response.appointmentId)\n  }\n\n  cti.store.variables.v_submitDialogFormPayload_clear = true\n}\n\ndelete cti.store.variables.v_submitDialogFormPayload\ndelete cti.store.offlineApi.api_rio_offline.submitdialogform\n\ncti.utils.updatePage()"},"_auto_id_":"947ab400-e860-4382-b4e9-f689fad177a2"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog(\n  'API CALL: submitdialogform FAILED - Reason: ' + response.message, \n  'error'\n)\n\n// Notify the user of failed submission\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to submit Dialog+ Form: \" + response.message\n})\n\n// Set status to failed\ncti.store.variables.selected_visit.dialog_form_status = \"failed\";\ncti.store.variables.selected_visit.dialog_form_status_text = \"Failed to Upload Dialog+, tap to retry...\";\n\ndelete cti.store.variables.v_submitDialogFormPayload\ndelete cti.store.offlineApi.api_rio_offline.submitdialogform\n\ncti.utils.updatePage()"},"_auto_id_":"1a8b62df-e9f1-45d0-b5dd-7e245aabdc3f"}]}],"name":"SubmitDialogForm"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (window.debug_lifestyle) {\n    debugger\n}\n  \n  window.logManager.consoleLog(\n    'API Call: submitlifestyleform - Sending...', \n    'info'\n  )\n\n   \n  cti.fn_toggle_spinner('open', 'Submitting Lifestyle Form, please wait...')\n  \n  cti.store.variables.selected_visit.lifestyle_form_status = \"sending\"\n  cti.store.variables.selected_visit.lifestyle_form_status_text = \"Syncing form to RiO\"\n  \n  // Set payload\n  var payload = {\n    appointmentId : \"\",\n    clientId : {},\n    authorId : null,\n    referralId: '',\n    admissionassess : \"\",\n    AssessmentDate : \"\",\n    assessmentstatus : \"\",\n    lssmoked : \"\",\n    lscigperday : \"\",\n    smokeadvice : \"\",\n    Refsmoke : \"\",\n    StopSmoke : \"\",\n    smokeintoffer : \"\",\n    smokefreetext1 : \"\",\n    diethealthy : \"\",\n    lsdietcomment : \"\",\n    dietintervention : \"\",\n    dietintdetails : \"\",\n    regularexercise : \"\",\n    exintoffer : \"\",\n    intdetails : \"\",\n    alcCurrentUser : \"\",\n    withdrawal : \"\",\n    alcHowOften : \"\",\n    alcHowManyUnits : \"\",\n    alcExceedUnits : \"\",\n    alcIntervention : \"\",\n    alcintdetail : \"\",\n    alcFurtherInfo : \"\",\n    recdruguse : \"\",\n    drugintoffer : \"\",\n    drugintdetails : \"\",\n    menwellbeing : \"\",\n    signpost : \"\",\n    signdetail : \"\",\n    addcomm : \"\",\n    exercise: [],\n    recdrugstab: []\n  }\n  \n  // Set variables for the form page, current appointment and\n  // the payload submission object\n  var lifestyleForms = []\n  var lifestyleFormOne = cti.store.pages.LifestyleFormOne\n  lifestyleForms.push(lifestyleFormOne)\n  var lifestyleFormTwo = cti.store.pages.LifestyleFormTwo\n  lifestyleForms.push(lifestyleFormTwo)\n  var lifestyleFormThree = cti.store.pages.LifestyleFormThree\n  lifestyleForms.push(lifestyleFormThree)\n  var lifestyleFormFour = cti.store.pages.LifestyleFormFour\n  lifestyleForms.push(lifestyleFormFour)\n  var lifestyleFormFive = cti.store.pages.LifestyleFormFive\n  lifestyleForms.push(lifestyleFormFive)\n  var lifestyleFormSix = cti.store.pages.LifestyleFormSix\n  lifestyleForms.push(lifestyleFormSix)\n  \n  var lifestyleForm = lifestyleForms.reduce(function(result, currentObject) {\n      for(var key in currentObject) {\n          if (currentObject.hasOwnProperty(key)) {\n              result[key] = currentObject[key]\n          }\n      }\n    \n      return result\n  }, {})\n  \n  var appointment = cti.store.variables.selected_visit\n  var repeater = cti.store.repeater\n  \n  if(repeater && repeater.LifestyleFormThree && repeater.LifestyleFormThree.exercise_repeater) {\n    var lifestyleExerciseRepeater = JSON.parse(JSON.stringify(repeater.LifestyleFormThree.exercise_repeater))\n  }\n  if(repeater && repeater.LifestyleFormFive && repeater.LifestyleFormFive.drugs_group) {\n    var lifestyleDrugRepeater = JSON.parse(JSON.stringify(repeater.LifestyleFormFive.drugs_group))\n  }\n  \n  // Set the clientId and AssessmentDate elements\n  payload.appointmentId = appointment.appointmentId\n  payload.clientId = appointment.attendees.attendee.clientId\n  payload.referralId = appointment.attendees.attendee.referral.referralId || \"\"\n  payload.AssessmentDate = moment().format('YYYY-MM-DD HH:mm:ss')\n  \n  // Check that we have a valid page source\n  if(lifestyleForm === undefined) {\n    lifestyleForm = {}\n  }\n  \n  // Check the admissionassess input element\n  if(lifestyleForm.admissionassess) {\n    payload.admissionassess = lifestyleForm.admissionassess\n  }\n  // Check the assessmentstatus input element\n  if(lifestyleForm.assessmentstatus) {\n    payload.assessmentstatus = lifestyleForm.assessmentstatus.value\n  }\n  // Check the lssmoked input element\n  if(lifestyleForm.lssmoked) {\n    payload.lssmoked = lifestyleForm.lssmoked.value\n  }\n  // Check the lscigperday input element\n  if(lifestyleForm.lscigperday) {\n    payload.lscigperday = lifestyleForm.lscigperday\n  }\n  // Check the smokeadvice input element\n  if(lifestyleForm.smokeadvice) {\n    payload.smokeadvice = lifestyleForm.smokeadvice\n  }\n  // Check the Refsmoke input element\n  if(lifestyleForm.Refsmoke) {\n    payload.Refsmoke = lifestyleForm.Refsmoke.value\n  }\n  // Check the StopSmoke input element\n  if(lifestyleForm.StopSmoke) {\n    payload.StopSmoke = lifestyleForm.StopSmoke.value\n  }\n  // Check the smokeintoffer input element\n  if(lifestyleForm.smokeintoffer) {\n    payload.smokeintoffer = lifestyleForm.smokeintoffer.value\n  }\n  // Check the smokefreetext1 input element\n  if(lifestyleForm.smokefreetext1) {\n    payload.smokefreetext1 = lifestyleForm.smokefreetext1\n  }\n  // Check the diethealthy input element\n  if(lifestyleForm.diethealthy) {\n    payload.diethealthy = lifestyleForm.diethealthy.value\n  }\n  // Check the lsdietcomment input element\n  if(lifestyleForm.lsdietcomment) {\n    payload.lsdietcomment = lifestyleForm.lsdietcomment\n  }\n  // Check the dietintervention input element\n  if(lifestyleForm.dietintervention) {\n    payload.dietintervention = lifestyleForm.dietintervention.value\n  }\n  // Check the dietintdetails input element\n  if(lifestyleForm.dietintdetails) {\n    payload.dietintdetails = lifestyleForm.dietintdetails\n  }\n  // Check the regularexercise input element\n  if(lifestyleForm.regularexcercise) {\n    payload.regularexercise = lifestyleForm.regularexcercise.value\n  }\n  // Check the exintoffer input element\n  if(lifestyleForm.exintoffer) {\n    payload.exintoffer = lifestyleForm.exintoffer.value\n  }\n  // Check the intdetails input element\n  if(lifestyleForm.intdetails) {\n    payload.intdetails = lifestyleForm.intdetails\n  }\n  // Check the alcCurrentUser input element\n  if(lifestyleForm.alcCurrentUser) {\n    payload.alcCurrentUser = lifestyleForm.alcCurrentUser\n  }\n  // Check the withdrawal input element\n  if(lifestyleForm.withdrawal) {\n    payload.withdrawal = lifestyleForm.withdrawal\n  }\n  // Check the alcHowOften input element\n  if(lifestyleForm.alcHowOften) {\n    payload.alcHowOften = lifestyleForm.alcHowOften.value\n  }\n  // Check the alcHowManyUnits input element\n  if(lifestyleForm.alcHowManyUnits) {\n    payload.alcHowManyUnits = lifestyleForm.alcHowManyUnits.value\n  }\n  // Check the alcExceedUnits input element\n  if(lifestyleForm.alcExceedUnits) {\n    payload.alcExceedUnits = lifestyleForm.alcExceedUnits.value\n  }\n  // Check the alcIntervention input element\n  if(lifestyleForm.alcIntervention) {\n    payload.alcIntervention = lifestyleForm.alcIntervention.value\n  }\n  // Check the alcintdetail input element\n  if(lifestyleForm.alcintdetail) {\n    payload.alcintdetail = lifestyleForm.alcintdetail\n  }\n  // Check the alcFurtherInfo input element\n  if(lifestyleForm.alcFurtherInfo) {\n    payload.alcFurtherInfo = lifestyleForm.alcFurtherInfo\n  }\n  // Check the recdruguse input element\n  if(lifestyleForm.recdruguse) {\n    payload.recdruguse = lifestyleForm.recdruguse.value\n  }\n  // Check the drugintoffer input element\n  if(lifestyleForm.drugintoffer) {\n    payload.drugintoffer = lifestyleForm.drugintoffer.value\n  }\n  // Check the drugintdetails input element\n  if(lifestyleForm.drugintdetails) {\n    payload.drugintdetails = lifestyleForm.drugintdetails\n  }\n  // Check the menwellbeing input element\n  if(lifestyleForm.menwellbeing) {\n    payload.menwellbeing = lifestyleForm.menwellbeing.value\n  }\n  // Check the signpost input element\n  if(lifestyleForm.signpost) {\n    payload.signpost = lifestyleForm.signpost.value\n  }\n  // Check the signdetail input element\n  if(lifestyleForm.signdetail) {\n    payload.signdetail = lifestyleForm.signdetail\n  }\n  // Check the addcomm input element\n  if(lifestyleForm.addcomm) {\n    payload.addcomm = lifestyleForm.addcomm\n  }\n  \n  // Have a shufty thru the repeated form elements\n  if (lifestyleDrugRepeater && Object.keys(lifestyleDrugRepeater).length  > 0) {\n    for (var i=0, tot=Object.keys(lifestyleDrugRepeater).length; i < tot; i++) {\n      var temp_recdrugstabRow = {}\n      temp_recdrugstabRow.recdrugstabRow = {}\n      temp_recdrugstabRow.recdrugstabRow = lifestyleDrugRepeater[i]\n      //temp_recdrugstabRow.recdrugstabRow.drugname = temp_recdrugstabRow.recdrugstabRow.drugname.value\n      temp_recdrugstabRow.recdrugstabRow.drugname = lifestyleDrugRepeater[i].drugname.value\n          payload.recdrugstab.push(temp_recdrugstabRow)\n    }\n  }\n  \n  if (lifestyleExerciseRepeater && Object.keys(lifestyleExerciseRepeater).length > 0) {\n    for (var i=0, tot=Object.keys(lifestyleExerciseRepeater).length; i < tot; i++) {\n      var temp_exerciseRow = {}\n      temp_exerciseRow.exerciseRow = {}\n      temp_exerciseRow.exerciseRow = lifestyleExerciseRepeater[i]\n      //temp_exerciseRow.exerciseRow.Intensity = temp_exerciseRow.exerciseRow.Intensity.value\n      temp_exerciseRow.exerciseRow.Intensity = lifestyleExerciseRepeater[i].Intensity.value\n          payload.exercise.push(temp_exerciseRow)\n    }\n  }\n  \n  // Set the payload parameter in the store\n  cti.store.variables.v_submitlifestyleFormPayload = payload\n\n  console.log(`Lifestyle form payload:`, `${JSON.stringify(payload)}`)\n  \n  setTimeout(function(){\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n  }, 3000)\n  \n  $success()"},"_auto_id_":"ed99101c-c19b-4e4f-b49a-7b8dcb67a365","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"submitlifestyleform","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_submitlifestyleFormPayload}}"}},"_auto_id_":"7b3f526b-93fa-4994-a47b-14286fc2864a","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Grab response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif(!response.success) {  \n  cti.fn_toggle_spinner('close')\n\n  window.logManager.consoleLog(\n    'API CALL: submitlifestyleform FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Unable to submit Lifestyle Form: \" + response.message\n  })\n  \n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    selected_visit.lifestyle_form_status = \"failed\"\n    selected_visit.lifestyle_form_status_text = \"Failed to Upload Lifestyle Form data, tap to retry...\"\n  }\n} else {\n  window.logManager.consoleLog(\n    'API CALL: submitlifestyleform SUCCESS', \n    'info'\n  )\n  var currentFormLength = 0\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentFormLength = cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms.length\n\n    if(response.data != undefined && response.data.length >= currentFormLength) {\n      cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms = response.data\n    }\n\n    for (var i in cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms) {\n      var lifestyleForm = cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms[i]\n      var date = lifestyleForm.assessmentDate.result\n\n      lifestyleForm.assessmentDate.displayDate = moment(date).format(\"DD MMM YYYY HH:mm\")\n    }\n    cti.store.variables.selected_visit.lifestyle_form_status = \"complete\"\n    cti.store.variables.selected_visit.lifestyle_form_status_text = \"Completed\"\n\n    delete cti.store.variables.selected_visit.lifestyle_form_page_one\n    delete cti.store.variables.selected_visit.lifestyle_form_page_two\n    delete cti.store.variables.selected_visit.lifestyle_form_page_three\n    delete cti.store.variables.selected_visit.lifestyle_form_page_four\n    delete cti.store.variables.selected_visit.lifestyle_form_page_five\n    delete cti.store.variables.selected_visit.lifestyle_form_page_six\n\n    delete cti.store.variables.selected_visit.lifestyle_form_repeater_three\n    delete cti.store.variables.selected_visit.lifestyle_form_repeater_five\n  } else {\n    cti.fn_update_patient_data(response.clientId.value, 'lifestyle', response.data, response.appointmentId)\n  }\n\n  cti.store.variables.v_submitlifestyleFormPayload_clear = true\n}\n\ndelete cti.store.variables.v_submitlifestyleFormPayload\ndelete cti.store.offlineApi.api_rio_offline.submitlifestyleform\n\ncti.utils.updatePage()"},"_auto_id_":"a6041f37-338e-49cb-bf97-5bf65573a672"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog(\n  'API CALL: submitlifestyleform FAILED - Reason: ' + response.message, \n  'error'\n)\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to submit Lifestyle Form: \" + response.message\n})\n\n// Set the status to failed\ncti.store.variables.selected_visit.lifestyle_form_status = \"failed\";\ncti.store.variables.selected_visit.lifestyle_form_status_text = \"Failed to Upload Lifestyle Form data, tap to retry...\";\n\ndelete cti.store.variables.v_submitlifestyleFormPayload\ndelete cti.store.offlineApi.api_rio_offline.submitlifestyleform\n\ncti.utils.updatePage()"},"_auto_id_":"dbdb2978-e9c6-4737-8da3-7a6599a657de"}]}],"name":"SubmitLifestyleForm"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\"API Call: RegisterPush - Sending...\", \"info\");\n\n// Check for a notification token - can't do anything without it...\nif (!$store.notification.token) {\n  cti.store.variables.v_isAuthenticated = false;\n\n  cti.utils.callAction(\"show-notification\", {\n    name: \"notification_error\",\n    title: \"Notification Token Error\",\n    text: \"Unable to register for push notifications - token does not exist.\"\n  });\n\n  window.logManager.consoleLog(\n    \"API Call: RegisterPush - Notification token does not exist, cannot register for push...\",\n    \"info\"\n  );\n\n  cti.fn_toggle_spinner(\"close\");\n\n  // Allow for local testing...\n  if (window.dev) {\n    cti.store.variables.v_isAuthenticated = true;\n    delete cti.store.variables.shouldRegisterPush;\n\n    if (cti.store.variables.isFirstLogin) {\n      cti.fn_toggle_spinner(\n        \"open\",\n        \"Running as dev so faking /GetStaticData from the RegisterPush actionflow\"\n      );\n      cti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n\n      delete cti.store.variables.isFirstLogin;\n    } else {\n      cti.fn_toggle_spinner(\n        \"open\",\n        \"Running as dev so faking /DiaryInformation from the RegisterPush actionflow\"\n      );\n\n      cti.utils.callAction(\"call-actionflow\", { name: \"DiaryInformation\" });\n    }\n  }\n\n  return false;\n}\n\n$success();\n"},"_auto_id_":"16ec9883-a2ee-4c54-b78f-084159530fdb","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio_main","operation":"pushRegister","params":{"os":"{{$store.env.platform.name}}","notificationToken":"{{$store.notification.token}}","username":"{{$store.variables.loggedInUser}}","registeredPushId":"{{$store.variables.registeredPushId}}","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"9e2cc1ad-69bf-45b8-8034-b9dc0e211d42","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success || !$data.$response.response.RegistrationId){\n  cti.fn_toggle_spinner('close');\n  \n  window.logManager.consoleLog(\n    'API Call: pushRegister FAILED - Reason ' + ($data.$response.message || 'No Message'), \n    'error'\n  );\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Error\" , \n    \"text\" : \"Unable to register for push notifications - cannot log in.\"\n  });\n} else {\n  window.logManager.consoleLog(\n    'API Call: pushRegister SUCCESS', \n    'info'\n  );\n\n  cti.store.variables.registeredPushId = $data.$response.response.RegistrationId\n  \n  cti.fn_toggle_spinner('open', 'Downloading Application Data, please wait...');\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n  $success();\n}"},"_auto_id_":"7645ad84-8344-4c78-8af7-a83b0964333f","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: pushRegister FAILED - Reason ' + ($data.$response.message || 'No Message'), \n  'error'\n);\n\ncti.fn_toggle_spinner('close');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Error\" , \n  \"text\" : \"Unable to register for push notifications - cannot log in.\"\n});"},"_auto_id_":"3de685e6-c18a-4e13-8f2a-ee59d92cfbdf","actions":[]}]}],"name":"RegisterPush"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: push/pushDeregister SUCCESS', \n  'info'\n);\n\n$success()"},"_auto_id_":"4e2cae2a-2be5-4091-9cc3-eff883b3e456","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio_main","operation":"pushDeregister","params":{"registeredPushId":"{{$store.variables.registeredPushId}}","tags":"{{$store.variables.temp_user}}","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"f761a7a6-25a4-4567-97d1-59c62142af03","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: push/pushDeregister SUCCESS', \n  'info'\n);\n\ncti.store.variables.registeredPushId = ''\ncti.store.variables.temp_user = ''\n\n$success()"},"_auto_id_":"7189ce67-8d7b-49ea-bf06-40e7884e202d"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: push/pushDeregister FAILED - Reason ' + $data.$response.message, \n  'info'\n);"},"_auto_id_":"d6e33824-15dd-42cd-b93a-a5c0768549a6"}]}],"name":"DeregisterPush"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(window.debug){\n \tdebugger; \n}\n\nwindow.logManager.consoleLog(\n  'API Call: removealert - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Removing Alert...')\n\nvar payload = {\n  clientId : {},\n  alertId: null,\n  endDateTime: null,\n  comment: null,\n}\n\npayload.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId\npayload.alertId = cti.store.variables.alertToRemove.id\npayload.endDateTime = moment(cti.store.pages.RemoveAlert.date).format(\"YYYY-MM-DD\")\npayload.comment = cti.store.pages.RemoveAlert.description\n                       \ncti.store.variables.v_alertToRemove = payload\n\nsetTimeout(function(){ \n  cti.store.variables.v_alertToRemove_clear = true\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n}, 3000)\n\n$success()"},"_auto_id_":"6f765702-c5cc-4a21-8083-6c1af4efb010","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"removealert","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_alertToRemove}}"}},"_auto_id_":"c855ebb9-be4b-403f-a0f2-e40af8827f23","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"//RemoveAlert response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif(!response.success){\n  window.logManager.consoleLog(\n    'API CALL: removealert FAILED - Reason: ' + response.message || \"No message returned\",  \n    'info'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Remove Alert Failed: \" + response.message || \"No message returned\" \n  })\n} else {\n  var currentAlerts = []\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentAlerts = cti.store.variables.selected_visit.patientData.alerts\n\n    if(response.data != undefined) {\n      if(response.data.patientAlerts != undefined) {\n        if(response.data.patientAlerts.patientAlert != undefined) {\n          if(response.data.patientAlerts.patientAlert instanceof Array) {\n            currentAlerts = response.data.patientAlerts.patientAlert\n          } else {\n            currentAlerts = []\n            currentAlerts.push(response.data.patientAlerts.patientAlert)\n          }\n\n          // Re-order alerts array\n          currentAlerts.sort(function(a, b) {\n            return a.date > b.date ? -1 : a.date < b.date ? 1 : 0;\n          });\n\n          var displayAlerts = JSON.parse(JSON.stringify(currentAlerts))\n          for (var i = displayAlerts.length; i-- > 0;) {\n            var thisAlert = displayAlerts[i]\n\n            if (thisAlert.removalDate) {\n              displayAlerts.splice(i, 1)\n            }\n          }\n\n          // Set open alerts temp variable in the store\n          cti.store.variables.filter = \"open\"\n          cti.store.variables.selected_visit.patientData.displayAlerts = displayAlerts\n\n          // Update patient alerts\n          cti.store.variables.selected_visit.patientData.alerts = currentAlerts\n\n          // Refresh timeline\n          cti.fn_prep_timeline()\n        }\n      }\n    }\n  } else {\n    if(response.data != undefined) {\n      if(response.data.patientAlerts != undefined) {\n        if(response.data.patientAlerts.patientAlert != undefined) {\n          if(response.data.patientAlerts.patientAlert instanceof Array) {\n            currentAlerts = response.data.patientAlerts.patientAlert\n          } else {\n            currentAlerts = []\n            currentAlerts.push(response.data.patientAlerts.patientAlert)\n          }\n        }\n      }\n    }\n\n    if(currentAlerts.length > 0) {\n      cti.fn_update_patient_data(response.clientId.value, 'alerts', currentAlerts)\n    }\n  } \n\n  window.logManager.consoleLog(\n    'API CALL: removealert SUCCESS', \n    'info'\n  )\n\n  cti.store.variables.v_alertToRemove_clear = true\n}\n\ndelete cti.store.variables.v_alertToRemove\ndelete cti.store.variables.alertToRemove\ndelete cti.store.api.api_rio.removealert\n\n$success()"},"_auto_id_":"37fb50ca-db0d-4137-b8d9-8c74030ec183"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response;\n\nwindow.logManager.consoleLog(\n  'API CALL: removealert FAILED - Reason: ' + response.message || \"No message returned\", \n  'error'\n)\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Remove Alert Failed: \" + response.message || \"No message returned\" \n})\n\ndelete cti.store.variables.v_alertToRemove\ndelete cti.store.variables.alertToRemove\ndelete cti.store.api.api_rio.removealert\n\n//cti.fn_toggle_spinner('close', '', 1500)\n//cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n\n$success()"},"_auto_id_":"f876c54c-b5e4-41df-8427-15045f713b50"}]}],"name":"RemoveAlert"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: alertsadd - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Submitting Alert...')\n\nvar payload = {\n\tclientId: {},\n    date: null,\n    type: \"\",\n    priority: \"\",\n    text: null\n}\n\npayload.clientId.type = cti.store.variables.selected_visit.patientData.demographics.clientId.type\npayload.clientId.value = cti.store.variables.selected_visit.patientData.demographics.clientId.value\npayload.date = moment().format(\"YYYY-MM-DD\")\npayload.type = cti.store.pages.Alert.type.value\npayload.text = cti.store.pages.Alert.description\n\nif(cti.store.pages.Alert.priority.value != 'dummy') {\n  payload.priority = cti.store.pages.Alert.priority.value\n}\n\ncti.utils.destroyPageData('Alert');\n\ncti.store.variables.v_alertToAdd = payload;\n\n\n\nsetTimeout(function(){ \n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"})\n}, 3000)\n\n$success()"},"_auto_id_":"84a5b0e4-b07f-4605-943d-f5ec287e1d04","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addalert","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_alertToAdd}}"}},"_auto_id_":"5f60c659-b276-454c-ac9e-7196dee473cd","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Alerts response\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif(!response.success){\n  window.logManager.consoleLog(\n    'API CALL: alertsadd FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Add Alert Failed: \" + response.message || \"No message returned\"\n  })\n} else {\n  var currentAlerts = []\n\n  if(selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    currentAlerts = cti.store.variables.selected_visit.patientData.alerts\n\n    if(response.data != undefined) {\n      if(response.data.patientAlerts != undefined) {\n        if(response.data.patientAlerts.patientAlert != undefined) {\n          if(response.data.patientAlerts.patientAlert instanceof Array) {\n            currentAlerts = response.data.patientAlerts.patientAlert\n          } else {\n            currentAlerts = []\n            currentAlerts.push(response.data.patientAlerts.patientAlert)\n          }\n\n          // Re-order alerts array\n          currentAlerts.sort(function(a, b) {\n            return a.date > b.date ? -1 : a.date < b.date ? 1 : 0\n          });\n\n          var displayAlerts = JSON.parse(JSON.stringify(currentAlerts))\n\n          for (var i = displayAlerts.length; i-- > 0;) {\n            var thisAlert = displayAlerts[i]\n\n            if (thisAlert.removalDate) {\n              displayAlerts.splice(i, 1)\n            }\n          }\n\n          // Set open alerts temp variable in the store\n          cti.store.variables.filter = \"open\"\n          cti.store.variables.selected_visit.patientData.displayAlerts = displayAlerts\n\n          // Update patient alerts\n          cti.store.variables.selected_visit.patientData.alerts = currentAlerts\n\n          // Refresh timeline\n          cti.fn_prep_timeline()\n        }\n      }\n    }\n  } else {\n    if(response.data != undefined) {\n      if(response.data.patientAlerts != undefined) {\n        if(response.data.patientAlerts.patientAlert != undefined) {\n          if(response.data.patientAlerts.patientAlert instanceof Array) {\n            currentAlerts = response.data.patientAlerts.patientAlert\n          } else {\n            currentAlerts = []\n            currentAlerts.push(response.data.patientAlerts.patientAlert)\n          }\n        }\n      }\n    }\n\n    if(currentAlerts.length > 0) {\n      cti.fn_update_patient_data(response.clientId.value, 'alerts', currentAlerts)\n    }\n  } \n\n  window.logManager.consoleLog(\n    'API CALL: alertsadd SUCCESS', \n    'info'\n  );\n\n  cti.store.variables.v_alertToAdd_clear = true\n  \n  if(cti.store.state.currentPage != \"Alert\") {\n    cti.utils.destroyPageData('Alert')\n  }\n}\n\ndelete cti.store.variables.v_alertToAdd\ndelete cti.store.api.api_rio.alertsadd\n\n$success()"},"_auto_id_":"dbceea72-e4b9-41a4-b880-8a1f268b0825"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog(\n  'API CALL: alertsadd FAILED - Reason: ' + response.message, \n  'error'\n);\n\ncti.utils.callAction(\n  \"show-notification\", {\n    \"name\": \"notification_error\",\n    \"title\": \"Server Error\",\n    \"text\": \"Unable to connect to the server: \" + response.message || \"No message returned\"\n  }\n);\n\ndelete cti.store.variables.v_alertToAdd\ndelete cti.store.api.api_rio.alertsadd\n\n//cti.fn_toggle_spinner('close', '', 1500)\n//cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n\n$success()"},"_auto_id_":"5948089e-55a6-4ad6-bc38-5083bfe6a1af"}]}],"name":"AddAlert"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog('API Call: addprogressnote - Sending...', 'info')\n\nvar payload = {\n  clientId: {},\n  noteDateTime: null,\n  noteText: null,\n  noteType: null,\n  isValidatedNote: null,\n  subNoteType: null,\n  specialty: null,\n  riskType: {\n    string: []\n  },\n  isSignificantEvent: null,\n  isThirdParty: null,\n  isClientConceal: null,\n  document: null,\n  documentName: null,\n  documentType: null\n}\n\npayload.clientId.type = cti.store.variables.selected_visit.patientData.demographics.clientId.type\npayload.clientId.value = cti.store.variables.selected_visit.patientData.demographics.clientId.value\n//payload.noteDateTime = moment().format('YYYY-MM-DD HH:mm:ss')\npayload.noteDateTime = moment(cti.store.pages.Note.noteDate.result).format('YYYY-MM-DD HH:mm:ss');\n\ncti.store.pages.Note.noteDate.time;\n\npayload.noteText = cti.store.pages.Note.noteText\n\npayload.isValidatedNote = (cti.store.pages.Note.isValidated && cti.store.pages.Note.isValidated.value === '1') || false\n\nif (cti.store.pages.Note.noteType) {\n  payload.noteType = cti.store.pages.Note.noteType.value\n}\n\nif (cti.store.pages.Note.subType) {\n  payload.subNoteType = cti.store.pages.Note.subType.value\n}\n\nif (cti.store.pages.Note.specialty != undefined) {\n  payload.specialty = cti.store.pages.Note.specialty.value\n}\n\nif (cti.store.repeater.Note && cti.store.repeater.Note.group_riskType) {\n  payload.riskType.string = cti.store.repeater.Note.group_riskType.map(r => {\n    return r.riskType.value\n  })\n}\n\nif (cti.store.pages.Note.flagSignificantEvent) {\n  payload.isSignificantEvent = cti.store.pages.Note.flagSignificantEvent\n}\n\nif (cti.store.pages.Note.flagThirdParty) {\n  payload.isThirdParty = cti.store.pages.Note.flagThirdParty\n}\n\nif (cti.store.pages.Note.flagClientConceal) {\n  payload.isClientConceal = cti.store.pages.Note.flagClientConceal\n}\n\nif (cti.store.media && cti.store.media.btnPhoto && cti.store.media.btnPhoto.base64) {\n  var base64 = cti.store.media.btnPhoto.base64\n  var fileExtension = cti.store.media.btnPhoto.fileExtension\n  var clientId = cti.store.variables.selected_visit.patientData.demographics.clientId.value\n\n  if (base64 != undefined || base64 != '') {\n    payload.document = base64\n    payload.documentName = 'progressnote_photo_' + clientId + '.' + fileExtension\n    payload.documentType = cti.store.schema.metadata.imageType || 'V7AA'\n  }\n\n  delete cti.store.media.btnPhoto\n}\n\nif (window.debug) {\n  debugger\n}\n\n// Wipe all Note data ready for more notes to be added - we're not waiting for the response to do this.\ncti.utils.destroyPageData('Note')\n\nif (cti.store.repeater.Note && cti.store.repeater.Note.group_riskType) {\n  delete cti.store.repeater.Note.group_riskType\n}\n\ncti.store.variables.v_progressNoteToAdd = payload\n\nsetTimeout(function() {\n  cti.utils.callAction('go-to-page', { name: 'Visit' })\n}, 3000)\n\n$success()\n"},"_auto_id_":"2b73dcf9-d787-44e9-8108-fb63487e941a","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addnote","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_progressNoteToAdd}}"}},"_auto_id_":"91b294cd-f3a0-4748-83d5-edc614dae15c","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Progress notes response\n\nif (window.debug) {\n  debugger\n}\n\nvar response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif (!response.success) {\n  window.logManager.consoleLog('API CALL: addprogressnote FAILED - Reason: ' + response.message, 'error')\n\n  cti.utils.callAction('show-notification', {\n    name: 'notification_error',\n    title: 'Server Connection Error',\n    text: 'Add Progress Note Failed: ' + response.message\n  })\n} else {\n  let currentNotes = response.data && response.data.progressNotes && response.data.progressNotes.progressNote || null\n\n  if (!!currentNotes && !currentNotes instanceof Array) {\n    currentNotes = [currentNotes]\n  }\n\n  if (selected_visit && selected_visit.attendees.attendee.clientId.value == response.clientId.value) {\n    if (currentNotes.length > 0) {\n      cti.store.variables.selected_visit.patientData.progressNotes = currentNotes\n\n      var documents = cti.store.variables.selected_visit.patientData.documents\n\n      for (var i in currentNotes) {\n        var note = currentNotes[i]\n\n        if (note.associatedDocuments && note.associatedDocuments.associatedDocument) {\n          var exists = false\n\n          for (var x in documents) {\n            var document = documents[x]\n\n            if (document.documentId == note.associatedDocuments.associatedDocument.documentId) {\n              exists = true\n            }\n          }\n\n          if (!exists) {\n            var newDocument = JSON.parse(JSON.stringify(note.associatedDocuments.associatedDocument))\n\n            var dateCreated = newDocument.dateCreated.replace('T', ' ')\n            newDocument.dateCreated = dateCreated\n            var documentDate = newDocument.documentDate.replace('T', ' ')\n            newDocument.documentDate = documentDate\n            var insertedDate = newDocument.insertedDate.replace('T', ' ')\n            newDocument.insertedDate = insertedDate\n\n            documents.push(newDocument)\n          }\n        }\n      }\n\n      cti.fn_prep_timeline()\n    }\n  } else {\n    if (currentNotes.length > 0) {\n      cti.fn_update_patient_data(response.clientId.value, 'notes', currentNotes)\n    }\n  }\n\n  window.logManager.consoleLog('API CALL: addprogressnote SUCCESS', 'info')\n\n  cti.store.variables.v_progressNoteToAdd_clear = true\n\n  if (cti.store.state.currentPage != 'Note') {\n    delete cti.store.variables.note\n    delete cti.store.variables.v_progressNoteToAdd_clear\n    delete cti.store.variables.uiSubNoteTypes\n  }\n}\n\ndelete cti.store.variables.v_progressNoteToAdd\ndelete cti.store.api.api_rio.addprogressnote\n\n$success()\n"},"_auto_id_":"146334cf-48ec-419c-ab25-86170ba7caf7","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog('API CALL: addprogressnote FAILED - Reason: ' + response.message, 'error')\n\ncti.utils.callAction('show-notification', {\n  name: 'notification_error',\n  title: 'Server Error: Add Progress Note',\n  text: 'Unable to connect to the server: ' + response.message || 'No message returned'\n})\n\nif (cti.store.media && cti.store.media.btnPhoto && cti.store.media.btnPhoto.base64) {\n  delete cti.store.media.btnPhoto.base64\n  delete cti.store.media.btnPhoto.fileExtension\n}\n\ndelete cti.store.api.api_rio.addprogressnote\ndelete cti.store.variables.v_progressNoteToAdd\n\n$success()\n"},"_auto_id_":"0d4f2aa0-445d-4d8d-8b7c-c8c06df36035","actions":[]}]}],"name":"AddProgressNote"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n    \"appointmentBooking\": {\n        \"clientId\": {},\n        \"teamId\": null,\n        \"date\": null,\n        \"referralId\": null,\n        \"activities\": {\n            \"string\": []\n        },\n        \"comment\": null,\n        \"bookRepeatAppointments\": null,\n        \"repeatType\": null,\n        \"numberOfRepeats\": null,\n        \"repeatInterval\": null,\n        \"weekDays\": null,\n        \"dateOfMonth\": null,\n        \"monthOfYear\": null,\n        \"weekInMonth\": null,\n        \"authorId\": null\n    }\n}\n\nvar activities = cti.store.repeater.Team_Planner.group_activities;\nvar newActivities = [];\n\nfor (var i in activities) {\n    newActivities.push(activities[i].activity.value);\n}\n\npayload.appointmentBooking.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId;\npayload.appointmentBooking.teamId = cti.store.pages.Team_Planner.select_team.value;\npayload.appointmentBooking.date = cti.store.pages.Team_Planner.date_planner;\npayload.appointmentBooking.referralId = cti.store.pages.Team_Planner.select_referral.value;\npayload.appointmentBooking.activities.string = newActivities;\npayload.appointmentBooking.comment = cti.store.pages.Team_Planner.comments;\n\ncti.store.variables.selected_visit.repeat === undefined ? payload.appointmentBooking.bookRepeatAppointments = false : payload.appointmentBooking.bookRepeatAppointments = true;\n\nif (payload.appointmentBooking.bookRepeatAppointments) {\n    payload.appointmentBooking.repeatType = cti.store.pages.Team_Planner.radio_repeat;\n    payload.appointmentBooking.numberOfRepeats = cti.store.pages.Team_Planner.number_appointments.toString();\n\n    if (payload.appointmentBooking.repeatType === \"Daily\") {\n        if (cti.store.pages.Team_Planner.radio_daily == \"Every weekday\") {\n            payload.appointmentBooking.repeatType = \"WeekDay\";\n        } else {\n            payload.appointmentBooking.repeatInterval = cti.store.pages.Team_Planner.select_daily_interval.value.toString();\n        }\n    } else if (payload.appointmentBooking.repeatType === \"Weekly\") {\n        var p = cti.store.pages.Team_Planner;\n        var bitValue = 0;\n\n        if (p.checkbox_weekly_days[1]) { bitValue += 1; }\n        if (p.checkbox_weekly_days[2]) { bitValue += 2; }\n        if (p.checkbox_weekly_days[3]) { bitValue += 4; }\n        if (p.checkbox_weekly_days[4]) { bitValue += 8; }\n        if (p.checkbox_weekly_days[5]) { bitValue += 16; }\n        if (p.checkbox_weekly_days[6]) { bitValue += 32; }\n        if (p.checkbox_weekly_days[7]) { bitValue += 64; }\n\n        payload.appointmentBooking.weekDays = bitValue.toString();\n        payload.appointmentBooking.repeatInterval = cti.store.pages.Team_Planner.select_weekly_interval.value.toString();\n    } else if (payload.appointmentBooking.repeatType === \"Monthly\") {\n        payload.appointmentBooking.repeatInterval = cti.store.pages.Team_Planner.select_month_interval.value.toString();\n\n        if (cti.store.pages.Team_Planner.select_month_day) {\n            payload.appointmentBooking.dateOfMonth = cti.store.pages.Team_Planner.select_month_day.value.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_weekday) {\n            var p = cti.store.pages.Team_Planner;\n            var day = cti.store.pages.Team_Planner.select_weekday.value;\n            var bitValue = 0;\n\n            if (day == \"1\") { bitValue = 1; }\n            if (day == \"2\") { bitValue = 2; }\n            if (day == \"3\") { bitValue = 4; }\n            if (day == \"4\") { bitValue = 8; }\n            if (day == \"5\") { bitValue = 16; }\n            if (day == \"6\") { bitValue = 32; }\n            if (day == \"7\") { bitValue = 64; }\n\n            payload.appointmentBooking.weekDays = bitValue.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_position) {\n            if (cti.store.pages.Team_Planner.select_position.value == \"First\") {\n                payload.appointmentBooking.weekInMonth = \"1\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Second\") {\n                payload.appointmentBooking.weekInMonth = \"2\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Third\") {\n                payload.appointmentBooking.weekInMonth = \"3\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Fourth\") {\n                payload.appointmentBooking.weekInMonth = \"4\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Last\") {\n                payload.appointmentBooking.weekInMonth = \"5\";\n            }\n        }\n    } else if (payload.appointmentBooking.repeatType === \"Yearly\") {\n        if (cti.store.pages.Team_Planner.select_weekday) {\n            var p = cti.store.pages.Team_Planner;\n            var day = cti.store.pages.Team_Planner.select_weekday.value;\n            var bitValue = 0;\n\n            if (day == \"1\") { bitValue = 1; }\n            if (day == \"2\") { bitValue = 2; }\n            if (day == \"3\") { bitValue = 4; }\n            if (day == \"4\") { bitValue = 8; }\n            if (day == \"5\") { bitValue = 16; }\n            if (day == \"6\") { bitValue = 32; }\n            if (day == \"7\") { bitValue = 64; }\n\n            payload.appointmentBooking.weekDays = bitValue.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_year_month_day) {\n            payload.appointmentBooking.dateOfMonth = cti.store.pages.Team_Planner.select_year_month_day.value.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_month) {\n            payload.appointmentBooking.monthOfYear = cti.store.pages.Team_Planner.select_month.value.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_position) {\n            if (cti.store.pages.Team_Planner.select_position.value == \"First\") {\n                payload.appointmentBooking.weekInMonth = \"1\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Second\") {\n                payload.appointmentBooking.weekInMonth = \"2\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Third\") {\n                payload.appointmentBooking.weekInMonth = \"3\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Fourth\") {\n                payload.appointmentBooking.weekInMonth = \"4\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Last\") {\n                payload.appointmentBooking.weekInMonth = \"5\";\n            }\n        }\n    }\n}\n\ncti.store.variables.v_teamplannerToAdd = payload;\ncti.store.variables.v_teamplannerToAdd_clear = payload;\n\n$success();"},"_auto_id_":"b6f48280-d8f3-43a9-aca6-e1ad55ba4625","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addTPAppointment","params":{"applicationkey":"{{$store.schema.metadata.applicationkey}}","Authorization":"Basic {{$store.variables.auth_header}}","payload":"{{$store.variables.v_teamplannerToAdd}}"}},"_auto_id_":"6ee51849-c9d9-4160-8fe9-1258d9fb7eea","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  console.log(\"API CALL: /appointments/teamadd | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : $data.$response.message || \"Add Team Planner Appointment Failed\"});\n} else {\n  console.log(\"API CALL: /appointments/teamadd | SUCCESS\");\n}\n\ndelete cti.store.variables.v_teamplannerToAdd;\n$success();"},"_auto_id_":"981c0ea1-5973-487c-95c9-0e3a8a2b1cc8"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"console.log(\"API CALL: /appointments/teamadd | FAILED\");\nconsole.log(\"API FAILURE: \" + $data.$response.message);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : $data.$response.message || \"Add Team Planner Appointment Failed\"\n});\n\n$success();"},"_auto_id_":"fd643769-dcd1-4189-a170-3c58ada1cb74"}]},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"9c89b3c1-4a83-418b-8d9c-3bf70c453491"}],"name":"AddTPAppointment"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n  appointmentDetails : {\n    appointmentDateTime: null,\n    appointmentType: null,\n    authorId: null,\n    bookedDateTime: null,\n    comment: null,\n    healthcareProfessional: null,\n    intendedDuration: null,\n    location: null,\n    isNonClientAppointment: false\n  },\n  appointmentContacts: []\n}\n\n// Add to appointmentDetails\npayload.appointmentDetails.appointmentDateTime = moment(cti.store.pages.HCP_Diary.date_planner).format('YYYY-MM-DD HH:mm:ssZZ');\npayload.appointmentDetails.appointmentType = cti.store.pages.HCP_Diary.select_type.value\npayload.appointmentDetails.bookedDateTime = moment().format('YYYY-MM-DD HH:mm:ssZZ')\npayload.appointmentDetails.comment = cti.store.pages.HCP_Diary.text_comment\npayload.appointmentDetails.healthcareProfessional = cti.store.pages.Login.username\npayload.appointmentDetails.intendedDuration = cti.store.pages.HCP_Diary.select_intended_duration.value\npayload.appointmentDetails.location = cti.store.pages.HCP_Diary.select_location.value\n\nif(cti.store.pages.HCP_Diary.switch_non_client != undefined) {\n  payload.appointmentDetails.isNonClientAppointment = cti.store.pages.HCP_Diary.switch_non_client\n}\n\n//Add to appointmentContacts\n\nvar addContact = function() {\n  let contact = {\n    activities : {\n    \tstring: []\n  \t},\n    clientId : null,\n    comment : null,\n    faceToFace : null,\n    interpreterComment : null,\n    interpreterLanguage : null,\n    interpreterStatus : null,\n    isNonClientAppointment : null,\n    proxyContact : null,\n    referralId : null,\n    transportComment : null,\n    transportStatus : null,\n    proxyContact : null,\n  }\n  contact.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId\n  \n  if(cti.store.pages.HCP_Diary.contact_comment != undefined) {\n    contact.comment = cti.store.pages.HCP_Diary.contact_comment;\n  }\n  if(cti.store.pages.HCP_Diary.switch_f2f_contact != undefined) {\n    contact.faceToFace = cti.store.pages.HCP_Diary.switch_f2f_contact\n  }\n  if(cti.store.pages.HCP_Diary.interpreter_comment != undefined) {\n    contact.interpreterComment = cti.store.pages.HCP_Diary.interpreter_comment\n  }\n  if(cti.store.pages.HCP_Diary.select_interpret_language != undefined) {\n    if(cti.store.pages.HCP_Diary.select_interpret_language.value != undefined) {\n      contact.interpreterLanguage = cti.store.pages.HCP_Diary.select_interpret_language.value\n    }\n  }\n  if(cti.store.pages.HCP_Diary.select_interpret_required != undefined) {\n    if(cti.store.pages.HCP_Diary.select_interpret_required.value != undefined) {\n      contact.interpreterStatus = cti.store.pages.HCP_Diary.select_interpret_required.value\n    }\n  }\n  if(cti.store.pages.HCP_Diary.switch_non_client != undefined) {\n    contact.isNonClientAppointment = cti.store.pages.HCP_Diary.switch_non_client\n  }\n  if(cti.store.pages.HCP_Diary.switch_proxy_contact != undefined) {\n    contact.proxyContact = cti.store.pages.HCP_Diary.switch_proxy_contact\n  }\n  if(cti.store.pages.HCP_Diary.transport_comment != undefined) {\n    contact.transportComment = cti.store.pages.HCP_Diary.transport_comment\n  }\n  if(cti.store.pages.HCP_Diary.select_transport_required != undefined) {\n    if(cti.store.pages.HCP_Diary.select_transport_required.value != undefined) {\n      contact.transportStatus = cti.store.pages.HCP_Diary.select_transport_required.value\n    }\n  }\n\n  contact.referralId = cti.store.variables.selected_visit.attendees.attendee.referral.referralId\n  \n  cti.store.repeater.HCP_Diary.group_activities.forEach(function(a) {\n    contact.activities.string.push(a.activity.value)\n  })\n\n  payload.appointmentContacts.push(contact)\n}\n\naddContact()\n\ncti.store.variables.v_appointmentToAdd = payload\ncti.store.variables.v_appointmentToAdd_clear = true\n\n$success()"},"_auto_id_":"258c8b73-31b1-4379-95fc-ffd4436b5224","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addHCPAppointment","params":{"payload":"$store.variables.v_appointmentToAdd","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"8761a75d-e791-4e35-8a5b-03194faae506","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"console.log('AddHCPAppointment: Success', $data)\n\n$success()"},"_auto_id_":"4feb4e99-fe86-49e0-a4de-02bef3c2c3a4"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"console.log('AddHCPAppointment: Fail', $data)\n\n$success()"},"_auto_id_":"87b4f50e-c24a-4033-8268-5e64fd731e26"}]}],"name":"AddHCPAppointment"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: outcomesave - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Submitting Outcome...');\n\nvar arrivalTime = null, \n    actualTime = null, \n    actualDuration = null\n\nvar payload = {\n  appointmentOutcome: {\n    appointmentId: null,\n    clientId: {},\n    authorId: null,\n    arrivalTime: null,\n    actualTime: null,\n    actualDuration: null,\n    activities: {\n      string: []\n    },\n    consultationMedium: null,\n    outcome: null,\n    comments: null\n  }\n}\n\nvar activities = []\n\nfor(var i in cti.store.variables.o_activities) {\n  activities.push(cti.store.variables.o_activities[i].value)\n}\n\nvar arrivalTimeDt = new Date(cti.store.variables.selected_visit.arrivalTime)\nvar arrivalTimeStr = arrivalTimeDt.toString()\nvar arrivalTimeOffset = (arrivalTimeStr.substring(arrivalTimeStr.indexOf('+'))).substring(0,5)\n\nif (cti.store.pages.Outcome.arrivalTime) {\n  arrivalTime = cti.store.pages.Outcome.arrivalTime + arrivalTimeOffset\n}\n\nif (cti.store.pages.Outcome.actualTime) {\n  actualTime = cti.store.pages.Outcome.actualTime + arrivalTimeOffset\n}\n\nactualDuration = (Number(cti.store.pages.Outcome.duration_hours.value) * 60 +\n                  Number(cti.store.pages.Outcome.duration_minutes.value)\n                 ).toString()\n\npayload.appointmentOutcome.appointmentId = cti.store.variables.selected_visit.appointmentId\npayload.appointmentOutcome.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId\npayload.appointmentOutcome.arrivalTime = arrivalTime\npayload.appointmentOutcome.actualTime = actualTime\npayload.appointmentOutcome.actualDuration = actualDuration\npayload.appointmentOutcome.activities.string = activities\npayload.appointmentOutcome.outcome = cti.store.pages.Outcome.outcome.value\ncti.store.pages.Outcome.comments != undefined ? payload.appointmentOutcome.comments = cti.store.pages.Outcome.comments : null\n\ncti.store.variables.v_outcomePayload = payload\n\n// Set the local appointment with updated information\ncti.store.variables.selected_visit.attendees.attendee.outcome = {\n  code : cti.store.pages.Outcome.outcome.value,\n  value : cti.store.pages.Outcome.outcome.label\n}\n\ncti.store.variables.selected_visit.attendees.attendee.outcomeComment = payload.appointmentOutcome.comments\n\ndelete cti.store.variables.selected_visit.attendees.attendee.possibleActivities\ndelete cti.store.variables.selected_visit.attendees.attendee.possibleOutcomes\n\n// Load appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  var appointments = doc.data\n  var appointment = cti.store.variables.selected_visit\n\n  // Check that we have a valid appointment\n  for(var i in appointments) {\n    if(appointments[i].appointmentId == appointment.appointmentId) {\n      // Update the appointment data with the selected appointment\n      appointments[i] = cti.store.variables.selected_visit\n      break;\n    }\n  }\n\n  // Update the pouch DB with new data\n  window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n    window.logManager.consoleLog(\n      'Pouch DB: Updated Appointment Data. Revision: ' + rev,\n      'info'\n    )\n\n    setTimeout(function(){ \n      cti.store.variables.v_outcomePayload_clear = true\n      cti.fn_load_appointments()\n    }, 3000)\n\n    $success()\n  }, function(reason, e) {\n    setTimeout(function(){ \n      cti.store.variables.v_outcomePayload_clear = true\n      cti.fn_load_appointments()\n    }, 3000)\n\n    $success()\n\n    window.logManager.consoleLog(\n      'Pouch DB: Failed to Update Appointment Data - ' + reason + e,\n      'error'\n    )\n  });\n}, function (reason, err) {\n  // Reset appointments\n  setTimeout(function(){ \n    cti.store.variables.v_outcomePayload_clear = true\n    cti.fn_load_appointments()\n  }, 3000)\n\n  $success()\n\n  window.logManager.consoleLog(\n    'Pouch DB: Error: Failed retriveing Appointments Data from Pouch - ' + reason + err,\n    'error'\n  )\n})"},"_auto_id_":"2a7c0e7e-6e38-4ced-bce6-d20ddd4c2a83","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"outcomesave","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_outcomePayload}}"}},"_auto_id_":"a12e130f-59df-4df6-b308-b7d05186bd88","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\nvar selected_visit = cti.store.variables.selected_visit\n\nif(!response.success) {\n  window.logManager.consoleLog(\n    'API Call: outcomesave - FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Submit Outcome Failed: \" + response.message || \"No message retured\"\n  })\n\n  cti.fn_toggle_spinner('close')\n} else {\n  delete cti.store.variables.v_outcomePayload\n  \n  window.logManager.consoleLog(\n    'API Call: outcomesave - SUCCESS', \n    'info'\n  )\n}"},"_auto_id_":"a6c1daaa-73f8-4536-adbb-cec7d2ee5e75"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response\n\nwindow.logManager.consoleLog(\n  'API Call: outcomesave - FAILED - Reason: ' + response.message, \n  'error'\n)\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Submit Outcome Failed: \" + response.message || \"No message returned\"\n});\n\ncti.fn_toggle_spinner('close')"},"_auto_id_":"f5477a51-ce4e-471e-baa7-75d4b8e728c8"}]}],"name":"SubmitOutcome"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: getdocument - Sending...', \n  'info'\n)\n\n$success()"},"_auto_id_":"58dcf9d5-5bc7-4c06-a0f7-927c90dd8a51"},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getdocument","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_documentGetPayload}}"}},"_auto_id_":"ebf017bd-64bf-4ca1-8def-7e93712d034e","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"var response = cti.store.api.api_rio.getdocument;\n\nif(!response.success) {\n  window.logManager.consoleLog(\n    'API Call: getdocument - FAILED - Reason: ' + response.message, \n    'info'\n  )\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Get Document Failed: \" + response.message || \"No message returned\"\n  });\n  \n  delete cti.store.variables.v_selectedDocument\n} else {\n  window.logManager.consoleLog(\n    'API Call: getdocument - SUCCESS', \n    'info'\n  )\n  \n  cti.store.variables.v_selectedDocument.base64 = response.data.document.data\n  cti.fn_letOsOpenDocument()\n}\n\ndelete cti.store.variables.v_documentGetPayload\ndelete cti.store.api.api_rio.getdocument\n\ncti.fn_toggle_spinner('close')"},"_auto_id_":"3f491b2d-7a03-4e45-84ef-065b6cf577d3","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = cti.store.api.api_rio.getdocument\n\nwindow.logManager.consoleLog(\n  'API Call: getdocument - FAILED - Reason: ' + response.message, \n  'info'\n)\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Get Document Failed: \" + response.message || \"No message returned\"\n})\n\ndelete cti.store.variables.v_documentGetPayload\ndelete cti.store.variables.v_selectedDocument\ndelete cti.store.api.api_rio.getdocument\n\ncti.fn_toggle_spinner('close')"},"_auto_id_":"58837222-7b43-4d29-a345-a3cd90541ab4"}]}],"name":"GetDocument"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if (!cti.store.variables.online) {\n  cti.utils.callAction(\"show-notification\", {\n    name: \"warning_persistent\",\n    title: \"Currently Offline\",\n    text: \"You have updates - click Refresh Appointments when you are online\"\n  });\n\n  cti.fn_toggle_spinner(\"close\", \"\");\n} else {\n  window.logManager.consoleLog(\"API Call: GetPushData - Sending...\", \"info\");\n\n  $success();\n}\n"},"_auto_id_":"913c18b3-33f6-437c-ba03-8314f1ba2b88","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getappointment","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","appointmentId":"{{$store.variables.getAppointmentPayload}}","pushDataPayload":"{{$store.variables.pushDataPayload}}"}},"_auto_id_":"726b93dd-8f17-4e1f-a0cb-86cab919d44d","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if (window.debug) {\n  debugger\n}\n\n// GetPushData API Success Response Function\n// Grab response\nvar response = $data.$response\nvar pushDataPayload = cti.store.variables.pushDataPayload\n\n// If unsuccessful clear down data and process the error message\nif(!response.success) {\n  window.logManager.consoleLog(\n    'API CALL: getappointment FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.fn_toggle_spinner('close')\n} else {\n  if(pushDataPayload.pushType == \"patient\" && pushDataPayload.includeDemographics) {\n    cti.fn_save_to_pouch(\"demographics\", $data.$response, false, pushDataPayload.clientId.value)\n  } else if(pushDataPayload.pushType == \"patient\" && pushDataPayload.includeAllergies) {\n    cti.fn_save_to_pouch(\"allergies\", $data.$response, false, pushDataPayload.clientId.value)\n  } else if(pushDataPayload.pushType == \"patient\" && pushDataPayload.includeAlerts) {\n    cti.fn_save_to_pouch(\"alerts\", $data.$response, false, pushDataPayload.clientId.value)\n  } else if(pushDataPayload.pushType == \"patient\" && pushDataPayload.includeNotes) {\n    cti.fn_save_to_pouch(\"progressNotes\", $data.$response, false, pushDataPayload.clientId.value)\n  } else if(pushDataPayload.pushType == \"appointment\") {\n    cti.fn_save_to_pouch(\"appointment\", $data.$response, pushDataPayload.appointmentExists, pushDataPayload.appointmentId)\n  }\n\n  window.logManager.consoleLog(\n    'API CALL: getappointment SUCCESS', \n    'info'\n  )\n}\n\ndelete cti.store.api.api_rio.getappointment"},"_auto_id_":"cf5aaabe-2410-4dae-829c-2fcb08e3891a"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetAppointment Offline API Fail Response Function\n// Grab response\nvar response = $data.$response\nvar appointmentPayload = cti.store.variables.getAppointmentPayload\n\nconsole.log('::error:: Push Event failed to retrieve appointment ',appointmentPayload.appointmentId);\nconsole.log('::error:: Error message: ', $data.$response);\n\ndelete cti.store.variables.getAppointmentPayload"},"_auto_id_":"e6a971e0-2250-4a6d-80fb-5f97690eef7e"}]}],"name":"GetPushData"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: getstaticdata - Sending...', \n  'info'\n);\n\n$success()"},"_auto_id_":"f449ed45-d4a4-4fef-8829-2be76e1e64e9","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getstaticdata","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"2356ff74-0e5d-4f70-97d1-cc58431bf731","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"var rio_api = cti.store.api.api_rio\nvar response = rio_api.getstaticdata\n\nif (window.debug) {\n  debugger\n}\n\nvar dataObject = {\n  alerttypes: {\n    data: []\n  },\n  alertpriorities: {\n    data: []\n  },\n  getnoteconfig: {\n    data: {\n      progressNoteConfiguration: {}\n    }\n  },\n  getnotetypes: {\n    data: {\n      progressNoteTypes: {\n        uiNoteTypes: []\n      }\n    }\n  },\n  getnotespecialites: {\n    data: {\n      userSpecialties: {\n        userSpecialty: []\n      }\n    }\n  },\n  getnoterisktypes: {\n    data: {\n      riskTypes: {\n        riskType: []\n      }\n    }\n  },\n  getbookingrefdata: {\n    data: {\n      appointmentBookingReferenceData: {}\n    }\n  },\n  diarytemplate: {\n    data: []\n  },\n  teamplannerreferencedata: {\n    data: []\n  },\n  busydiaryslots: {\n    data: []\n  }\n}\n\ncti.store.variables.defaultNoteType = null\ncti.store.variables.defaultSubNoteType = null\n\nif (!response.success) {\n  // GetStaticData status set to failed: false\n  cti.store.variables.getStaticDataStatus = false\n\n  window.logManager.consoleLog('API CALL: getstaticdata FAILED - Reason: ' + response.message, 'error')\n\n  cti.utils.callAction('show-notification', {\n    name: 'notification_error',\n    title: 'Server Connection Error',\n    text: 'Unable to retrieve Alert Priorities Reference data.'\n  })\n\n  cti.fn_toggle_spinner('close')\n} else {\n  // GetStaticData status set to success: true\n  cti.store.variables.getStaticDataStatus = true\n\n  if (response.data.alertTypes) {\n    // cti.store.variables.getAlertTypesStatus = true\n    dataObject.alerttypes.data = response.data.alertTypes\n  }\n  if (response.data.alertPriorities) {\n    // cti.store.variables.getAlertPrioritiesStatus = true\n    dataObject.alertpriorities.data = response.data.alertPriorities\n  }\n  if (response.data.progressNoteConfiguration) {\n    // cti.store.variables.getNoteConfigStatus = true\n    dataObject.getnoteconfig.data.progressNoteConfiguration = response.data.progressNoteConfiguration\n  }\n  if (response.data.progressNoteTypes) {\n    // cti.store.variables.getNoteTypesStatus = true\n    dataObject.getnotetypes.data.progressNoteTypes.uiNoteTypes = response.data.progressNoteTypes\n\n    const defaultNote = dataObject.getnotetypes.data.progressNoteTypes.uiNoteTypes.find(n => n.isDefault)\n\n    // We need to craft the default carefully here so we can mix and match studio-instances with server-instances...\n    cti.store.variables.defaultNoteType = defaultNote\n      ? {\n          value: defaultNote.code\n        }\n      : null\n\n    // Only sub notes within the default note can be set to default.\n    if (defaultNote && !!defaultNote.sub) {\n      const defaultSubNote = defaultNote.sub.find(n => n.isDefault)\n\n      cti.store.variables.defaultSubNoteType = defaultSubNote\n        ? {\n            value: defaultSubNote.code\n          }\n        : null\n    }\n  }\n  if (response.data.userSpecialties) {\n    // cti.store.variables.getNoteSpecialitesStatus = true\n    dataObject.getnotespecialites.data.userSpecialties.userSpecialty = response.data.userSpecialties\n  }\n  if (response.data.riskTypes) {\n    // cti.store.variables.getNoteRiskTypesStatus = true\n    dataObject.getnoterisktypes.data.riskTypes.riskType = response.data.riskTypes\n  }\n  if (response.data.appointmentBookingReferenceData) {\n    // cti.store.variables.getBookingRefDataStatus = true\n    dataObject.getbookingrefdata.data.appointmentBookingReferenceData = response.data.appointmentBookingReferenceData\n  }\n  if (response.data.diaryTemplates) {\n    // cti.store.variables.getDiaryTemplateStatus = true\n    dataObject.diarytemplate.data = response.data.diaryTemplates\n  }\n  if (response.data.teamPlannerData) {\n    // cti.store.variables.getTeamRefDataStatus = true\n    dataObject.teamplannerreferencedata.data = response.data.teamPlannerData\n  }\n  if (response.data.busyDiarySlots) {\n    // cti.store.variables.getBusyDiarySlotsStatus = true\n    dataObject.busydiaryslots.data = response.data.busyDiarySlots\n  }\n\n  if (response.data.inactivityTimeout) {\n    console.log(`GetStaticData:: New user inactivity timeout (${response.data.inactivityTimeout})...`)\n    cti.store.variables.inactivityTimeout = response.data.inactivityTimeout\n  }\n\n  dataObject.authenticate = rio_api.authenticate\n  cti.store.api.api_rio = JSON.parse(JSON.stringify(dataObject))\n\n  window.logManager.consoleLog('API CALL: getstaticdata SUCCESS', 'info')\n\n  cti.fn_toggle_spinner('close')\n  cti.fn_toggle_spinner('open', 'Fetching Appointments, please wait...')\n\n  cti.utils.callAction('call-actionflow', { name: 'GetVisitList' })\n}\n"},"_auto_id_":"30d5a501-96cc-47d2-8dfe-9c120aefc211"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var rio_api = cti.store.api.api_rio\nvar response = rio_api.getstaticdata\n\n// GetStaticData status set to failed: false\ncti.store.variables.getStaticDataStatus = false\n\nwindow.logManager.consoleLog(\n  'API CALL: getstaticdata FAILED - Reason: ' + $data.$response.message, \n  'error'\n);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\" , \n  \"text\" : \"Unable to retrieve Alert Priorities Reference data.\"\n});\n\ncti.fn_toggle_spinner('close');"},"_auto_id_":"98b61313-a24f-4346-b33f-50ddd7963aed"}]}],"name":"GetStaticData"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: getappointments - Sending...', \n  'info'\n)\n\n//Set the date range to sync -1, +1\ncti.store.variables.v_appointmentSyncFromDate = moment().subtract(1, 'days').format(\"YYYY-MM-DD\")\ncti.store.variables.v_appointmentSyncToDate = moment().add(1, 'days').format(\"YYYY-MM-DD\")\n\n$success()"},"_auto_id_":"8a658f34-3884-4456-83aa-1cf3d99b1c48","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getappointments","params":{"id":"{{$store.pages.Login.username}}","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","fromDate":"{{$store.variables.v_appointmentSyncFromDate}}","toDate":"{{$store.variables.v_appointmentSyncToDate}}"}},"_auto_id_":"60d96450-e4ef-4998-b6f7-0b6b03828eac","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Grab response\nvar response = cti.store.api.api_rio.getappointments\n\nif(!response.success){\n  // GetVisitList status set to failed: false\n  cti.store.variables.getVisitListStatus = false\n\n  cti.fn_toggle_spinner('close')\n\n  window.logManager.consoleLog(\n    'API CALL: getappointments FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Unable to get Appointments.\"\n  })                           \n} else {\n  // GetVisitList status set to success: true\n  cti.store.variables.getVisitListStatus = true\n\n  window.logManager.consoleLog(\n    'API CALL: getappointments SUCCESS', \n    'info'\n  )\n\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    var appointments = []\n\n    if(doc.data && doc.data.length > 0) {\n      appointments = doc.data\n      var updatedAppointments = []\n\n      for(var i in response.data) {\n        var responseAppointment = {}\n        var responseAppointment = response.data[i]\n        var exists = false\n\n        for(var x in appointments) {\n          var deviceAppointment = {}\n          var deviceAppointment = appointments[x]\n\n          if(deviceAppointment.appointmentId == responseAppointment.appointmentId) {\n            exists = true\n            break\n          } \n        }\n\n        var pushAppointment = {}\n\n        if(exists) {\n          if(deviceAppointment.status != \"started\") {\n            deviceAppointment = responseAppointment\n          } else {\n            deviceAppointment.patientData = responseAppointment.patientData\n          }\n\n          pushAppointment = JSON.parse(JSON.stringify(deviceAppointment))\n        } else {\n          pushAppointment = JSON.parse(JSON.stringify(responseAppointment))\n        }\n\n        updatedAppointments.push(pushAppointment)\n      }\n    } else {\n      updatedAppointments = response.data\n    }\n\n    window.pouchManager.saveToDatabase(\n      \"appointments\", \n      updatedAppointments, function(rev) {\n        window.logManager.consoleLog(\n          'Pouch DB - Saved Appointment Data. Revision: ' + rev, \n          'info'\n        )\n\n        delete cti.store.api.api_rio.getappointments\n\n        if(cti.store.variables.firstLogin) {\n          delete cti.store.variables.firstLogin\n\n          cti.utils.callAction(\"go-to-page\", { name: \"Set_PIN\" })\n        } else {\n          cti.fn_load_appointments()\n        }\n      }, function(reason, e) {\n        window.logManager.consoleLog(\n          'Pouch DB - Failed to save Appointment Data - ' + reason, e, \n          'error'\n        )\n\n        cti.fn_toggle_spinner('close')\n        delete cti.store.api.api_rio.getappointments\n      })\n  }, function (reason, err) {\n    window.logManager.consoleLog(\n      'Pouch DB - Appointments Pouch DB does not exist, creating new instance... - ' + reason + err,\n      'Info'\n    )\n\n    window.pouchManager.saveToDatabase(\n      \"appointments\", \n      cti.store.api.api_rio.getappointments.data, function(rev) {\n        window.logManager.consoleLog(\n          'Pouch DB - Saved Appointment Data. Revision: ' + rev, \n          'info'\n        )\n\n        delete cti.store.api.api_rio.getappointments\n\n        if(cti.store.variables.firstLogin) {\n          delete cti.store.variables.firstLogin\n\n          cti.utils.callAction(\"go-to-page\", { name: \"Set_PIN\" })\n        } else {\n          cti.fn_load_appointments()\n        }\n      }, function(reason, e) {\n        window.logManager.consoleLog(\n          'Pouch DB - Failed to save Appointment Data - ' + reason, e, \n          'error'\n        )\n\n        cti.fn_toggle_spinner('close')\n        delete cti.store.api.api_rio.getappointments\n      })\n  })\n}"},"_auto_id_":"300cbab3-9eaf-4577-8c03-fd68a7aa92bf","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetVisitList status set to failed: false\ncti.store.variables.getVisitListStatus = false;\n\ncti.fn_toggle_spinner('close');\n\nwindow.logManager.consoleLog(\n  'API CALL - Fail Response: GetVisitList - Reason: ' + $data.$response.message, \n  'error'\n);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to connect to server.\"\n});                           \n\n$success();"},"_auto_id_":"ee9159a6-14b9-4d14-886e-677ea32c3711","actions":[]}]}],"name":"GetVisitList"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog('actionflow: RevokeAuthentication', 'info')\n\nif (window.debug) {\n  debugger\n}\n\ncti.store.variables.v_isAuthenticated = false\n\n// Store a temp copy of the username for use within the deregister push call.\ncti.store.variables.temp_user = cti.store.variables.loggedInUser\ncti.store.variables.loggedInUser = ''\n\ncti.fn_clearActivityTimeout()\ncti.fn_stopActivityListener()\n\ncti.fn_onAppResume()\n\n$success()"},"_auto_id_":"f6723f9c-a082-40de-b8fc-c92c99250730","actions":[]}],"name":"RevokeAuthentication"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_clearActivityTimeout()\n\ncti.store.variables.lastUserActivity = new Date().getTime()\n\nconsole.log(`fn_startActivityListener:: Setting up user activity event listener...`)\n\ncti.store.variables.timeoutTimer = setTimeout(function() {\n  console.log(`Actionflow:UserActivity:: Hit activity timeout, off to PIN entry we go...`)\n    \n  cti.fn_clearActivityTimeout()\n  cti.fn_stopActivityListener()\n  \n  cti.utils.callAction('go-to-page', { name: 'Enter_PIN' })\n}, cti.store.variables.inactivityTimeout)"},"_auto_id_":"9dc308be-065f-49e1-bacd-e70bb38e0076"}],"name":"UserActivity"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.v_appointmentDate = moment().format(\"YYYY-MM-DD\");\ncti.store.variables.v_appointmentDateText = \"Today\";\n\ncti.fn_toggle_spinner(\"open\", \"Fetching Appointments, please wait...\");\ncti.utils.callAction(\"call-actionflow\", { name: \"GetVisitList\" });"},"_auto_id_":"63193bc6-56f4-43cd-8cd8-f98f22b97d70"}],"name":"RefreshAppointments"}],"dataflows":[],"config":[{"name":"ELFT_FUNCTIONS","type":"scripting","item-type":"js-asset","_auto_id_":"024c512c-b2ef-42bb-94ba-4f4c58b59cb4","fileName":"ELFT-function-library.js"},{"name":"On-Load Event","type":"event","item-type":"onload","_auto_id_":"f2e5db87-aa36-449f-8128-a4dc77963667","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"function storeOrientation() {\n  if (window.debug) {\n    debugger;\n  }\n  setTimeout(() => {\n    switch (window.orientation) {\n      case -90:\n      case 90:\n        cti.store.variables.orientation = \"landscape\";\n        break;\n      default:\n        if (window.screen.width > window.screen.height) {\n          cti.store.variables.orientation = \"landscape\";\n        } else {\n          cti.store.variables.orientation = \"portrait\";\n        }\n        break;\n    }\n\n    cti.utils.updatePage();\n  }, 250);\n}\n\nfunction storeOnlineStatus() {\n  cti.store.variables.online = true;\n  cti.utils.updatePage();\n}\n\nfunction storeOfflineStatus() {\n  cti.store.variables.online = false;\n  cti.utils.updatePage();\n}\n\n//mobile / desktop\nwindow.addEventListener(\"orientationchange\", storeOrientation);\nwindow.addEventListener(\"resize\", storeOrientation);\n\nwindow.addEventListener(\"online\", storeOnlineStatus);\nwindow.addEventListener(\"offline\", storeOfflineStatus);\n\nstoreOrientation();\n\ncti.store.variables.online = navigator.onLine;\n\n\ncti.store.variables.applicationData = []\n\ncti.store.variables.applicationData.push({name: \"Application Key\", value: cti.utils.getMetadataItem('applicationkey')})\ncti.store.variables.applicationData.push({name: \"Build ID\", value: cti.store.schema.buildId})\ncti.store.variables.applicationData.push({name: \"Package ID\", value: cti.store.schema.packageId})\ncti.store.variables.applicationData.push({name: \"Version\", value: cti.store.schema.version})\n\n\n//prevent iOS from highlighting phone numbers!\n$(\"head\").append('<meta name=\"format-detection\" content=\"telephone=no\" />');\n\ndocument.addEventListener(\n  \"resume\",\n  function(e) {\n    cti.fn_onAppResume(false);\n  },\n  false\n);\n\ncti.fn_onAppResume(true);\n\n$success();\n"},"_auto_id_":"d53cc595-5d4e-43ab-a1c2-e8d48cd5a9b2","actions":[]}]},{"name":"js_moment","type":"scripting","item-type":"js-asset","_auto_id_":"202c0252-82ef-4b33-a49d-3fb80b1116db","fileName":"moment.min.js"},{"name":"js_slip","type":"scripting","item-type":"js-asset","_auto_id_":"533d19d5-1713-43ee-b559-1e2fd8e4635f","fileName":"slip.js"},{"name":"pdf","type":"scripting","item-type":"js-asset","_auto_id_":"fd94355c-9a7d-42e8-b227-d30fbb5e5ca4","fileName":"pdf.js"},{"name":"pdf_worker","type":"scripting","item-type":"js-asset","_auto_id_":"4e7bb6e3-b8c1-41ba-bb31-f106e93692e0","fileName":"pdf.worker.js"},{"name":"pouchManager","type":"scripting","item-type":"js-asset","_auto_id_":"3c661861-9777-414e-9cc0-9f9e4e3ad750","fileName":"pouchManager.js"},{"name":"logManager","type":"scripting","item-type":"js-asset","_auto_id_":"93914f96-7ca9-4531-8d5c-4ab8886c95bd","fileName":"logManager.js"},{"name":"noUiSliderJS","type":"scripting","item-type":"js-asset","_auto_id_":"673f6988-ab14-4ee5-9f78-13b0f3d0bcec","fileName":"nouislider.min.js"},{"name":"js_asset_1","type":"scripting","item-type":"js-asset","_auto_id_":"e6b2e788-4d53-4900-a5d7-89619c29fced","fileName":"bootstrap.min.js"},{"name":"fn_call_contact","type":"scripting","item-type":"function","_auto_id_":"a25dd8d1-f5be-4dd4-9f6d-eb7a68d7c325","sync":true,"params":[{"name":"scope","description":"Element of 'this' from the onclick"}],"content":"window.logManager.consoleLog(\n  'function fn_call_contact(scope)', \n  'info'\n)\n\nif(scope) {\n  if(window) {\n  window.open('tel:141'+scope.replace(/\\\\s/g,''),'_system')\n  } else {\n    cti.utils.callAction(\"show-notification\", {\n      \"name\": \"notification_warning\", \n      \"title\" : \"Warning\", \n      \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n    })\n  }\n} else {\n  cti.utils.callAction(\"call-component-function\", {\"page\":\"Patient\",\"componentInstanceId\":\"edb5c78b-6c74-4ce2-a3a7-56d36fed07d5\",\"function\":\"toggle\"})\n}","actions":[]},{"name":"fn_calc_visit_duration","type":"scripting","item-type":"function","_auto_id_":"093bd40c-2f3d-4643-b59a-d389db3fce6f","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_calc_visit_duration()', \n  'info'\n);\n\nif (!cti.store.pages.Outcome) {\n  cti.store.pages.Outcome = {};\n}\n\nvar startDate = cti.store.variables.selected_visit.arrivalTime;\nvar arrivalTime = moment(startDate).format(\"HH:mm\");\nvar arrivalTimeHours = moment(arrivalTime, \"HH:mm\").format(\"HH\");\nvar arrivalTimeMinutes = moment(arrivalTime, \"HH:mm\").format(\"mm\");\nvar minsArrivalTime = parseInt(arrivalTimeMinutes);\nvar arrivalTimeLabel = \"\";\n\nif(minsArrivalTime < 15) { arrivalTimeLabel = arrivalTimeHours+\":00\"; }\nelse if(minsArrivalTime >= 15 && minsArrivalTime < 30) { arrivalTimeLabel = arrivalTimeHours+\":15\"; }\nelse if(minsArrivalTime >= 30 && minsArrivalTime < 45) { arrivalTimeLabel = arrivalTimeHours+\":30\"; } \nelse if(minsArrivalTime >= 45 && minsArrivalTime < 60) { arrivalTimeLabel = arrivalTimeHours+\":45\"; }\n\ncti.store.pages.Outcome.arrivalTime = arrivalTimeLabel;\ncti.store.pages.Outcome.actualTime = arrivalTimeLabel;\n\nvar now = moment().format(\"YYYY-MM-DDTHH:mm:ss\");\nvar time = moment.utc(moment(now,\"YYYY-MM-DDTHH:mm:ss\").diff(moment(startDate,\"YYYY-MM-DDTHH:mm:ss\"))).format(\"HH:mm\");\nvar mins = moment(time, \"HH:mm\").format(\"m\");\nvar hours = moment(time, \"HH:mm\").format(\"h\");\n\ncti.store.pages.Outcome.duration_hours = {\"label\": hours, \"value\": hours };\ncti.store.pages.Outcome.duration_minutes = {\"label\": mins, \"value\": mins };\n\ncti.utils.updatePage();"},{"name":"fn_canOutcomeAppointment","type":"scripting","item-type":"function","_auto_id_":"c9702942-26b0-420e-8397-e3ad97547b45","sync":true,"params":[],"content":"window.logManager.consoleLog('fn_canOutcomeAppointment()', 'info')\n\nif (window.debug) {\n  debugger\n}\n\ncti.store.variables.unsavedVisitData = ''\n\n// Unsaved progress note...\nlet enteredData = null\n\nif (cti.store.pages.Note) {\n  const n = cti.store.pages.Note\n\n  if (!!n) {\n    enteredData = ['noteType', 'subType', 'isValidated', 'specialty', 'noteText', 'flagSignificantEvent', 'flagThirdParty', 'flagClientConceal'].some(e => !!n[e])\n\n    if (!enteredData) {\n      enteredData = n.list_riskType && n.list_riskType.numberOfItems > 0\n    }\n\n    if (!enteredData) {\n      enteredData = (cti.store.media.btnPhoto && !!cti.store.media.btnPhoto.images) || (cti.store.media.btnAudio && !!cti.store.media.btnAudio.audio)\n    }\n  }\n}\n\nif (enteredData) {\n  console.log(`You got some Note data!!`)\n  cti.store.variables.unsavedVisitData += `${!!cti.store.variables.unsavedVisitData ? ', ' : ''}Note`\n}\n\n// Unsaved alert...\nenteredData = null\nif (cti.store.pages.Note) {\n  const n = cti.store.pages.Alert\n\n  if (!!n) {\n    enteredData = ['type', 'priority', 'description'].some(e => !!n[e])\n  }\n}\n\nif (enteredData) {\n  console.log(`You got some Alert data!!`)\n  cti.store.variables.unsavedVisitData += `${!!cti.store.variables.unsavedVisitData ? ', ' : ''}Alert`\n}\n\n// Check form statuses before outcoming.\n\nvar dialog = cti.store.variables.selected_visit.dialog_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\n\ncti.store.variables.o_activities = []\n\nif (dialog == 'failed' || dialog == 'inprogress') {\n  cti.store.variables.unsavedVisitData += `${!!cti.store.variables.unsavedVisitData ? ', ' : ''}Dialog+`\n} else if (dialog == 'complete' || dialog == 'sending') {\n  var dialogObj = {\n    group: undefined,\n    value: 'RMDialog',\n    label: 'DIALOG+'\n  }\n\n  cti.store.variables.o_activities.push(dialogObj)\n}\n\nif (safety == 'failed' || safety == 'inprogress') {\n  cti.store.variables.unsavedVisitData += `${!!cti.store.variables.unsavedVisitData ? ', ' : ''}My Safety Plan`\n} else if (safety == 'complete' || safety == 'sending') {\n  var safetyObj = {\n    group: undefined,\n    value: 'RMMSP',\n    label: 'My Safety Plan'\n  }\n\n  cti.store.variables.o_activities.push(safetyObj)\n}\n\nif (lifestyle == 'failed' || lifestyle == 'inprogress') {\n  cti.store.variables.unsavedVisitData += `${!!cti.store.variables.unsavedVisitData ? ', ' : ''}Lifestyle Assessment Form`\n} else if (lifestyle == 'complete' || lifestyle == 'sending') {\n  var lifestyleObj = {\n    group: undefined,\n    value: 'RMLife',\n    label: 'Lifestyle Assessment Form'\n  }\n\n  cti.store.variables.o_activities.push(lifestyleObj)\n}\n\nreturn cti.store.variables.unsavedVisitData === ''\n"},{"name":"fn_clearActivityTimeout","type":"scripting","item-type":"function","_auto_id_":"434b15af-12f2-412e-8c99-a8cef70f3fbf","sync":true,"params":[],"content":"console.log(`fn_clearActivityTimeout:: Clearing user activity timeout...`)\n\nclearTimeout(cti.store.variables.timeoutTimer)"},{"name":"fn_dialogCopyPrevious","type":"scripting","item-type":"function","_auto_id_":"c03aff42-ef71-4101-a1ed-83dcf6d6125e","sync":true,"params":[{"name":"question","description":"The question to copy the previous value from and to","required":true}],"content":"const page = 'DialogFormOne'\n\n// We can assume the page and previous data exist because the copy function should not be available if not. Today's value might not exist so check for that first - we're adding to, rather than replacing.\nif (!cti.store.pages[page][question]) {\n  cti.store.pages[page][question] = ''\n}\ncti.store.pages[page][question] += cti.store.pages[page][`${question}_prev`]"},{"name":"fn_DialogForm_Toggler","type":"scripting","item-type":"function","_auto_id_":"8c019918-0c14-4a22-a90a-5860b5bc081f","sync":true,"params":[{"name":"index","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_DialogForm_Toggler(index)', \n  'info'\n);\n\ncti.store.pages.DialogPlus_Form.active_question = parseInt(index, 10);\ncti.store.pages.DialogPlus_Form.active_question_display = parseInt(index, 10) +1;\ncti.utils.updatePage();","actions":[]},{"name":"fn_get_location","type":"scripting","item-type":"function","_auto_id_":"bcd20c8b-3548-41b8-b652-0c61912d9d6a","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_get_location()', \n  'info'\n)\n\nfunction setPosition(position){\n  window.logManager.consoleLog(\n    'function setPosition() Callback - Successfully saved current location', \n    'info'\n  )\n  \n  if(position && position.coords && position.coords.latitude) {\n  \tcti.store.variables.latitude = position.coords.latitude.toString()\n  } else {\n    cti.store.variables.latitude = cti.store.schema.metadata.latitude || \"53.3125156\" // Sevelec HQ latitude\n  }\n  if(position && position.coords && position.coords.longitude) {\n  \tcti.store.variables.longitude = position.coords.longitude.toString()\n  } else {\n    cti.store.variables.longitude = cti.store.schema.metadata.longitude || \"-1.3461527\" // Sevelec HQ longitude\n  }\n  \n  return true\n}\n\nif(cti.store.env.platform.name != \"electron\"){\n  navigator.geolocation.getCurrentPosition(setPosition)\n  return true;\n} else {\n  cti.store.variables.latitude = cti.store.schema.metadata.latitude || \"53.3125156\" // Sevelec HQ latitude\n  cti.store.variables.longitude = cti.store.schema.metadata.longitude || \"-1.3461527\" // Sevelec HQ longitude\n  \n  return true\n}"},{"name":"fn_hideFreeSpinner","type":"scripting","item-type":"function","_auto_id_":"eefe23e3-9d50-48e0-adf7-c82df4aa8dca","sync":true,"params":[],"content":"const spinners = document.body.getElementsByClassName('free-spinner')\n\nlet i = spinners && spinners.length\nwhile (i--) {\n  spinners[i].remove()\n}"},{"name":"fn_init_google_maps","type":"scripting","item-type":"function","_auto_id_":"db191980-6c00-4996-b0f5-eaa55a198507","sync":true,"params":[{"name":"callback"}],"content":"window.logManager.consoleLog(\"function fn_init_google_maps(callback)\", \"info\");\n\n// Grab api key from schema\nvar apiKey = cti.store.schema.metadata.googleMapsApiKey;\n// Set Google URL with the cti.fn_render_map as the callback function\nvar url = \"https://maps.googleapis.com/maps/api/js?v=3.31&key=\" + apiKey + \"&callback=\" + callback;\n\n// If Google maps is not initiated into the app, create and load it here\nif (cti.store.variables.online && $(\"head script[src='\" + url + \"']\").length == 0) {\n  var s = document.createElement(\"script\");\n  s.type = \"text/javascript\";\n  s.src = url;\n\n  // Use any selector\n  s.async = true;\n  s.defer = true;\n  $(\"head\").append(s);\n  console.log(\"maps loaded\");\n  return true;\n} else {\n  return false;\n}\n"},{"name":"fn_load_appointments","type":"scripting","item-type":"function","_auto_id_":"c70d8079-dd69-4e9c-8609-3a1e5ac7d4b1","sync":true,"params":[],"content":"window.logManager.consoleLog('function fn_load_appointments(filter)', 'info')\n\nif (window.debug) {\n  debugger\n}\n\nif (cti.store.variables.v_appointmentDate === undefined) {\n  cti.store.variables.v_appointmentDate = moment().format('YYYY-MM-DD')\n  cti.store.variables.v_appointmentDateText = 'Today'\n}\n\n// Load appointments from pouch\nwindow.pouchManager.loadFromDatabase(\n  'appointments',\n  function(doc) {\n    // Set the appointments variable\n    var appointments = doc.data\n\n    // Filter the appointments with user friendly data and append\n    // status values to them via the fn_set_appointments function\n    var setAppointments = cti.fn_set_appointments(appointments)\n\n    // Reset the v_selectedDayAppointments array\n    cti.store.variables.v_selectedDayAppointments = []\n\n    // For loop throught the array of appointments\n    for (var i in setAppointments) {\n      var thisAppointment = setAppointments[i]\n\n      // If thisAppointment created date matches our filter date then\n      // push this into the v_selectedDayAppointments array\n      if (moment(thisAppointment.appointmentDateTime).format('YYYY-MM-DD') === cti.store.variables.v_appointmentDate) {\n        var pushAppointment = JSON.parse(JSON.stringify(thisAppointment))\n        cti.store.variables.v_selectedDayAppointments.push(pushAppointment)\n      }\n    }\n\n    // Loop through the selectedDay appointments and create readable\n    // index values for them\n    for (var x in cti.store.variables.v_selectedDayAppointments) {\n      var thisSelectedDayAppointment = cti.store.variables.v_selectedDayAppointments[x]\n      thisSelectedDayAppointment.index = parseInt(x)\n      var title = ''\n\n      if (thisSelectedDayAppointment.patientData.demographics.title != undefined && thisSelectedDayAppointment.patientData.demographics.title != '') {\n        title = ' (' + thisSelectedDayAppointment.patientData.demographics.title + ')'\n      }\n\n      var displayName = thisSelectedDayAppointment.patientData.demographics.surname + ', ' + thisSelectedDayAppointment.patientData.demographics.firstname + title\n      thisSelectedDayAppointment.displayName = displayName\n\n      thisSelectedDayAppointment.surname = thisSelectedDayAppointment.patientData.demographics.surname\n      thisSelectedDayAppointment.mobilePhoneNumber = thisSelectedDayAppointment.patientData.demographics.mobilePhoneNumber\n      thisSelectedDayAppointment.eveningPhoneNumber = thisSelectedDayAppointment.patientData.demographics.eveningPhoneNumber\n      thisSelectedDayAppointment.officePhoneNumber = thisSelectedDayAppointment.patientData.demographics.officePhoneNumber\n\n      // Delete all patientData\n      delete thisSelectedDayAppointment.patientData\n\n      // Remove additional appointment information\n      delete thisSelectedDayAppointment.addressFormatted\n      delete thisSelectedDayAppointment.age\n      delete thisSelectedDayAppointment.attendees\n      delete thisSelectedDayAppointment.dialog_form\n      delete thisSelectedDayAppointment.gpDetails\n      delete thisSelectedDayAppointment.healthcareProfessional\n      delete thisSelectedDayAppointment.lifestyle_form\n      delete thisSelectedDayAppointment.location\n      delete thisSelectedDayAppointment.safety_form\n      delete thisSelectedDayAppointment.warnings\n      delete thisSelectedDayAppointment.createdAtDateTime\n      delete thisSelectedDayAppointment.intendedDuration\n    }\n\n    // Update the pouch DB with new data\n    window.pouchManager.saveToDatabase(\n      'appointments',\n      setAppointments,\n      function(rev) {\n        window.logManager.consoleLog('Pouch DB - Updated Appointment Data. Revision: ' + rev, 'info')\n\n        if (cti.store.variables.return) {\n          delete cti.store.variables.return\n          delete cti.store.variables.selected_visit\n        }\n\n        cti.fn_toggle_spinner('close', '', 500)\n\n        cti.utils.callAction('go-to-page', { name: 'Visits' })\n\n        // if (cti.store.state.currentPage == 'Visits') {\n        //   window.logManager.consoleLog('fn_load_appointments: Is Visits page so no navigation', 'info')\n\n        //   for (var i in cti.store.variables.v_selectedDayAppointments) {\n        //     var appointment = cti.store.variables.v_selectedDayAppointments[i]\n        //     var postcode = appointment.postCode.replace(/\\s/g, '')\n        //     var id = 'travel-container-' + i\n            \n        //     var travelContainer = document.getElementById(id)\n\n        //     if (travelContainer) {\n        //       if (navigator.appVersion.indexOf('Android') != -1) {\n        //         travelContainer.onclick = function() {\n        //           cti.fn_navigate(postcode)\n        //         }\n        //       } else {\n        //         travelContainer.href = 'maps:0,0?q=' + postcode\n        //       }\n        //     } else {\n        //       console.log(`Could not find ${id} in DOM, could not set click event or href.`)\n        //     }\n        //   }\n        //   cti.utils.updatePage()\n        // } else {\n        //   window.logManager.consoleLog('fn_load_appointments: Navigating to Visits page', 'info')\n\n        //   cti.utils.callAction('go-to-page', { name: 'Visits' })\n        // }\n      },\n      function(reason, e) {\n        window.logManager.consoleLog('Pouch DB - Failed to Update Appointment Data - ' + reason + e, 'error')\n\n        cti.fn_toggle_spinner('close', '', 500)\n      }\n    )\n  },\n  function(reason, err) {\n    window.logManager.consoleLog('Pouch DB - Failed retrieving Appointments Data from Pouch - ' + reason + err, 'error')\n\n    cti.fn_toggle_spinner('close', '', 500)\n  }\n)\n","actions":[]},{"name":"fn_load_document","type":"scripting","item-type":"function","_auto_id_":"40232cfd-eb89-490c-977b-0090029628de","sync":true,"params":[{"required":true,"name":"document","description":"The document object"}],"content":"window.logManager.consoleLog(\"function fn_load_document(document)\", \"info\");\n\n// Parse the selected document\nvar docObj = JSON.parse(document);\n\nif (!cti.fn_sanitizeMimeType(docObj)) {\n  cti.utils.callAction(\"show-notification\", {\n    name: \"notification_error\",\n    title: \"Error\",\n    text: `Filetype \"${document.fileType || \"\"}\" is not supported`\n  });\n  return false;\n}\n\nif (!cti.store.variables.online) {\n  cti.utils.callAction(\"show-notification\", {\n    name: \"notification_warning\",\n    title: \"Warning: Device Offline\",\n    text: \"You are currently offline, please try again.\"\n  });\n  return false;\n}\n\n// Load Spinner\ncti.fn_toggle_spinner(\"open\", \"Downloading Document...\");\n\n// Package the documentGet payload object ...\nvar documentPayload = {\n  clientId: cti.store.variables.selected_visit.patientData.demographics.clientId,\n  documentId: docObj.documentId,\n  documentSerialNumber: docObj.serialNumber,\n  documentDate: docObj.documentDate\n};\n\n// Remove rouge T if coming from the progress notes\nvar formattedDate = documentPayload.documentDate.replace(\"T\", \" \");\ndocumentPayload.documentDate = formattedDate;\n\n// ... also set a global variable so that we can access the doc type on success return\ncti.store.variables.v_selectedDocument = docObj;\n\n// Set payload object and kick off GetDocument actionflow\ncti.store.variables.v_documentGetPayload = documentPayload;\ncti.utils.callAction(\"call-actionflow\", { name: \"GetDocument\" });\n"},{"name":"fn_letOsOpenDocument","type":"scripting","item-type":"function","_auto_id_":"0a3e394e-e08a-40b4-ba40-deeb99d5d6f0","sync":true,"params":[],"content":"window.logManager.consoleLog(\"function fn_letOsOpenDocument()\", \"info\");\n\nif (window.debug_fn_letOsOpenDocument) {\n  debugger;\n}\n\nif (!cti.store.variables.v_selectedDocument) {\n  return;\n}\nconst document = cti.store.variables.v_selectedDocument;\n\nconst base64 = document.base64 || \"\";\n\nif (!base64) {\n  return onError({ code: \"File data not downloaded\" });\n}\n\nconst mimeType = cti.fn_sanitizeMimeType(document.fileType && document.fileType.toLowerCase() || \"\");\nconst fileExtension = cti.fn_getFileExtFromMimeType(mimeType);\n\nif (!fileExtension) {\n  return onError({\n    code: `Filetype \"${mimeType || \"\"}\" is not supported`\n  });\n}\n\nconst fileName =\n  (document.documentId || \"document\") +\n  \"-\" +\n  new Date().valueOf() +\n  \".\" +\n  fileExtension;\n\nfunction gotFileSystem(fs, fileName) {\n  fs.getFile(\n    fileName,\n    { create: true, exclusive: false },\n    gotFileEntry,\n    onError\n  );\n}\n\nfunction gotFileEntry(fileEntry) {\n  fileEntry.createWriter(fileWriter => {\n    fileWriter.onwriteend = e => {\n      openFile(cordova.file.dataDirectory + fileName, mimeType);\n    };\n    fileWriter.onerror = err => {\n      console.log(`Write file failed: ${err.toString()}.`);\n      return false;\n    };\n\n    fetch(`data:${mimeType};base64,${base64}`)\n      .then(res => res.blob())\n      .then(blob => fileWriter.write(blob));\n  });\n}\n\nfunction onError(e) {\n  console.log(`Document open failed with code: ${e.code}`);\n  cti.utils.callAction(\"show-notification\", {\n    name: \"notification_error\",\n    title: \"Error\",\n    text: `Requested document could not be opened.`\n  });\n}\n\nwindow.resolveLocalFileSystemURL(\n  cordova.file.dataDirectory,\n  dirEntry => {\n    gotFileSystem(dirEntry, fileName);\n  },\n  onError\n);\n\n// Open file with the relevant application\nfunction openFile(filePath, mimeType) {\n  cordova.plugins.fileOpener2.open(filePath, mimeType, {\n    error: e => {\n      onError({ code: JSON.stringify(e) });\n    }\n  });\n}\n"},{"name":"fn_sanitizeMimeType","type":"scripting","item-type":"function","_auto_id_":"530deb38-96af-4cef-9724-120ebe43e667","sync":true,"params":[{"name":"mimeType","required":true}],"content":"window.logManager.consoleLog(\"function fn_sanitizeMimeType(document)\", \"info\");\n\nif (window.debug_fn_sanitizeMimeType) {\n  debugger\n}\n\nif (!mimeType) {\n  return false;\n}\n\nswitch (mimeType) {\n  case \"image/x-ms-bmp\":\n    mimeType = \"image/bmp\";\n    break;\n  case \"application/rtf\":\n    mimeType = \"text/rtf\";\n    break;\n  default:\n    break;\n}\n\nreturn mimeType\n"},{"name":"fn_getFileExtFromMimeType","type":"scripting","item-type":"function","_auto_id_":"ff83f503-4590-4358-887b-7739bef8c207","sync":true,"params":[{"name":"mimeType","required":true}],"content":"window.logManager.consoleLog(\"function fn_getFileExtFromMimeType(mimeType)\", \"info\");\n\nif (window.debug_fn_getFileExtFromMimeType) {\n  debugger\n}\n\nif (!mimeType) {\n  return false;\n}\n\nlet fileExtension = \"\"\nswitch (mimeType) {\n  case \"image/bmp\":\n    fileExtension = \"bmp\";\n    break;\n  case \"application/msword\":\n    fileExtension = \"doc\";\n    break;\n  case \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\":\n    fileExtension = \"docx\";\n    break;\n  case \"image/gif\":\n    fileExtension = \"gif\";\n    break;\n  case \"text/html\":\n    fileExtension = \"html\";\n    break;\n  case \"image/jpeg\":\n    fileExtension = \"jpg\";\n    break;\n  case \"application/pdf\":\n    fileExtension = \"pdf\";\n    break;\n  case \"image/png\":\n    fileExtension = \"png\";\n    break;\n  case \"text/rtf\":\n    fileExtension = \"rtf\";\n    break;\n  case \"text/plain\":\n    fileExtension = \"txt\";\n    break;\n  case \"application/vnd.ms-excel\":\n    fileExtension = \"xls\";\n    break;\n  case \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\":\n    fileExtension = \"xlsx\";\n    break;\n  default:\n    break;\n}\n\nreturn fileExtension\n"},{"name":"fn_load_form","type":"scripting","item-type":"function","_auto_id_":"638888a9-bbad-413f-b335-dcbfaf6e77e8","sync":true,"params":[{"name":"formType","description":"What form we want to load"}],"content":"window.logManager.consoleLog(\n    'function fn_load_form(form)', \n    'info'\n  )\n  \n  // Check that we have started the visit. If not then return false and show warning\n  if(cti.store.variables.selected_visit.status != \"complete\" && cti.store.variables.selected_visit.arrivalTime === undefined) {\n    cti.utils.callAction(\"show-notification\", {\n      \"name\": \"notification_warning\", \n      \"title\" : \"Warning: You have not started this Visit\", \n      \"text\" : \"You must start the Visit before you can complete any forms.\"\n    })\n    \n    return false\n  }\n  \n  const patientData = cti.store.variables.selected_visit.patientData || null\n  \n  // If we're selecting the dialog form, check that we haven't already started the form\n  if(formType === \"dialogplus\") {\n    // If we haven't started the form, set the status to inprogress\n    if(cti.store.variables.selected_visit.dialog_form_status != \"complete\" && cti.store.variables.selected_visit.dialog_form_status != \"outcomed\") {\n      if(cti.store.variables.selected_visit.dialog_form_status == \"sending\") {\n           cti.utils.callAction(\"show-notification\", {\n            \"name\": \"notification_warning\", \n            \"title\" : \"Warning: Dialog+ Form currently syncing to RiO\", \n            \"text\" : \"You have completed and submitted the Dialog+ Form for this Appointment.\"\n          })\n  \n          return false\n      }\n      \n      cti.fn_showFreeSpinner('Loading Dialog+ Form...')\n      \n      cti.store.variables.selected_visit.dialog_form_status = \"inprogress\"\n      cti.store.variables.selected_visit.dialog_form_status_text = \"In Progress...\"\n      \n      cti.store.variables.dialogIsReadOnly = false\n  \n      cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormPre\"})\n    } else {\n      if(cti.store.variables.selected_visit.patientData.dialogPlusForms && cti.store.variables.selected_visit.patientData.dialogPlusForms.length > 0) {\n        cti.fn_view_dialog(true)\n      } else {\n        cti.utils.callAction(\"show-notification\", {\n          \"name\": \"notification_warning\", \n          \"title\" : \"Warning: There are no Dialog+ Forms\", \n          \"text\" : \"This patient does not currently have any Dialog+ Forms completed.\"\n        })\n        \n        return false\n      }\n    }\n  } else if(formType === \"phlifestyl\") {\n    // If we haven't started the form, set the status to inprogress\n    if(cti.store.variables.selected_visit.lifestyle_form_status != \"complete\" && cti.store.variables.selected_visit.lifestyle_form_status != \"outcomed\") {\n      if(cti.store.variables.selected_visit.lifestyle_form_status == \"sending\") {\n           cti.utils.callAction(\"show-notification\", {\n            \"name\": \"notification_warning\", \n            \"title\" : \"Warning: Lifestyle Assesment Form currently syncing to RiO\", \n            \"text\" : \"You have completed and submitted the Lifestyle Assessment Form for this Appointment.\"\n          })\n  \n          return false\n      }\n      \n      cti.fn_toggle_spinner('open', 'Loading Lifestyle Assessment Form...')\n      \n      // Set defaults if this is the first time we've opened this form in this visit.\n      if (cti.store.variables.selected_visit.lifestyle_form_status !== \"inprogress\") {\n        // Set up defaults if we have any (individual question defaults are set up on the page itself, we manage switches here because they have no default option....\n        cti.store.variables.lastLifestyleForm = null\n        if (patientData && patientData.lifestyleAssessmentForms && patientData.lifestyleAssessmentForms.length > 0) {\n          cti.store.variables.lastLifestyleForm = patientData.lifestyleAssessmentForms[0]\n        }\n      }\n      \n      cti.store.variables.selected_visit.lifestyle_form_status = \"inprogress\"\n      cti.store.variables.selected_visit.lifestyle_form_status_text = \"In Progress...\"\n  \n      cti.utils.callAction(\"go-to-page\", {\"name\":\"LifestyleFormOne\"})\n    } else {\n      if(cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms && cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms.length > 0) {\n        cti.fn_view_lifestyle(true)\n      } else {\n        cti.utils.callAction(\"show-notification\", {\n          \"name\": \"notification_warning\", \n          \"title\" : \"Warning: There are no Lifestyle Forms\", \n          \"text\" : \"This patient does not currently have any Lifestyle Forms completed.\"\n        })\n  \n        return false\n      }\n    }\n  } else if(formType === \"msp\") {\n    if(cti.store.variables.selected_visit.safety_form_status != \"complete\" && cti.store.variables.selected_visit.safety_form_status != \"outcomed\") {\n      if(cti.store.variables.selected_visit.safety_form_status == \"sending\") {\n           cti.utils.callAction(\"show-notification\", {\n            \"name\": \"notification_warning\", \n            \"title\" : \"Warning: My Safety Plan Form currently syncing to RiO\", \n            \"text\" : \"You have completed and submitted the My Safety Plan Form for this Appointment.\"\n          })\n  \n          return false\n      }\n      \n      // Set defaults if this is the first time we've opened this form in this visit.\n      if (cti.store.variables.selected_visit.safety_form_status !== \"inprogress\") {\n        // Set up defaults if we have any (individual question defaults are set up on the page itself, we manage switches here because they have no default option....\n        cti.store.variables.lastMySafety = null\n        if (patientData && patientData.mySafetyPlanForms && patientData.mySafetyPlanForms.length > 0) {\n          cti.store.variables.lastMySafety = patientData.mySafetyPlanForms[0]\n\n          //if the SafetyForm page doesn't exist create it as an empty object so properties can be set on it.\n          if(!cti.store.pages.SafetyForm){\n            cti.store.pages.SafetyForm = {};\n          }\n  \n          cti.store.pages.SafetyForm.sf_advancedirective = cti.store.variables.lastMySafety.advDir.result === \"1\"\n          cti.store.pages.SafetyForm.sf_serviceuseragreedplan = cti.store.variables.lastMySafety.suAgree.result === \"1\"\n        }\n      }\n    \n      cti.fn_toggle_spinner('open', 'Loading My Safety Plan Form...')\n      \n      cti.store.variables.selected_visit.safety_form_status = \"inprogress\"\n      cti.store.variables.selected_visit.safety_form_status_text = \"In Progress...\"\n  \n      cti.utils.callAction(\"go-to-page\", {\"name\":\"SafetyForm\"})\n    } else {\n      if(cti.store.variables.selected_visit.patientData.mySafetyPlanForms && cti.store.variables.selected_visit.patientData.mySafetyPlanForms.length > 0) {\n        cti.fn_view_safety(true)\n      } else {\n        cti.utils.callAction(\"show-notification\", {\n          \"name\": \"notification_warning\", \n          \"title\" : \"Warning: There are no My Safety Forms\", \n          \"text\" : \"This patient does not currently have any My Safety Forms completed.\"\n        })\n  \n        return false\n      }\n    }\n  } "},{"name":"fn_merge_busy_slots","type":"scripting","item-type":"function","_auto_id_":"3f67456a-b2da-4d14-86ac-3a43410e64d7","sync":true,"params":[{"name":"bookedSlots","description":"Busy / Booked appointment slots","required":true},{"name":"dow","description":"Day of the week to merge (zero-indexed)","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_merge_busy_slots(bookedSlots, dow)', \n  'info'\n);\n\n// Process all sessions on the given day and return a list of free slots which can be booked into.\n\nvar diaryTemplate = cti.store.variables.v_diary_template\n\nvar selectedDay = diaryTemplate[dow] || {}\nbookedSlots = bookedSlots || []\nvar freeSlots = []\n\n// Ensure we've got at least one session to work with - if not, bomb straight out with empty free slots.\nif (!selectedDay.sessions || !selectedDay.sessions[0] || !selectedDay.sessions[0].startTime) {\n  return freeSlots\n}\n\nbookedSlots.sort(function(a, b) {\n  if (!a.startDateTime || !b.startDateTime || !a.endDateTime || !b.endDateTime) {\n    return 0\n  }\n  if (a.startDateTime < b.startDateTime) {\n    return -1\n  }\n  if (a.startDateTime > b.startDateTime) {\n    return 1\n  }\n  if (a.endDateTime < b.endDateTime) {\n    return -1\n  }\n  if (a.endDateTime > b.endDateTime) {\n    return 1\n  }\n  return 0\n})\n\nvar getBusyPointerStartTime = function getBusyPointerStartTime(busyPointerIndex, sessionIndex) {\n  // Ascertain if we have any booked slots to use and if so, do. Otherwise, use the current end of session marker.\n  if (bookedSlots && bookedSlots.length > busyPointerIndex && bookedSlots[busyPointerIndex].startDateTime) {\n    return moment(bookedSlots[busyPointerIndex].startDateTime)\n  } else {\n    return moment(selectedDay.sessions[sessionIndex].endTime, 'HH:mm')\n  }\n}\n\nvar freePointer = moment.duration(selectedDay.sessions[0].startTime)\n\nvar busyPointerIndex = 0\n\nvar busyPointer = moment.duration(moment(getBusyPointerStartTime(busyPointerIndex, 0)).format('HH:mm'))\n\nselectedDay.sessions.forEach(function(session, index) {\n  var sessionEndMins = moment.duration(session.endTime).asMinutes()\n\n  while (freePointer.asMinutes() + session.slotLength <= sessionEndMins) {\n    // Slot conflict checking...\n    //\n    // - Need to move freePointer to the end of each bookedSlot if it meets / overlaps.\n    // - Can add the free slot if the current potential free slot starts before the current busy pointer (either an appt or the end of session marker) and that slot can exist in its entirety - i.e. adding\n    //   slot length to the start time is still within those bounds.\n    if (freePointer.asMinutes() <= busyPointer.asMinutes() && freePointer.asMinutes() + session.slotLength <= busyPointer.asMinutes()) {\n      var hours = Math.floor(freePointer.asHours())\n      var start = (hours < 10 ? '0' : '') + hours + moment.utc(freePointer.asMilliseconds()).format(':mm')\n\n      // const slot = {\n      //   day: `${selectedDay.name}`,\n      //   time: `${start}`,\n      //   duration: session.slotLength\n      // }\n\n      var slot = {\n        code: '' + start,\n        value: '' + start\n      }\n\n      freeSlots.push(slot)\n    }\n\n    // Update the pointers accordingly.\n\n    // If we're at the start of or into the appt, move the free pointer to the end of this appt and move the busyPointer on to the next appt if there is one or alternatively, the end of the session.\n    if ((freePointer.asMinutes() >= busyPointer.asMinutes() || freePointer.asMinutes() + session.slotLength >= busyPointer.asMinutes()) && !!bookedSlots[busyPointerIndex]) {\n      // Set freePointer to be the latter of the end of the blocking appt and the next available slot start - to avoid odd minutes being made available.\n      var busySlotEnd = moment.duration(moment(bookedSlots[busyPointerIndex].endDateTime, 'YYYY-MM-DD HH:mm:ss').format('HH:mm'))\n\n      // Add as many slot lengths as we need to get past the current busy slot.\n      while (freePointer.asMinutes() < busySlotEnd.asMinutes()) {\n        freePointer = freePointer.add(session.slotLength, 'minutes')\n      }\n\n      busyPointerIndex++\n\n      busyPointer = moment.duration(getBusyPointerStartTime(busyPointerIndex, index).format('HH:mm'))\n    } else {\n      freePointer.add(session.slotLength, 'minutes')\n    }\n  }\n\n  // If we've got another session, update the pointer to either its current position or the start of the next session, whichever is later (to account for session overlaps).\n  if (!!selectedDay.sessions[index + 1]) {\n    var nextSessionStart = moment.duration(selectedDay.sessions[index + 1].startTime)\n    if (nextSessionStart.asMinutes() > freePointer.asMinutes()) {\n      freePointer = nextSessionStart\n    }\n  }\n})\n\nreturn freeSlots"},{"name":"fn_navigate","type":"scripting","item-type":"function","_auto_id_":"f3d7cea4-1ab7-450e-8624-cdefbbea95bc","sync":true,"params":[{"name":"postcode"}],"content":"window.logManager.consoleLog(\n  'function fn_navigate(postcode)', \n  'info'\n)\n\nif((cti.store.env.platform.name).toLowerCase().indexOf('ios') != -1) { \n  cti.utils.callAction(\"call-url\", {\"name\":\"url_google_maps\",\"params\":{\"saddr\":\"current location\",\"daddr\":postcode}})\n} else {\n  var destination = \"geo:0,0?q=\" + postcode.replace(/\\s/g,'')\n  window.open(destination)\n}","actions":[]},{"name":"fn_note_load_subnotes","type":"scripting","item-type":"function","_auto_id_":"3c67b950-2640-416d-a350-85fcb81edd41","sync":true,"params":[],"content":"if (window.debug) {\n  debugger\n}\nconsole.log(`fn_note_load_subnotes()`)\n\nif (!cti.store.pages.Note) {\n  cti.store.pages.Note = {}\n}\n\nvar config = cti.store.api.api_rio.getnoteconfig.data.progressNoteConfiguration\nvar noteTypes = cti.store.api.api_rio.getnotetypes.data.progressNoteTypes.uiNoteTypes\nvar selectedNote = cti.store.pages.Note.noteType || cti.store.variables.defaultNoteType || null\n\ncti.store.variables.note = undefined\ncti.store.variables.uiSubNoteTypes = undefined\n\nif (selectedNote) {\n  var hasSubNotes = false\n\n  const note = noteTypes.find(n => n.code === selectedNote.value)\n\n  if (note) {\n    cti.store.variables.note = note\n    cti.store.variables.uiSubNoteTypes = note.sub\n  }\n}\n\nif (cti.store.variables.note && cti.store.variables.note.canValidateOwn) {\n  cti.store.pages.Note.isValidated = {\n    label: 'Not Validated',\n    value: '0'\n  }\n} else if (cti.store.variables.note && config.validatedByDefault) {\n  cti.store.pages.Note.isValidated = {\n    label: 'Validated',\n    value: '1'\n  }\n} else {\n  cti.store.pages.Note.isValidated = undefined\n}\n\ncti.utils.updatePage()\n"},{"name":"fn_normalise_diary_templ","type":"scripting","item-type":"function","_auto_id_":"3d7016ce-be17-479a-a7d3-6b7a3843a799","sync":true,"params":[{"name":"importedTemplate","description":"The diary template array from RiO","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_normalise_diary_templ(importedTemplate)', \n  'info'\n);\n\n// importedTemplate = array of template objects\n\n// Servelec days are 1-indexed.\nvar DAY_NUMBER_OFFSET = 1;\n\nvar diaryTemplate = [{\n  name: 'Monday',\n  sessions: []\n}, {\n  name: 'Tuesday',\n  sessions: []\n}, {\n  name: 'Wednesday',\n  sessions: []\n}, {\n  name: 'Thursday',\n  sessions: []\n}, {\n  name: 'Friday',\n  sessions: []\n}, {\n  name: 'Saturday',\n  sessions: []\n}, {\n  name: 'Sunday',\n  sessions: []\n}];\n\n// Normalise diary template data - we're only interested in so much of it.\ndiaryTemplate.forEach(function (dt, i) {\n  // Add all of today's sessions.\n  dt.sessions = importedTemplate.filter(function (e) {\n    var appointmentsAreAllowed = function appointmentsAreAllowed() {\n      return e.noAppointments != true;\n    };\n    var isCorrectDay = function isCorrectDay() {\n      return e.dayNumber === (i + DAY_NUMBER_OFFSET).toString();\n    };\n    var isInMultiRange = function isInMultiRange() {\n      // If this slot only covers one day, it's not multi so exit.\n      if (e.endDayNumber === e.dayNumber) {\n        return false;\n      }\n\n      return i + DAY_NUMBER_OFFSET >= parseInt(e.dayNumber) && i + DAY_NUMBER_OFFSET <= parseInt(e.endDayNumber);\n    };\n\n    return appointmentsAreAllowed() && (isCorrectDay() || isInMultiRange());\n  }).map(function (e) {\n    return {\n      startTime: e.startTime,\n      endTime: e.endTime,\n      slotLength: parseInt(e.slotLength),\n      addedFromDay: e.dayOfWeek\n    };\n  }).sort(function (a, b) {\n    if (a.startTime < b.startTime) {\n      return -1;\n    }\n    if (a.startTime > b.startTime) {\n      return 1;\n    }\n    if (a.endTime < b.endTime) {\n      return -1;\n    }\n    if (a.endTime > b.endTime) {\n      return 1;\n    }\n    return 0;\n  });\n});\n\ncti.store.variables.v_diary_template = diaryTemplate"},{"name":"fn_onAppResume","type":"scripting","item-type":"function","_auto_id_":"54d0b5ef-5bf7-4662-99a9-c53dea750143","sync":true,"params":[{"name":"isFreshLoad","description":"Tells the function that we are loading from cold","default":"false"}],"content":"console.log(`fn_onAppResume`);\n\nif (window.debug) {\n  debugger;\n}\n\nfunction goLogin() {\n  localStorage.Community_Worker_stack = '[\"/Login\"]';\n  cti.store.state.currentPage = \"Login\";\n\n  cti.utils.callAction(\"go-to-page\", { name: \"Login\" });\n}\nfunction goPin() {\n  localStorage.Community_Worker_stack = '[\"/Enter_PIN\"]';\n  cti.store.state.currentPage = \"Enter_PIN\";\n\n  cti.utils.callAction(\"go-to-page\", { name: \"Enter_PIN\" });\n}\n\nfunction goSetPin() {\n  localStorage.Community_Worker_stack = '[\"/Set_PIN\"]';\n  cti.store.state.currentPage = \"Set_PIN\";\n\n  cti.utils.callAction(\"go-to-page\", { name: \"Set_PIN\" });\n}\n\nfunction goVisits() {\n  localStorage.Community_Worker_stack = '[\"/Visits\"]';\n  cti.store.state.currentPage = \"Visits\";\n\n  cti.utils.callAction(\"call-actionflow\", { name: \"RefreshAppointments\" });\n\n  cti.fn_startActivityListener();\n}\n\nvar isTouchIdAvailable = function() {\n  console.log(`Checking for biometrics...`);\n  if (window.plugins && window.plugins.touchid) {\n    console.log(`TouchID plugin available, checking for TouchID / FaceID...`);\n    window.plugins.touchid.isAvailable(iOSverifyPrint, goPin);\n  } else {\n    console.log(`TouchID plugin NOT available...setting manual PIN`);\n    goPin();\n  }\n};\n\nvar iOSverifyPrint = function() {\n  console.log(\n    `Running iOSVerifyPrint...specifically 'verifyFingerprintWithCustomPasswordFallbackAndEnterPasswordLabel()'`\n  );\n\n  // Seeing a race condition in iOS 11 where this attempts to load whilst the app is still loading (somehow) - seeing error -1004: User interaction is required.\n  setTimeout(() => {\n    window.plugins.touchid.verifyFingerprintWithCustomPasswordFallbackAndEnterPasswordLabel(\n      \"Scan your fingerprint please\",\n      \"Enter App PIN\",\n      function(msg) {\n        console.log(`TouchID success:`);\n        console.log(JSON.stringify(msg));\n        goVisits();\n      },\n      function(msg) {\n        console.log(`TouchID failed:`);\n        console.log(JSON.stringify(msg));\n        // code: -8 (TouchID blocked)\n        //  code: -3 (fallback)\n        //  code: -2 (cancelled)\n        if (msg.code < 0) {\n          goPin();\n        }\n      }\n    );\n  }, 0);\n};\n\nvar isFingerprintAuthAvailable = function() {\n  console.log(`Checking for FingerprintAuth...`);\n  FingerprintAuth.isAvailable(\n    function(result) {\n      console.log(result);\n\n      if (\n        result.isAvailable === true &&\n        result.hasEnrolledFingerprints === true\n      ) {\n        var encryptConfig = {\n          maxAttempts: 3,\n          locale: \"en_US\",\n          dialogTitle: \"Fingerprint scan\",\n          dialogMessage: \"Please scan your fingerprint\"\n        }; // See config object for required parameters\n\n        FingerprintAuth.encrypt(\n          encryptConfig,\n          function(_fingerResult) {\n            if (_fingerResult.withFingerprint) {\n              goVisits();\n            } else if (_fingerResult.withBackup) {\n              goVisits();\n            }\n          },\n          function(err) {\n            if (err === \"Cancelled\") {\n              console.log(\"FingerprintAuth cancelled\");\n              goPin();\n            } else {\n              console.log(`FingerprintAuth error: ${err}`);\n              goPin();\n            }\n          }\n        );\n      } else {\n        console.log(\"FingerprintAuth not available or user has not enrolled\");\n        goPin();\n      }\n    },\n    function(err) {\n      console.log(\"FingerprintAuth not available\");\n      goPin();\n    }\n  );\n};\n\n// If this isn't a fresh load then it's a resume. In that case, we only want to auth if we're not logged in / without PIN or if user has been inactive for the last n seconds where n = timeout.\nif (!isFreshLoad) {\n  console.log(`App resumed...`);\n  if (\n    cti.store.variables.lastUserActivity &&\n    cti.store.variables.lastUserActivity >=\n      new Date().getTime() - cti.store.variables.inactivityTimeout\n  ) {\n    console.log(`User activity within the timeout window...`);\n    if (\n      cti.store.variables.v_isAuthenticated &&\n      cti.store.variables.v_userPIN\n    ) {\n      console.log(`User is already authenticated so will allow continue...`);\n\n      /*       if (cti.store.state.currentPage === \"Login\") {\n        goPin();\n      } */\n      if (cti.store.state.currentPage === \"Login\") {\n        switch (cti.store.env.platform.name) {\n          case \"ios\":\n            isTouchIdAvailable();\n            break;\n          case \"android\":\n            isFingerprintAuthAvailable();\n            break;\n          default:\n            goPin();\n        }\n      }\n\n      return;\n    }\n  }\n} else {\n  console.log(`App fresh load...`);\n}\n\ncti.fn_clearActivityTimeout();\ncti.fn_stopActivityListener();\n\nif (cti.store.variables.v_isAuthenticated) {\n  if (cti.store.variables.v_userPIN) {\n    console.log(\n      `App resumed, already authenticated, PIN set - biometrics falling back to PIN...`\n    );\n\n    switch (cti.store.env.platform.name) {\n      case \"ios\":\n        isTouchIdAvailable();\n        break;\n      case \"android\":\n        isFingerprintAuthAvailable();\n        break;\n      default:\n        goPin();\n    }\n  } else {\n    console.log(\n      `App resumed, already authenticated, PIN not set - prompting to set...`\n    );\n\n    goSetPin();\n  }\n} else {\n  console.log(`App resumed, NOT authenticated, login please`);\n\n  cti.fn_restoreInitialState().then(res => goLogin());\n}\n"},{"name":"fn_openContentMenu","type":"scripting","item-type":"function","_auto_id_":"335d5190-8fd6-4eaf-ab65-c102e68e9035","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_openContentMenu()', \n  'info'\n);\n\nvar contextMenu = document.getElementsByTagName('ct-context-menu')[0];\ncontextMenu.toggle();"},{"name":"fn_populate_duration_dl","type":"scripting","item-type":"function","_auto_id_":"2637d090-0615-4390-9283-e85b89e43506","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_populate_duration_dl()', \n  'info'\n);\n\ncti.store.variables.duration_minutes = [];\nfor (var i = 0; i < 61; i++) {\n  cti.store.variables.duration_minutes.push({\"label\":i.toString(),\"value\":i.toString()});\n}\n\ncti.store.variables.duration_hours = [];\nfor (var i = 0; i < 25; i++) {\n  cti.store.variables.duration_hours.push({\"label\":i.toString(),\"value\":i.toString()});\n}"},{"name":"fn_prep_forms","type":"scripting","item-type":"function","_auto_id_":"6e603a4a-7d46-4b0e-98d0-150671c688d8","sync":true,"params":[{"name":"appointment","description":"Appointment object","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_prep_forms(appointment)', \n  'info'\n)\n\nvar activities = []\nvar dialog = false, \n    lifestyle = false, \n    safety = false\n\nif(appointment.attendees) {\n  if(appointment.attendees.attendee) {\n    if(appointment.attendees.attendee.activities) {\n      if(appointment.attendees.attendee.activities.activity) {\n        if (appointment.attendees.attendee.activities.activity instanceof Array) {\n          activities = appointment.attendees.attendee.activities.activity\n        } else {\n          var object = appointment.attendees.attendee.activities.activity\n          activities.push(object)\n        }\n      }\n    }\n  }\n}\n\nif(appointment.dialog_form === undefined || appointment.lifestyle_form === undefined || appointment.safety_form === undefined) {\n  for(var i in activities) {\n    var code = activities[i].activityType.code\n    \n    if(code === \"dialogplus\" || code === \"RMDialog\") {\n      dialog = true\n\n      if(appointment.status == \"complete\") {\n        cti.store.variables.selected_visit.dialog_form_status = \"outcomed\"\n        cti.store.variables.selected_visit.dialog_form_status_text = \"Appointment Outcomed\"\n      } else {\n        cti.store.variables.selected_visit.dialog_form_status = \"notcomplete\"\n        cti.store.variables.selected_visit.dialog_form_status_text = \"Not Completed\"\n      }\n    } else if(code === \"phlifestyl\" || code === \"RMLife\") {\n      lifestyle = true\n\n      if(appointment.status == \"complete\") {\n        cti.store.variables.selected_visit.lifestyle_form_status = \"outcomed\"\n        cti.store.variables.selected_visit.lifestyle_form_status_text = \"Appointment Outcomed\"\n      } else {\n        cti.store.variables.selected_visit.lifestyle_form_status = \"notcomplete\"\n        cti.store.variables.selected_visit.lifestyle_form_status_text = \"Not Completed\"\n      }\n    } else if(code === \"msp\" || code === \"RMMSP\") {\n      safety = true\n\n      if(appointment.status == \"complete\") {\n        cti.store.variables.selected_visit.safety_form_status = \"outcomed\"\n        cti.store.variables.selected_visit.safety_form_status_text = \"Appointment Outcomed\"\n      } else {\n        cti.store.variables.selected_visit.safety_form_status = \"notcomplete\"\n        cti.store.variables.selected_visit.safety_form_status_text = \"Not Completed\"\n      }\n    }\n  }\n\n  appointment.dialog_form = dialog;\n  appointment.lifestyle_form = lifestyle;\n  appointment.safety_form = safety;\n} else {\n  if(appointment.dialog_form && appointment.dialog_form_status) {\n    dialog = appointment.dialog_form_status\n  }\n  if(appointment.lifestyle_form && appointment.lifestyle_form_status) {\n    lifestyle = appointment.lifestyle_form_status\n  }\n  if(appointment.safety_form && appointment.safety_form_status) {\n    safety = appointment.safety_form_status\n  }\n\n  if(dialog == \"inprogress\" || dialog == \"failed\") {\n    if(appointment.dialog_form_page != undefined && appointment.status != \"complete\") {\n      cti.store.pages.DialogFormPre = appointment.dialog_form_page.dialog_form_page_pre\n      cti.store.pages.DialogFormOne = appointment.dialog_form_page.dialog_form_page_one\n      cti.store.repeater.DialogFormTwo = appointment.dialog_form_page.dialog_form_repeater_pre\n      cti.store.repeater.DialogFormThree = appointment.dialog_form_page.dialog_form_repeater_one\n    } else if(appointment.status == \"complete\") {\n      appointment.dialog_form_status = \"outcomed\"\n      appointment.dialog_form_status_text = \"Appointment Outcomed\"\n    }\n  } else if(appointment.status == \"complete\") {\n    appointment.dialog_form_status = \"outcomed\"\n    appointment.dialog_form_status_text = \"Appointment Outcomed\"\n  }\n\n  if(lifestyle == \"inprogress\" || lifestyle == \"failed\") {\n    if(appointment.lifestyle_form_page != undefined && appointment.status != \"complete\") {\n      cti.store.pages.LifestyleFormOne = appointment.lifestyle_form_page.lifestyle_form_page_one\n      cti.store.pages.LifestyleFormTwo = appointment.lifestyle_form_page.lifestyle_form_page_two\n      cti.store.pages.LifestyleFormThree = appointment.lifestyle_form_page.lifestyle_form_page_three\n      cti.store.pages.LifestyleFormFour = appointment.lifestyle_form_page.lifestyle_form_page_four\n      cti.store.pages.LifestyleFormFive = appointment.lifestyle_form_page.lifestyle_form_page_five\n      cti.store.pages.LifestyleFormSix = appointment.lifestyle_form_page.lifestyle_form_page_six\n\n      cti.store.repeater.LifestyleFormThree = appointment.lifestyle_form_page.lifestyle_form_repeater_three\n      cti.store.repeater.LifestyleFormFive = appointment.lifestyle_form_page.lifestyle_form_repeater_five\n    } else if(appointment.status == \"complete\") {\n      appointment.lifestyle_form_status = \"outcomed\"\n      appointment.lifestyle_form_status_text = \"Appointment Outcomed\"\n    }\n  } else if(appointment.status == \"complete\") {\n    appointment.lifestyle_form_status = \"outcomed\"\n    appointment.lifestyle_form_status_text = \"Appointment Outcomed\"\n  }\n\n  if(safety == \"inprogress\" || safety == \"failed\") {\n    if(appointment.safety_form_page != undefined && appointment.status != \"complete\") {\n      cti.store.pages.SafetyForm = appointment.safety_form_page\n    } else if(appointment.status == \"complete\") {\n      appointment.safety_form_status = \"outcomed\"\n      appointment.safety_form_status_text = \"Appointment Outcomed\"\n    }\n  } else if(appointment.status == \"complete\") {\n    appointment.safety_form_status = \"outcomed\"\n    appointment.safety_form_status_text = \"Appointment Outcomed\"\n  }\n}"},{"name":"fn_prep_timeline","type":"scripting","item-type":"function","_auto_id_":"72309a2b-0d9d-47b4-b3a4-c582f8a1a202","sync":true,"params":[],"content":"if(window.debug){\n\tdebugger; \n}\n\nwindow.logManager.consoleLog(\n  'function fn_prep_timeline()', \n  'info'\n)\n\nvar p = cti.store.variables.selected_visit.patientData\ncti.store.variables.timeline = []\nvar timeline = []\n\n// ##### Documents Preperation Functionality Begin\nif (p.documents == undefined) { \n  p.documents = [] \n}\n\nfor(var a in p.documents) {\n  var patientDocument = p.documents[a]\n  patientDocument.displayDate = moment(patientDocument.dateCreated).format(\"YYYY-MM-DDTHH:mm:ss\")\n\n  var dateCreated = moment(patientDocument.dateCreated).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientDocument.dateCreated = dateCreated\n  var documentDate = moment(patientDocument.documentDate).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientDocument.documentDate = documentDate\n}\n\nvar documents = JSON.parse(JSON.stringify(p.documents))\n\nfor(var b in documents) {\n  var timelineDocument = documents[b]\n  var dateString = patientDocument.dateCreated\n\n  timelineDocument.eventDate = new Date(dateString.replace(\" \", \"T\"))\n  timelineDocument.eventType = \"documents\"\n\n  delete timelineDocument.insertedDate\n  delete timelineDocument.documentId\n  delete timelineDocument.serialNumber\n  delete timelineDocument.userId\n  delete timelineDocument.fileSize\n  delete timelineDocument.fileType\n  delete timelineDocument.author\n  delete timelineDocument.description\n  delete timelineDocument.dateCreated\n  delete timelineDocument.documentDate\n  delete timelineDocument.displayDate\n\n  timeline.push(timelineDocument)\n}\n\np.documents.sort(function(a, b) {\n  return a.displayDate > b.displayDate ? -1 : a.displayDate < b.displayDate ? 1 : 0\n})\n// ##### Documents Preperation Functionality End\n\n// ##### Referrals Preperation Functionality Begin\nif (p.referrals == undefined) { \n  p.referrals = [] \n}\n\nfor(var c in p.referrals) {\n  var patientReferral = p.referrals[c]\n  var dateString = moment(patientReferral.referralDate).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientReferral.referralDate = dateString\n}\n\nvar referrals = JSON.parse(JSON.stringify(p.referrals))\n\nfor (var d in referrals) {\n  var timelineReferral = referrals[d]\n  var dateString = moment(timelineReferral.referralDate).format(\"YYYY-MM-DDTHH:mm:ss\")\n\n  timelineReferral.eventType = \"referral\"\n  timelineReferral.eventDate = new Date(dateString.replace(\" \", \"T\"))\n\n  if (timelineReferral.healthcareProfessional) {\n    timelineReferral.referredToDisplay = timelineReferral.healthcareProfessional.value\n  } else {\n    if (timelineReferral.team != \"\" && timelineReferral.team != undefined) {\n      timelineReferral.referredToDisplay = timelineReferral.team.value\n    } else {\n      timelineReferral.referredToDisplay = \"No Referrer Team/HCP\"\n    }\n  }\n\n  delete timelineReferral.referralId\n  delete timelineReferral.team\n  delete timelineReferral.referralDate\n  delete timelineReferral.associatedDocuments\n\n  timeline.push(timelineReferral)\n}\n\np.referrals.sort(function(a, b) {\n  return a.referralDate > b.referralDate ? -1 : a.referralDate < b.referralDate ? 1 : 0\n})\n// ##### Referrals Preperation Functionality End\n\n// ##### Progress Notes Preperation Functionality Begin\nif(p.progressNotes == undefined) {\n  p.progressNotes = []\n}\n\nfor(var e in p.progressNotes) {\n  var patientNote = p.progressNotes[e]\n  var dateString = moment(patientNote.dateTime).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientNote.dateTime = dateString\n}\n\nvar notes = JSON.parse(JSON.stringify(p.progressNotes))\n\nfor (var f in notes) {\n  var timelineNote = notes[f]\n  var dateString = timelineNote.dateTime\n\n  timelineNote.eventDate = new Date(dateString.replace(\" \", \"T\"))\n  timelineNote.eventType = \"notes\"\n\n  var risk, validated\n\n  if (timelineNote.isRiskRelated == \"0\") {\n    risk = \"No\"\n  } else {\n    risk = \"Yes\"\n  }\n\n  if (timelineNote.verifyDate == undefined) {\n    validated = \"No\"\n  } else {\n    validated = \"Yes\"\n  }\n\n  var rowOne = \"<p><strong>Added by</strong> \" + timelineNote.enteredBy.value || \"Unknown\" + \"</p>\"\n  var rowTwo = \"<p><strong>Is Risk:</strong> \" + risk + \"</pr>\"\n  var rowThree = \"<p><strong>Validated:</strong> \" + validated + \"</p><br>\"\n\n  timelineNote.timeLineDisplay = rowOne + rowTwo + rowThree + timelineNote.noteText\n\n  delete timelineNote.clientId\n  delete timelineNote.noteId\n  delete timelineNote.noteNumber\n  delete timelineNote.subNoteNumber\n  delete timelineNote.isConcealFromClient\n  delete timelineNote.enteredDateTime\n  delete timelineNote.enteredBy\n  delete timelineNote.isEnteredInError\n  delete timelineNote.isHtmlIncludedFlag\n  delete timelineNote.isAutoSaved\n  delete timelineNote.isSignificant\n  delete timelineNote.isThirdParty\n  delete timelineNote.noteText\n  delete timelineNote.isRiskRelated\n  delete timelineNote.specialty\n  delete timelineNote.associatedDocuments\n  delete timelineNote.date\n  delete timelineNote.dateTime\n\n  timeline.push(timelineNote)\n}\n\np.progressNotes.sort(function(a, b) {\n  return a.dateTime > b.dateTime ? -1 : a.dateTime < b.dateTime ? 1 : 0\n})\n// ##### Progress Notes Preperation Functionality End\n\n// ##### Appointment Preperation Functionality Begin\nif(p.appointmentHistory == undefined) {\n  p.appointmentHistory = []\n}\n\nfor(var g in p.appointmentHistory) {\n  var patientAppointment = p.appointmentHistory[g]\n  var dateString = moment(patientAppointment.date).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientAppointment.date = dateString\n}\n\nvar appointments = JSON.parse(JSON.stringify(p.appointmentHistory))\n\nfor (var h in appointments) {\n  var timelineAppointment = appointments[h]\n  timelineAppointment.eventType = \"appointments\"\n\n  var dateString = timelineAppointment.date\n  timelineAppointment.eventDate = new Date(dateString.replace(\" \", \"T\"))\n\n  timelineAppointment.displayDate = moment(timelineAppointment.date).format(\"YYYY-MM-DDTHH:mm:ss\")\n  timelineAppointment.timeLineDisplay = \"\"\n\n  if(timelineAppointment.outcome != \"\" || timelineAppointment.outcome != undefined) {\n    var rowOne = \"<p><strong>Outcome:</strong> \" + timelineAppointment.outcome + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowOne\n  }\n\n  if(timelineAppointment.cancellationReason != \"\" || timelineAppointment.cancellationReason != undefined) {\n    var rowTwo = \"<p><strong>Cancellation Reason:</strong> \" + timelineAppointment.cancellationReason + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowTwo\n  }\n\n  if(timelineAppointment.location != \"\" || timelineAppointment.location != undefined) {\n    var rowThree = \"<p><strong>Location:</strong> \" + timelineAppointment.location + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowThree\n  }\n  if(timelineAppointment.clinic != \"\" || timelineAppointment.clinic != undefined) {\n    var rowFour = \"<p><strong>Setting:</strong> \" + timelineAppointment.clinic + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowFour\n  }\n\n  if(timelineAppointment.intendedDuration != \"\" || timelineAppointment.intendedDuration != undefined) {\n    var rowFive = \"<p><strong>Duration:</strong> \" + timelineAppointment.intendedDuration + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowFive\n  }\n\n  if(timelineAppointment.comment != \"\" || timelineAppointment.comment != undefined) {\n    var rowSix = \"<p><strong>Comment:</strong> \" + timelineAppointment.comment + \"</p>\"\n    timelineAppointment.timeLineDisplay += rowSix\n  }\n\n  delete timelineAppointment.clinic\n  delete timelineAppointment.intendedDuration\n  delete timelineAppointment.location\n  delete timelineAppointment.hcpCode\n  delete timelineAppointment.outcome\n  delete timelineAppointment.cancellationReason\n  delete timelineAppointment.displayDate\n  delete timelineAppointment.date\n\n  timeline.push(timelineAppointment)\n}\n\np.appointmentHistory.sort(function(a, b) {\n  return a.date > b.date ? -1 : a.date < b.date ? 1 : 0\n})\n// ##### Appointments Preperation Functionality End\n\n// ##### Alerts Preperation Functionality Begin\ncti.store.variables.selected_visit.hasAlerts = false\ncti.store.variables.selected_visit.openAlerts = 0\n\nif(p.alerts == undefined) {\n  p.alerts = []\n}\n\nfor(var i in p.alerts) {\n  var patientAlert = p.alerts[i]\n  var dateString = moment(patientAlert.date).format(\"YYYY-MM-DDTHH:mm:ss\")\n  patientAlert.date = dateString\n  \n  if (!patientAlert.removalDate) {\n    cti.store.variables.selected_visit.hasAlerts = true\n    cti.store.variables.selected_visit.openAlerts++\n  }\n}\n\nvar alerts = JSON.parse(JSON.stringify(p.alerts))\n\nfor (var j in alerts) {\n  var timelineAlert = alerts[j]\n  var dateString = moment(timelineAlert.date).format(\"YYYY-MM-DDTHH:mm:ss\")\n\n  if (timelineAlert.removalDate) {\n    var endedDateString = moment(timelineAlert.removalDate, \"YYYY-MM-DDTHH:mm:ss\").format(\"YYYY-MM-DDTHH:mm:ss\");\n    var eventDate = new Date(endedDateString.replace(\" \", \"T\"));\n\n    var endedAlert = {\n      eventType: \"alerts-removed\",\n      eventDate: eventDate\n    }\n\n    endedAlert.displayText = timelineAlert.type.value + \" (Created On: \" + moment(timelineAlert.date).format(\"DD MMM YYYY\") + \")\"\n\n    delete timelineAlert.date\n    delete timelineAlert.removalReason\n    delete timelineAlert.removalComment\n    delete timelineAlert.removalDate\n    delete timelineAlert.text\n    delete timelineAlert.priority \n    delete timelineAlert.id \n\n    timelineAlert.eventType = \"alerts-added\"\n    timelineAlert.eventDate = new Date(dateString.replace(\" \", \"T\"))\n\n    timeline.push(timelineAlert)\n    timeline.push(endedAlert)\n  } else {\n    timelineAlert.eventType = \"alerts-added\"\n    timelineAlert.eventDate = new Date(dateString.replace(\" \", \"T\"))\n\n    delete timelineAlert.date\n    delete timelineAlert.removalReason\n    delete timelineAlert.removalComment\n    delete timelineAlert.removalDate\n    delete timelineAlert.text\n    delete timelineAlert.priority \n    delete timelineAlert.id \n\n    timeline.push(timelineAlert)\n  }\n}\n\np.alerts.sort(function(a, b) {\n  return a.date > b.date ? -1 : a.date < b.date ? 1 : 0\n})\n// ##### Alerts Preperation Functionality End\n\n// ##### Allergies Preperation Functionality Begin\nif(p.allergies == undefined) {\n  p.allergies = []\n}\n\nfor(var k in p.allergies) {\n  var patientAllergy = p.allergies[k]\n\n  if(patientAllergy.yearOfIdentification == \"0\" || \n     patientAllergy.yearOfIdentification == \"\" ||\n     patientAllergy.yearOfIdentification == undefined) \n  {\n    var birthDate = p.demographics.birthDate\n    var yearValue = moment(birthDate).format(\"YYYY\")\n\n    patientAllergy.yearOfIdentification = yearValue\n    patientAllergy.dateTime = birthDate+\"T00:00:00\"\n  } else {\n    patientAllergy.dateTime = patientAllergy.yearOfIdentification+\"-01-01T00:00:00\"\n  }\n}\n\nvar allergies = JSON.parse(JSON.stringify(p.allergies))\n\nfor(var l in allergies) {\n  var timelineAllergy = allergies[l]\n\n  timelineAllergy.eventDate = new Date(timelineAllergy.dateTime.replace(\" \", \"T\"))\n  timelineAllergy.eventDateDisplay = \"Year: \" + timelineAllergy.yearOfIdentification\n  timelineAllergy.eventType = \"allergies\"\n\n  delete timelineAllergy.dateTime\n  delete timelineAllergy.reaction\n  delete timelineAllergy.reactionType\n  delete timelineAllergy.reactionSeverity\n  delete timelineAllergy.reportedBy\n\n  timeline.push(timelineAllergy)\n}\n\np.allergies.sort(function(a, b) {\n  return a.dateTime > b.dateTime ? -1 : a.dateTime < b.dateTime ? 1 : 0\n})\n// ##### Allergies Preperation Functionality End\n\n// ##### Contacts Preperation Functionality Begin\nif (p.contacts == undefined) { \n  p.contacts = [] \n}\n// ##### Contacts Preperation Functionality End\n\n// ##### Dialog + Forms Preperation Functionality Begin\nif(p.dialogPlusForms === undefined) {\n  p.dialogPlusForms = []\n}\n\nfor (var i in p.dialogPlusForms) {\n  var dialogForm = p.dialogPlusForms[i]\n\n  dialogForm.assessmentDate.displayDate = moment(dialogForm.assessmentDate.result).format(\"DD MMM YYYY HH:mm\")\n}\n// ##### Dialog + Forms Preperation Functionality End\n\n// ##### Lifestyle Assessment Forms Preperation Functionality Begin\nif(p.lifestyleAssessmentForms === undefined) {\n  p.lifestyleAssessmentForms = []\n}\n\nfor (var i in p.lifestyleAssessmentForms) {\n  var lifestyleForm = p.lifestyleAssessmentForms[i]\n\n  lifestyleForm.assessmentDate.displayDate = moment(lifestyleForm.assessmentDate.result).format(\"DD MMM YYYY HH:mm\")\n}\n// ##### Lifestyle Assessment Forms Preperation Functionality End\n\n// ##### My Safety Plan Forms Preperation Functionality Begin\nif(p.mySafetyPlanForms === undefined) {\n  p.mySafetyPlanForms = []\n}\n\nfor (var i in p.mySafetyPlanForms) {\n  var safetyForm = p.mySafetyPlanForms[i]\n\n  safetyForm.assessmentDate.displayDate = moment(safetyForm.assessmentDate.result).format(\"DD MMM YYYY HH:mm\")\n}\n// ##### My Safety Plan Forms Preperation Functionality End\n\n// Order Timeline by newest entry first\ntimeline.sort(function(a, b) {\n  return a.eventDate > b.eventDate ? -1 : a.eventDate < b.eventDate ? 1 : 0\n})\n\n// ------------------------------------------------\n// PW #SRA-444 Populate timeline display date, new field now used in display template\nfor (var t of timeline) {\n  if (t.eventType == \"allergies\") {\n  \tt.timelineDisplayDate = t.eventDateDisplay;\n  }\n  else {\n  \tlet d = (typeof t.eventDate == \"string\") ? new Date(t.eventDate) : t.eventDate;\n    // Ok, this is rather clunky and dirty and doesn't account properly for the BST stuff,\n    // but will withhold the time if a time segment isn't relevant\n    if (d.getHours() < 2 && d.getMinutes() == 0) {\n      t.timelineDisplayDate = moment(d).format('DD MMM YYYY');\n    }\n    else {\n      t.timelineDisplayDate = moment(d).format('DD MMM YYYY HH:mm');\n    }    \n  }\n}\n// PW #SRA-444 \n// ------------------------------------------------\n\n// Set timeline variable\ncti.store.variables.timeline = timeline"},{"name":"fn_processPush","type":"scripting","item-type":"function","_auto_id_":"2ae65d29-d529-488d-af2f-dddbffb08ba8","sync":true,"params":[{"name":"pushPayload","required":true}],"content":"if (window.debug) {\n  debugger\n}\n\ntry {\n  // Notifty user we are updating device data\n  cti.fn_toggle_spinner('open', 'Update Received, refreshing Appointment list, please wait...')\n\n  var notificationType = ''\n\n  if (typeof pushPayload !== 'object') {\n    pushPayload = JSON.parse(pushPayload)\n  }\n\n  if (typeof pushPayload.payload !== 'object') {\n    if (pushPayload.payload.indexOf('AppointmentAdded') != -1 && pushPayload.payload.indexOf('\"AppointmentAdded\"') == -1) {\n      pushPayload.payload = pushPayload.payload.replace('AppointmentAdded', '\"AppointmentAdded\"')\n    }\n\n    pushPayload.payload = JSON.parse(pushPayload.payload)\n  }\n\n  if (pushPayload.payload && pushPayload.payload.notificationType) {\n    notificationType = pushPayload.payload.notificationType\n  } else {\n    notificationType = 'Error'\n  }\n\n  if (notificationType === 'AppointmentCancelled') {\n    // AppointmentCancelled: Remove the appointment from device, reload the\n    // appointments data and navigate user back to visits page\n\n    // Set the appointment to cancel\n    if (pushPayload.payload.appointmentId) {\n      cti.store.variables.appointmentId = pushPayload.payload.appointmentId.toString()\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Load appointments from pouch\n    window.pouchManager.loadFromDatabase(\n      'appointments',\n      function(doc) {\n        // Set the appointments array\n        var appointments = doc.data\n\n        // Find the appointment on device...\n        for (var i in appointments) {\n          if (appointments[i].appointmentId === cti.store.variables.appointmentId) {\n            // ... and remove it from the main array\n            appointments.splice(i, 1)\n            break\n          }\n        }\n\n        // Check that we aren't the the current visit, and if we are\n        // then remove the data\n        var selectedVisit = cti.store.variables.selected_visit\n\n        if (selectedVisit) {\n          if (selectedVisit.appointmentId === cti.store.variables.appointmentId) {\n            cti.store.variables.return = true\n          }\n        }\n\n        // Update the pouch DB with cancelled appointment\n        window.pouchManager.saveToDatabase(\n          'appointments',\n          appointments,\n          function(rev) {\n            var appointmentId = cti.store.variables.appointmentId\n            window.logManager.consoleLog('Pouch DB - Removed appointment ' + appointmentId + ' successfully. Revision: ' + rev, 'info')\n\n            if (cti.store.variables.return || cti.store.state.currentPage == 'Visits') {\n              cti.fn_load_appointments()\n            }\n\n            cti.fn_toggle_spinner('close', '')\n            delete cti.store.variables.appointmentId\n          },\n          function(reason, e) {\n            var appointmentId = cti.store.variables.appointmentId\n            window.logManager.consoleLog('Pouch DB - Error updating pouch for appointment ' + appointmentId + '. Reason: ' + reason + e, 'error')\n\n            if (cti.store.variables.return || cti.store.state.currentPage == 'Visits') {\n              cti.fn_load_appointments()\n            }\n\n            cti.fn_toggle_spinner('close')\n            delete cti.store.variables.appointmentId\n          }\n        )\n      },\n      function(reason, err) {\n        window.logManager.consoleLog('Pouch DB - Failed retrieving Appointments Data from Pouch - ', reason + err, 'error')\n\n        cti.fn_toggle_spinner('close')\n        delete cti.store.variables.appointmentId\n      }\n    )\n  } else if (notificationType === 'AppointmentUpdated' || notificationType === 'AppointmentOutcomed') {\n    // AppointmentUpdated or AppointmentOutcomed: set the global payload to contain\n    // the appointmentId and the exists flag (true in this case)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.appointmentId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'appointment',\n        appointmentId: pushPayload.payload.appointmentId,\n        appointmentExists: true\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' })\n  } else if (notificationType === 'AppointmentAdded') {\n    // AppointmentAdded: set the global payload to contain\n    // the appointmentId and the exists flag (false in this case)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.appointmentId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'appointment',\n        appointmentId: pushPayload.payload.appointmentId,\n        appointmentExists: false\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' })\n  } else if (notificationType === 'ProgressNoteAdded') {\n\n    // ProgressNoteAdded: set the global payload to contain\n    // the appointmentId and the exists flag (true in this case)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.clientId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'patient',\n        clientId: pushPayload.payload.clientId,\n        appointmentExists: true,\n        includeNotes: true\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '');\n      return false;\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' });\n\n  }\n  \n  else if (notificationType === 'DemographicUpdated' || notificationType === 'GPUpdated' || notificationType === 'AddressUpdated') {\n    // DemographicUpdated, GPUpdated, AddressUpdated, DeathRegistered: set the global payload to contain\n    // the appointmentId and the exists flag (true for the demographics flag)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.clientId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'patient',\n        clientId: pushPayload.payload.clientId,\n        appointmentExists: false,\n        includeDemographics: true\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' })\n  } else if (notificationType == 'DeathRegistered') {\n    // DeathRegistered: Remove any appointments from device, reload the\n    // appointments data and navigate user back to visits page\n\n    // Set the patient to remove\n    if (pushPayload.payload.clientId) {\n      cti.store.variables.clientId = pushPayload.payload.clientId\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Load appointments from pouch\n    window.pouchManager.loadFromDatabase(\n      'appointments',\n      function(doc) {\n        // Set the appointments array\n        var appointments = doc.data\n\n        // Find the appointments on device for the patient...\n        for (var i in appointments) {\n          if (appointments[i].attendees.attendee.clientId.value == cti.store.variables.clientId.value) {\n            // ... and remove them from the main array\n            appointments.splice(i, 1)\n          }\n        }\n\n        // Check that we aren't the the current visit, and if we are\n        // then remove the data\n        var selectedVisit = cti.store.variables.selected_visit\n\n        if (selectedVisit) {\n          if (selectedVisit.attendees.attendee.clientId.value == cti.store.variables.clientId.value) {\n            cti.store.variables.return = true\n          }\n        }\n\n        // Update the pouch DB with cancelled appointment\n        window.pouchManager.saveToDatabase(\n          'appointments',\n          appointments,\n          function(rev) {\n            var app = cti.store.variables.clientId.value\n            window.logManager.consoleLog('Pouch DB - Removed patient appointments ' + app + ' successfully. Revision: ' + rev, 'info')\n\n            if (cti.store.variables.return || cti.store.state.currentPage === 'Visits') {\n              cti.fn_load_appointments()\n            }\n\n            cti.fn_toggle_spinner('close', '')\n            delete cti.store.variables.clientId\n          },\n          function(reason, e) {\n            var app = cti.store.variables.clientId.value\n            window.logManager.consoleLog('Pouch DB - Error updating pouch for appointment ' + app + '. Reason: ' + reason + e, 'error')\n\n            cti.fn_toggle_spinner('close')\n            delete cti.store.variables.clientId\n          }\n        )\n      },\n      function(reason, err) {\n        window.logManager.consoleLog('Pouch DB - Failed retriveing Appointments Data from Pouch - ', reason + err, 'error')\n\n        cti.fn_toggle_spinner('close')\n        delete cti.store.variables.clientId\n      }\n    )\n  } else if (notificationType === 'AllergyAdded' || notificationType === 'AllergyRemoved') {\n    // AllergyAdded, AllergyRemoved: set the global payload to contain\n    // the appointmentId and the exists flag (true for the allergies flag)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.clientId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'patient',\n        clientId: pushPayload.payload.clientId,\n        appointmentExists: false,\n        includeAllergies: true\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' })\n  } else if (notificationType === 'AlertAdded' || notificationType === 'AlertRemoved') {\n    // AlertAdded, AlertRemoved: set the global payload to contain\n    // the appointmentId and the exists flag (true for the alerts flag)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.clientId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'patient',\n        clientId: pushPayload.payload.clientId,\n        appointmentExists: false,\n        includeAlerts: true\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' })\n  } else {\n    cti.fn_toggle_spinner('close')\n  }\n} catch (e) {\n  cti.utils.callAction('show-notification', {\n    name: 'notification_warning',\n    title: 'Catch Error',\n    text: e\n  })\n  cti.fn_toggle_spinner('close', '')\n}"},{"name":"fn_recordUserActivity","type":"scripting","item-type":"function","_auto_id_":"1a41da5c-6e41-4491-8e6a-14ad8e0e4d77","sync":true,"params":[],"content":"cti.utils.callActionflow('UserActivity')"},{"name":"fn_restoreInitialState","type":"scripting","item-type":"function","_auto_id_":"323d8432-8a0a-4e36-8f51-6c89de08f01b","sync":true,"params":[],"content":"if (window.logManager) {\n  window.logManager.consoleLog('function fn_restoreInitialState()', 'info')\n} else {\n  console.log(`function fn_restoreInitialState()`)\n}\n\nreturn new Promise((resolve, reject) => {\n  const clearData = function() {\n    // Blat any page data (other than Login) hanging around...\n    cti.store.pages = {}\n    cti.store.media = {}\n    cti.store.repeater = {}\n  }\n\n  // Clear down appointment specific data\n  delete cti.store.variables.show_advanced_note\n  delete cti.store.variables.show_advanced_appt\n\n  // Clear down data success flags\n  delete cti.store.variables.getStaticDataStatus\n  delete cti.store.variables.getVisitListStatus\n\n  // Clear down appointment listing data\n  delete cti.store.variables.v_appointmentSyncFromDate\n  delete cti.store.variables.v_appointmentSyncToDate\n  delete cti.store.variables.v_appointmentDate\n  delete cti.store.variables.v_appointmentDateText\n  delete cti.store.variables.v_selectedDayAppointments\n  delete cti.store.variables.v_appointments\n  delete cti.store.variables.v_dialogForms\n  delete cti.store.variables.v_safetyForms\n\n  // Clear down user credentials\n  delete cti.store.variables.v_userPIN\n  delete cti.store.variables.v_isAuthenticated\n  delete cti.store.variables.v_pinAttempts\n  delete cti.store.variables.auth_header\n\n  // Clear down app level data\n  // NOTE: Not sure how this will affect the app for now, might need reviewing at some point\n  delete cti.store.variables.v_diary_template\n  delete cti.store.variables.v_planner\n  delete cti.store.variables.duration_minutes\n  delete cti.store.variables.duration_hours\n\n  if (!window.pouchManager) {\n    console.log(`PouchManager not available, appointments will not be cleared.`)\n\n    clearData()\n\n    resolve()\n  } else {\n    // Delete appointments from pouch\n    window.pouchManager.loadFromDatabase(\n      'appointments',\n      function(doc) {\n        // Reset appointments array\n        doc.data = []\n\n        window.pouchManager.saveToDatabase(\n          'appointments',\n          doc.data,\n          function(rev) {\n            window.logManager.consoleLog('Pouch DB: Successfully deleted Appointments Data from Pouch', 'info')\n            clearData()\n\n            resolve()\n          },\n          function(reason, e) {\n            window.logManager.consoleLog('Pouch DB - Failed to delete Appointment Data - ' + reason, e, 'error')\n            clearData()\n\n            resolve()\n          }\n        )\n      },\n      function(reason, err) {\n        window.logManager.consoleLog('Pouch DB: Failed retrieving Appointments Data from Pouch - ' + reason + err, 'error')\n        clearData()\n\n        resolve()\n      }\n    )\n  }\n})\n"},{"name":"fn_render_map","type":"scripting","item-type":"function","_auto_id_":"e3a3f805-5d59-4de6-9885-f18cfa297762","sync":true,"params":[],"content":"window.logManager.consoleLog('function fn_render_map()', 'info')\n\nif (!window.google) {\n  window.logManager.consoleLog('function fn_render_map() - No Google maps installed on device.', 'error')\n\n  return false\n}\n\nif (!cti.store.variables.v_selectedDayAppointments) {\n  window.logManager.consoleLog('function fn_render_map() - No appointment data [cti.store.variables.appointments]', 'error')\n\n  return false\n}\n\nif (cti.store.variables.latitude == undefined || cti.store.variables.longitude == undefined) {\n  cti.store.variables.latitude = cti.store.schema.metadata.latitude || '53.3125156' // Sevelec HQ latitude\n  cti.store.variables.longitude = cti.store.schema.metadata.longitude || '-1.3461527' // Sevelec HQ longitude\n\n  cti.fn_get_location()\n}\n\nvar directionDisplay\nvar directionsService = new google.maps.DirectionsService()\nvar map\nvar start = new google.maps.LatLng(cti.store.variables.latitude, cti.store.variables.longitude)\n\nvar myOptions = {\n  zoom: 8,\n  mapTypeId: google.maps.MapTypeId.ROADMAP,\n  center: start\n}\n\nfunction renderDirections(result) {\n  var rendererOptions = {\n    map: map,\n    suppressMarkers: true\n  }\n  var directionsRenderer = new google.maps.DirectionsRenderer(rendererOptions)\n  directionsRenderer.setDirections(result)\n}\n\nfunction requestDirections(start, end, indx, markerContent) {\n  directionsService.route(\n    {\n      origin: start,\n      destination: end,\n      travelMode: google.maps.DirectionsTravelMode.DRIVING\n    },\n    function(result) {\n      if (!result || !result.status || ['ZERO_RESULTS', 'NO_ROUTES', 'NOT_FOUND'].indexOf(result.status) > -1 || !result.routes) {\n        window.logManager.consoleLog(`function fn_render_map():requestDirections() - no routes for postcode ${end}.`, 'error')\n\n        return false\n      }\n\n      var duration = result.routes[0].legs[0].duration\n      var marker = new google.maps.Marker({\n        position: {\n          lat: result.routes[0].legs[0].end_location.lat(),\n          lng: result.routes[0].legs[0].end_location.lng()\n        },\n        map: map,\n        label: (indx + 1).toString(),\n        icon: 'user-assets/pin.png'\n      })\n\n      var step = result.routes[0].legs[0].steps.length - 1\n      var lat = result.routes[0].legs[0].steps[step].start_location.lat()\n      var long = result.routes[0].legs[0].steps[step].start_location.lng()\n\n      txt = new TxtOverlay(new google.maps.LatLng(lat, long), duration.text, 'durationBox', map)\n\n      google.maps.event.addListener(\n        marker,\n        'click',\n        (function(marker, i, duration) {\n          //add the duration to the appointment data\n          cti.store.variables.v_selectedDayAppointments[i].appointmentEta = moment()\n            .add(duration.value, 'seconds')\n            .format('hh:mm')\n\n          return function() {\n            var infowindow = new google.maps.InfoWindow()\n            infowindow.setContent('<p>' + cti.store.variables.v_selectedDayAppointments[i].displayName + '<br/>' + cti.store.variables.v_selectedDayAppointments[i].appointmentType.value + '<br/>Travel Time: ' + duration.text + '</p>')\n            infowindow.open(map, marker)\n          }\n        })(marker, indx, duration)\n      )\n      renderDirections(result)\n    }\n  )\n}\n\nmap = new google.maps.Map(document.getElementById('layersmap'), myOptions)\nwindow.mymap = map\n\n//add destination markers\nvar infowindow = new google.maps.InfoWindow()\nfor (var i = 0; i < cti.store.variables.v_selectedDayAppointments.length; i++) {\n  var a = cti.store.variables.v_selectedDayAppointments[i]\n  var markerContent = a.surname\n  requestDirections(start, a.postCode, i, markerContent)\n}\n\n//add user location marker\nmarkerusr = new google.maps.Marker({\n  position: start,\n  map: map,\n  label: {\n    text: 'Me',\n    color: 'white'\n  }\n})\n\n//add traffic layer\nvar trafficLayer = new google.maps.TrafficLayer()\ntrafficLayer.setMap(map)\n\n//adapted from http://code.google.com/apis/maps/documentation/javascript/overlays.html#CustomOverlays\n//text overlays\nfunction TxtOverlay(pos, txt, cls, map) {\n  // Now initialize all properties.\n  this.pos = pos\n  this.txt_ = txt\n  this.cls_ = cls\n  this.map_ = map\n  // We define a property to hold the image's\n  // div. We'll actually create this div\n  // upon receipt of the add() method so we'll\n  // leave it null for now.\n  this.div_ = null\n  // Explicitly call setMap() on this overlay\n  this.setMap(map)\n}\nTxtOverlay.prototype = new google.maps.OverlayView()\nTxtOverlay.prototype.onAdd = function() {\n  // Note: an overlay's receipt of onAdd() indicates that\n  // the map's panes are now available for attaching\n  // the overlay to the map via the DOM.\n  // Create the DIV and set some basic attributes.\n  var div = document.createElement('DIV')\n  div.className = this.cls_\n  div.innerHTML = this.txt_\n  // Set the overlay's div_ property to this DIV\n  this.div_ = div\n  var overlayProjection = this.getProjection()\n  var position = overlayProjection.fromLatLngToDivPixel(this.pos)\n  div.style.left = position.x + 'px'\n  div.style.top = position.y + 'px'\n  // We add an overlay to a map via one of the map's panes.\n  var panes = this.getPanes()\n  panes.floatPane.appendChild(div)\n}\nTxtOverlay.prototype.draw = function() {\n  var overlayProjection = this.getProjection()\n  // Retrieve the southwest and northeast coordinates of this overlay\n  // in latlngs and convert them to pixels coordinates.\n  // We'll use these coordinates to resize the DIV.\n  var position = overlayProjection.fromLatLngToDivPixel(this.pos)\n  var div = this.div_\n  div.style.left = position.x + 'px'\n  div.style.top = position.y + 'px'\n}\n//Optional: helper methods for removing and toggling the text overlay.\nTxtOverlay.prototype.onRemove = function() {\n  this.div_.parentNode.removeChild(this.div_)\n  this.div_ = null\n}\nTxtOverlay.prototype.hide = function() {\n  if (this.div_) {\n    this.div_.style.visibility = 'hidden'\n  }\n}\nTxtOverlay.prototype.show = function() {\n  if (this.div_) {\n    this.div_.style.visibility = 'visible'\n  }\n}\nTxtOverlay.prototype.toggle = function() {\n  if (this.div_) {\n    if (this.div_.style.visibility == 'hidden') {\n      this.show()\n    } else {\n      this.hide()\n    }\n  }\n}\nTxtOverlay.prototype.toggleDOM = function() {\n  if (this.getMap()) {\n    this.setMap(null)\n  } else {\n    this.setMap(this.map_)\n  }\n}","actions":[]},{"name":"fn_save_appointment","type":"scripting","item-type":"function","_auto_id_":"c9addaf6-e131-4e49-af12-e74947b7a50e","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_save_appointment(selected_visit)', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Returning to Appointments List...')\n\nvar selected_visit = cti.store.variables.selected_visit\nvar dialog = cti.store.variables.selected_visit.dialog_form_status\nvar lifestyle = cti.store.variables.selected_visit.lifestyle_form_status\nvar safety = cti.store.variables.selected_visit.safety_form_status\n\n// Retain any currently inprogress forms for usage later on\nif(dialog == \"inprogress\" || dialog == \"failed\") {\n  selected_visit.dialog_form_page = {\n    dialog_form_page_pre : cti.store.pages.DialogFormPre || {},\n    dialog_form_page_one : cti.store.pages.DialogFormOne || {},\n    dialog_form_repeater_pre : cti.store.repeater.DialogFormPre || {},\n    dialog_form_repeater_one : cti.store.repeater.DialogFormOne || {}\n  }\n}\nif(lifestyle == \"inprogress\" || lifestyle == \"failed\") {\n  selected_visit.lifestyle_form_page = {\n    lifestyle_form_page_one : cti.store.pages.LifestyleFormOne || {},\n    lifestyle_form_page_two : cti.store.pages.LifestyleFormTwo || {},\n    lifestyle_form_page_three : cti.store.pages.LifestyleFormThree || {},\n    lifestyle_form_page_four : cti.store.pages.LifestyleFormFour || {},\n    lifestyle_form_page_five : cti.store.pages.LifestyleFormFive || {},\n    lifestyle_form_page_six : cti.store.pages.LifestyleFormSix || {},\n    lifestyle_form_repeater_three : cti.store.repeater.LifestyleFormThree || {},\n    lifestyle_form_repeater_five : cti.store.repeater.LifestyleForm || {}\n  }\n} \nif(safety == \"inprogress\" || safety == \"failed\") {\n  selected_visit.safety_form_page = cti.store.pages.SafetyForm || {}\n}\n\n// Load appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  var appointments = doc.data;\n\n  // Check that we have a valid appointment\n  for(var i in appointments) {\n    if(appointments[i].appointmentId == cti.store.variables.selected_visit.appointmentId) {\n      // Update the appointment data with the selected appointment\n      appointments[i] = cti.store.variables.selected_visit;\n      break;\n    }\n  }\n\n  // Update the pouch DB with new data\n  window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n    window.logManager.consoleLog(\n      'Pouch DB: Updated Appointment Data. Revision: ' + rev,\n      'info'\n    )\n    \n    // Clear down dialog form data\n    cti.utils.destroyPageData('DialogFormPre')\n    cti.utils.destroyPageData('DialogFormOne')\n\tcti.store.repeater.DialogFormPre = {}\n    cti.store.repeater.DialogFormOne = {}\n\n    // Clear down lifestyle form data\n    cti.utils.destroyPageData('LifestyleFormOne')\n    cti.utils.destroyPageData('LifestyleFormTwo')\n    cti.utils.destroyPageData('LifestyleFormThree')\n    cti.utils.destroyPageData('LifestyleFormFour')\n    cti.utils.destroyPageData('LifestyleFormFive')\n    cti.utils.destroyPageData('LifestyleFormSix')\n    cti.store.repeater.LifestyleFormThree = {}\n    cti.store.repeater.LifestyleFormFive = {}\n\n    // Clear down safety form data\n    cti.utils.destroyPageData('SafetyForm')\n    \n    // Clear down form views\n    cti.utils.destroyPageData('DialogForm_View')\n    cti.utils.destroyPageData('LifestyleForm_View')\n    cti.utils.destroyPageData('SafetyForm_View')\n    \n    // Clear down submission entry pages\n    cti.utils.destroyPageData('Alert')\n    cti.utils.destroyPageData('RemoveAlert')\n    cti.utils.destroyPageData('Note')\n    cti.utils.destroyPageData('Outcome')\n    \n    // Set clear down variable\n    cti.store.variables.clearDown = true\n\n    // Reset appointments\n    cti.fn_load_appointments()\n  }, function(reason, e) {\n    window.logManager.consoleLog(\n      'Pouch DB: Failed to Update Appointment Data - ' + reason + e,\n      'error'\n    )\n    cti.fn_toggle_spinner('close')\n  })\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB: Error: Failed retriveing Appointments Data from Pouch - ' + reason + err,\n    'error'\n  )\n  cti.fn_toggle_spinner('close')\n})"},{"name":"fn_save_to_pouch","type":"scripting","item-type":"function","_auto_id_":"02ac2616-9ecc-48cb-b08b-1622f4fb42ed","sync":true,"params":[{"name":"type","description":"The type of data we are sending","required":true},{"name":"data","description":"Data payload","required":true},{"name":"exists","description":"Whether we are updating patientData or not"},{"name":"id","description":"Either clientId or appointmentId"}],"content":"window.logManager.consoleLog(\n  'function fn_save_to_pouch(type, data, exists, id)', \n  'info'\n)\n\nif(exists === undefined) { exists = false }\n\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  var selectedVisit = cti.store.variables.selected_visit\n  var appointments = doc.data\n  \n  if(type == \"demographics\") {\n    for(var i in appointments) {\n      if(appointments[i].attendees.attendee.clientId.value == id) {\n        appointments[i].patientData.demographics = data.data.patientDemographic\n      }\n    }\n    \n    if(selectedVisit) {\n      if(selectedVisit.attendees.attendee.clientId.value == id) {\n        selectedVisit.patientData.demographics = data.data.patientDemographic\n        cti.fn_prep_timeline()\n      }\n    }\n  } else if(type == \"allergies\") {\n    for(var i in appointments) {\n      if(appointments[i].attendees.attendee.clientId.value == id) {\n        appointments[i].patientData.allergies = data.data.allergies\n      }\n    }\n    \n    if(selectedVisit) {\n      if(selectedVisit.attendees.attendee.clientId.value == id) {\n        selectedVisit.patientData.allergies = data.data.allergies\n        cti.fn_prep_timeline()\n      }\n    }\n  } else if(type == \"alerts\") {\n    for(var i in appointments) {\n      if(appointments[i].attendees.attendee.clientId.value == id) {\n        appointments[i].patientData.alerts = data.data.alerts\n      }\n    }\n    \n    if(selectedVisit) {\n      if(selectedVisit.attendees.attendee.clientId.value == id) {\n        selectedVisit.patientData.alerts = data.data.alerts\n        cti.fn_prep_timeline()\n      }\n    }\n  } else if(type == \"progressNotes\") {\n    for(var i in appointments) {\n      if(appointments[i].attendees.attendee.clientId.value == id) {\n        appointments[i].patientData.progressNotes = data.data.progressNotes\n      }\n    }\n    \n    if(selectedVisit) {\n      if(selectedVisit.attendees.attendee.clientId.value == id) {\n        selectedVisit.patientData.progressNotes = data.data.progressNotes\n        cti.fn_prep_timeline()\n      }\n    }\n  }\n  \n  else if(type == \"appointment\") {\n    if(exists) {\n      for(var i in appointments) {\n        if(appointments[i].appointmentId == id) {\n          appointments[i].appointmentDateTime = data.data.appointment.appointmentDateTime\n          appointments[i].appointmentId = data.data.appointment.appointmentId\n          appointments[i].appointmentType = data.data.appointment.appointmentType\n          appointments[i].attendees = data.data.appointment.attendees\n          appointments[i].createdAtDateTime = data.data.appointment.createdAtDateTime\n          appointments[i].hasPreviousFirstAppointmentOutcome = data.data.appointment.hasPreviousFirstAppointmentOutcome\n          appointments[i].healthcareProfessional = data.data.appointment.healthcareProfessional\n          appointments[i].intendedDuration = data.data.appointment.intendedDuration\n          appointments[i].location = data.data.appointment.location\n          break\n        }\n      }\n\n      // Check that we aren't in an appointment and if we are, update it\n      var selectedVisit = cti.store.variables.selected_visit\n      if(selectedVisit) {\n        if(selectedVisit.appointmentId === id) {\n          selectedVisit.appointmentDateTime = data.data.appointment.appointmentDateTime\n          selectedVisit.appointmentId = data.data.appointment.appointmentId\n          selectedVisit.appointmentType = data.data.appointment.appointmentType\n          selectedVisit.attendees = data.data.appointment.attendees\n          selectedVisit.createdAtDateTime = data.data.appointment.createdAtDateTime\n          selectedVisit.hasPreviousFirstAppointmentOutcome = data.data.appointment.hasPreviousFirstAppointmentOutcome\n          selectedVisit.healthcareProfessional = data.data.appointment.healthcareProfessional\n          selectedVisit.intendedDuration = data.data.appointment.intendedDuration\n          selectedVisit.location = data.data.appointment.location\n          cti.fn_prep_timeline()\n        }\n      }\n    } else {\n      appointments.push(data.data.appointment)\n\n      appointments.sort(function(a,b) { \n        return new Date(a.appointmentDateTime).getTime() - new Date(b.appointmentDateTime).getTime() \n      })\n    }\n  }\n \n  // Update the pouch DB with new data\n  window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n    window.logManager.consoleLog(\n      'Pouch DB - Saved Appointment Data. Revision: ' + rev, \n      'info'\n    )\n\n    // Reset appointments\n    delete cti.store.variables.pushDataPayload\n    delete cti.store.api.api_rio.getappointment\n\n    // Reset appointments only if we are on a valid page to do so\n    if(cti.store.state.currentPage == \"Visits\") { \n      cti.fn_load_appointments()\n    } else {\n      cti.utils.updatePage()\n    }\n    \n    cti.fn_toggle_spinner('close')\n  }, function(reason, e) {\n    window.logManager.consoleLog(\n      'Pouch DB - Failed to update appointment '+id+'. '+reason+e, \n      'error'\n    )\n    \n    cti.fn_toggle_spinner('close')\n  })\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB - Failed to update appointment '+id+'. '+reason+err, \n    'error'\n  )\n\n  cti.fn_toggle_spinner('close')\n})"},{"name":"fn_set_appointments","type":"scripting","item-type":"function","_auto_id_":"ccc57943-92fa-499c-9221-07ea1fc01885","sync":true,"params":[{"name":"appointments"}],"content":"window.logManager.consoleLog('function fn_set_appointments(appointments)', 'info')\n\nif (appointments === undefined) {\n  appointments = {}\n}\n\n//appointments.forEach(function(obj, idx) {\nfor (var i in appointments) {\n  var obj = appointments[i]\n\n  // Check if the appointment has already been completed or not\n  if (obj.attendees && obj.attendees.attendee && obj.attendees.attendee.outcome) {\n    obj['status'] = 'complete'\n  } else {\n    if (obj.status != 'started') {\n      obj['status'] = 'new'\n    }\n  }\n\n  // Create friendly time stamps\n  obj.shortTime = moment(obj.appointmentDateTime).format('HH:mm')\n  obj.shortEndTime = moment(obj.appointmentDateTime)\n    .add(obj.intendedDuration, 'minutes')\n    .format('HH:mm')\n\n  // No patientData means nothing more to process so continue.\n  var patientData = obj.patientData || null\n  if (patientData === null) {\n    obj['patientData'] = {\n      appointmentHistory: [],\n      dialogPlusForms: [],\n      progressNotes: [],\n      contacts: [],\n      allergies: [],\n      demographics: [],\n      alerts: [],\n      documents: [],\n      referrals: [],\n      mySafetyPlanForms: []\n    }\n    return false\n  }\n\n  if (patientData.patient) {\n    if (window.debug) {\n      debugger\n    }\n    patientData.patient.forEach(e => (e.birthDateFormatted = moment(e.birthDate).format('DD-MM-YYYY')))\n  }\n\n  if (window.debug) {\n    debugger\n  }\n\n  // Some helper mapping on DIALOG+ forms if we have any:\n  if (patientData.dialogPlusForms) {\n    patientData.dialogPlusForms.forEach((form, idx) => {\n      let dateFormat = 'ddd Do MMM'\n\n      // If we have any other entries with the same date, include the time.\n      if (patientData.dialogPlusForms.find(f => f.assessmentDate.result === form.assessmentDate.result)) {\n        dateFormat = 'ddd Do MMM HH:mm'\n      }\n\n      form.displayDate = form.assessmentDate && form.assessmentDate.result ? moment(form.assessmentDate.result).format(dateFormat) : ''\n      form.index = idx\n    })\n  }\n\n  var demographics = patientData.demographics || null\n\n  if (demographics === null) {\n    return false\n  }\n\n  // Set friendly formatted GP Details\n  //\n  // EDIT (LG): Re-work around this so that we can account for multiple healthcareProviders\n  var currentGP\n  var currentProvider\n\n  if (demographics.healthcareProvider.healthcareProvider && Array.isArray(demographics.healthcareProvider.healthcareProvider)) {\n    for (var i in demographics.healthcareProvider.healthcareProvider) {\n      var provider = demographics.healthcareProvider.healthcareProvider[i]\n\n      if (provider.endDate === '' || provider.endDate === undefined) {\n        currentGP = provider.generalPractioner.value\n        currentProvider = provider\n        break\n      }\n    }\n  } else {\n    currentGP = (demographics.healthcareProvider && demographics.healthcareProvider.healthcareProvider && demographics.healthcareProvider.healthcareProvider.generalPractioner && demographics.healthcareProvider.healthcareProvider.generalPractioner.value) || ''\n    currentProvider = demographics.healthcareProvider.healthcareProvider\n  }\n\n  var gp = currentGP\n\n  obj.gpDetails = (gp !== '' ? gp + ' (' : '') + (currentProvider && currentProvider.practice && currentProvider.practice.value) + (gp !== '' ? ')' : '')\n\n  // Set friendly formatted NHS number\n  if (!!demographics.nhsNumber) {\n    obj.nhsNumFormatted = demographics.nhsNumber.substring(0, 3) + ' ' + demographics.nhsNumber.substring(3, 6) + ' ' + demographics.nhsNumber.substring(6, 10)\n  } else {\n    obj.nhsNumFormatted = ''\n  }\n\n  // Set friendly formatted address\n  obj.addressFormatted = [obj.patientData.demographics.address.addressLine1 || '', obj.patientData.demographics.address.addressLine2 || '', obj.patientData.demographics.address.addressLine3 || '', obj.patientData.demographics.address.addressLine4 || '']\n    .filter(function(e) {\n      return e.length > 0\n    })\n    .join(', ')\n\n  // Set postcode for navigation\n  obj.postCode = (demographics.address && demographics.address.postCode) || ''\n\n  // Set patients age (note: now using moment for more precision)\n  var now = moment().format('YYYY-MM-DD')\n  obj.age = (demographics.birthDate && moment(now).diff(demographics.birthDate, 'years')) || ''\n}\n\nreturn appointments\n"},{"name":"fn_setPreviousDialogVals","type":"scripting","item-type":"function","_auto_id_":"d78cdbae-8275-47a7-923e-6bb24a165071","sync":true,"params":[{"name":"index","description":"Index of the DIALOG+ intance we want to set","required":true}],"content":"ct.f_setPreviousDialogVals(index);"},{"name":"fn_set_view","type":"scripting","item-type":"function","_auto_id_":"37611c81-0396-4a35-a251-859a1c12f244","sync":true,"params":[{"name":"view_name"},{"name":"manual_filter","description":"Passed true when clicked from the filer button"}],"content":"window.logManager.consoleLog(\n  'function fn_set_view(view_name, manualFilter)', \n  'info'\n)\n\nif (window.debug) {\n  debugger\n}\n\nif(view_name == \"Timeline\") {\n  \n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Timeline\"})\n  \n} else if(view_name == \"Patient Demographics\") {\n  \n  var patient = JSON.parse(JSON.stringify(cti.store.variables.selected_visit.patientData.demographics))\n  var array = []\n  patient.allergiesLength = cti.store.variables.selected_visit.patientData.allergies.length\n  patient.alertsLength = cti.store.variables.selected_visit.patientData.alerts.length\n  patient.age = cti.store.variables.selected_visit.age\n  patient.nhsNumFormatted = cti.store.variables.selected_visit.nhsNumFormatted\n  patient.age = cti.store.variables.selected_visit.age\n  patient.gpDetails = cti.store.variables.selected_visit.gpDetails\n  patient.postCode = cti.store.variables.selected_visit.postCode\n  patient.addressFormatted = cti.store.variables.selected_visit.addressFormatted\n  \n  patient.birthDate = moment(cti.store.variables.selected_visit.patientData.demographics.birthDate).format('DD MMM YYYY')\n  \n  if(patient.language === undefined) {\n    patient.language = {\n      code : null,\n      value : \"Not Specified\"\n    }\n  }\n  if(patient.nationality === undefined) {\n    patient.nationality = {\n      code : null,\n      value : \"Not Specified\"\n    }\n  }\n  \n\n  array.push(patient)\n  cti.store.variables.selected_visit.patientData.patient = array\n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  \n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Patient\"})\n  \n} else if(view_name == \"Alerts\") {\n  var alertsArray = JSON.parse(JSON.stringify(cti.store.variables.selected_visit.patientData.alerts))\n  \n  if(manual_filter) {\n    cti.store.variables.filter = \"open\"\n  } else {\n    if(cti.store.variables.filter === undefined) {\n      cti.store.variables.filter = \"open\"\n    } else if(cti.store.variables.filter === \"open\") {\n      cti.store.variables.filter = \"all\"\n    } else if(cti.store.variables.filter === \"all\") {\n      cti.store.variables.filter = \"open\"\n    }\n  }\n \n  if(cti.store.variables.filter === \"open\") {\n    for (var i = alertsArray.length; i-- > 0;) {\n      var thisAlert = alertsArray[i]\n\n      if (thisAlert.removalDate) {\n        alertsArray.splice(i, 1)\n      }\n    }\n    \n    if(alertsArray.length == 0) {\n      cti.store.variables.filter = \"all\"\n      alertsArray = JSON.parse(JSON.stringify(cti.store.variables.selected_visit.patientData.alerts))\n      cti.store.variables.selected_visit.patientData.displayAlerts = alertsArray\n    } else {\n      cti.store.variables.selected_visit.patientData.displayAlerts = alertsArray\n    }\n  } else {\n    cti.store.variables.selected_visit.patientData.displayAlerts = alertsArray\n  }\n  \n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Alerts\"})\n  \n} else if(view_name == \"Appointments\") {\n  \n  for(var i in cti.store.variables.selected_visit.patientData.appointmentHistory) {\n    var thisApp = cti.store.variables.selected_visit.patientData.appointmentHistory[i];\n    \n    if(thisApp.cancellationReason != \"\" || thisApp.comment != \"\" || thisApp.outcome != \"\") {\n      thisApp.rowClass = \"middle-row\";\n   \t} else {\n      thisApp.rowClass = \"bottom-row\";\n    }\n  }\n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Appointments\"})\n  \n} else if(view_name == \"Referrals\") {\n  \n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Referrals\"})\n  \n} else if(view_name == \"Progress Notes\") {\n  \n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Notes\"})\n  \n} else if(view_name == \"Documents\") {\n  \n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Documents\"})\n  \n} else if(view_name == \"Allergies\") {\n  \n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Allergies\"})\n  \n} else if(view_name == \"Contacts\") {\n  \n  delete cti.store.variables.selected_visit.patientData.displayAlerts\n  delete cti.store.variables.selected_visit.patientData.patient\n  cti.store.variables.visit_view_mode = view_name\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Contacts\"})\n  \n}\n  \ncti.utils.updatePage()"},{"name":"fn_showFreeSpinner","type":"scripting","item-type":"function","_auto_id_":"c21c255e-7b8c-4ee8-89f3-7953e52aac3f","sync":true,"params":[{"name":"displayMessage","description":"The message to display","default":"Loading..."}],"content":"const container = document.createElement('div')\ncontainer.classList.add('free-spinner')\n\nconst header = document.createElement('div')\nheader.classList.add('free-spinner-header')\n\nconst animation = document.createElement('div')\nanimation.classList.add('free-spinner-animation')\n\nconst message = document.createElement('div')\nmessage.classList.add('free-spinner-loading-message')\nmessage.innerHTML = displayMessage || 'Loading...'\n\ncontainer.appendChild(header)\ncontainer.appendChild(animation)\ncontainer.appendChild(message)\n\ndocument.body.appendChild(container)"},{"name":"fn_startActivityListener","type":"scripting","item-type":"function","_auto_id_":"86e261b2-bff0-425a-a369-d4b07fb9df9e","sync":true,"params":[],"content":"console.log(`fn_startActivityListener:: Setting up user activity event listener...defaulting to 15 mins...`)\n\n// Set default timeout here as 15 mins, this can be overwritten by the /getStaticData endpoint / actionflow. Data should be set in response.data.inactivityTimeout.\ncti.store.variables.inactivityTimeout = 15 * 60 * 1000\n\ndocument.body.addEventListener(\n  'click',\n  cti.fn_recordUserActivity,\n  false\n)\n\n// Fake user activity to kick off the initial timer.\ncti.utils.callActionflow('UserActivity')"},{"name":"fn_stopActivityListener","type":"scripting","item-type":"function","_auto_id_":"4e05e920-a0ec-421c-9865-d1889f1c584e","sync":true,"params":[],"content":"console.log(`fn_stopActivityListener`)\n\ndocument.body.removeEventListener(\n  'click',\n  cti.fn_recordUserActivity,\n  false\n)"},{"name":"fn_toggle_lifestyle","type":"scripting","item-type":"function","_auto_id_":"02cb599e-dd7d-4b8c-aa38-a24abde1cd6a","sync":true,"params":[{"name":"id"}],"content":"window.logManager.consoleLog(\n  'function fn_toggle_lifestyle(id)', \n  'info'\n);\n\nvar elm = document.getElementById(id)\nvar elementClasses = elm.classList\nvar navigateClass = elementClasses[2]\n\nif(navigateClass == \"fa-chevron-up\") {\n  elm.classList.remove(\"fa-chevron-up\")\n  elm.classList.add(\"fa-chevron-down\")\n  \n  if(id == \"smoking\") {\n    cti.store.variables.lifestyleHideFlags.smoking = true\n  } else if(id == \"diet\") {\n    cti.store.variables.lifestyleHideFlags.diet = true\n  } else if(id == \"exercise\") {\n    cti.store.variables.lifestyleHideFlags.exercise = true\n  } else if(id == \"alcohol\") {\n    cti.store.variables.lifestyleHideFlags.alcohol = true\n  } else if(id == \"drugs\") {\n    cti.store.variables.lifestyleHideFlags.drugs = true\n  } else if(id == \"other\") {\n    cti.store.variables.lifestyleHideFlags.other = true\n  }\n} else {\n  elm.classList.add(\"fa-chevron-up\")\n  elm.classList.remove(\"fa-chevron-down\")\n  \n  if(id == \"smoking\") {\n    cti.store.variables.lifestyleHideFlags.smoking = false\n  } else if(id == \"diet\") {\n    cti.store.variables.lifestyleHideFlags.diet = false\n  } else if(id == \"exercise\") {\n    cti.store.variables.lifestyleHideFlags.exercise = false\n  } else if(id == \"alcohol\") {\n    cti.store.variables.lifestyleHideFlags.alcohol = false\n  } else if(id == \"drugs\") {\n    cti.store.variables.lifestyleHideFlags.drugs = false\n  } else if(id == \"other\") {\n    cti.store.variables.lifestyleHideFlags.other = false\n  }\n}\n\ncti.utils.updatePage()"},{"name":"fn_toggle_dialog","type":"scripting","item-type":"function","_auto_id_":"0965d0b3-2e37-436a-88e8-f0da6d76e636","sync":true,"params":[{"name":"id"}],"content":"window.logManager.consoleLog(\n  'function fn_toggle_dialog(id)', \n  'info'\n)\n\nvar elm = document.getElementById(id)\nvar elementClasses = elm.classList\nvar navigateClass = elementClasses[2]\n\nif(navigateClass == \"fa-chevron-up\") {\n  elm.classList.remove(\"fa-chevron-up\")\n  elm.classList.add(\"fa-chevron-down\")\n  \n  if(id == \"assessment\") {\n    cti.store.variables.dialogHideFlags.assessment = true\n  } else if(id == \"mental\") {\n    cti.store.variables.dialogHideFlags.mental = true\n  } else if(id == \"physical\") {\n    cti.store.variables.dialogHideFlags.physical = true\n  } else if(id == \"job\") {\n    cti.store.variables.dialogHideFlags.job = true\n  } else if(id == \"accommodation\") {\n    cti.store.variables.dialogHideFlags.accommodation = true\n  } else if(id == \"leisure\") {\n    cti.store.variables.dialogHideFlags.leisure = true\n  } else if(id == \"family\") {\n    cti.store.variables.dialogHideFlags.family = true\n  } else if(id == \"friendships\") {\n    cti.store.variables.dialogHideFlags.friendships = true\n  } else if(id == \"personal\") {\n    cti.store.variables.dialogHideFlags.personal = true\n  } else if(id == \"finances\") {\n    cti.store.variables.dialogHideFlags.finances = true\n  } else if(id == \"identity\") {\n    cti.store.variables.dialogHideFlags.identity = true\n  } else if(id == \"substance\") {\n    cti.store.variables.dialogHideFlags.substance = true\n  } else if(id == \"medication\") {\n    cti.store.variables.dialogHideFlags.medication = true\n  } else if(id == \"practical\") {\n    cti.store.variables.dialogHideFlags.practical = true\n  } else if(id == \"meetings\") {\n    cti.store.variables.dialogHideFlags.meetings = true\n  }\n} else {\n  elm.classList.add(\"fa-chevron-up\")\n  elm.classList.remove(\"fa-chevron-down\")\n  \n  if(id == \"assessment\") {\n    cti.store.variables.dialogHideFlags.assessment = false\n  } else if(id == \"mental\") {\n    cti.store.variables.dialogHideFlags.mental = false\n  } else if(id == \"physical\") {\n    cti.store.variables.dialogHideFlags.physical = false\n  } else if(id == \"job\") {\n    cti.store.variables.dialogHideFlags.job = false\n  } else if(id == \"accommodation\") {\n    cti.store.variables.dialogHideFlags.accommodation = false\n  } else if(id == \"leisure\") {\n    cti.store.variables.dialogHideFlags.leisure = false\n  } else if(id == \"family\") {\n    cti.store.variables.dialogHideFlags.family = false\n  } else if(id == \"friendships\") {\n    cti.store.variables.dialogHideFlags.friendships = false\n  } else if(id == \"personal\") {\n    cti.store.variables.dialogHideFlags.personal = false\n  } else if(id == \"finances\") {\n    cti.store.variables.dialogHideFlags.finances = false\n  } else if(id == \"identity\") {\n    cti.store.variables.dialogHideFlags.identity = false\n  } else if(id == \"substance\") {\n    cti.store.variables.dialogHideFlags.substance = false\n  } else if(id == \"medication\") {\n    cti.store.variables.dialogHideFlags.medication = false\n  } else if(id == \"practical\") {\n    cti.store.variables.dialogHideFlags.practical = false\n  } else if(id == \"meetings\") {\n    cti.store.variables.dialogHideFlags.meetings = false\n  }\n}\n\ncti.utils.updatePage()"},{"name":"fn_view_lifestyle","type":"scripting","item-type":"function","_auto_id_":"70f9b7c7-7fdd-4b1b-84ed-58f753980c22","sync":true,"params":[{"name":"currentForm"}],"content":"window.logManager.consoleLog(\n    'function fn_view_lifestyle(currentForm)', \n    'info'\n  )\n  \n  cti.store.variables.v_lifestyleForms = []\n  var form = []\n  var editForms = []\n  \n  if(currentForm) {\n    cti.fn_toggle_spinner('open', 'Loading Completed Lifestyle Assessment Form...')\n    form = cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms[0]\n    var array = []\n    array.push(form)\n    editForms = JSON.parse(JSON.stringify(array))\n  } else {\n    cti.fn_toggle_spinner('open', 'Loading Lifestyle Assessment Forms...')\n    form = cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms\n    editForms = JSON.parse(JSON.stringify(form))\n  }\n  \n  for(var i in editForms) {\n    var thisForm = editForms[i]\n    var formObject = {}\n  \n    var mapping = [\n      { \"destination\" : \"lssmoked\", \"source\" : \"lssmoked\" },\n      { \"destination\" : \"lscigperday\", \"source\" : \"lscigperday\" },\n      { \"destination\" : \"smokeadvice\", \"source\" : \"smokeadvice\" },\n      { \"destination\" : \"Refsmoke\", \"source\" : \"refsmoke\" },\n      { \"destination\" : \"StopSmoke\", \"source\" : \"stopSmoke\" },\n      { \"destination\" : \"smokeintoffer\", \"source\" : \"smokeintoffer\" },\n      { \"destination\" : \"smokefreetext1\", \"source\" : \"smokefreetext1\" },\n      { \"destination\" : \"diethealthy\", \"source\" : \"diethealthy\" },\n      { \"destination\" : \"lsdietcomment\", \"source\" : \"lsdietcomment\" },\n      { \"destination\" : \"dietintervention\", \"source\" : \"dietintervention\" },\n      { \"destination\" : \"dietintdetails\", \"source\" : \"dietintdetails\" },\n      { \"destination\" : \"regularexercise\", \"source\" : \"regularexercise\", \"typeOverride\" : \"repeater\" },\n      { \"destination\" : \"exintoffer\", \"source\" : \"exintoffer\" },\n      { \"destination\" : \"intdetails\", \"source\" : \"intdetails\" },\n      { \"destination\" : \"alcCurrentUser\", \"source\" : \"alcCurrentUser\" },\n      { \"destination\" : \"withdrawal\", \"source\" : \"withdrawal\", \"sourceTypeOverride\" : \"multi\", \"typeOverride\" : \"multi-toString\" },\n      { \"destination\" : \"alcHowOften\", \"source\" : \"alcHowOften\" },\n      { \"destination\" : \"alcHowManyUnits\", \"source\" : \"alcHowManyUnits\" },\n      { \"destination\" : \"alcExceedUnits\", \"source\" : \"alcExceedUnits\" },\n      { \"destination\" : \"alcIntervention\", \"source\" : \"alcIntervention\" },\n      { \"destination\" : \"alcintdetail\", \"source\" : \"alcintdetail\" },\n      { \"destination\" : \"recdruguse\", \"source\" : \"recdruguse\", \"typeOverride\" : \"repeater\" },\n      { \"destination\" : \"drugintoffer\", \"source\" : \"drugintoffer\" },\n      { \"destination\" : \"drugintdetails\", \"source\" : \"drugintdetails\" },\n      { \"destination\" : \"menwellbeing\", \"source\" : \"menwellbeing\" },\n      { \"destination\" : \"signpost\", \"source\" : \"signpost\" },\n      { \"destination\" : \"signdetail\", \"source\" : \"signdetail\" },\n      { \"destination\" : \"addcomm\", \"source\" : \"addcomm\" },\n      { \"destination\" : \"YNPresent\", \"source\" : \"yhpresent\" },\n      { \"destination\" : \"admissionassess\", \"source\" : \"admissionassess\" },\n      { \"destination\" : \"SentCopy\", \"source\" : \"sentcopy\" },\n      { \"destination\" : \"assessmentstatus\", \"source\" : \"assessmentstatus\" },\n      { \"destination\" : \"assessmentDate\", \"source\" : \"assessmentDate\", \"typeOverride\" : \"date\" }\n    ]\n  \n    if (window.debug) {\n      debugger\n    }\n    \n    mapping.forEach(element => {\n      var sourceEntry = thisForm[element.source]\n  \n      if(sourceEntry != undefined) {\n        if(element.typeOverride && element.typeOverride == \"toString\") {\n          formObject[element.destination] = (sourceEntry.result || \"\").toString()\n        } else if(element.typeOverride && element.typeOverride == \"toInt\") {\n          if(sourceEntry.result != \"\") {\n            formObject[element.destination] = parseInt(sourceEntry.result)\n          } else {\n            formObject[element.destination] = 0\n          }\n        } else if(element.typeOverride && element.typeOverride == \"date\") {\n          if(sourceEntry.displayDate != \"\" && sourceEntry.displayDate != undefined) {\n            formObject[element.destination] = sourceEntry.displayDate\n          } else {\n            formObject[element.destination] = moment(sourceEntry.result).format('DD MMM YYYY hh:mmA')\n          }\n        } else {\n          if((sourceEntry.type && sourceEntry.type == \"multi\") || (element.sourceTypeOverride && element.sourceTypeOverride === \"multi\")) {\n            formObject[element.destination] = {\n              \"label\" : sourceEntry.resultString || \"\",\n              \"value\" : sourceEntry.result || \"\"\n            }\n  \n            if(element.typeOverride) {\n              if (element.typeOverride == \"repeater\") {\n                formObject[element.destination].repeater = sourceEntry.repeater\n              }\n              if (element.typeOverride == \"multi-toString\") {\n                formObject[element.destination].value = formObject[element.destination].value.toString()\n              }\n            }   \n          } else {\n            formObject[element.destination] = sourceEntry.result\n          }\n        }\n      } else {\n        formObject[element.destination] = \"\"\n      }\n    })\n  \n    cti.store.variables.v_lifestyleForms.push(formObject)\n  }\n  \n  if(cti.store.variables.v_lifestyleForms.length === 0) {\n    cti.fn_toggle_spinner('close')\n    cti.utils.callAction(\"show-notification\", {\n      \"name\": \"notification_warning\", \n      \"title\" : \"Warning: This patient currently has no Lifestyle Assessment Forms\", \n      \"text\" : \"The current patient does not have any previously submitted Lifestyle Assessment Forms.\"\n    })\n  } else {\n    cti.store.variables.lifestyleHideFlags = {\n      smoking : true,\n      diet : true,\n      exercise : true,\n      alcohol: true,\n      drugs: true,\n      other: true\n    }\n  \n    cti.utils.callAction(\"go-to-page\", {\"name\":\"LifestyleForm_View\"});\n  }","actions":[]},{"name":"fn_toggle_spinner","type":"scripting","item-type":"function","_auto_id_":"aa8f1181-8707-4e01-b5e9-52879149f436","sync":true,"params":[{"name":"orientation","description":"To dictate whether we are opening or closing the spinner","required":true},{"name":"message","description":"Message to display on the spinner"},{"name":"timeout","description":"Timeout period while data loads"}],"actions":[],"content":"window.logManager.consoleLog(\n  \"function fn_toggle_spinner(orientation, message, timeout)\",\n  \"info\"\n);\n\nif (orientation === \"open\") {\n  var spinner = document.querySelectorAll(\"load-spinner\");\n\n  if (spinner && spinner.length > 0) {\n    spinner[0].setAttribute(\"message\", message);\n    spinner[0].startSpin();\n    spinner[0].show();\n  }\n} else {\n  const closeSpinner = () => {\n    var spinner = document.querySelectorAll(\"load-spinner\");\n\n    if (spinner && spinner.length > 0) {\n      spinner[0].close();\n      spinner[0].stopSpin();\n    }\n  };\n  if (timeout) {\n    setTimeout(closeSpinner, timeout);\n  } else {\n    closeSpinner();\n  }\n}\n"},{"name":"fn_toggle_visit_menu","type":"scripting","item-type":"function","_auto_id_":"fe2fae25-2d57-4d0f-ac78-92d263951060","sync":true,"params":[{"name":"id"}],"content":"window.logManager.consoleLog(\n  'function fn_toggle_visit_menu(id)', \n  'info'\n);\n\nvar idx = JSON.parse(id);\nvar alreadyexpanded = ($('#group_visit_' + idx.$index + ' > div')[0].className.indexOf('row-expanded') > -1);\n$('#list_visits md-group > div').removeClass('row-expanded');\nif (!alreadyexpanded) {\n\t$('#group_visit_' + idx.$index + ' > div').toggleClass('row-expanded');\n}"},{"name":"fn_toggleModelBoolean","type":"scripting","item-type":"function","_auto_id_":"d82e4c2d-d33b-4ab6-acc6-e36af802bdb1","sync":true,"params":[{"name":"page","description":"The page the question lives on (yes, only pages atm)","required":true},{"name":"question","description":"The question to toggle (whether it exists already or not...)","required":true}],"content":"if (!page || !question) {\n  return\n}\n\nif (!cti.store.pages[page]) {\n  cti.store.pages[page] = {}\n\n  cti.store.pages[page][question] = true\n} else {\n  cti.store.pages[page][question] = !cti.store.pages[page][question]\n}"},{"name":"fn_top_scroll","type":"scripting","item-type":"function","_auto_id_":"9aaa5523-e92d-462d-8cf1-3018cf5ed285","sync":true,"params":[{"name":"id"}],"content":"window.logManager.consoleLog(\n  'function fn_top_scroll(id)', \n  'info'\n);\n\nvar objDiv = document.getElementById(id);\nobjDiv.scrollTop = 0;"},{"name":"fn_view_dialog","type":"scripting","item-type":"function","_auto_id_":"f049bcab-167c-48eb-bc15-98732db59a08","sync":true,"params":[{"name":"currentForm"}],"content":"window.logManager.consoleLog(\n  'function fn_view_dialog(currentForm)', \n  'info'\n)\n\ncti.fn_showFreeSpinner('Loading Dialog+ Forms...')\n\nif (cti.store.variables.selected_visit.patientData.dialogPlusForms) {\n  cti.store.variables.selected_visit.patientData.dialogPlusForms.forEach((form, idx) => {\n    let dateFormat = 'ddd Do MMM'\n\n    // If we have any other entries with the same date, include the time.\n    if (cti.store.variables.selected_visit.patientData.dialogPlusForms.find(f => f.assessmentDate.result === form.assessmentDate.result)) {\n      dateFormat = 'ddd Do MMM HH:mm'\n    }\n\n    form.displayDate = form.assessmentDate && form.assessmentDate.result ? moment(form.assessmentDate.result).format(dateFormat) : ''\n    form.index = idx\n  })\n}\n\ncti.store.variables.dialogIsReadOnly = true\ncti.utils.callAction(\"go-to-page\", {\"name\":\"DialogFormOne\"})"},{"name":"fn_view_safety","type":"scripting","item-type":"function","_auto_id_":"e5164d2c-f490-463b-80c9-7e3e3ab50270","sync":false,"params":[{"name":"currentForm"}],"content":"window.logManager.consoleLog(\n  'function fn_view_safety(currentForm)', \n  'info'\n)\n\ncti.store.variables.v_safetyForms = []\nvar form = []\nvar editForms = []\n\nif(currentForm) {\n  cti.fn_toggle_spinner('open', 'Loading Completed My Safety Plan Form...')\n  form = cti.store.variables.selected_visit.patientData.mySafetyPlanForms[0]\n  var array = []\n  array.push(form)\n  editForms = JSON.parse(JSON.stringify(array))\n} else {\n  cti.fn_toggle_spinner('open', 'Loading My Safety Plan Forms...')\n  form = cti.store.variables.selected_visit.patientData.mySafetyPlanForms\n  editForms = JSON.parse(JSON.stringify(form))\n}\n\nfor(var i in editForms) {\n  var thisForm = editForms[i]\n\n  var formObject = {\n    sf_triggers : thisForm.triggers.result || 'No data provided',\n    sf_triggers_actionplan : thisForm.triggersAp.result || 'No data provided',\n    sf_contact : thisForm.contact.result || 'No data provided',\n    sf_contactreach : thisForm.contReach.result || 'No data provided',\n    sf_outofcrisis : thisForm.outofCrisis.result || 'No data provided',\n    sf_earlyws : thisForm.earlyWs.result || 'No data provided',\n    sf_earlyws_actionplan : thisForm.earlyWsap.result || 'No data provided',\n    sf_getworse : thisForm.getWorse.result || 'No data provided',\n    sf_getworse_actionplan : thisForm.getWorseAp.result || 'No data provided',\n    sf_assisteddecision : thisForm.decisions.result || 'No data provided',\n    sf_advancedirective : thisForm.advDir.result == \"1\" ? true : false,\n    sf_serviceuseragreedplan : thisForm.suAgree.result == \"1\" ? true : false,\n    sf_crisisnumber : thisForm.crisisNo.result || 'No data provided',\n    sf_assessmentdate : moment(thisForm.assessmentDate.result).format('DD MMM YYYY hh:mmA') || 'No data provided'\n  }\n\n  cti.store.variables.v_safetyForms.push(formObject)\n}\n\nif(cti.store.variables.v_safetyForms.length === 0) {\n  cti.fn_toggle_spinner('close')\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: This patient currently has no Safety Forms\", \n    \"text\" : \"The current patient does not have any previously submitted Safety Forms.\"\n  })\n} else {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"SafetyForm_View\"});\n}"},{"name":"fn_update_patient_data","type":"scripting","item-type":"function","_auto_id_":"6912f128-f7fd-42af-97d0-fb6069a3a31b","sync":true,"params":[{"name":"clientId"},{"name":"type"},{"name":"data"},{"name":"appointmentId"}],"content":"window.logManager.consoleLog(\n  'function fn_update_patient_data(clientId, type, data)', \n  'info'\n)\n\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  if(doc.data && doc.data.length > 0) {\n    appointments = doc.data\n\n    for(var i in appointments) {\n      var thisAppointment = appointments[i]\n\n      if(thisAppointment.attendees.attendee.clientId.value == clientId) {\n        if(type == \"alerts\") {\n          thisAppointment.patientData.alerts = data\n        } else if(type == \"notes\") {\n          thisAppointment.patientData.progressNotes = data\n        } else if(type == \"lifestyle\") {\n          thisAppointment.patientData.lifestyleAssessmentForms = data\n          \n          for (var x in thisAppointment.patientData.lifestyleAssessmentForms) {\n            var lifestyleForm = thisAppointment.patientData.lifestyleAssessmentForms[x]\n            var date = lifestyleForm.assessmentDate.result\n\n            lifestyleForm.assessmentDate.displayDate = moment(date).format(\"DD MMM YYYY HH:mm\")\n          }\n\n          if(thisAppointment.appointmentId == appointmentId) {\n            thisAppointment.lifestyle_form_status = \"complete\"\n            thisAppointment.lifestyle_form_status_text = \"Completed\"\n\n            delete thisAppointment.lifestyle_form_page_one\n            delete thisAppointment.lifestyle_form_page_two\n            delete thisAppointment.lifestyle_form_page_three\n            delete thisAppointment.lifestyle_form_page_four\n            delete thisAppointment.lifestyle_form_page_five\n            delete thisAppointment.lifestyle_form_page_six\n          }\n        } else if(type == \"dialog\") {\n          thisAppointment.patientData.dialogPlusForms = data\n          \n          for (var x in thisAppointment.patientData.dialogPlusForms) {\n            var dialogPlusForm = thisAppointment.patientData.dialogPlusForms[x]\n            var date = dialogPlusForm.assessmentDate.result\n\n            dialogPlusForm.assessmentDate.displayDate = moment(date).format(\"DD MMM YYYY HH:mm\")\n          }\n\n          if(thisAppointment.appointmentId == appointmentId) {\n            thisAppointment.dialog_form_status = \"complete\"\n            thisAppointment.dialog_form_status_text = \"Completed\"\n\n            delete thisAppointment.dialog_form_page\n          }\n        } else if(type == \"safety\") {\n          thisAppointment.patientData.mySafetyPlanForms = data\n          \n          for (var x in thisAppointment.patientData.mySafetyPlanForms) {\n            var mySafetyPlanForm = thisAppointment.patientData.mySafetyPlanForms[x]\n            var date = mySafetyPlanForm.assessmentDate.result\n\n            mySafetyPlanForm.assessmentDate.displayDate = moment(date).format(\"DD MMM YYYY HH:mm\")\n          }\n\n          if(thisAppointment.appointmentId == appointmentId) {\n            thisAppointment.safety_form_status = \"complete\"\n            thisAppointment.safety_form_status_text = \"Completed\"\n\n            delete thisAppointment.safety_form_page\n          }\n        }\n      }\n    }\n  }\n\n  window.pouchManager.saveToDatabase(\n    \"appointments\", \n    appointments, function(rev) {\n      window.logManager.consoleLog(\n        'Pouch DB - Saved Appointment Data. Revision: ' + rev, \n        'info'\n      )\n    }, function(reason, e) {\n      window.logManager.consoleLog(\n        'Pouch DB - Failed to save Appointment Data - ' + reason, e, \n        'error'\n      )\n    })\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB - Appointments Pouch DB does not exisit, creating new instance... - ' + reason + err,\n    'Info'\n  )\n\n})"},{"name":"testPushResponse","type":"scripting","item-type":"function","_auto_id_":"b25df889-0bf6-406c-8ae0-f82f1015992c","sync":true,"params":[{"name":"notification","required":true}],"content":"window.logManager.consoleLog(\n  'function testPushResponse(notification)', \n  'info'\n);\n\nif (window.debug) {\n  debugger\n}\n\n/*\n{\n  \"event\": \"message\",\n  \"payload\": {\n    \"clientId\": {\n      \"type\": \"MRN\",\n      \"value\": \"RRRiO6MOD0922\"\n    },\n    \"notificationType\": \"AlertAdded\"\n  },\n  \"from\": \"888020801908\",\n  \"message\": \"Patient Updated\",\n  \"service\": \"GCM\"\n}\n*/\n\n/*\n{\n  \"event\": \"message\",\n  \"payload\": {\n    \"trustODSCode\": \"dev\",\n    \"appointments\": [\n      {\n        \"appointmentId\": 2008948\n      }\n    ],\n    \"notificationType\":\"AppointmentCancelled\"\n  },\n  \"from\": \"888020801908\",\n  \"message\": \"Patient Updated\",\n  \"service\": \"GCM\"\n}\n*/\n\n// Notifty user we are updating device data\ncti.fn_toggle_spinner('open', 'Update Received, refreshing Appointment list, please wait...');\n\n// Grab the response\nvar pushPayload = JSON.parse(notification)\n// COPY EVERYTHING BELOW THIS LINE TO NOTIFICATION ACTION\nvar notificationType = ''\n\ntry {\n  if (typeof pushPayload !== 'object') {\n    pushPayload = JSON.parse(pushPayload)\n  }\n\n  if (typeof pushPayload.payload !== 'object') {\n    if (pushPayload.payload.indexOf('AppointmentAdded') != -1 && pushPayload.payload.indexOf('\"AppointmentAdded\"') == -1) {\n      pushPayload.payload = pushPayload.payload.replace('AppointmentAdded', '\"AppointmentAdded\"')\n    }\n\n    pushPayload.payload = JSON.parse(pushPayload.payload)\n  }\n\n  if (pushPayload.payload && pushPayload.payload.notificationType) {\n    notificationType = pushPayload.payload.notificationType\n  } else {\n    notificationType = 'Error'\n  }\n\n  if (notificationType === 'AppointmentCancelled') {\n    // AppointmentCancelled: Remove the appointment from device, reload the\n    // appointments data and navigate user back to visits page\n\n    // Set the appointment to cancel\n    if (pushPayload.payload.appointmentId) {\n      cti.store.variables.appointmentId = pushPayload.payload.appointmentId.toString()\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Load appointments from pouch\n    window.pouchManager.loadFromDatabase(\n      'appointments',\n      function(doc) {\n        // Set the appointments array\n        var appointments = doc.data\n\n        // Find the appointment on device...\n        for (var i in appointments) {\n          if (appointments[i].appointmentId === cti.store.variables.appointmentId) {\n            // ... and remove it from the main array\n            appointments.splice(i, 1)\n            break\n          }\n        }\n\n        // Check that we aren't the the current visit, and if we are\n        // then remove the data\n        var selectedVisit = cti.store.variables.selected_visit\n\n        if (selectedVisit) {\n          if (selectedVisit.appointmentId === cti.store.variables.appointmentId) {\n            cti.store.variables.return = true\n          }\n        }\n\n        // Update the pouch DB with cancelled appointment\n        window.pouchManager.saveToDatabase(\n          'appointments',\n          appointments,\n          function(rev) {\n            var appointmentId = cti.store.variables.appointmentId\n            window.logManager.consoleLog('Pouch DB - Removed appointment ' + appointmentId + ' successfully. Revision: ' + rev, 'info')\n\n            if (cti.store.variables.return || cti.store.state.currentPage == 'Visits') {\n              cti.fn_load_appointments()\n            }\n\n            cti.fn_toggle_spinner('close', '')\n            delete cti.store.variables.appointmentId\n          },\n          function(reason, e) {\n            var appointmentId = cti.store.variables.appointmentId\n            window.logManager.consoleLog('Pouch DB - Error updating pouch for appointment ' + appointmentId + '. Reason: ' + reason + e, 'error')\n\n            if (cti.store.variables.return || cti.store.state.currentPage == 'Visits') {\n              cti.fn_load_appointments()\n            }\n\n            cti.fn_toggle_spinner('close')\n            delete cti.store.variables.appointmentId\n          }\n        )\n      },\n      function(reason, err) {\n        window.logManager.consoleLog('Pouch DB - Failed retrieving Appointments Data from Pouch - ', reason + err, 'error')\n\n        cti.fn_toggle_spinner('close')\n        delete cti.store.variables.appointmentId\n      }\n    )\n  } else if (notificationType === 'AppointmentUpdated' || notificationType === 'AppointmentOutcomed') {\n    // AppointmentUpdated or AppointmentOutcomed: set the global payload to contain\n    // the appointmentId and the exists flag (true in this case)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.appointmentId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'appointment',\n        appointmentId: pushPayload.payload.appointmentId,\n        appointmentExists: true\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' })\n  } else if (notificationType === 'AppointmentAdded') {\n    // AppointmentAdded: set the global payload to contain\n    // the appointmentId and the exists flag (false in this case)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.appointmentId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'appointment',\n        appointmentId: pushPayload.payload.appointmentId,\n        appointmentExists: false\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' })\n  } else if (notificationType === 'DemographicUpdated' || notificationType === 'GPUpdated' || notificationType === 'AddressUpdated') {\n    // DemographicUpdated, GPUpdated, AddressUpdated, DeathRegistered: set the global payload to contain\n    // the appointmentId and the exists flag (true for the demographics flag)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.clientId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'patient',\n        clientId: pushPayload.payload.clientId,\n        appointmentExists: false,\n        includeDemographics: true\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' })\n  } else if (notificationType == 'DeathRegistered') {\n    // DeathRegistered: Remove any appointments from device, reload the\n    // appointments data and navigate user back to visits page\n\n    // Set the patient to remove\n    if (pushPayload.payload.clientId) {\n      cti.store.variables.clientId = pushPayload.payload.clientId\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Load appointments from pouch\n    window.pouchManager.loadFromDatabase(\n      'appointments',\n      function(doc) {\n        // Set the appointments array\n        var appointments = doc.data\n\n        // Find the appointments on device for the patient...\n        for (var i in appointments) {\n          if (appointments[i].attendees.attendee.clientId.value == cti.store.variables.clientId.value) {\n            // ... and remove them from the main array\n            appointments.splice(i, 1)\n          }\n        }\n\n        // Check that we aren't the the current visit, and if we are\n        // then remove the data\n        var selectedVisit = cti.store.variables.selected_visit\n\n        if (selectedVisit) {\n          if (selectedVisit.attendees.attendee.clientId.value == cti.store.variables.clientId.value) {\n            cti.store.variables.return = true\n          }\n        }\n\n        // Update the pouch DB with cancelled appointment\n        window.pouchManager.saveToDatabase(\n          'appointments',\n          appointments,\n          function(rev) {\n            var app = cti.store.variables.clientId.value\n            window.logManager.consoleLog('Pouch DB - Removed patient appointments ' + app + ' successfully. Revision: ' + rev, 'info')\n\n            if (cti.store.variables.return || cti.store.state.currentPage === 'Visits') {\n              cti.fn_load_appointments()\n            }\n\n            cti.fn_toggle_spinner('close', '')\n            delete cti.store.variables.clientId\n          },\n          function(reason, e) {\n            var app = cti.store.variables.clientId.value\n            window.logManager.consoleLog('Pouch DB - Error updating pouch for appointment ' + app + '. Reason: ' + reason + e, 'error')\n\n            cti.fn_toggle_spinner('close')\n            delete cti.store.variables.clientId\n          }\n        )\n      },\n      function(reason, err) {\n        window.logManager.consoleLog('Pouch DB - Failed retriveing Appointments Data from Pouch - ', reason + err, 'error')\n\n        cti.fn_toggle_spinner('close')\n        delete cti.store.variables.clientId\n      }\n    )\n  } else if (notificationType === 'AllergyAdded' || notificationType === 'AllergyRemoved') {\n    // AllergyAdded, AllergyRemoved: set the global payload to contain\n    // the appointmentId and the exists flag (true for the allergies flag)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.clientId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'patient',\n        clientId: pushPayload.payload.clientId,\n        appointmentExists: false,\n        includeAllergies: true\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' })\n  } else if (notificationType === 'AlertAdded' || notificationType === 'AlertRemoved') {\n    // AlertAdded, AlertRemoved: set the global payload to contain\n    // the appointmentId and the exists flag (true for the alerts flag)\n\n    // Check that we have a value appointmentId\n    if (pushPayload.payload.clientId) {\n      cti.store.variables.pushDataPayload = {\n        pushType: 'patient',\n        clientId: pushPayload.payload.clientId,\n        appointmentExists: false,\n        includeAlerts: true\n      }\n    } else {\n      cti.fn_toggle_spinner('close', '')\n      return false\n    }\n\n    // Call the GetAppointment ActionFlow\n    cti.utils.callAction('call-actionflow', { name: 'GetPushData' })\n  } else {\n    cti.fn_toggle_spinner('close')\n  }\n} catch (e) {\n  cti.utils.callAction('show-notification', {\n    name: 'notification_warning',\n    title: 'Catch Error',\n    text: e\n  })\n  cti.fn_toggle_spinner('close', '')\n}\n"},{"name":"orientation","type":"scripting","item-type":"variable","_auto_id_":"ff995e12-b350-45d6-bdd4-620a2d80d294","variable-type":"string"},{"name":"visit_view_mode","type":"scripting","item-type":"variable","_auto_id_":"f39581dd-c358-49f0-bb82-d9cb14ac9e18","variable-type":"string"},{"name":"visit_list_view_mode","type":"scripting","item-type":"variable","_auto_id_":"67024457-3ad2-4bc9-848a-7c25bed3ef4c","variable-type":"string","value":"list"},{"name":"show_advanced_note","type":"scripting","item-type":"variable","_auto_id_":"9b8f14a4-8f42-4556-ba09-d5771b1fea4f","variable-type":"boolean","value":"false"},{"name":"show_advanced_appt","type":"scripting","item-type":"variable","_auto_id_":"edf0457a-d580-4667-85f4-18ef943cddff","variable-type":"boolean","value":"false"},{"name":"auth_header","type":"scripting","item-type":"variable","_auto_id_":"fa1c2d7f-0a10-47bc-b92c-9f1b18874197","variable-type":"string"},{"name":"v_free_slots","type":"scripting","item-type":"variable","_auto_id_":"bd3dc03e-1399-422e-8ef1-0f44a69ecad7","variable-type":"string"},{"name":"v_dialog_plus_questions","type":"scripting","item-type":"variable","_auto_id_":"50a9aad3-4046-4321-84d0-5cd98ebd21c5","variable-type":"string"},{"name":"api_rio","type":"integration","item-type":"api","_auto_id_":"ff9cc79e-2ce6-4da5-a512-b85cacffe69d","headers":{},"params":[],"operations":[{"name":"getappointments","method":"POST","path":"/getappointments","summary":"Gets a list of appointments with patient data","params":[{"name":"Authorization","type":"string","description":"Base64 encoded username and password","in":"header","required":true},{"name":"applicationkey","description":"The application key","type":"string","typeConfig":{},"in":"header","required":true},{"name":"id","description":"HCP id","type":"string","typeConfig":{},"in":"body","required":true},{"name":"fromDate","description":"Range of appointments from date","type":"string","typeConfig":{},"in":"body","required":true},{"name":"toDate","description":"Range of appointments to date","type":"string","typeConfig":{},"in":"body","required":true}],"responses":[],"$open":false,"ttlMinutes":60,"content-type":""},{"name":"authenticate","method":"POST","path":"/authenticate","summary":"Authenticates a user","params":[{"name":"Authorization","type":"string","description":"Base64 encoded username and password","in":"header","required":true},{"name":"applicationkey","description":"Used to determine which API to connect to","type":"string","typeConfig":{},"in":"header","required":true}],"responses":[],"$open":false,"ttlMinutes":60,"content-type":""},{"ttlMinutes":60,"name":"setappointmenteta","summary":"Specify an ETA at which the HCP expects to arrive at the appointment location","path":"/setappointmenteta","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Base64 encoded username and password","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"application key specific for using our API","type":"string","typeConfig":{},"in":"header","required":true},{"name":"appointmentId","description":"Visit Appointment id","type":"string","typeConfig":{},"in":"body","required":true},{"name":"eta","description":"Arrival ETA","type":"string","typeConfig":{},"in":"body","required":true}]},{"ttlMinutes":60,"name":"alerttypes","summary":"Static Data for Alert Types","path":"/staticdata/alerttypes","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"alertpriorities","summary":"Alert Priorities Static Data","path":"/staticdata/alertpriorities","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"path":"/alerts","name":"getalerts","summary":"Refresh Alerts List","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body","required":true}],"$open":false},{"ttlMinutes":60,"name":"getbookingrefdata","summary":"Get Static Reference Data for Booking an Appointment","path":"/staticdata/appointmentbookingreferencedata","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"diarytemplate","summary":"Diary Template Static Data","path":"/staticdata/diarytemplate","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"teamplannerreferencedata","summary":"teamplannerreferencedata","path":"/staticdata/teamplannerreferencedata","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"teams","description":"teams","type":"string","typeConfig":{},"in":"body","required":true}]},{"ttlMinutes":60,"name":"busydiaryslots","summary":"Get user's busy slots","path":"/bookings/busydiaryslots","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"fromDate","description":"fromDate","type":"string","typeConfig":{},"in":"body","required":true},{"name":"toDate","description":"toDate","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnoteconfig","summary":"Get the Progress Note Configuration","path":"/getprogressnoteconfiguration","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnotetypes","summary":"Get Note Types","path":"/getprogressnotetypes","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnotespecialites","summary":"Get Note Specialites","path":"/getprogressnotespecialites","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnoterisktypes","summary":"Get Note Risk Types","path":"/getprogressnoterisktypes","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"outcomesave","summary":"Saves outcome of visit","path":"/appointments/outcomesave","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getdocument","summary":"Gets individual document data","path":"/getdocument","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header base64","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}]},{"ttlMinutes":60,"name":"getstaticdata","summary":"Pulls back all static data in one call","path":"/staticdata","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header","required":true}]},{"ttlMinutes":60,"name":"submitsafetyform","summary":"Submits the safety form","path":"/mysafetyplan/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"submitdialogform","summary":"Submits dialog+ form","path":"/dialogplus/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"submitlifestyleform","summary":"Submit lifestyle form","path":"/lifestyleassessment/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"addprogressnote","summary":"Add a progress note","path":"/addprogressnote","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"alertsadd","summary":"Add an alert","path":"/alerts/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"removealert","path":"/alerts/remove","summary":"Remove single alert","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"path":"/getappointment","name":"getappointment","summary":"Gets a single appointment from a PUSH notification call","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"pushDataPayload","description":"Appointment ID","type":"string","typeConfig":{},"in":"body"}],"$open":true}],"url":"https://infinity.api.servelechsc.com/api/v3","definitions":{}},{"name":"api_rio_main","type":"integration","item-type":"api","_auto_id_":"33748468-35df-4740-8680-6f451735be13","headers":{},"params":[],"operations":[{"ttlMinutes":60,"name":"pushRegister","summary":"Registers the device for push notifications.","path":"/push/register","method":"POST","content-type":"application/json","$open":false,"params":[{"name":"os","description":"Operating system the request is being sent from","type":"string","typeConfig":{},"in":"body"},{"name":"notificationToken","description":"Device's unique token registered against the relevant service.","type":"string","typeConfig":{},"in":"body"},{"description":"The username of the currently logged in user - for targetted notifications.","name":"username","type":"string","typeConfig":{},"in":"body"},{"description":"If this user / device combo is already registered, the saved ID.","name":"registeredPushId","type":"string","typeConfig":{},"in":"body"},{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"}]},{"ttlMinutes":60,"name":"pushDeregister","path":"/push/deregister","summary":"Deregisters the user and device from the push notification service.","method":"POST","content-type":"application/json","$open":true,"params":[{"description":"If this user / device combo is already registered, the saved ID.","name":"registeredPushId","type":"string","typeConfig":{},"in":"body","required":true},{"name":"tags","description":"The tags registered by this device - in this case, the username.","type":"string","typeConfig":{},"in":"body"},{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header","required":true}]}],"url":"https://infinity.api.servelechsc.com/api"},{"name":"api_rio_offline","type":"integration","item-type":"offline-api","_auto_id_":"e3100357-1301-4eee-982a-02d7257ac7ad","headers":{},"params":[],"operations":[{"ttlMinutes":1000,"name":"addHCPAppointment","summary":"Add new HCP appointment","path":"/appointments/add","method":"POST","content-type":"application/json","$open":false,"params":[{"name":"payload","description":"Appointment payload","type":"string","typeConfig":{},"in":"body","required":true},{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"}]},{"ttlMinutes":60,"name":"addTPAppointment","summary":"Add a new Team Planner appointment","path":"/appointments/teamadd","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getappointment","summary":"Gets an updated singular appointment without the patientData","path":"/getappointment","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"appointmentId","description":"Appointment ID","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":30,"name":"outcomesave","summary":"End visit","path":"/appointments/outcomesave","method":"POST","content-type":"application/json","$open":true,"params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}]},{"ttlMinutes":30,"path":"/mysafetyplan/add","name":"submitsafetyform","summary":"Submit safety form","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":30,"name":"submitdialogform","summary":"Submit dialog form","path":"/dialogplus/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":30,"name":"submitlifestyleform","summary":"Submit lifestyle form","path":"/lifestyleassessment/add","method":"POST","content-type":"application/json","$open":true,"params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}]},{"ttlMinutes":30,"name":"addnote","summary":"Add progress note","path":"/addprogressnote","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":true},{"ttlMinutes":30,"name":"addalert","summary":"Add alert","path":"/alerts/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":true},{"ttlMinutes":30,"name":"removealert","summary":"Remove alert","path":"/alerts/remove","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}],"$open":true}],"url":"https://infinity.api.servelechsc.com/api/v3","definitions":{}},{"name":"api_rio_offline_main","type":"integration","item-type":"offline-api","_auto_id_":"5e944fe4-e097-4c9c-a50b-fc7d414e79c6","headers":{},"params":[],"operations":[{"ttlMinutes":60,"name":"pushRegister","summary":"Registers the device for push notifications.","path":"/push/register","method":"POST","content-type":"application/json","params":[{"name":"os","description":"Operating system the request is being sent from","type":"string","typeConfig":{},"in":"body","required":true},{"name":"notificationToken","description":"Device's unique token registered against the relevant service.","type":"string","typeConfig":{},"in":"body","required":true},{"name":"username","description":"The username of the currently logged in user - for targetted notifications.","type":"string","typeConfig":{},"in":"body","required":true},{"name":"registeredPushId","description":"If this user / device combo is already registered, the saved ID.","type":"string","typeConfig":{},"in":"body"},{"name":"Authorization","description":"Base64 encoded username and password","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"pushDeregister","summary":"Deregisters the user / device from the push notification service.","path":"/push/deregister","method":"POST","content-type":"application/json","$open":true,"params":[{"name":"registeredPushId","description":"If this user / device combo is already registered, the saved ID.","type":"string","typeConfig":{},"in":"body","required":true},{"name":"tags","description":"The tags registered by this device - in this case, the username.","type":"string","typeConfig":{},"in":"body"},{"name":"Authorization","description":"Base64 encoded username and password","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}]}],"url":"https://infinity.api.servelechsc.com/api"},{"name":"url_google_maps","type":"integration","item-type":"url","_auto_id_":"99606cfa-4927-4aab-92cd-6ab72e962172","params":{},"target":"_system","url":"http://maps.google.com/"},{"name":"notification_error","type":"notification","item-type":"app-notification","_auto_id_":"cf63ce44-16b9-458b-91ea-193c9afb1e24","options":{"autoDismiss":true},"style":"error"},{"name":"notification_info","type":"notification","item-type":"app-notification","_auto_id_":"418171e5-8009-4f8f-a133-497c6b69bb68","options":{"autoDismiss":true},"style":"success"},{"name":"notification_success","type":"notification","item-type":"app-notification","_auto_id_":"8b78ba02-4727-403e-bfa2-4c4b69abdc60","options":{"autoDismiss":true},"style":"success"},{"name":"notification_warning","type":"notification","item-type":"app-notification","_auto_id_":"8b5715bf-9908-40b7-98a4-b5975d10d9a6","options":{"autoDismiss":true},"style":"warning"},{"name":"noUiSliderCSS","type":"style","item-type":"css-asset","_auto_id_":"1fe223eb-9d19-45bc-bb31-ed99d848be94","fileName":"nouislider.min.css"},{"name":"font_opensans","type":"style","item-type":"font-asset","_auto_id_":"1f8cd6ea-7dcb-4503-8818-9eb7e56c24a0","fileName":"OpenSans-Regular.ttf"},{"name":"font_opensans_light","type":"style","item-type":"font-asset","_auto_id_":"49937495-4d70-4dba-bbf8-9c958aa0ef5b","fileName":"OpenSans-Light.ttf"},{"name":"css_main","type":"style","item-type":"css-asset","_auto_id_":"488967a5-4bd6-4b52-ba9c-978d74bf588d","fileName":"servelec.css"},{"name":"image_rio_logo","type":"style","item-type":"image-asset","_auto_id_":"89dea4f3-c423-4e7e-a8a8-3b8a40de8e78","fileName":"RiO oceano o Logo.jpg"},{"name":"image_servelec_logo","type":"style","item-type":"image-asset","_auto_id_":"6d030ecb-5ab3-4797-8b4f-ec56a756683c","fileName":"Servelec hsc Logo - RGB.JPG"},{"name":"image_splash","type":"style","item-type":"image-asset","_auto_id_":"6bdf425d-97ca-436f-b8b4-3421db0de522","fileName":"newriopage.png"},{"name":"image_pin","type":"style","item-type":"image-asset","_auto_id_":"62dc3282-89ff-42d3-96ef-b00f8aa908ac","fileName":"pin.png"},{"name":"image_safety","type":"style","item-type":"image-asset","_auto_id_":"7e3576ed-6cb2-4862-8635-8a3ff8d73e15","fileName":"thin-0635_anti_virus_protection_shield.png"},{"name":"image_dialog","type":"style","item-type":"image-asset","_auto_id_":"cb3b2616-5191-4a17-8f7b-6d15d4d4f2c1","fileName":"thin-0064_bullet_list_view.png"},{"name":"image_lifestyle","type":"style","item-type":"image-asset","_auto_id_":"1b232ceb-3f4f-411b-8dc8-6bc1a934288d","fileName":"thin-0842_fitness_running.png"},{"name":"image_medicine","type":"style","item-type":"image-asset","_auto_id_":"e26dc941-01e4-470c-bbf5-040c55051682","fileName":"thin-0820_medicine_drugs_ill_pill.png"},{"name":"image_referral","type":"style","item-type":"image-asset","_auto_id_":"0b1032df-8914-44f4-bc48-adb0e139bd07","fileName":"thin-0825_stetoscope_doctor_hospital_ill.png"},{"name":"image_admission","type":"style","item-type":"image-asset","_auto_id_":"96d37b07-2d9f-4bed-976c-d8860cbf6a37","fileName":"thin-0823_hospital_ill_medicine_doctor_ambulance.png"},{"name":"image_vte","type":"style","item-type":"image-asset","_auto_id_":"d190680f-a104-4679-a2ca-ea06b54dba5a","fileName":"thin-0815_lungs_breathing.png"},{"name":"image_timeline","type":"style","item-type":"image-asset","_auto_id_":"396cdc17-cfe6-4c39-925b-dd71f5f55b34","fileName":"thin-0117_folder_documents_revert_history.png"},{"name":"image_alerts","type":"style","item-type":"image-asset","_auto_id_":"9f0fd3f9-f77a-4044-94ad-e30eae9862fc","fileName":"thin-0550_attention_error_alert_caution.png"},{"name":"image_documents","type":"style","item-type":"image-asset","_auto_id_":"fad17b99-7240-40ec-8f1d-aba5bab2eddf","fileName":"thin-0073_documents_files_paper_text_archive_copy.png"},{"name":"image_appointments","type":"style","item-type":"image-asset","_auto_id_":"ca808029-f4b7-4c03-93c7-ac0622011b4b","fileName":"thin-0023_calendar_month_day_planner_events.png"},{"name":"image_mha","type":"style","item-type":"image-asset","_auto_id_":"7d2f098c-ce28-4e02-9937-6c5a9a5c0f55","fileName":"thin-0026_time_watch_clock.png"},{"name":"image_contacts","type":"style","item-type":"image-asset","_auto_id_":"bb99e399-8591-47bd-a394-3d99f8b61b87","fileName":"thin-0301_address_book_contacts.png"},{"name":"image_progress","type":"style","item-type":"image-asset","_auto_id_":"6a286242-0da6-49e2-8976-07847b05df15","fileName":"thin-0003_write_pencil_new_edit.png"},{"name":"image_allergies","type":"style","item-type":"image-asset","_auto_id_":"34927d85-70a3-46d9-bd8a-e8c988ac0aed","fileName":"thin-0816_microscope_laboratory.png"},{"name":"image_patient","type":"style","item-type":"image-asset","_auto_id_":"92887b73-99fc-4edd-9d2c-652de57cc908","fileName":"thin-0708_user_profile.png"},{"name":"image_tasks","type":"style","item-type":"image-asset","_auto_id_":"379e363f-0905-4ee1-9d24-117247b1b19d","fileName":"thin-0102_notebook_to_do_bullets_list.png"},{"name":"alert_icon","type":"style","item-type":"image-asset","_auto_id_":"2094a016-4438-4992-936e-5e70fa228f6f","fileName":"alert_icon.svg"},{"name":"allergy_icon","type":"style","item-type":"image-asset","_auto_id_":"5dc19083-4d4e-459f-bd7f-705738d94251","fileName":"allergy_icon.svg"},{"name":"handset_icon","type":"style","item-type":"image-asset","_auto_id_":"90d0eec3-c0fb-477c-b9c7-fd906245215e","fileName":"handset_icon.png"},{"name":"location","type":"style","item-type":"image-asset","_auto_id_":"22fc0c57-f15d-465f-92ce-05ecba99d661","fileName":"location.png"},{"name":"icon_close","type":"style","item-type":"image-asset","_auto_id_":"0ac6c8de-f2d6-4947-a797-d575f74a7d40","fileName":"icon_close.png"},{"name":"icon_close_svg","type":"style","item-type":"image-asset","_auto_id_":"d8440a57-fe46-4ca5-93f6-d4c9446528ea","fileName":"close_icon.svg"},{"name":"checkboxSliderReplacement","type":"style","item-type":"css","_auto_id_":"8c8b0544-35a1-4740-86fc-a7c7898a2f6c","content":".radioButtons input {\n    display:none;\n}\n.radioButtons label {\n    padding: 15px;\n    border: 1px solid;\n}\n\n.radioButtons {\n    width:100%;\n    text-align: center;\n    margin-bottom: 3%;\n}\n\n.radioButtons input[type=radio]:checked + label {\n    background-color:#2C9A42;\n}"},{"name":"preventClicksDialogPlus","type":"style","item-type":"css","_auto_id_":"9fd8722b-5422-484d-9383-2b6a0cadaae6","content":".avoid-clicks {\n  pointer-events: none;\n  background-color: lightgray;\n  opacity: 0.65;\n}\n"},{"name":"visitIconTransparentBG","type":"style","item-type":"css","_auto_id_":"7abb5e98-33ea-488a-8d48-b06ffbcbf01f","content":"div#Visit #scrollable_menu .summary .icon {\n background-color:transparent !important; \n}\ndiv#Visit .row.summary {\n margin: 0px 5px !important; \n}"},{"name":"nativeDatePickers","type":"style","item-type":"css","_auto_id_":"a6f2c889-77f7-4c94-b23b-82f488aafb30","content":"#note-date{\n \twidth: 100%;\n    background: white;\n    height: 35px;\n    -webkit-appearance: none;\n    border-radius: 5px;\n    padding: 10px;\n\tmargin-bottom: 20px; \n    outline: none;\n    border-color: rgb(202, 202, 202);\n}"},{"name":"image_alerts_semi","type":"style","item-type":"image-asset","_auto_id_":"16418353-b8cc-496c-b2bf-689de97e588e","fileName":"thin-0550_attention_error_alert_caution_semi.png"},{"name":"warning_persistent","type":"notification","item-type":"app-notification","_auto_id_":"7262ffc9-a747-4ed3-a0bc-86191425d9bd","options":{"autoDismiss":false},"style":"warning","actions":[]},{"name":"appt_or_patient_update","type":"notification","item-type":"push-event","_auto_id_":"15e300c3-0df8-4b32-b75d-00b2268be1e0","operations":[],"actions":[{"event":"push-received","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog('pushNotification - Push Notification Received', 'info')\n\nif (window.debug) {\n  debugger\n}\n\nvar push = $data.$notification\n\nif (typeof push !== 'object') {\n  cti.store.variables.incomingPush = JSON.parse(push) \n} else {\n  cti.store.variables.incomingPush = push\n}\n\nconsole.log(`Push Data: ${cti.store.variables.incomingPush}`)\n\ncti.fn_processPush(push)\n"},"_auto_id_":"b1ac86c8-f44e-41e9-8c93-992b273facc0","actions":[]}]}],"components":[{"name":"ct_popup_box","description":"","icon":"fa-puzzle-piece","_auto_id_":"606531b4-9a85-4f06-b7ce-52e3902da20a","tagName":"ct-popup-box","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"id","description":"","type":"string","enum":null,"required":true}],"functions":[{"name":"toggle","description":"Toggles the menu opened and closed based on the value\nof the this.opened property (initially set to false)","params":[{"name":"containerid","description":"id of container the popup is in","type":"string","enum":null,"required":true}],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"ct_popup_box.js","transpiled":"ct_popup_box.output.js"}},{"name":"ct_context_menu","description":"","icon":"fa-puzzle-piece","_auto_id_":"1fa0aab1-7b03-413d-b3e0-433405059753","tagName":"ct-context-menu","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"MinWidth","description":"","type":"number","enum":null,"required":false},{"name":"Direction","description":"","type":"string","enum":null,"required":false},{"name":"Overlay","description":"","type":"boolean","enum":null,"required":false}],"functions":[{"name":"toggle","description":"Toggles the page opened and closed based on the value\nof the this.opened property (initially set to false)","params":[],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"ct_context_menu.js","transpiled":"ct_context_menu.output.js"}},{"name":"activity_spinner","description":"","icon":"fa-puzzle-piece","_auto_id_":"0d99e205-ae61-431d-85d1-6a3702fa694b","tagName":"load-spinner","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"message","description":"A message to display whilst the spinner is showing","type":"string","enum":null,"required":false}],"functions":[{"name":"show","description":"Invoke the spinner","params":[],"returnType":"void","returnEnum":null},{"name":"close","description":"Remove/hide the spinner","params":[],"returnType":"void","returnEnum":null},{"name":"startSpin","description":"Add the 'spinner' class to start the animation","params":[],"returnType":"void","returnEnum":null},{"name":"stopSpin","description":"Remove the 'spinner' class to prevent animation in the backgroud","params":[],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"activity_spinner.js","transpiled":"activity_spinner.output.js"}},{"name":"photo_manager","description":"","icon":"fa-puzzle-piece","_auto_id_":"c909563e-7265-4dea-9113-de3314af7d2e","tagName":"photo-manager","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"captureWidth","description":"Width restriction on captured photos","type":"number","enum":null,"required":false},{"name":"captureHeight","description":"Height restriction on captured photos","type":"number","enum":null,"required":false},{"name":"captureQuality","description":"QUality setting for captured photos","type":"number","enum":["50","75","90","100"],"required":false},{"name":"captureCategory","description":"Optional category identifier to assign to photos when captured.","type":"string","enum":null,"required":false},{"name":"displayCategory","description":"Optional category on which to filter display of photos","type":"string","enum":null,"required":false},{"name":"maxPhotos","description":"Maximum number of photos that can be captured in this category (default is 3)","type":"number","enum":null,"required":false}],"events":[{"name":"captureComplete","description":"Fired when a photo has been captured","type":"void","enum":null},{"name":"editPhoto","description":"Fired when user selects edit option","type":"void","enum":null},{"name":"maxPhotosTaken","description":"Fired when we have taken the maximum number of photos in this category","type":"void","enum":null}],"functions":[{"name":"takePhoto","description":"Take a photo","params":[{"name":"filename","description":"A filename to allocate to the capture photo","type":"string","enum":null,"required":false}],"returnType":"void","returnEnum":null},{"name":"deletePhoto","description":"Delete a photo","params":[{"name":"id","description":"The internal id of the photo to remove","type":"string","enum":null,"required":true}],"returnType":"void","returnEnum":null},{"name":"clearPhotos","description":"Clear photos","params":[],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"photo_manager.js","transpiled":"photo_manager.output.js"}},{"name":"cti_radio_buttons","description":"","icon":"fa-puzzle-piece","_auto_id_":"48eb4683-12b3-4299-a31e-d2f721d0fa7b","tagName":"cti-radio-buttons","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"questionText","description":"Question description","type":"string","enum":null,"required":false},{"name":"selectedValue","description":"Selected value to allow us to preselect if the value exists in the store","type":"string","enum":null,"required":false}],"events":[{"name":"radioPressed","description":"Emitted when a value changes in the component","type":"void","enum":null},{"name":"connected","description":"Emitted when the element has connected","type":"void","enum":null}]},"userConfig":{},"valid":true,"files":{"original":"cti_radio_buttons.js","transpiled":"cti_radio_buttons.output.js"}},{"name":"cti_slider","description":"","icon":"fa-puzzle-piece","_auto_id_":"93f9a77a-705f-4dc5-8740-370c65706076","tagName":"cti-slider","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"readOnly","description":"Question description","type":"boolean","enum":null,"required":false},{"name":"historicOnly","description":"Whether we should only display historic data - i.e. no useable slider.","type":"boolean","enum":null,"required":false},{"name":"sliderID","description":"id for the slider div to allow multiple per page","type":"string","enum":null,"required":false},{"name":"questionText","description":"text to be displayed above the slider","type":"string","enum":null,"required":false},{"name":"rangeMin","description":"lowest value on the slider","type":"number","enum":null,"required":false},{"name":"rangeMax","description":"highest value on the slider","type":"number","enum":null,"required":false},{"name":"roundToSteps","description":"bind function to round slider to closest step","type":"boolean","enum":null,"required":false},{"name":"currentDot","description":"whether or not a 'current' dot should be rendered","type":"string","enum":null,"required":false},{"name":"previousDot","description":"whether or not a 'previous' dot should be rendered","type":"string","enum":null,"required":false},{"name":"storeLocation","description":"toggle to write slider data back to this location in the cti store","type":"string","enum":null,"required":false},{"name":"previousValue","description":"pass the value entered in a previous dialog+ form to show second bar","type":"string","enum":null,"required":false},{"name":"debounceOverride","description":"change the standard debounce from 500ms","type":"number","enum":null,"required":false}],"events":[{"name":"connected","description":"Emitted when the element has connected","type":"void","enum":null},{"name":"disconnected","description":"Emitted when the element has disconnected","type":"void","enum":null},{"name":"sliderValueChanged","description":"throw the new value","type":"void","enum":null}]},"userConfig":{},"valid":true,"files":{"original":"cti_slider.js","transpiled":"cti_slider.output.js"}}],"lastSchemaUpgradeDate":"WNGRADED_MANUALLY_FROM_24_TO_22_BY_KEVIN_FREEMAN","icondata":"rio_logo.png","jwt":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBfaWQiOiJmZGZkODljYi01NDZjLTQyMTItODVmNy1kODQ4ZGMzN2EwNzUiLCJhcHBfbmFtZSI6IkNvbW11bml0eV9Xb3JrZXIiLCJidWlsZF9pZCI6IjE3OTJiZTY3LTNlMzEtNGRmMi05NDU0LWI0YjUzMGRhYzhkNiIsImNsaWVudF9pZCI6Ijc3ZGJmY2YyLWQwMWYtNDUwOS05ZTFiLTlhY2E5ZjE1OGM0NCIsImNsaWVudF9zZWNyZXQiOiJOR1UwVGpaV01sVndjMWw2VEdnMlJ6SktURGxLUVQwOSIsImV4cCI6MTU1MjAwMzIwMCwiZnJlcXVlbmN5IjoyMTYwMDAwMDAsImhhc2giOiI0NjFmZGJiNjFlYjJkY2NlYTA4NDY4ODgwM2NiY2E2ZDY4NjQ0MzE2YmIxYjVhZTIyYzc4MjU5OTM4MTRlN2Q2IiwibGljX2V4cCI6MTU0OTQxMTIwMCwibHBfaWQiOiI2MmY3ZDE4My1mZTIxLTQyZGItYjNiNy0yNjc2NmUyNzY5NWQiLCJwYWNrYWdlX2lkIjoiY29tLnNlcnZlbGVjLmVsZnQuY29tbXVuaXR5d29ya2VyIiwicmVmcmVzaF90b2tlbiI6ImJsRXJRMnBMUmxwcVVHUm1SVTQzZFN0QmVEaFRiM1JvVDA5eFFUUlVWV1JJWjFSRWJWQnVhMFZXWnowPSIsInR5cGUiOiJmdWxsIiwiaWF0IjoxNTM2ODQzNTU1fQ.kksT-Hee4OB83OLFE6QSHI2fE8fx3Ay2tRe2D0DUErwTEhQBqsSrkfIDNydiHRGLKAu9mFaN0a1RKHFY-nnrsLS8l7uVZVJYdc9RH5Oym9xQ9aUa4f8ZPomJ4ZEDfXJODGyodZwwJVYTbePd5tnC2h30DZOkAi1YOAPC7vgqdc4GByubK2HPAG8r9E5pfS4wTH7bSl7_a3JDLscrB60SwcDsoKfRb9niQzpsiVdobZSesJqkwnDs_B86hd5ACTKxvdDBVtREkRcPEip8fOF_JiWtjeMfJQoMFx4hZlqeMxNekuNvOpsRfFhS02rRW9xJP1kFeMJKezhOKmbku_UjBQ","buildId":"1792be67-3e31-4df2-9454-b4b530dac8d6","hostContext":0}